const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/latency-chart-Bj5OSYzg.es-BSmZYl0D.js","assets/index-BSR7YrIA.js","assets/index-BKz5hrV6.css"])))=>i.map(i=>d[i]);
import{g as ed,j as b,b as v,t as ac,d as cc,_ as td,e as nd,u as sd}from"./index-BSR7YrIA.js";import id from"./Loader-BR6Ae3rj.js";import{u as rd}from"./useQuery-Bls-ed2C.js";import{a as od,g as ad}from"./Api-9Y_Rk4KA.js";import{a as Bs,b as wn,d as on,e as xt,f as cd,g as lc,h as Hi,_ as ld,j as ud,i as dd,c as Le}from"./tslib.es6-C5pfz3D-.js";function hd(e,t){for(var n=0;n<t.length;n++){const s=t[n];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in e)){const r=Object.getOwnPropertyDescriptor(s,i);r&&Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}const fd="_videoCallContainer_17p3b_1",pd={videoCallContainer:fd};let uc=!0,dc=!0;function Fn(e,t,n){const s=e.match(t);return s&&s.length>=n&&parseFloat(s[n],10)}function un(e,t,n){if(!e.RTCPeerConnection)return;const s=e.RTCPeerConnection.prototype,i=s.addEventListener;s.addEventListener=function(o,a){if(o!==t)return i.apply(this,arguments);const c=u=>{const d=n(u);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(a,c),i.apply(this,[o,c])};const r=s.removeEventListener;s.removeEventListener=function(o,a){if(o!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(a))return r.apply(this,arguments);const c=this._eventMap[t].get(a);return this._eventMap[t].delete(a),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[o,c])},Object.defineProperty(s,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function md(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(uc=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function gd(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(dc=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function hc(){if(typeof window=="object"){if(uc)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function qr(e,t){dc&&console.warn(e+" is deprecated, please use "+t+" instead.")}function bd(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(Fn(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(Fn(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(Fn(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=Fn(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function Ao(e){return Object.prototype.toString.call(e)==="[object Object]"}function fc(e){return Ao(e)?Object.keys(e).reduce(function(t,n){const s=Ao(e[n]),i=s?fc(e[n]):e[n],r=s&&!Object.keys(i).length;return i===void 0||r?t:Object.assign(t,{[n]:i})},{}):e}function fr(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(s=>{s.endsWith("Id")?fr(e,e.get(t[s]),n):s.endsWith("Ids")&&t[s].forEach(i=>{fr(e,e.get(i),n)})}))}function Do(e,t,n){const s=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const r=[];return e.forEach(o=>{o.type==="track"&&o.trackIdentifier===t.id&&r.push(o)}),r.forEach(o=>{e.forEach(a=>{a.type===s&&a.trackId===o.id&&fr(e,a,i)})}),i}const No=hc;function pc(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const s=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const d=typeof a[u]=="object"?a[u]:{ideal:a[u]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const p=function(l,h){return l?l+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(d.ideal!==void 0){c.optional=c.optional||[];let l={};typeof d.ideal=="number"?(l[p("min",u)]=d.ideal,c.optional.push(l),l={},l[p("max",u)]=d.ideal,c.optional.push(l)):(l[p("",u)]=d.ideal,c.optional.push(l))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[p("",u)]=d.exact):["min","max"].forEach(l=>{d[l]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[p(l,u)]=d[l])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},i=function(a,c){if(t.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const u=function(d,p,l){p in d&&!(l in d)&&(d[l]=d[p],delete d[p])};a=JSON.parse(JSON.stringify(a)),u(a.audio,"autoGainControl","googAutoGainControl"),u(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=s(a.audio)}if(a&&typeof a.video=="object"){let u=a.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const d=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete a.video.facingMode;let p;if(u.exact==="environment"||u.ideal==="environment"?p=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(l=>{l=l.filter(m=>m.kind==="videoinput");let h=l.find(m=>p.some(f=>m.label.toLowerCase().includes(f)));return!h&&l.length&&p.includes("back")&&(h=l[l.length-1]),h&&(a.video.deviceId=u.exact?{exact:h.deviceId}:{ideal:h.deviceId}),a.video=s(a.video),No("chrome: "+JSON.stringify(a)),c(a)})}a.video=s(a.video)}return No("chrome: "+JSON.stringify(a)),c(a)},r=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,u){i(a,d=>{n.webkitGetUserMedia(d,c,p=>{u&&u(r(p))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,u=>a(u).then(d=>{if(u.audio&&!d.getAudioTracks().length||u.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(r(d))))}}}function vd(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(s){return t(s).then(i=>{const r=s.video&&s.video.width,o=s.video&&s.video.height,a=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:a||3}},r&&(s.video.mandatory.maxWidth=r),o&&(s.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(s)})}}}function mc(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function gc(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",i=>{let r;e.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):r={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[s.stream],this.dispatchEvent(o)}),s.stream.getTracks().forEach(i=>{let r;e.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===i.id):r={track:i};const o=new Event("track");o.track=i,o.receiver=r,o.transceiver={receiver:r},o.streams=[s.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else un(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function bc(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=i.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,c){let u=i.apply(this,arguments);return u||(u=t(this,a),this._senders.push(u)),u};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(t(this,o))})};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],s.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(i=>i._pc=this),s},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function vc(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,i,r]=arguments;if(arguments.length>0&&typeof s=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof s!="function"))return t.apply(this,[]);const o=function(c){const u={};return c.result().forEach(p=>{const l={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(h=>{l[h]=p.stat(h)}),u[l.id]=l}),u},a=function(c){return new Map(Object.keys(c).map(u=>[u,c[u]]))};if(arguments.length>=2){const c=function(u){i(a(o(u)))};return t.apply(this,[c,s])}return new Promise((c,u)=>{t.apply(this,[function(d){c(a(o(d)))},u])}).then(i,r)}}function Sc(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=s.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>Do(o,r.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),un(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>Do(r,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const s=arguments[0];let i,r,o;return this.getSenders().forEach(a=>{a.track===s&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===s&&(r?o=!0:r=a),a.track===s)),o||i&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function yc(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(p=>p.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(u=>a.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],s.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function Cc(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return yc(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(p=>this._reverseStreams[p.id])};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(p=>{if(this.getSenders().find(h=>h.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const p=new e.MediaStream(d.getTracks());this._streams[d.id]=p,this._reverseStreams[p.id]=d,d=p}s.apply(this,[d])};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},e.RTCPeerConnection.prototype.addTrack=function(d,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const l=[].slice.call(arguments,1);if(l.length!==1||!l[0].getTracks().find(f=>f===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[p.id];if(m)m.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const f=new e.MediaStream([d]);this._streams[p.id]=f,this._reverseStreams[f.id]=p,this.addStream(f)}return this.getSenders().find(f=>f.track===d)};function r(u,d){let p=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(l=>{const h=u._reverseStreams[l],m=u._streams[h.id];p=p.replace(new RegExp(m.id,"g"),h.id)}),new RTCSessionDescription({type:d.type,sdp:p})}function o(u,d){let p=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(l=>{const h=u._reverseStreams[l],m=u._streams[h.id];p=p.replace(new RegExp(h.id,"g"),m.id)}),new RTCSessionDescription({type:d.type,sdp:p})}["createOffer","createAnswer"].forEach(function(u){const d=e.RTCPeerConnection.prototype[u],p={[u](){const l=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[m=>{const f=r(this,m);l[0].apply(null,[f])},m=>{l[1]&&l[1].apply(null,m)},arguments[2]]):d.apply(this,arguments).then(m=>r(this,m))}};e.RTCPeerConnection.prototype[u]=p[u]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=c.get.apply(this);return u.type===""?u:r(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let l;Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(f=>d.track===f)&&(l=this._streams[h])}),l&&(l.getTracks().length===1?this.removeStream(this._reverseStreams[l.id]):l.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function pr(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const s=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function Tc(e,t){un(e,"negotiationneeded",n=>{const s=n.target;if(!((t.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")&&s.signalingState!=="stable"))return n})}const Lo=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Tc,shimAddTrackRemoveTrack:Cc,shimAddTrackRemoveTrackWithNative:yc,shimGetDisplayMedia:vd,shimGetSendersWithDtmf:bc,shimGetStats:vc,shimGetUserMedia:pc,shimMediaStream:mc,shimOnTrack:gc,shimPeerConnection:pr,shimSenderReceiverGetStats:Sc},Symbol.toStringTag,{value:"Module"}));function kc(e,t){const n=e&&e.navigator,s=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,r,o){qr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(r,o)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},r=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),r(o)},s&&s.prototype.getSettings){const o=s.prototype.getSettings;s.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(s&&s.prototype.applyConstraints){const o=s.prototype.applyConstraints;s.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function Sd(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(s){if(!(s&&s.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return s.video===!0?s.video={mediaSource:t}:s.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(s)})}function wc(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mr(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const r=e.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return s.apply(this,[r||null]).then(c=>{if(t.version<53&&!o)try{c.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;c.forEach((d,p)=>{c.set(p,Object.assign({},d,{type:n[d.type]||d.type}))})}return c}).then(o,a)}}function Ec(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function _c(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(i=>i._pc=this),s}),un(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ic(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){qr("removeStream","removeTrack"),this.getSenders().forEach(s=>{s.track&&n.getTracks().includes(s.track)&&this.removeTrack(s)})})}function Rc(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Pc(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const i=s.length>0;i&&s.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(i){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=s,o.sendEncodings=s,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function xc(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const s=t.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function Oc(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Ac(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const Mo=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Pc,shimCreateAnswer:Ac,shimCreateOffer:Oc,shimGetDisplayMedia:Sd,shimGetParameters:xc,shimGetUserMedia:kc,shimOnTrack:wc,shimPeerConnection:mr,shimRTCDataChannel:Rc,shimReceiverGetStats:_c,shimRemoveStream:Ic,shimSenderGetStats:Ec},Symbol.toStringTag,{value:"Module"}));function Dc(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(i=>t.call(this,i,s)),s.getVideoTracks().forEach(i=>t.call(this,i,s))},e.RTCPeerConnection.prototype.addTrack=function(s,...i){return i&&i.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(n);if(s===-1)return;this._localStreams.splice(s,1);const i=n.getTracks();this.getSenders().forEach(r=>{i.includes(r.track)&&this.removeTrack(r)})})}}function Nc(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const r=new Event("addstream");r.stream=i,this.dispatchEvent(r)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(r)>=0)return;s._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,s.dispatchEvent(o)})}),t.apply(s,arguments)}}}function Lc(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,s=t.createAnswer,i=t.setLocalDescription,r=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(u,d){const p=arguments.length>=2?arguments[2]:arguments[0],l=n.apply(this,[p]);return d?(l.then(u,d),Promise.resolve()):l},t.createAnswer=function(u,d){const p=arguments.length>=2?arguments[2]:arguments[0],l=s.apply(this,[p]);return d?(l.then(u,d),Promise.resolve()):l};let a=function(c,u,d){const p=i.apply(this,[c]);return d?(p.then(u,d),Promise.resolve()):p};t.setLocalDescription=a,a=function(c,u,d){const p=r.apply(this,[c]);return d?(p.then(u,d),Promise.resolve()):p},t.setRemoteDescription=a,a=function(c,u,d){const p=o.apply(this,[c]);return d?(p.then(u,d),Promise.resolve()):p},t.addIceCandidate=a}function Mc(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,s=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>s(jc(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(s,i,r){t.mediaDevices.getUserMedia(s).then(i,r)}).bind(t))}function jc(e){return e&&e.video!==void 0?Object.assign({},e,{video:fc(e.video)}):e}function Fc(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(s,i){if(s&&s.iceServers){const r=[];for(let o=0;o<s.iceServers.length;o++){let a=s.iceServers[o];a.urls===void 0&&a.url?(qr("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(s.iceServers[o])}s.iceServers=r}return new t(s,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function Uc(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $c(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(s){if(s){typeof s.offerToReceiveAudio<"u"&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):s.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof s.offerToReceiveVideo<"u"&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):s.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Vc(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const jo=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Vc,shimCallbacksAPI:Lc,shimConstraints:jc,shimCreateOfferLegacy:$c,shimGetUserMedia:Mc,shimLocalStreamsAPI:Dc,shimRTCIceServerUrls:Fc,shimRemoteStreamsAPI:Nc,shimTrackEventTransceiver:Uc},Symbol.toStringTag,{value:"Module"}));var qi={exports:{}},Fo;function yd(){return Fo||(Fo=1,function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(s=>s.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const s=t.splitSections(n);return s&&s[0]},t.getMediaSections=function(n){const s=t.splitSections(n);return s.shift(),s},t.matchPrefix=function(n,s){return t.splitLines(n).filter(i=>i.indexOf(s)===0)},t.parseCandidate=function(n){let s;n.indexOf("a=candidate:")===0?s=n.substring(12).split(" "):s=n.substring(10).split(" ");const i={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let r=8;r<s.length;r+=2)switch(s[r]){case"raddr":i.relatedAddress=s[r+1];break;case"rport":i.relatedPort=parseInt(s[r+1],10);break;case"tcptype":i.tcpType=s[r+1];break;case"ufrag":i.ufrag=s[r+1],i.usernameFragment=s[r+1];break;default:i[s[r]]===void 0&&(i[s[r]]=s[r+1]);break}return i},t.writeCandidate=function(n){const s=[];s.push(n.foundation);const i=n.component;i==="rtp"?s.push(1):i==="rtcp"?s.push(2):s.push(i),s.push(n.protocol.toUpperCase()),s.push(n.priority),s.push(n.address||n.ip),s.push(n.port);const r=n.type;return s.push("typ"),s.push(r),r!=="host"&&n.relatedAddress&&n.relatedPort&&(s.push("raddr"),s.push(n.relatedAddress),s.push("rport"),s.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(s.push("ufrag"),s.push(n.usernameFragment||n.ufrag)),"candidate:"+s.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let s=n.substring(9).split(" ");const i={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),i.name=s[0],i.clockRate=parseInt(s[1],10),i.channels=s.length===3?parseInt(s[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let s=n.payloadType;n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+s+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const s=n.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const s={};let i;const r=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<r.length;o++)i=r[o].trim().split("="),s[i[0].trim()]=i[1];return s},t.writeFmtp=function(n){let s="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const r=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?r.push(o+"="+n.parameters[o]):r.push(o)}),s+="a=fmtp:"+i+" "+r.join(";")+`\r
`}return s},t.parseRtcpFb=function(n){const s=n.substring(n.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},t.writeRtcpFb=function(n){let s="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(r=>{s+="a=rtcp-fb:"+i+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),s},t.parseSsrcMedia=function(n){const s=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,s),10)},r=n.indexOf(":",s);return r>-1?(i.attribute=n.substring(s+1,r),i.value=n.substring(r+1)):i.attribute=n.substring(s+1),i},t.parseSsrcGroup=function(n){const s=n.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(i=>parseInt(i,10))}},t.getMid=function(n){const s=t.matchPrefix(n,"a=mid:")[0];if(s)return s.substring(6)},t.parseFingerprint=function(n){const s=n.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},t.getDtlsParameters=function(n,s){return{role:"auto",fingerprints:t.matchPrefix(n+s,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,s){let i="a=setup:"+s+`\r
`;return n.fingerprints.forEach(r=>{i+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),i},t.parseCryptoLine=function(n){const s=n.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const s=n.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,s){return t.matchPrefix(n+s,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,s){const i=t.matchPrefix(n+s,"a=ice-ufrag:")[0],r=t.matchPrefix(n+s,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(n){let s="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(s+=`a=ice-lite\r
`),s},t.parseRtpParameters=function(n){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(n)[0].split(" ");s.profile=r[2];for(let a=3;a<r.length;a++){const c=r[a],u=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(u){const d=t.parseRtpMap(u),p=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(d.parameters=p.length?t.parseFmtp(p[0]):{},d.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),s.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(d.name.toUpperCase());break}}}t.matchPrefix(n,"a=extmap:").forEach(a=>{s.headerExtensions.push(t.parseExtmap(a))});const o=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return s.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),s},t.writeRtpDescription=function(n,s){let i="";i+="m="+n+" ",i+=s.codecs.length>0?"9":"0",i+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=s.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(o=>{i+=t.writeRtpMap(o),i+=t.writeFmtp(o),i+=t.writeRtcpFb(o)});let r=0;return s.codecs.forEach(o=>{o.maxptime>r&&(r=o.maxptime)}),r>0&&(i+="a=maxptime:"+r+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(o=>{i+=t.writeExtmap(o)}),i},t.parseRtpEncodingParameters=function(n){const s=[],i=t.parseRtpParameters(n),r=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=t.matchPrefix(n,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname"),c=a.length>0&&a[0].ssrc;let u;const d=t.matchPrefix(n,"a=ssrc-group:FID").map(l=>l.substring(17).split(" ").map(m=>parseInt(m,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(u=d[0][1]),i.codecs.forEach(l=>{if(l.name.toUpperCase()==="RTX"&&l.parameters.apt){let h={ssrc:c,codecPayloadType:parseInt(l.parameters.apt,10)};c&&u&&(h.rtx={ssrc:u}),s.push(h),r&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},s.push(h))}}),s.length===0&&c&&s.push({ssrc:c});let p=t.matchPrefix(n,"b=");return p.length&&(p[0].indexOf("b=TIAS:")===0?p=parseInt(p[0].substring(7),10):p[0].indexOf("b=AS:")===0?p=parseInt(p[0].substring(5),10)*1e3*.95-50*40*8:p=void 0,s.forEach(l=>{l.maxBitrate=p})),s},t.parseRtcpParameters=function(n){const s={},i=t.matchPrefix(n,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(s.cname=i.value,s.ssrc=i.ssrc);const r=t.matchPrefix(n,"a=rtcp-rsize");s.reducedSize=r.length>0,s.compound=r.length===0;const o=t.matchPrefix(n,"a=rtcp-mux");return s.mux=o.length>0,s},t.writeRtcpParameters=function(n){let s="";return n.reducedSize&&(s+=`a=rtcp-rsize\r
`),n.mux&&(s+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(s+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),s},t.parseMsid=function(n){let s;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return s=i[0].substring(7).split(" "),{stream:s[0],track:s[1]};const r=t.matchPrefix(n,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(r.length>0)return s=r[0].value.split(" "),{stream:s[0],track:s[1]}},t.parseSctpDescription=function(n){const s=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const o=t.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:s.fmt,maxMessageSize:r};const a=t.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:r}}},t.writeSctpDescription=function(n,s){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&i.push("a=max-message-size:"+s.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,s,i){let r;const o=s!==void 0?s:2;return n?r=n:r=t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,s){const i=t.splitLines(n);for(let r=0;r<i.length;r++)switch(i[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[r].substring(2)}return s?t.getDirection(s):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const s=t.splitLines(n);for(let i=0;i<s.length;i++)if(s[i].length<2||s[i].charAt(1)!=="=")return!1;return!0},e.exports=t}(qi)),qi.exports}var Bc=yd();const Sn=ed(Bc),Cd=hd({__proto__:null,default:Sn},[Bc]);function xs(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&(s=JSON.parse(JSON.stringify(s)),s.candidate=s.candidate.substring(2)),s.candidate&&s.candidate.length){const i=new t(s),r=Sn.parseCandidate(s.candidate);for(const o in r)o in i||Object.defineProperty(i,o,{value:r[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(s)},e.RTCIceCandidate.prototype=t.prototype,un(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function gr(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||un(e,"icecandidate",t=>{if(t.candidate){const n=Sn.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Os(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Sn.splitSections(a.sdp);return c.shift(),c.some(u=>{const d=Sn.parseMLine(u);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},s=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const u=parseInt(c[1],10);return u!==u?-1:u},i=function(a){let c=65536;return t.browser==="firefox"&&(t.version<57?a===-1?c=16384:c=2147483637:t.version<60?c=t.version===57?65535:65536:c=2147483637),c},r=function(a,c){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);const d=Sn.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?u=parseInt(d[0].substring(19),10):t.browser==="firefox"&&c!==-1&&(u=2147483637),u},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=s(arguments[0]),u=i(c),d=r(arguments[0],c);let p;u===0&&d===0?p=Number.POSITIVE_INFINITY:u===0||d===0?p=Math.max(u,d):p=Math.min(u,d);const l={};Object.defineProperty(l,"maxMessageSize",{get(){return p}}),this._sctp=l}return o.apply(this,arguments)}}function As(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(s,i){const r=s.send;s.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(s.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return r.apply(s,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},un(e,"datachannel",s=>(t(s.channel,s.target),s))}function br(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const s=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const r=i.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const o=new Event("connectionstatechange",i);r.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function vr(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t._safariVersion>=13.1)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function Ds(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Ns(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const Td=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:vr,shimAddIceCandidateNullOrEmpty:Ds,shimConnectionState:br,shimMaxMessageSize:Os,shimParameterlessSetLocalDescription:Ns,shimRTCIceCandidate:xs,shimRTCIceCandidateRelayProtocol:gr,shimSendThrowTypeError:As},Symbol.toStringTag,{value:"Module"}));function kd({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=hc,s=bd(e),i={browserDetails:s,commonShim:Td,extractVersion:Fn,disableLog:md,disableWarnings:gd,sdp:Cd};switch(s.browser){case"chrome":if(!Lo||!pr||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(s.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Lo,Ds(e,s),Ns(e),pc(e,s),mc(e),pr(e,s),gc(e),Cc(e,s),bc(e),vc(e),Sc(e),Tc(e,s),xs(e),gr(e),br(e),Os(e,s),As(e),vr(e,s);break;case"firefox":if(!Mo||!mr||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Mo,Ds(e,s),Ns(e),kc(e,s),mr(e,s),wc(e),Ic(e),Ec(e),_c(e),Rc(e),Pc(e),xc(e),Oc(e),Ac(e),xs(e),br(e),Os(e,s),As(e);break;case"safari":if(!jo||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=jo,Ds(e,s),Ns(e),Fc(e),$c(e),Lc(e),Dc(e),Nc(e),Uc(e),Mc(e),Vc(e),xs(e),gr(e),Os(e,s),As(e),vr(e,s);break;default:n("Unsupported browser!");break}return i}kd({window:typeof window>"u"?void 0:window});function On(e){let t=typeof e;if(t=="object"){if(Array.isArray(e))return"array";if(e===null)return"null"}return t}function Hs(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}let Lt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),vi=[];for(let e=0;e<Lt.length;e++)vi[Lt[e].charCodeAt(0)]=e;vi[45]=Lt.indexOf("+");vi[95]=Lt.indexOf("/");function wd(e){let t=e.length*3/4;e[e.length-2]=="="?t-=2:e[e.length-1]=="="&&(t-=1);let n=new Uint8Array(t),s=0,i=0,r,o=0;for(let a=0;a<e.length;a++){if(r=vi[e.charCodeAt(a)],r===void 0)switch(e[a]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:o=r,i=1;break;case 1:n[s++]=o<<2|(r&48)>>4,o=r,i=2;break;case 2:n[s++]=(o&15)<<4|(r&60)>>2,o=r,i=3;break;case 3:n[s++]=(o&3)<<6|r,i=0;break}}if(i==1)throw Error("invalid base64 string.");return n.subarray(0,s)}function Ed(e){let t="",n=0,s,i=0;for(let r=0;r<e.length;r++)switch(s=e[r],n){case 0:t+=Lt[s>>2],i=(s&3)<<4,n=1;break;case 1:t+=Lt[i|s>>4],i=(s&15)<<2,n=2;break;case 2:t+=Lt[i|s>>6],t+=Lt[s&63],n=0;break}return n&&(t+=Lt[i],t+="=",n==1&&(t+="=")),t}var qs;(function(e){e.symbol=Symbol.for("protobuf-ts/unknown"),e.onRead=(n,s,i,r,o)=>{(t(s)?s[e.symbol]:s[e.symbol]=[]).push({no:i,wireType:r,data:o})},e.onWrite=(n,s,i)=>{for(let{no:r,wireType:o,data:a}of e.list(s))i.tag(r,o).raw(a)},e.list=(n,s)=>{if(t(n)){let i=n[e.symbol];return s?i.filter(r=>r.no==s):i}return[]},e.last=(n,s)=>e.list(n,s).slice(-1)[0];const t=n=>n&&Array.isArray(n[e.symbol])})(qs||(qs={}));function _d(e,t){return Object.assign(Object.assign({},e),t)}var Ie;(function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"})(Ie||(Ie={}));function Id(){let e=0,t=0;for(let s=0;s<28;s+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<s,(i&128)==0)return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(n&15)<<28,t=(n&112)>>4,(n&128)==0)return this.assertBounds(),[e,t];for(let s=3;s<=31;s+=7){let i=this.buf[this.pos++];if(t|=(i&127)<<s,(i&128)==0)return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function Wi(e,t,n){for(let r=0;r<28;r=r+7){const o=e>>>r,a=!(!(o>>>7)&&t==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const s=e>>>28&15|(t&7)<<4,i=t>>3!=0;if(n.push((i?s|128:s)&255),!!i){for(let r=3;r<31;r=r+7){const o=t>>>r,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(t>>>31&1)}}const Ls=65536*65536;function Hc(e){let t=e[0]=="-";t&&(e=e.slice(1));const n=1e6;let s=0,i=0;function r(o,a){const c=Number(e.slice(o,a));i*=n,s=s*n+c,s>=Ls&&(i=i+(s/Ls|0),s=s%Ls)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),[t,s,i]}function Sr(e,t){if(t>>>0<=2097151)return""+(Ls*t+(e>>>0));let n=e&16777215,s=(e>>>24|t<<8)>>>0&16777215,i=t>>16&65535,r=n+s*6777216+i*6710656,o=s+i*8147497,a=i*2,c=1e7;r>=c&&(o+=Math.floor(r/c),r%=c),o>=c&&(a+=Math.floor(o/c),o%=c);function u(d,p){let l=d?String(d):"";return p?"0000000".slice(l.length)+l:l}return u(a,0)+u(o,a)+u(r,1)}function Uo(e,t){if(e>=0){for(;e>127;)t.push(e&127|128),e=e>>>7;t.push(e)}else{for(let n=0;n<9;n++)t.push(e&127|128),e=e>>7;t.push(1)}}function Rd(){let e=this.buf[this.pos++],t=e&127;if((e&128)==0)return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<7,(e&128)==0)return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<14,(e&128)==0)return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<21,(e&128)==0)return this.assertBounds(),t;e=this.buf[this.pos++],t|=(e&15)<<28;for(let n=5;(e&128)!==0&&n<10;n++)e=this.buf[this.pos++];if((e&128)!=0)throw new Error("invalid varint");return this.assertBounds(),t>>>0}let me;function Pd(){const e=new DataView(new ArrayBuffer(8));me=globalThis.BigInt!==void 0&&typeof e.getBigInt64=="function"&&typeof e.getBigUint64=="function"&&typeof e.setBigInt64=="function"&&typeof e.setBigUint64=="function"?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:e}:void 0}Pd();function qc(e){if(!e)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}const Wc=/^-?[0-9]+$/,Ws=4294967296,ms=2147483648;class Gc{constructor(t,n){this.lo=t|0,this.hi=n|0}isZero(){return this.lo==0&&this.hi==0}toNumber(){let t=this.hi*Ws+(this.lo>>>0);if(!Number.isSafeInteger(t))throw new Error("cannot convert to safe number");return t}}class Ye extends Gc{static from(t){if(me)switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=="")throw new Error("string is no integer");t=me.C(t);case"number":if(t===0)return this.ZERO;t=me.C(t);case"bigint":if(!t)return this.ZERO;if(t<me.UMIN)throw new Error("signed value for ulong");if(t>me.UMAX)throw new Error("ulong too large");return me.V.setBigUint64(0,t,!0),new Ye(me.V.getInt32(0,!0),me.V.getInt32(4,!0))}else switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=t.trim(),!Wc.test(t))throw new Error("string is no integer");let[n,s,i]=Hc(t);if(n)throw new Error("signed value for ulong");return new Ye(s,i);case"number":if(t==0)return this.ZERO;if(!Number.isSafeInteger(t))throw new Error("number is no integer");if(t<0)throw new Error("signed value for ulong");return new Ye(t,t/Ws)}throw new Error("unknown value "+typeof t)}toString(){return me?this.toBigInt().toString():Sr(this.lo,this.hi)}toBigInt(){return qc(me),me.V.setInt32(0,this.lo,!0),me.V.setInt32(4,this.hi,!0),me.V.getBigUint64(0,!0)}}Ye.ZERO=new Ye(0,0);class ge extends Gc{static from(t){if(me)switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=="")throw new Error("string is no integer");t=me.C(t);case"number":if(t===0)return this.ZERO;t=me.C(t);case"bigint":if(!t)return this.ZERO;if(t<me.MIN)throw new Error("signed long too small");if(t>me.MAX)throw new Error("signed long too large");return me.V.setBigInt64(0,t,!0),new ge(me.V.getInt32(0,!0),me.V.getInt32(4,!0))}else switch(typeof t){case"string":if(t=="0")return this.ZERO;if(t=t.trim(),!Wc.test(t))throw new Error("string is no integer");let[n,s,i]=Hc(t);if(n){if(i>ms||i==ms&&s!=0)throw new Error("signed long too small")}else if(i>=ms)throw new Error("signed long too large");let r=new ge(s,i);return n?r.negate():r;case"number":if(t==0)return this.ZERO;if(!Number.isSafeInteger(t))throw new Error("number is no integer");return t>0?new ge(t,t/Ws):new ge(-t,-t/Ws).negate()}throw new Error("unknown value "+typeof t)}isNegative(){return(this.hi&ms)!==0}negate(){let t=~this.hi,n=this.lo;return n?n=~n+1:t+=1,new ge(n,t)}toString(){if(me)return this.toBigInt().toString();if(this.isNegative()){let t=this.negate();return"-"+Sr(t.lo,t.hi)}return Sr(this.lo,this.hi)}toBigInt(){return qc(me),me.V.setInt32(0,this.lo,!0),me.V.setInt32(4,this.hi,!0),me.V.getBigInt64(0,!0)}}ge.ZERO=new ge(0,0);const $o={readUnknownField:!0,readerFactory:e=>new Od(e)};function xd(e){return e?Object.assign(Object.assign({},$o),e):$o}class Od{constructor(t,n){this.varint64=Id,this.uint32=Rd,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=n??new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let t=this.uint32(),n=t>>>3,s=t&7;if(n<=0||s<0||s>5)throw new Error("illegal tag: field no "+n+" wire type "+s);return[n,s]}skip(t){let n=this.pos;switch(t){case Ie.Varint:for(;this.buf[this.pos++]&128;);break;case Ie.Bit64:this.pos+=4;case Ie.Bit32:this.pos+=4;break;case Ie.LengthDelimited:let s=this.uint32();this.pos+=s;break;case Ie.StartGroup:let i;for(;(i=this.tag()[1])!==Ie.EndGroup;)this.skip(i);break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return new ge(...this.varint64())}uint64(){return new Ye(...this.varint64())}sint64(){let[t,n]=this.varint64(),s=-(t&1);return t=(t>>>1|(n&1)<<31)^s,n=n>>>1^s,new ge(t,n)}bool(){let[t,n]=this.varint64();return t!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new Ye(this.sfixed32(),this.sfixed32())}sfixed64(){return new ge(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),n=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(n,n+t)}string(){return this.textDecoder.decode(this.bytes())}}function ae(e,t){if(!e)throw new Error(t)}const Ad=34028234663852886e22,Dd=-34028234663852886e22,Nd=4294967295,Ld=2147483647,Md=-2147483648;function Bn(e){if(typeof e!="number")throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>Ld||e<Md)throw new Error("invalid int 32: "+e)}function Gs(e){if(typeof e!="number")throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>Nd||e<0)throw new Error("invalid uint 32: "+e)}function Wr(e){if(typeof e!="number")throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>Ad||e<Dd))throw new Error("invalid float 32: "+e)}const Vo={writeUnknownFields:!0,writerFactory:()=>new Fd};function jd(e){return e?Object.assign(Object.assign({},Vo),e):Vo}class Fd{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let i=0;i<this.chunks.length;i++)t+=this.chunks[i].length;let n=new Uint8Array(t),s=0;for(let i=0;i<this.chunks.length;i++)n.set(this.chunks[i],s),s+=this.chunks[i].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,n){return this.uint32((t<<3|n)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(Gs(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return Bn(t),Uo(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let n=this.textEncoder.encode(t);return this.uint32(n.byteLength),this.raw(n)}float(t){Wr(t);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,t,!0),this.raw(n)}double(t){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,t,!0),this.raw(n)}fixed32(t){Gs(t);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t,!0),this.raw(n)}sfixed32(t){Bn(t);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,t,!0),this.raw(n)}sint32(t){return Bn(t),t=(t<<1^t>>31)>>>0,Uo(t,this.buf),this}sfixed64(t){let n=new Uint8Array(8),s=new DataView(n.buffer),i=ge.from(t);return s.setInt32(0,i.lo,!0),s.setInt32(4,i.hi,!0),this.raw(n)}fixed64(t){let n=new Uint8Array(8),s=new DataView(n.buffer),i=Ye.from(t);return s.setInt32(0,i.lo,!0),s.setInt32(4,i.hi,!0),this.raw(n)}int64(t){let n=ge.from(t);return Wi(n.lo,n.hi,this.buf),this}sint64(t){let n=ge.from(t),s=n.hi>>31,i=n.lo<<1^s,r=(n.hi<<1|n.lo>>>31)^s;return Wi(i,r,this.buf),this}uint64(t){let n=Ye.from(t);return Wi(n.lo,n.hi,this.buf),this}}const Bo={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},Ho={ignoreUnknownFields:!1};function Ud(e){return e?Object.assign(Object.assign({},Ho),e):Ho}function $d(e){return e?Object.assign(Object.assign({},Bo),e):Bo}function Vd(e,t){var n,s;let i=Object.assign(Object.assign({},e),t);return i.typeRegistry=[...(n=e?.typeRegistry)!==null&&n!==void 0?n:[],...(s=t?.typeRegistry)!==null&&s!==void 0?s:[]],i}const Kc=Symbol.for("protobuf-ts/message-type");function Ks(e){let t=!1;const n=[];for(let s=0;s<e.length;s++){let i=e.charAt(s);i=="_"?t=!0:/\d/.test(i)?(n.push(i),t=!0):t?(n.push(i.toUpperCase()),t=!1):s==0?n.push(i.toLowerCase()):n.push(i)}return n.join("")}var w;(function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"})(w||(w={}));var It;(function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER"})(It||(It={}));var Js;(function(e){e[e.NO=0]="NO",e[e.PACKED=1]="PACKED",e[e.UNPACKED=2]="UNPACKED"})(Js||(Js={}));function Bd(e){var t,n,s,i;return e.localName=(t=e.localName)!==null&&t!==void 0?t:Ks(e.name),e.jsonName=(n=e.jsonName)!==null&&n!==void 0?n:Ks(e.name),e.repeat=(s=e.repeat)!==null&&s!==void 0?s:Js.NO,e.opt=(i=e.opt)!==null&&i!==void 0?i:e.repeat||e.oneof?!1:e.kind=="message",e}function Hd(e){if(typeof e!="object"||e===null||!e.hasOwnProperty("oneofKind"))return!1;switch(typeof e.oneofKind){case"string":return e[e.oneofKind]===void 0?!1:Object.keys(e).length==2;case"undefined":return Object.keys(e).length==1;default:return!1}}class qd{constructor(t){var n;this.fields=(n=t.fields)!==null&&n!==void 0?n:[]}prepare(){if(this.data)return;const t=[],n=[],s=[];for(let i of this.fields)if(i.oneof)s.includes(i.oneof)||(s.push(i.oneof),t.push(i.oneof),n.push(i.oneof));else switch(n.push(i.localName),i.kind){case"scalar":case"enum":(!i.opt||i.repeat)&&t.push(i.localName);break;case"message":i.repeat&&t.push(i.localName);break;case"map":t.push(i.localName);break}this.data={req:t,known:n,oneofs:Object.values(s)}}is(t,n,s=!1){if(n<0)return!0;if(t==null||typeof t!="object")return!1;this.prepare();let i=Object.keys(t),r=this.data;if(i.length<r.req.length||r.req.some(o=>!i.includes(o))||!s&&i.some(o=>!r.known.includes(o)))return!1;if(n<1)return!0;for(const o of r.oneofs){const a=t[o];if(!Hd(a))return!1;if(a.oneofKind===void 0)continue;const c=this.fields.find(u=>u.localName===a.oneofKind);if(!c||!this.field(a[a.oneofKind],c,s,n))return!1}for(const o of this.fields)if(o.oneof===void 0&&!this.field(t[o.localName],o,s,n))return!1;return!0}field(t,n,s,i){let r=n.repeat;switch(n.kind){case"scalar":return t===void 0?n.opt:r?this.scalars(t,n.T,i,n.L):this.scalar(t,n.T,n.L);case"enum":return t===void 0?n.opt:r?this.scalars(t,w.INT32,i):this.scalar(t,w.INT32);case"message":return t===void 0?!0:r?this.messages(t,n.T(),s,i):this.message(t,n.T(),s,i);case"map":if(typeof t!="object"||t===null)return!1;if(i<2)return!0;if(!this.mapKeys(t,n.K,i))return!1;switch(n.V.kind){case"scalar":return this.scalars(Object.values(t),n.V.T,i,n.V.L);case"enum":return this.scalars(Object.values(t),w.INT32,i);case"message":return this.messages(Object.values(t),n.V.T(),s,i)}break}return!0}message(t,n,s,i){return s?n.isAssignable(t,i):n.is(t,i)}messages(t,n,s,i){if(!Array.isArray(t))return!1;if(i<2)return!0;if(s){for(let r=0;r<t.length&&r<i;r++)if(!n.isAssignable(t[r],i-1))return!1}else for(let r=0;r<t.length&&r<i;r++)if(!n.is(t[r],i-1))return!1;return!0}scalar(t,n,s){let i=typeof t;switch(n){case w.UINT64:case w.FIXED64:case w.INT64:case w.SFIXED64:case w.SINT64:switch(s){case It.BIGINT:return i=="bigint";case It.NUMBER:return i=="number"&&!isNaN(t);default:return i=="string"}case w.BOOL:return i=="boolean";case w.STRING:return i=="string";case w.BYTES:return t instanceof Uint8Array;case w.DOUBLE:case w.FLOAT:return i=="number"&&!isNaN(t);default:return i=="number"&&Number.isInteger(t)}}scalars(t,n,s,i){if(!Array.isArray(t))return!1;if(s<2)return!0;if(Array.isArray(t)){for(let r=0;r<t.length&&r<s;r++)if(!this.scalar(t[r],n,i))return!1}return!0}mapKeys(t,n,s){let i=Object.keys(t);switch(n){case w.INT32:case w.FIXED32:case w.SFIXED32:case w.SINT32:case w.UINT32:return this.scalars(i.slice(0,s).map(r=>parseInt(r)),n,s);case w.BOOL:return this.scalars(i.slice(0,s).map(r=>r=="true"?!0:r=="false"?!1:r),n,s);default:return this.scalars(i,n,s,It.STRING)}}}function vt(e,t){switch(t){case It.BIGINT:return e.toBigInt();case It.NUMBER:return e.toNumber();default:return e.toString()}}class Wd{constructor(t){this.info=t}prepare(){var t;if(this.fMap===void 0){this.fMap={};const n=(t=this.info.fields)!==null&&t!==void 0?t:[];for(const s of n)this.fMap[s.name]=s,this.fMap[s.jsonName]=s,this.fMap[s.localName]=s}}assert(t,n,s){if(!t){let i=On(s);throw(i=="number"||i=="boolean")&&(i=s.toString()),new Error(`Cannot parse JSON ${i} for ${this.info.typeName}#${n}`)}}read(t,n,s){this.prepare();const i=[];for(const[r,o]of Object.entries(t)){const a=this.fMap[r];if(!a){if(!s.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${r}`);continue}const c=a.localName;let u;if(a.oneof){if(o===null&&(a.kind!=="enum"||a.T()[0]!=="google.protobuf.NullValue"))continue;if(i.includes(a.oneof))throw new Error(`Multiple members of the oneof group "${a.oneof}" of ${this.info.typeName} are present in JSON.`);i.push(a.oneof),u=n[a.oneof]={oneofKind:c}}else u=n;if(a.kind=="map"){if(o===null)continue;this.assert(Hs(o),a.name,o);const d=u[c];for(const[p,l]of Object.entries(o)){this.assert(l!==null,a.name+" map value",null);let h;switch(a.V.kind){case"message":h=a.V.T().internalJsonRead(l,s);break;case"enum":if(h=this.enum(a.V.T(),l,a.name,s.ignoreUnknownFields),h===!1)continue;break;case"scalar":h=this.scalar(l,a.V.T,a.V.L,a.name);break}this.assert(h!==void 0,a.name+" map value",l);let m=p;a.K==w.BOOL&&(m=m=="true"?!0:m=="false"?!1:m),m=this.scalar(m,a.K,It.STRING,a.name).toString(),d[m]=h}}else if(a.repeat){if(o===null)continue;this.assert(Array.isArray(o),a.name,o);const d=u[c];for(const p of o){this.assert(p!==null,a.name,null);let l;switch(a.kind){case"message":l=a.T().internalJsonRead(p,s);break;case"enum":if(l=this.enum(a.T(),p,a.name,s.ignoreUnknownFields),l===!1)continue;break;case"scalar":l=this.scalar(p,a.T,a.L,a.name);break}this.assert(l!==void 0,a.name,o),d.push(l)}}else switch(a.kind){case"message":if(o===null&&a.T().typeName!="google.protobuf.Value"){this.assert(a.oneof===void 0,a.name+" (oneof member)",null);continue}u[c]=a.T().internalJsonRead(o,s,u[c]);break;case"enum":if(o===null)continue;let d=this.enum(a.T(),o,a.name,s.ignoreUnknownFields);if(d===!1)continue;u[c]=d;break;case"scalar":if(o===null)continue;u[c]=this.scalar(o,a.T,a.L,a.name);break}}}enum(t,n,s,i){if(t[0]=="google.protobuf.NullValue"&&ae(n===null||n==="NULL_VALUE",`Unable to parse field ${this.info.typeName}#${s}, enum ${t[0]} only accepts null.`),n===null)return 0;switch(typeof n){case"number":return ae(Number.isInteger(n),`Unable to parse field ${this.info.typeName}#${s}, enum can only be integral number, got ${n}.`),n;case"string":let r=n;t[2]&&n.substring(0,t[2].length)===t[2]&&(r=n.substring(t[2].length));let o=t[1][r];return typeof o>"u"&&i?!1:(ae(typeof o=="number",`Unable to parse field ${this.info.typeName}#${s}, enum ${t[0]} has no value for "${n}".`),o)}ae(!1,`Unable to parse field ${this.info.typeName}#${s}, cannot parse enum value from ${typeof n}".`)}scalar(t,n,s,i){let r;try{switch(n){case w.DOUBLE:case w.FLOAT:if(t===null)return 0;if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""){r="empty string";break}if(typeof t=="string"&&t.trim().length!==t.length){r="extra whitespace";break}if(typeof t!="string"&&typeof t!="number")break;let o=Number(t);if(Number.isNaN(o)){r="not a number";break}if(!Number.isFinite(o)){r="too large or small";break}return n==w.FLOAT&&Wr(o),o;case w.INT32:case w.FIXED32:case w.SFIXED32:case w.SINT32:case w.UINT32:if(t===null)return 0;let a;if(typeof t=="number"?a=t:t===""?r="empty string":typeof t=="string"&&(t.trim().length!==t.length?r="extra whitespace":a=Number(t)),a===void 0)break;return n==w.UINT32?Gs(a):Bn(a),a;case w.INT64:case w.SFIXED64:case w.SINT64:if(t===null)return vt(ge.ZERO,s);if(typeof t!="number"&&typeof t!="string")break;return vt(ge.from(t),s);case w.FIXED64:case w.UINT64:if(t===null)return vt(Ye.ZERO,s);if(typeof t!="number"&&typeof t!="string")break;return vt(Ye.from(t),s);case w.BOOL:if(t===null)return!1;if(typeof t!="boolean")break;return t;case w.STRING:if(t===null)return"";if(typeof t!="string"){r="extra whitespace";break}try{encodeURIComponent(t)}catch(c){c="invalid UTF8";break}return t;case w.BYTES:if(t===null||t==="")return new Uint8Array(0);if(typeof t!="string")break;return wd(t)}}catch(o){r=o.message}this.assert(!1,i+(r?" - "+r:""),t)}}class Gd{constructor(t){var n;this.fields=(n=t.fields)!==null&&n!==void 0?n:[]}write(t,n){const s={},i=t;for(const r of this.fields){if(!r.oneof){let u=this.field(r,i[r.localName],n);u!==void 0&&(s[n.useProtoFieldName?r.name:r.jsonName]=u);continue}const o=i[r.oneof];if(o.oneofKind!==r.localName)continue;const a=r.kind=="scalar"||r.kind=="enum"?Object.assign(Object.assign({},n),{emitDefaultValues:!0}):n;let c=this.field(r,o[r.localName],a);ae(c!==void 0),s[n.useProtoFieldName?r.name:r.jsonName]=c}return s}field(t,n,s){let i;if(t.kind=="map"){ae(typeof n=="object"&&n!==null);const r={};switch(t.V.kind){case"scalar":for(const[c,u]of Object.entries(n)){const d=this.scalar(t.V.T,u,t.name,!1,!0);ae(d!==void 0),r[c.toString()]=d}break;case"message":const o=t.V.T();for(const[c,u]of Object.entries(n)){const d=this.message(o,u,t.name,s);ae(d!==void 0),r[c.toString()]=d}break;case"enum":const a=t.V.T();for(const[c,u]of Object.entries(n)){ae(u===void 0||typeof u=="number");const d=this.enum(a,u,t.name,!1,!0,s.enumAsInteger);ae(d!==void 0),r[c.toString()]=d}break}(s.emitDefaultValues||Object.keys(r).length>0)&&(i=r)}else if(t.repeat){ae(Array.isArray(n));const r=[];switch(t.kind){case"scalar":for(let c=0;c<n.length;c++){const u=this.scalar(t.T,n[c],t.name,t.opt,!0);ae(u!==void 0),r.push(u)}break;case"enum":const o=t.T();for(let c=0;c<n.length;c++){ae(n[c]===void 0||typeof n[c]=="number");const u=this.enum(o,n[c],t.name,t.opt,!0,s.enumAsInteger);ae(u!==void 0),r.push(u)}break;case"message":const a=t.T();for(let c=0;c<n.length;c++){const u=this.message(a,n[c],t.name,s);ae(u!==void 0),r.push(u)}break}(s.emitDefaultValues||r.length>0||s.emitDefaultValues)&&(i=r)}else switch(t.kind){case"scalar":i=this.scalar(t.T,n,t.name,t.opt,s.emitDefaultValues);break;case"enum":i=this.enum(t.T(),n,t.name,t.opt,s.emitDefaultValues,s.enumAsInteger);break;case"message":i=this.message(t.T(),n,t.name,s);break}return i}enum(t,n,s,i,r,o){if(t[0]=="google.protobuf.NullValue")return!r&&!i?void 0:null;if(n===void 0){ae(i);return}if(!(n===0&&!r&&!i))return ae(typeof n=="number"),ae(Number.isInteger(n)),o||!t[1].hasOwnProperty(n)?n:t[2]?t[2]+t[1][n]:t[1][n]}message(t,n,s,i){return n===void 0?i.emitDefaultValues?null:void 0:t.internalJsonWrite(n,i)}scalar(t,n,s,i,r){if(n===void 0){ae(i);return}const o=r||i;switch(t){case w.INT32:case w.SFIXED32:case w.SINT32:return n===0?o?0:void 0:(Bn(n),n);case w.FIXED32:case w.UINT32:return n===0?o?0:void 0:(Gs(n),n);case w.FLOAT:Wr(n);case w.DOUBLE:return n===0?o?0:void 0:(ae(typeof n=="number"),Number.isNaN(n)?"NaN":n===Number.POSITIVE_INFINITY?"Infinity":n===Number.NEGATIVE_INFINITY?"-Infinity":n);case w.STRING:return n===""?o?"":void 0:(ae(typeof n=="string"),n);case w.BOOL:return n===!1?o?!1:void 0:(ae(typeof n=="boolean"),n);case w.UINT64:case w.FIXED64:ae(typeof n=="number"||typeof n=="string"||typeof n=="bigint");let a=Ye.from(n);return a.isZero()&&!o?void 0:a.toString();case w.INT64:case w.SFIXED64:case w.SINT64:ae(typeof n=="number"||typeof n=="string"||typeof n=="bigint");let c=ge.from(n);return c.isZero()&&!o?void 0:c.toString();case w.BYTES:return ae(n instanceof Uint8Array),n.byteLength?Ed(n):o?"":void 0}}}function yr(e,t=It.STRING){switch(e){case w.BOOL:return!1;case w.UINT64:case w.FIXED64:return vt(Ye.ZERO,t);case w.INT64:case w.SFIXED64:case w.SINT64:return vt(ge.ZERO,t);case w.DOUBLE:case w.FLOAT:return 0;case w.BYTES:return new Uint8Array(0);case w.STRING:return"";default:return 0}}class Kd{constructor(t){this.info=t}prepare(){var t;if(!this.fieldNoToField){const n=(t=this.info.fields)!==null&&t!==void 0?t:[];this.fieldNoToField=new Map(n.map(s=>[s.no,s]))}}read(t,n,s,i){this.prepare();const r=i===void 0?t.len:t.pos+i;for(;t.pos<r;){const[o,a]=t.tag(),c=this.fieldNoToField.get(o);if(!c){let l=s.readUnknownField;if(l=="throw")throw new Error(`Unknown field ${o} (wire type ${a}) for ${this.info.typeName}`);let h=t.skip(a);l!==!1&&(l===!0?qs.onRead:l)(this.info.typeName,n,o,a,h);continue}let u=n,d=c.repeat,p=c.localName;switch(c.oneof&&(u=u[c.oneof],u.oneofKind!==p&&(u=n[c.oneof]={oneofKind:p})),c.kind){case"scalar":case"enum":let l=c.kind=="enum"?w.INT32:c.T,h=c.kind=="scalar"?c.L:void 0;if(d){let g=u[p];if(a==Ie.LengthDelimited&&l!=w.STRING&&l!=w.BYTES){let S=t.uint32()+t.pos;for(;t.pos<S;)g.push(this.scalar(t,l,h))}else g.push(this.scalar(t,l,h))}else u[p]=this.scalar(t,l,h);break;case"message":if(d){let g=u[p],S=c.T().internalBinaryRead(t,t.uint32(),s);g.push(S)}else u[p]=c.T().internalBinaryRead(t,t.uint32(),s,u[p]);break;case"map":let[m,f]=this.mapEntry(c,t,s);u[p][m]=f;break}}}mapEntry(t,n,s){let i=n.uint32(),r=n.pos+i,o,a;for(;n.pos<r;){let[c,u]=n.tag();switch(c){case 1:t.K==w.BOOL?o=n.bool().toString():o=this.scalar(n,t.K,It.STRING);break;case 2:switch(t.V.kind){case"scalar":a=this.scalar(n,t.V.T,t.V.L);break;case"enum":a=n.int32();break;case"message":a=t.V.T().internalBinaryRead(n,n.uint32(),s);break}break;default:throw new Error(`Unknown field ${c} (wire type ${u}) in map entry for ${this.info.typeName}#${t.name}`)}}if(o===void 0){let c=yr(t.K);o=t.K==w.BOOL?c.toString():c}if(a===void 0)switch(t.V.kind){case"scalar":a=yr(t.V.T,t.V.L);break;case"enum":a=0;break;case"message":a=t.V.T().create();break}return[o,a]}scalar(t,n,s){switch(n){case w.INT32:return t.int32();case w.STRING:return t.string();case w.BOOL:return t.bool();case w.DOUBLE:return t.double();case w.FLOAT:return t.float();case w.INT64:return vt(t.int64(),s);case w.UINT64:return vt(t.uint64(),s);case w.FIXED64:return vt(t.fixed64(),s);case w.FIXED32:return t.fixed32();case w.BYTES:return t.bytes();case w.UINT32:return t.uint32();case w.SFIXED32:return t.sfixed32();case w.SFIXED64:return vt(t.sfixed64(),s);case w.SINT32:return t.sint32();case w.SINT64:return vt(t.sint64(),s)}}}class Jd{constructor(t){this.info=t}prepare(){if(!this.fields){const t=this.info.fields?this.info.fields.concat():[];this.fields=t.sort((n,s)=>n.no-s.no)}}write(t,n,s){this.prepare();for(const r of this.fields){let o,a,c=r.repeat,u=r.localName;if(r.oneof){const d=t[r.oneof];if(d.oneofKind!==u)continue;o=d[u],a=!0}else o=t[u],a=!1;switch(r.kind){case"scalar":case"enum":let d=r.kind=="enum"?w.INT32:r.T;if(c)if(ae(Array.isArray(o)),c==Js.PACKED)this.packed(n,d,r.no,o);else for(const p of o)this.scalar(n,d,r.no,p,!0);else o===void 0?ae(r.opt):this.scalar(n,d,r.no,o,a||r.opt);break;case"message":if(c){ae(Array.isArray(o));for(const p of o)this.message(n,s,r.T(),r.no,p)}else this.message(n,s,r.T(),r.no,o);break;case"map":ae(typeof o=="object"&&o!==null);for(const[p,l]of Object.entries(o))this.mapEntry(n,s,r,p,l);break}}let i=s.writeUnknownFields;i!==!1&&(i===!0?qs.onWrite:i)(this.info.typeName,t,n)}mapEntry(t,n,s,i,r){t.tag(s.no,Ie.LengthDelimited),t.fork();let o=i;switch(s.K){case w.INT32:case w.FIXED32:case w.UINT32:case w.SFIXED32:case w.SINT32:o=Number.parseInt(i);break;case w.BOOL:ae(i=="true"||i=="false"),o=i=="true";break}switch(this.scalar(t,s.K,1,o,!0),s.V.kind){case"scalar":this.scalar(t,s.V.T,2,r,!0);break;case"enum":this.scalar(t,w.INT32,2,r,!0);break;case"message":this.message(t,n,s.V.T(),2,r);break}t.join()}message(t,n,s,i,r){r!==void 0&&(s.internalBinaryWrite(r,t.tag(i,Ie.LengthDelimited).fork(),n),t.join())}scalar(t,n,s,i,r){let[o,a,c]=this.scalarInfo(n,i);(!c||r)&&(t.tag(s,o),t[a](i))}packed(t,n,s,i){if(!i.length)return;ae(n!==w.BYTES&&n!==w.STRING),t.tag(s,Ie.LengthDelimited),t.fork();let[,r]=this.scalarInfo(n);for(let o=0;o<i.length;o++)t[r](i[o]);t.join()}scalarInfo(t,n){let s=Ie.Varint,i,r=n===void 0,o=n===0;switch(t){case w.INT32:i="int32";break;case w.STRING:o=r||!n.length,s=Ie.LengthDelimited,i="string";break;case w.BOOL:o=n===!1,i="bool";break;case w.UINT32:i="uint32";break;case w.DOUBLE:s=Ie.Bit64,i="double";break;case w.FLOAT:s=Ie.Bit32,i="float";break;case w.INT64:o=r||ge.from(n).isZero(),i="int64";break;case w.UINT64:o=r||Ye.from(n).isZero(),i="uint64";break;case w.FIXED64:o=r||Ye.from(n).isZero(),s=Ie.Bit64,i="fixed64";break;case w.BYTES:o=r||!n.byteLength,s=Ie.LengthDelimited,i="bytes";break;case w.FIXED32:s=Ie.Bit32,i="fixed32";break;case w.SFIXED32:s=Ie.Bit32,i="sfixed32";break;case w.SFIXED64:o=r||ge.from(n).isZero(),s=Ie.Bit64,i="sfixed64";break;case w.SINT32:i="sint32";break;case w.SINT64:o=r||ge.from(n).isZero(),i="sint64";break}return[s,i,r||o]}}function zd(e){const t=e.messagePrototype?Object.create(e.messagePrototype):Object.defineProperty({},Kc,{value:e});for(let n of e.fields){let s=n.localName;if(!n.opt)if(n.oneof)t[n.oneof]={oneofKind:void 0};else if(n.repeat)t[s]=[];else switch(n.kind){case"scalar":t[s]=yr(n.T,n.L);break;case"enum":t[s]=0;break;case"map":t[s]={};break}}return t}function Gi(e,t,n){let s,i=n,r;for(let o of e.fields){let a=o.localName;if(o.oneof){const c=i[o.oneof];if(c?.oneofKind==null)continue;if(s=c[a],r=t[o.oneof],r.oneofKind=c.oneofKind,s==null){delete r[a];continue}}else if(s=i[a],r=t,s==null)continue;switch(o.repeat&&(r[a].length=s.length),o.kind){case"scalar":case"enum":if(o.repeat)for(let u=0;u<s.length;u++)r[a][u]=s[u];else r[a]=s;break;case"message":let c=o.T();if(o.repeat)for(let u=0;u<s.length;u++)r[a][u]=c.create(s[u]);else r[a]===void 0?r[a]=c.create(s):c.mergePartial(r[a],s);break;case"map":switch(o.V.kind){case"scalar":case"enum":Object.assign(r[a],s);break;case"message":let u=o.V.T();for(let d of Object.keys(s))r[a][d]=u.create(s[d]);break}break}}}function Yd(e,t,n){if(t===n)return!0;if(!t||!n)return!1;for(let s of e.fields){let i=s.localName,r=s.oneof?t[s.oneof][i]:t[i],o=s.oneof?n[s.oneof][i]:n[i];switch(s.kind){case"enum":case"scalar":let a=s.kind=="enum"?w.INT32:s.T;if(!(s.repeat?qo(a,r,o):Jc(a,r,o)))return!1;break;case"map":if(!(s.V.kind=="message"?Wo(s.V.T(),gs(r),gs(o)):qo(s.V.kind=="enum"?w.INT32:s.V.T,gs(r),gs(o))))return!1;break;case"message":let c=s.T();if(!(s.repeat?Wo(c,r,o):c.equals(r,o)))return!1;break}}return!0}const gs=Object.values;function Jc(e,t,n){if(t===n)return!0;if(e!==w.BYTES)return!1;let s=t,i=n;if(s.length!==i.length)return!1;for(let r=0;r<s.length;r++)if(s[r]!=i[r])return!1;return!0}function qo(e,t,n){if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(!Jc(e,t[s],n[s]))return!1;return!0}function Wo(e,t,n){if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(!e.equals(t[s],n[s]))return!1;return!0}const zc=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({})),Xd=zc[Kc]={};class x{constructor(t,n,s){this.defaultCheckDepth=16,this.typeName=t,this.fields=n.map(Bd),this.options=s??{},Xd.value=this,this.messagePrototype=Object.create(null,zc),this.refTypeCheck=new qd(this),this.refJsonReader=new Wd(this),this.refJsonWriter=new Gd(this),this.refBinReader=new Kd(this),this.refBinWriter=new Jd(this)}create(t){let n=zd(this);return t!==void 0&&Gi(this,n,t),n}clone(t){let n=this.create();return Gi(this,n,t),n}equals(t,n){return Yd(this,t,n)}is(t,n=this.defaultCheckDepth){return this.refTypeCheck.is(t,n,!1)}isAssignable(t,n=this.defaultCheckDepth){return this.refTypeCheck.is(t,n,!0)}mergePartial(t,n){Gi(this,t,n)}fromBinary(t,n){let s=xd(n);return this.internalBinaryRead(s.readerFactory(t),t.byteLength,s)}fromJson(t,n){return this.internalJsonRead(t,Ud(n))}fromJsonString(t,n){let s=JSON.parse(t);return this.fromJson(s,n)}toJson(t,n){return this.internalJsonWrite(t,$d(n))}toJsonString(t,n){var s;let i=this.toJson(t,n);return JSON.stringify(i,null,(s=n?.prettySpaces)!==null&&s!==void 0?s:0)}toBinary(t,n){let s=jd(n);return this.internalBinaryWrite(t,s.writerFactory(),s).finish()}internalJsonRead(t,n,s){if(t!==null&&typeof t=="object"&&!Array.isArray(t)){let i=s??this.create();return this.refJsonReader.read(t,i,n),i}throw new Error(`Unable to parse message ${this.typeName} from JSON ${On(t)}.`)}internalJsonWrite(t,n){return this.refJsonWriter.write(t,n)}internalBinaryWrite(t,n,s){return this.refBinWriter.write(t,n,s),n}internalBinaryRead(t,n,s,i){let r=i??this.create();return this.refBinReader.read(t,r,s,n),r}}function Zd(e,t){var n,s,i;let r=e;return r.service=t,r.localName=(n=r.localName)!==null&&n!==void 0?n:Ks(r.name),r.serverStreaming=!!r.serverStreaming,r.clientStreaming=!!r.clientStreaming,r.options=(s=r.options)!==null&&s!==void 0?s:{},r.idempotency=(i=r.idempotency)!==null&&i!==void 0?i:void 0,r}class Qd{constructor(t,n,s){this.typeName=t,this.methods=n.map(i=>Zd(i,this)),this.options=s??{}}}class tt extends Error{constructor(t,n="UNKNOWN",s){super(t),this.name="RpcError",Object.setPrototypeOf(this,new.target.prototype),this.code=n,this.meta=s??{}}toString(){const t=[this.name+": "+this.message];this.code&&(t.push(""),t.push("Code: "+this.code)),this.serviceName&&this.methodName&&t.push("Method: "+this.serviceName+"/"+this.methodName);let n=Object.entries(this.meta);if(n.length){t.push(""),t.push("Meta:");for(let[s,i]of n)t.push(`  ${s}: ${i}`)}return t.join(`
`)}}function eh(e,t){if(!t)return e;let n={};bs(e,n),bs(t,n);for(let s of Object.keys(t)){let i=t[s];switch(s){case"jsonOptions":n.jsonOptions=Vd(e.jsonOptions,n.jsonOptions);break;case"binaryOptions":n.binaryOptions=_d(e.binaryOptions,n.binaryOptions);break;case"meta":n.meta={},bs(e.meta,n.meta),bs(t.meta,n.meta);break;case"interceptors":n.interceptors=e.interceptors?e.interceptors.concat(i):i.concat();break}}return n}function bs(e,t){if(!e)return;let n=t;for(let[s,i]of Object.entries(e))i instanceof Date?n[s]=new Date(i.getTime()):Array.isArray(i)?n[s]=i.concat():n[s]=i}var bt;(function(e){e[e.PENDING=0]="PENDING",e[e.REJECTED=1]="REJECTED",e[e.RESOLVED=2]="RESOLVED"})(bt||(bt={}));class vs{constructor(t=!0){this._state=bt.PENDING,this._promise=new Promise((n,s)=>{this._resolve=n,this._reject=s}),t&&this._promise.catch(n=>{})}get state(){return this._state}get promise(){return this._promise}resolve(t){if(this.state!==bt.PENDING)throw new Error(`cannot resolve ${bt[this.state].toLowerCase()}`);this._resolve(t),this._state=bt.RESOLVED}reject(t){if(this.state!==bt.PENDING)throw new Error(`cannot reject ${bt[this.state].toLowerCase()}`);this._reject(t),this._state=bt.REJECTED}resolvePending(t){this._state===bt.PENDING&&this.resolve(t)}rejectPending(t){this._state===bt.PENDING&&this.reject(t)}}var th=function(e,t,n,s){function i(r){return r instanceof n?r:new n(function(o){o(r)})}return new(n||(n=Promise))(function(r,o){function a(d){try{u(s.next(d))}catch(p){o(p)}}function c(d){try{u(s.throw(d))}catch(p){o(p)}}function u(d){d.done?r(d.value):i(d.value).then(a,c)}u((s=s.apply(e,t||[])).next())})};class nh{constructor(t,n,s,i,r,o,a){this.method=t,this.requestHeaders=n,this.request=s,this.headers=i,this.response=r,this.status=o,this.trailers=a}then(t,n){return this.promiseFinished().then(s=>t?Promise.resolve(t(s)):s,s=>n?Promise.resolve(n(s)):Promise.reject(s))}promiseFinished(){return th(this,void 0,void 0,function*(){let[t,n,s,i]=yield Promise.all([this.headers,this.response,this.status,this.trailers]);return{method:this.method,requestHeaders:this.requestHeaders,request:this.request,headers:t,response:n,status:s,trailers:i}})}}function Nt(e,t,n,s,i){var r;{let o=(a,c,u)=>t.unary(a,c,u);for(const a of((r=s.interceptors)!==null&&r!==void 0?r:[]).filter(c=>c.interceptUnary).reverse()){const c=o;o=(u,d,p)=>a.interceptUnary(c,u,d,p)}return o(n,i,s)}}var ye;(function(e){e[e.cancelled=0]="cancelled",e[e.unknown=1]="unknown",e[e.invalid_argument=2]="invalid_argument",e[e.malformed=3]="malformed",e[e.deadline_exceeded=4]="deadline_exceeded",e[e.not_found=5]="not_found",e[e.bad_route=6]="bad_route",e[e.already_exists=7]="already_exists",e[e.permission_denied=8]="permission_denied",e[e.unauthenticated=9]="unauthenticated",e[e.resource_exhausted=10]="resource_exhausted",e[e.failed_precondition=11]="failed_precondition",e[e.aborted=12]="aborted",e[e.out_of_range=13]="out_of_range",e[e.unimplemented=14]="unimplemented",e[e.internal=15]="internal",e[e.unavailable=16]="unavailable",e[e.dataloss=17]="dataloss"})(ye||(ye={}));function sh(e,t,n){if(n)for(let[s,i]of Object.entries(n))if(typeof i=="string")e.append(s,i);else for(let r of i)e.append(s,r);return e.set("Content-Type",t?"application/json":"application/protobuf"),e.set("Accept",t?"application/json":"application/protobuf, application/json"),e}function ih(e){if(!Hs(e)||typeof e.code!="string"||typeof e.msg!="string")return new tt("cannot read twirp error response",ye[ye.internal]);let t={};if(Hs(e.meta))for(let[n,s]of Object.entries(e.meta))typeof s=="string"&&(t[n]=s);return new tt(e.msg,e.code,t)}function rh(e){let t={};return e.forEach((n,s)=>{s.toLowerCase()!=="content-type"&&s.toLowerCase()!=="content-length"&&(t.hasOwnProperty(s)?t[s].push(n):t[s]=n)}),t}class oh{constructor(t){this.defaultOptions=t}mergeOptions(t){return eh(this.defaultOptions,t)}unary(t,n,s){var i,r,o;let a=s,c=this.makeUrl(t,a),u=(i=a.fetchInit)!==null&&i!==void 0?i:{},d=a.sendJson?t.I.toJsonString(n,a.jsonOptions):t.I.toBinary(n,a.binaryOptions),p=new vs,l=new vs,h=new vs,m=new vs;return globalThis.fetch(c,Object.assign(Object.assign({},u),{method:"POST",headers:sh(new globalThis.Headers,!!a.sendJson,a.meta),body:d,signal:(r=s.abort)!==null&&r!==void 0?r:null})).then(f=>{p.resolve(rh(f.headers));let g;try{g=f.type}catch{}switch(g){case"error":case"opaque":case"opaqueredirect":throw new tt(`fetch response type ${f.type}`,ye[ye.unknown])}return f.ok?a.sendJson?f.json().then(S=>t.O.fromJson(S,a.jsonOptions),()=>{throw new tt("unable to read response body as json",ye[ye.dataloss])}):f.arrayBuffer().then(S=>t.O.fromBinary(new Uint8Array(S),a.binaryOptions),()=>{throw new tt("unable to read response body",ye[ye.dataloss])}):f.json().then(S=>{throw ih(S)},()=>{throw new tt("received HTTP "+f.status+", unable to read response body as json",ye[ye.internal])})},f=>{throw f instanceof Error&&f.name==="AbortError"?new tt(f.message,ye[ye.cancelled]):new tt(f instanceof Error?f.message:f)}).then(f=>{l.resolve(f),h.resolve({code:"OK",detail:""}),m.resolve({})}).catch(f=>{let g=f instanceof tt?f:new tt(f instanceof Error?f.message:f,ye[ye.internal]);g.methodName=t.name,g.serviceName=t.service.typeName,p.rejectPending(g),l.rejectPending(g),h.rejectPending(g),m.rejectPending(g)}),new nh(t,(o=a.meta)!==null&&o!==void 0?o:{},n,p.promise,l.promise,h.promise,m.promise)}makeUrl(t,n){let s=n.baseUrl;s.endsWith("/")&&(s=s.substring(0,s.length-1));let i=t.name;return n.useProtoMethodName!==!0&&(i=Ks(i),i=i.substring(0,1).toUpperCase()+i.substring(1)),`${s}/${t.service.typeName}/${i}`}clientStreaming(t){const n=new tt("Client streaming is not supported by Twirp",ye[ye.unimplemented]);throw n.methodName=t.name,n.serviceName=t.service.typeName,n}duplex(t){const n=new tt("Duplex streaming is not supported by Twirp",ye[ye.unimplemented]);throw n.methodName=t.name,n.serviceName=t.service.typeName,n}serverStreaming(t){const n=new tt("Server streaming is not supported by Twirp",ye[ye.unimplemented]);throw n.methodName=t.name,n.serviceName=t.service.typeName,n}}function ce(e){return typeof e=="function"}function Yc(e){var t=function(s){Error.call(s),s.stack=new Error().stack},n=e(t);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Ki=Yc(function(e){return function(n){e(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(s,i){return i+1+") "+s.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function zs(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var rs=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,n,s,i,r;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Bs(o),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(f){t={error:f}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}else o.remove(this);var d=this.initialTeardown;if(ce(d))try{d()}catch(f){r=f instanceof Ki?f.errors:[f]}var p=this._finalizers;if(p){this._finalizers=null;try{for(var l=Bs(p),h=l.next();!h.done;h=l.next()){var m=h.value;try{Go(m)}catch(f){r=r??[],f instanceof Ki?r=wn(wn([],on(r)),on(f.errors)):r.push(f)}}}catch(f){s={error:f}}finally{try{h&&!h.done&&(i=l.return)&&i.call(l)}finally{if(s)throw s.error}}}if(r)throw new Ki(r)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Go(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(t)}},e.prototype._hasParent=function(t){var n=this._parentage;return n===t||Array.isArray(n)&&n.includes(t)},e.prototype._addParent=function(t){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t},e.prototype._removeParent=function(t){var n=this._parentage;n===t?this._parentage=null:Array.isArray(n)&&zs(n,t)},e.prototype.remove=function(t){var n=this._finalizers;n&&zs(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),Xc=rs.EMPTY;function Zc(e){return e instanceof rs||e&&"closed"in e&&ce(e.remove)&&ce(e.add)&&ce(e.unsubscribe)}function Go(e){ce(e)?e():e.unsubscribe()}var ah={Promise:void 0},ch={setTimeout:function(e,t){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];return setTimeout.apply(void 0,wn([e,t],on(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function Qc(e){ch.setTimeout(function(){throw e})}function Ko(){}function Ms(e){e()}var Gr=function(e){xt(t,e);function t(n){var s=e.call(this)||this;return s.isStopped=!1,n?(s.destination=n,Zc(n)&&n.add(s)):s.destination=dh,s}return t.create=function(n,s,i){return new Jn(n,s,i)},t.prototype.next=function(n){this.isStopped||this._next(n)},t.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(rs),lh=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(s){Ss(s)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(s){Ss(s)}else Ss(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){Ss(n)}},e}(),Jn=function(e){xt(t,e);function t(n,s,i){var r=e.call(this)||this,o;return ce(n)||!n?o={next:n??void 0,error:s??void 0,complete:i??void 0}:o=n,r.destination=new lh(o),r}return t}(Gr);function Ss(e){Qc(e)}function uh(e){throw e}var dh={closed:!0,next:Ko,error:uh,complete:Ko},Kr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function An(e){return e}function hh(e){return e.length===0?An:e.length===1?e[0]:function(n){return e.reduce(function(s,i){return i(s)},n)}}var et=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,s){var i=this,r=ph(t)?t:new Jn(t,n,s);return Ms(function(){var o=i,a=o.operator,c=o.source;r.add(a?a.call(r,c):c?i._subscribe(r):i._trySubscribe(r))}),r},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var s=this;return n=Jo(n),new n(function(i,r){var o=new Jn({next:function(a){try{t(a)}catch(c){r(c),o.unsubscribe()}},error:r,complete:i});s.subscribe(o)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[Kr]=function(){return this},e.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return hh(t)(this)},e.prototype.toPromise=function(t){var n=this;return t=Jo(t),new t(function(s,i){var r;n.subscribe(function(o){return r=o},function(o){return i(o)},function(){return s(r)})})},e.create=function(t){return new e(t)},e}();function Jo(e){var t;return(t=e??ah.Promise)!==null&&t!==void 0?t:Promise}function fh(e){return e&&ce(e.next)&&ce(e.error)&&ce(e.complete)}function ph(e){return e&&e instanceof Gr||fh(e)&&Zc(e)}function mh(e){return ce(e?.lift)}function yt(e){return function(t){if(mh(t))return t.lift(function(n){try{return e(n,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function Pt(e,t,n,s,i){return new gh(e,t,n,s,i)}var gh=function(e){xt(t,e);function t(n,s,i,r,o,a){var c=e.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=s?function(u){try{s(u)}catch(d){n.error(d)}}:e.prototype._next,c._error=r?function(u){try{r(u)}catch(d){n.error(d)}finally{this.unsubscribe()}}:e.prototype._error,c._complete=i?function(){try{i()}catch(u){n.error(u)}finally{this.unsubscribe()}}:e.prototype._complete,c}return t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var s=this.closed;e.prototype.unsubscribe.call(this),!s&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(Gr),bh=Yc(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Si=function(e){xt(t,e);function t(){var n=e.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return t.prototype.lift=function(n){var s=new zo(this,this);return s.operator=n,s},t.prototype._throwIfClosed=function(){if(this.closed)throw new bh},t.prototype.next=function(n){var s=this;Ms(function(){var i,r;if(s._throwIfClosed(),!s.isStopped){s.currentObservers||(s.currentObservers=Array.from(s.observers));try{for(var o=Bs(s.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}}})},t.prototype.error=function(n){var s=this;Ms(function(){if(s._throwIfClosed(),!s.isStopped){s.hasError=s.isStopped=!0,s.thrownError=n;for(var i=s.observers;i.length;)i.shift().error(n)}})},t.prototype.complete=function(){var n=this;Ms(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var s=n.observers;s.length;)s.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(n){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,n)},t.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},t.prototype._innerSubscribe=function(n){var s=this,i=this,r=i.hasError,o=i.isStopped,a=i.observers;return r||o?Xc:(this.currentObservers=null,a.push(n),new rs(function(){s.currentObservers=null,zs(a,n)}))},t.prototype._checkFinalizedStatuses=function(n){var s=this,i=s.hasError,r=s.thrownError,o=s.isStopped;i?n.error(r):o&&n.complete()},t.prototype.asObservable=function(){var n=new et;return n.source=this,n},t.create=function(n,s){return new zo(n,s)},t}(et),zo=function(e){xt(t,e);function t(n,s){var i=e.call(this)||this;return i.destination=n,i.source=s,i}return t.prototype.next=function(n){var s,i;(i=(s=this.destination)===null||s===void 0?void 0:s.next)===null||i===void 0||i.call(s,n)},t.prototype.error=function(n){var s,i;(i=(s=this.destination)===null||s===void 0?void 0:s.error)===null||i===void 0||i.call(s,n)},t.prototype.complete=function(){var n,s;(s=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||s===void 0||s.call(n)},t.prototype._subscribe=function(n){var s,i;return(i=(s=this.source)===null||s===void 0?void 0:s.subscribe(n))!==null&&i!==void 0?i:Xc},t}(Si),Z=function(e){xt(t,e);function t(n){var s=e.call(this)||this;return s._value=n,s}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(n){var s=e.prototype._subscribe.call(this,n);return!s.closed&&n.next(this._value),s},t.prototype.getValue=function(){var n=this,s=n.hasError,i=n.thrownError,r=n._value;if(s)throw i;return this._throwIfClosed(),r},t.prototype.next=function(n){e.prototype.next.call(this,this._value=n)},t}(Si),Jr={now:function(){return(Jr.delegate||Date).now()},delegate:void 0},Ys=function(e){xt(t,e);function t(n,s,i){n===void 0&&(n=1/0),s===void 0&&(s=1/0),i===void 0&&(i=Jr);var r=e.call(this)||this;return r._bufferSize=n,r._windowTime=s,r._timestampProvider=i,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=s===1/0,r._bufferSize=Math.max(1,n),r._windowTime=Math.max(1,s),r}return t.prototype.next=function(n){var s=this,i=s.isStopped,r=s._buffer,o=s._infiniteTimeWindow,a=s._timestampProvider,c=s._windowTime;i||(r.push(n),!o&&r.push(a.now()+c)),this._trimBuffer(),e.prototype.next.call(this,n)},t.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var s=this._innerSubscribe(n),i=this,r=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!n.closed;c+=r?1:2)n.next(a[c]);return this._checkFinalizedStatuses(n),s},t.prototype._trimBuffer=function(){var n=this,s=n._bufferSize,i=n._timestampProvider,r=n._buffer,o=n._infiniteTimeWindow,a=(o?1:2)*s;if(s<1/0&&a<r.length&&r.splice(0,r.length-a),!o){for(var c=i.now(),u=0,d=1;d<r.length&&r[d]<=c;d+=2)u=d;u&&r.splice(0,u+1)}},t}(Si),vh=function(e){xt(t,e);function t(n,s){return e.call(this)||this}return t.prototype.schedule=function(n,s){return this},t}(rs),Yo={setInterval:function(e,t){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];return setInterval.apply(void 0,wn([e,t],on(n)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},Sh=function(e){xt(t,e);function t(n,s){var i=e.call(this,n,s)||this;return i.scheduler=n,i.work=s,i.pending=!1,i}return t.prototype.schedule=function(n,s){var i;if(s===void 0&&(s=0),this.closed)return this;this.state=n;var r=this.id,o=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(o,r,s)),this.pending=!0,this.delay=s,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,s),this},t.prototype.requestAsyncId=function(n,s,i){return i===void 0&&(i=0),Yo.setInterval(n.flush.bind(n,this),i)},t.prototype.recycleAsyncId=function(n,s,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return s;s!=null&&Yo.clearInterval(s)},t.prototype.execute=function(n,s){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,s);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(n,s){var i=!1,r;try{this.work(n)}catch(o){i=!0,r=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){if(!this.closed){var n=this,s=n.id,i=n.scheduler,r=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,zs(r,this),s!=null&&(this.id=this.recycleAsyncId(i,s,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(vh),Xo=function(){function e(t,n){n===void 0&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(t,n,s){return n===void 0&&(n=0),new this.schedulerActionCtor(this,t).schedule(s,n)},e.now=Jr.now,e}(),yh=function(e){xt(t,e);function t(n,s){s===void 0&&(s=Xo.now);var i=e.call(this,n,s)||this;return i.actions=[],i._active=!1,i}return t.prototype.flush=function(n){var s=this.actions;if(this._active){s.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=s.shift());if(this._active=!1,i){for(;n=s.shift();)n.unsubscribe();throw i}},t}(Xo),Ch=new yh(Sh),Th=new et(function(e){return e.complete()});function kh(e){return e&&ce(e.schedule)}function zr(e){return e[e.length-1]}function wh(e){return ce(zr(e))?e.pop():void 0}function os(e){return kh(zr(e))?e.pop():void 0}function Eh(e,t){return typeof zr(e)=="number"?e.pop():t}var Yr=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function el(e){return ce(e?.then)}function tl(e){return ce(e[Kr])}function nl(e){return Symbol.asyncIterator&&ce(e?.[Symbol.asyncIterator])}function sl(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function _h(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var il=_h();function rl(e){return ce(e?.[il])}function ol(e){return cd(this,arguments,function(){var n,s,i,r;return lc(this,function(o){switch(o.label){case 0:n=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Hi(n.read())];case 3:return s=o.sent(),i=s.value,r=s.done,r?[4,Hi(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Hi(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function al(e){return ce(e?.getReader)}function Bt(e){if(e instanceof et)return e;if(e!=null){if(tl(e))return Ih(e);if(Yr(e))return Rh(e);if(el(e))return Ph(e);if(nl(e))return cl(e);if(rl(e))return xh(e);if(al(e))return Oh(e)}throw sl(e)}function Ih(e){return new et(function(t){var n=e[Kr]();if(ce(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Rh(e){return new et(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function Ph(e){return new et(function(t){e.then(function(n){t.closed||(t.next(n),t.complete())},function(n){return t.error(n)}).then(null,Qc)})}function xh(e){return new et(function(t){var n,s;try{for(var i=Bs(e),r=i.next();!r.done;r=i.next()){var o=r.value;if(t.next(o),t.closed)return}}catch(a){n={error:a}}finally{try{r&&!r.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}t.complete()})}function cl(e){return new et(function(t){Ah(e,t).catch(function(n){return t.error(n)})})}function Oh(e){return cl(ol(e))}function Ah(e,t){var n,s,i,r;return ld(this,void 0,void 0,function(){var o,a;return lc(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=ud(e),c.label=1;case 1:return[4,n.next()];case 2:if(s=c.sent(),!!s.done)return[3,4];if(o=s.value,t.next(o),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),s&&!s.done&&(r=n.return)?[4,r.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Jt(e,t,n,s,i){s===void 0&&(s=0),i===void 0&&(i=!1);var r=t.schedule(function(){n(),i?e.add(this.schedule(null,s)):this.unsubscribe()},s);if(e.add(r),!i)return r}function ll(e,t){return t===void 0&&(t=0),yt(function(n,s){n.subscribe(Pt(s,function(i){return Jt(s,e,function(){return s.next(i)},t)},function(){return Jt(s,e,function(){return s.complete()},t)},function(i){return Jt(s,e,function(){return s.error(i)},t)}))})}function ul(e,t){return t===void 0&&(t=0),yt(function(n,s){s.add(e.schedule(function(){return n.subscribe(s)},t))})}function Dh(e,t){return Bt(e).pipe(ul(t),ll(t))}function Nh(e,t){return Bt(e).pipe(ul(t),ll(t))}function Lh(e,t){return new et(function(n){var s=0;return t.schedule(function(){s===e.length?n.complete():(n.next(e[s++]),n.closed||this.schedule())})})}function Mh(e,t){return new et(function(n){var s;return Jt(n,t,function(){s=e[il](),Jt(n,t,function(){var i,r,o;try{i=s.next(),r=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(r)},0,!0)}),function(){return ce(s?.return)&&s.return()}})}function dl(e,t){if(!e)throw new Error("Iterable cannot be null");return new et(function(n){Jt(n,t,function(){var s=e[Symbol.asyncIterator]();Jt(n,t,function(){s.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function jh(e,t){return dl(ol(e),t)}function Fh(e,t){if(e!=null){if(tl(e))return Dh(e,t);if(Yr(e))return Lh(e,t);if(el(e))return Nh(e,t);if(nl(e))return dl(e,t);if(rl(e))return Mh(e,t);if(al(e))return jh(e,t)}throw sl(e)}function dn(e,t){return t?Fh(e,t):Bt(e)}function Hn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=os(e);return dn(e,n)}function Be(e,t){return yt(function(n,s){var i=0;n.subscribe(Pt(s,function(r){s.next(e.call(t,r,i++))}))})}var Uh=Array.isArray;function $h(e,t){return Uh(t)?e.apply(void 0,wn([],on(t))):e(t)}function hl(e){return Be(function(t){return $h(e,t)})}var Vh=Array.isArray,Bh=Object.getPrototypeOf,Hh=Object.prototype,qh=Object.keys;function Wh(e){if(e.length===1){var t=e[0];if(Vh(t))return{args:t,keys:null};if(Gh(t)){var n=qh(t);return{args:n.map(function(s){return t[s]}),keys:n}}}return{args:e,keys:null}}function Gh(e){return e&&typeof e=="object"&&Bh(e)===Hh}function Kh(e,t){return e.reduce(function(n,s,i){return n[s]=t[i],n},{})}function Zt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=os(e),s=wh(e),i=Wh(e),r=i.args,o=i.keys;if(r.length===0)return dn([],n);var a=new et(Jh(r,n,o?function(c){return Kh(o,c)}:An));return s?a.pipe(hl(s)):a}function Jh(e,t,n){return n===void 0&&(n=An),function(s){Zo(t,function(){for(var i=e.length,r=new Array(i),o=i,a=i,c=function(d){Zo(t,function(){var p=dn(e[d],t),l=!1;p.subscribe(Pt(s,function(h){r[d]=h,l||(l=!0,a--),a||s.next(n(r.slice()))},function(){--o||s.complete()}))},s)},u=0;u<i;u++)c(u)},s)}}function Zo(e,t,n){e?Jt(n,e,t):t()}function zh(e,t,n,s,i,r,o,a){var c=[],u=0,d=0,p=!1,l=function(){p&&!c.length&&!u&&t.complete()},h=function(f){return u<s?m(f):c.push(f)},m=function(f){u++;var g=!1;Bt(n(f,d++)).subscribe(Pt(t,function(S){t.next(S)},function(){g=!0},void 0,function(){if(g)try{u--;for(var S=function(){var C=c.shift();o||m(C)};c.length&&u<s;)S();l()}catch(C){t.error(C)}}))};return e.subscribe(Pt(t,h,function(){p=!0,l()})),function(){}}function zn(e,t,n){return n===void 0&&(n=1/0),ce(t)?zn(function(s,i){return Be(function(r,o){return t(s,r,i,o)})(Bt(e(s,i)))},n):(typeof t=="number"&&(n=t),yt(function(s,i){return zh(s,i,e,n)}))}function fl(e){return e===void 0&&(e=1/0),zn(An,e)}function Yh(){return fl(1)}function Qo(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Yh()(dn(e,os(e)))}var Xh=["addListener","removeListener"],Zh=["addEventListener","removeEventListener"],Qh=["on","off"];function Cr(e,t,n,s){if(ce(n)&&(s=n,n=void 0),s)return Cr(e,t,n).pipe(hl(s));var i=on(nf(e)?Zh.map(function(a){return function(c){return e[a](t,c,n)}}):ef(e)?Xh.map(ea(e,t)):tf(e)?Qh.map(ea(e,t)):[],2),r=i[0],o=i[1];if(!r&&Yr(e))return zn(function(a){return Cr(a,t,n)})(Bt(e));if(!r)throw new TypeError("Invalid event target");return new et(function(a){var c=function(){for(var u=[],d=0;d<arguments.length;d++)u[d]=arguments[d];return a.next(1<u.length?u:u[0])};return r(c),function(){return o(c)}})}function ea(e,t){return function(n){return function(s){return e[n](t,s)}}}function ef(e){return ce(e.addListener)&&ce(e.removeListener)}function tf(e){return ce(e.on)&&ce(e.off)}function nf(e){return ce(e.addEventListener)&&ce(e.removeEventListener)}function sf(e,t,n){return new et(function(s){var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return s.next(o.length===1?o[0]:o)},r=e(i);return ce(t)?function(){return t(i,r)}:void 0})}function Xr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=os(e),s=Eh(e,1/0),i=e;return i.length?i.length===1?Bt(i[0]):fl(s)(dn(i,n)):Th}function yi(e,t){return ce(t)?zn(e,t,1):zn(e,1)}function rf(e,t){return t===void 0&&(t=Ch),yt(function(n,s){var i=null,r=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var u=r;r=null,s.next(u)}};function c(){var u=o+e,d=t.now();if(d<u){i=this.schedule(void 0,u-d),s.add(i);return}a()}n.subscribe(Pt(s,function(u){r=u,o=t.now(),i||(i=t.schedule(c,e),s.add(i))},function(){a(),s.complete()},void 0,function(){r=i=null}))})}function We(e,t){return t===void 0&&(t=An),e=e??of,yt(function(n,s){var i,r=!0;n.subscribe(Pt(s,function(o){var a=t(o);(r||!e(i,a))&&(r=!1,i=a,s.next(o))}))})}function of(e,t){return e===t}function ys(e,t){return We(function(n,s){return n[e]===s[e]})}function af(){return yt(function(e,t){var n,s=!1;e.subscribe(Pt(t,function(i){var r=n;n=i,s&&t.next([r,i]),s=!0}))})}function cf(e){e===void 0&&(e={});var t=e.connector,n=t===void 0?function(){return new Si}:t,s=e.resetOnError,i=s===void 0?!0:s,r=e.resetOnComplete,o=r===void 0?!0:r,a=e.resetOnRefCountZero,c=a===void 0?!0:a;return function(u){var d,p,l,h=0,m=!1,f=!1,g=function(){p?.unsubscribe(),p=void 0},S=function(){g(),d=l=void 0,m=f=!1},C=function(){var y=d;S(),y?.unsubscribe()};return yt(function(y,T){h++,!f&&!m&&g();var k=l=l??n();T.add(function(){h--,h===0&&!f&&!m&&(p=Ji(C,c))}),k.subscribe(T),!d&&h>0&&(d=new Jn({next:function(I){return k.next(I)},error:function(I){f=!0,g(),p=Ji(S,i,I),k.error(I)},complete:function(){m=!0,g(),p=Ji(S,o),k.complete()}}),Bt(y).subscribe(d))})(u)}}function Ji(e,t){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(t===!0){e();return}if(t!==!1){var i=new Jn({next:function(){i.unsubscribe(),e()}});return Bt(t.apply(void 0,wn([],on(n)))).subscribe(i)}}function je(e,t,n){var s,i,r,o,a=!1;return e&&typeof e=="object"?(s=e.bufferSize,o=s===void 0?1/0:s,i=e.windowTime,t=i===void 0?1/0:i,r=e.refCount,a=r===void 0?!1:r,n=e.scheduler):o=e??1/0,cf({connector:function(){return new Ys(o,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function as(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=os(e);return yt(function(s,i){(n?Qo(e,s,n):Qo(e,s)).subscribe(i)})}function Tr(e,t){return t===void 0&&(t=!1),yt(function(n,s){var i=0;n.subscribe(Pt(s,function(r){var o=e(r,i++);(o||t)&&s.next(r),!o&&s.complete()}))})}function lf(e,t,n){var s=ce(e)||t||n?{next:e,error:t,complete:n}:e;return s?yt(function(i,r){var o;(o=s.subscribe)===null||o===void 0||o.call(s);var a=!0;i.subscribe(Pt(r,function(c){var u;(u=s.next)===null||u===void 0||u.call(s,c),r.next(c)},function(){var c;a=!1,(c=s.complete)===null||c===void 0||c.call(s),r.complete()},function(c){var u;a=!1,(u=s.error)===null||u===void 0||u.call(s,c),r.error(c)},function(){var c,u;a&&((c=s.unsubscribe)===null||c===void 0||c.call(s)),(u=s.finalize)===null||u===void 0||u.call(s)}))}):An}var Un={exports:{}},uf=Un.exports,ta;function df(){return ta||(ta=1,function(e,t){(function(n,s){var i="1.0.41",r="",o="?",a="function",c="undefined",u="object",d="string",p="major",l="model",h="name",m="type",f="vendor",g="version",S="architecture",C="console",y="mobile",T="tablet",k="smarttv",I="wearable",R="embedded",A=500,B="Amazon",N="Apple",$="ASUS",j="BlackBerry",D="Browser",E="Chrome",O="Edge",U="Firefox",H="Google",_="Honor",G="Huawei",se="Lenovo",De="LG",Ke="Microsoft",ne="Motorola",Te="Nvidia",he="OnePlus",ve="Opera",Je="OPPO",pt="Samsung",Dt="Sharp",Xe="Sony",Tt="Xiaomi",X="Zebra",ie="Facebook",Q="Chromium OS",fe="Mac OS",Se=" Browser",re=function(K,ee){var J={};for(var de in K)ee[de]&&ee[de].length%2===0?J[de]=ee[de].concat(K[de]):J[de]=K[de];return J},Pe=function(K){for(var ee={},J=0;J<K.length;J++)ee[K[J].toUpperCase()]=K[J];return ee},xe=function(K,ee){return typeof K===d?ke(ee).indexOf(ke(K))!==-1:!1},ke=function(K){return K.toLowerCase()},ct=function(K){return typeof K===d?K.replace(/[^\d\.]/g,r).split(".")[0]:s},F=function(K,ee){if(typeof K===d)return K=K.replace(/^\s\s*/,r),typeof ee===c?K:K.substring(0,A)},z=function(K,ee){for(var J=0,de,lt,Ze,te,W,ut;J<ee.length&&!W;){var mn=ee[J],Ln=ee[J+1];for(de=lt=0;de<mn.length&&!W&&mn[de];)if(W=mn[de++].exec(K),W)for(Ze=0;Ze<Ln.length;Ze++)ut=W[++lt],te=Ln[Ze],typeof te===u&&te.length>0?te.length===2?typeof te[1]==a?this[te[0]]=te[1].call(this,ut):this[te[0]]=te[1]:te.length===3?typeof te[1]===a&&!(te[1].exec&&te[1].test)?this[te[0]]=ut?te[1].call(this,ut,te[2]):s:this[te[0]]=ut?ut.replace(te[1],te[2]):s:te.length===4&&(this[te[0]]=ut?te[3].call(this,ut.replace(te[1],te[2])):s):this[te]=ut||s;J+=2}},M=function(K,ee){for(var J in ee)if(typeof ee[J]===u&&ee[J].length>0){for(var de=0;de<ee[J].length;de++)if(xe(ee[J][de],K))return J===o?s:J}else if(xe(ee[J],K))return J===o?s:J;return ee.hasOwnProperty("*")?ee["*"]:K},ue={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},pe={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ce={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,g],[/opios[\/ ]+([\w\.]+)/i],[g,[h,ve+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[g,[h,ve+" GX"]],[/\bopr\/([\w\.]+)/i],[g,[h,ve]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[h,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[g,[h,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,g],[/quark(?:pc)?\/([-\w\.]+)/i],[g,[h,"Quark"]],[/\bddg\/([\w\.]+)/i],[g,[h,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[h,"UC"+D]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[h,"Smart Lenovo "+D]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+D],g],[/\bfocus\/([\w\.]+)/i],[g,[h,U+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[h,ve+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[h,ve+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[h,"MIUI"+Se]],[/fxios\/([\w\.-]+)/i],[g,[h,U]],[/\bqihoobrowser\/?([\w\.]*)/i],[g,[h,"360"]],[/\b(qq)\/([\w\.]+)/i],[[h,/(.+)/,"$1Browser"],g],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1"+Se],g],[/samsungbrowser\/([\w\.]+)/i],[g,[h,pt+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[g,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[h,g],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[h],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[g,h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,ie],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[h,E+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,E+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[h,"Android "+D]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[g,M,ue]],[/(webkit|khtml)\/([\w\.]+)/i],[h,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],g],[/(wolvic|librewolf)\/([\w\.]+)/i],[h,g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[h,U+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[h,[g,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[h,[g,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[S,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[S,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[S,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[S,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[S,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[S,/ower/,r,ke]],[/ sun4\w[;\)]/i],[[S,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[S,ke]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[f,pt],[m,T]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[l,[f,pt],[m,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[l,[f,N],[m,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[f,N],[m,T]],[/(macintosh);/i],[l,[f,N]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[f,Dt],[m,y]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[l,[f,_],[m,T]],[/honor([-\w ]+)[;\)]/i],[l,[f,_],[m,y]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[l,[f,G],[m,T]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[f,G],[m,y]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[l,/_/g," "],[f,Tt],[m,T]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[l,/_/g," "],[f,Tt],[m,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[f,Je],[m,y]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[l,[f,M,{OnePlus:["304","403","203"],"*":Je}],[m,T]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[f,"Vivo"],[m,y]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[l,[f,"Realme"],[m,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[f,ne],[m,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[f,ne],[m,T]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[f,De],[m,T]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[f,De],[m,y]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[l,[f,se],[m,T]],[/(nokia) (t[12][01])/i],[f,l,[m,T]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[l,/_/g," "],[m,y],[f,"Nokia"]],[/(pixel (c|tablet))\b/i],[l,[f,H],[m,T]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[f,H],[m,y]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[f,Xe],[m,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[f,Xe],[m,T]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[f,he],[m,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[f,B],[m,T]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[f,B],[m,y]],[/(playbook);[-\w\),; ]+(rim)/i],[l,f,[m,T]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[f,j],[m,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[f,$],[m,T]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[f,$],[m,y]],[/(nexus 9)/i],[l,[f,"HTC"],[m,T]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[l,/_/g," "],[m,y]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[l,[f,"TCL"],[m,T]],[/(itel) ((\w+))/i],[[f,ke],l,[m,M,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[f,"Acer"],[m,T]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[f,"Meizu"],[m,y]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[l,[f,"Ulefone"],[m,y]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[l,[f,"Energizer"],[m,y]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[l,[f,"Cat"],[m,y]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[l,[f,"Smartfren"],[m,y]],[/droid.+; (a(?:015|06[35]|142p?))/i],[l,[f,"Nothing"],[m,y]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[l,[f,"Archos"],[m,T]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[l,[f,"Archos"],[m,y]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[f,l,[m,T]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[f,l,[m,y]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,l,[m,T]],[/(surface duo)/i],[l,[f,Ke],[m,T]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[f,"Fairphone"],[m,y]],[/(u304aa)/i],[l,[f,"AT&T"],[m,y]],[/\bsie-(\w*)/i],[l,[f,"Siemens"],[m,y]],[/\b(rct\w+) b/i],[l,[f,"RCA"],[m,T]],[/\b(venue[\d ]{2,7}) b/i],[l,[f,"Dell"],[m,T]],[/\b(q(?:mv|ta)\w+) b/i],[l,[f,"Verizon"],[m,T]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[f,"Barnes & Noble"],[m,T]],[/\b(tm\d{3}\w+) b/i],[l,[f,"NuVision"],[m,T]],[/\b(k88) b/i],[l,[f,"ZTE"],[m,T]],[/\b(nx\d{3}j) b/i],[l,[f,"ZTE"],[m,y]],[/\b(gen\d{3}) b.+49h/i],[l,[f,"Swiss"],[m,y]],[/\b(zur\d{3}) b/i],[l,[f,"Swiss"],[m,T]],[/\b((zeki)?tb.*\b) b/i],[l,[f,"Zeki"],[m,T]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],l,[m,T]],[/\b(ns-?\w{0,9}) b/i],[l,[f,"Insignia"],[m,T]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[f,"NextBook"],[m,T]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],l,[m,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],l,[m,y]],[/\b(ph-1) /i],[l,[f,"Essential"],[m,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[f,"Envizen"],[m,T]],[/\b(trio[-\w\. ]+) b/i],[l,[f,"MachSpeed"],[m,T]],[/\btu_(1491) b/i],[l,[f,"Rotor"],[m,T]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[l,[f,Te],[m,T]],[/(sprint) (\w+)/i],[f,l,[m,y]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[f,Ke],[m,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[f,X],[m,T]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[f,X],[m,y]],[/smart-tv.+(samsung)/i],[f,[m,k]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[f,pt],[m,k]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,De],[m,k]],[/(apple) ?tv/i],[f,[l,N+" TV"],[m,k]],[/crkey/i],[[l,E+"cast"],[f,H],[m,k]],[/droid.+aft(\w+)( bui|\))/i],[l,[f,B],[m,k]],[/(shield \w+ tv)/i],[l,[f,Te],[m,k]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[f,Dt],[m,k]],[/(bravia[\w ]+)( bui|\))/i],[l,[f,Xe],[m,k]],[/(mi(tv|box)-?\w+) bui/i],[l,[f,Tt],[m,k]],[/Hbbtv.*(technisat) (.*);/i],[f,l,[m,k]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,F],[l,F],[m,k]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[l,[m,k]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,k]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,l,[m,C]],[/droid.+; (shield)( bui|\))/i],[l,[f,Te],[m,C]],[/(playstation \w+)/i],[l,[f,Xe],[m,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[f,Ke],[m,C]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[l,[f,pt],[m,I]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[f,l,[m,I]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[l,[f,Je],[m,I]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[f,N],[m,I]],[/(opwwe\d{3})/i],[l,[f,he],[m,I]],[/(moto 360)/i],[l,[f,ne],[m,I]],[/(smartwatch 3)/i],[l,[f,Xe],[m,I]],[/(g watch r)/i],[l,[f,De],[m,I]],[/droid.+; (wt63?0{2,3})\)/i],[l,[f,X],[m,I]],[/droid.+; (glass) \d/i],[l,[f,H],[m,I]],[/(pico) (4|neo3(?: link|pro)?)/i],[f,l,[m,I]],[/; (quest( \d| pro)?)/i],[l,[f,ie],[m,I]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[m,R]],[/(aeobc)\b/i],[l,[f,B],[m,R]],[/(homepod).+mac os/i],[l,[f,N],[m,R]],[/windows iot/i],[[m,R]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[l,[m,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[m,T]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,T]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,y]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[l,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[h,O+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[h,g],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,g],[/ladybird\//i],[[h,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,g],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[h,[g,M,pe]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,M,pe],[h,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,fe],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,h],[/(ubuntu) ([\w\.]+) like android/i],[[h,/(.+)/,"$1 Touch"],g],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[h,g],[/\(bb(10);/i],[g,[h,j]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[g,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[h,U+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[h,E+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,Q],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,g],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,g]]},Ue=function(K,ee){if(typeof K===u&&(ee=K,K=s),!(this instanceof Ue))return new Ue(K,ee).getResult();var J=typeof n!==c&&n.navigator?n.navigator:s,de=K||(J&&J.userAgent?J.userAgent:r),lt=J&&J.userAgentData?J.userAgentData:s,Ze=ee?re(Ce,ee):Ce,te=J&&J.userAgent==de;return this.getBrowser=function(){var W={};return W[h]=s,W[g]=s,z.call(W,de,Ze.browser),W[p]=ct(W[g]),te&&J&&J.brave&&typeof J.brave.isBrave==a&&(W[h]="Brave"),W},this.getCPU=function(){var W={};return W[S]=s,z.call(W,de,Ze.cpu),W},this.getDevice=function(){var W={};return W[f]=s,W[l]=s,W[m]=s,z.call(W,de,Ze.device),te&&!W[m]&&lt&&lt.mobile&&(W[m]=y),te&&W[l]=="Macintosh"&&J&&typeof J.standalone!==c&&J.maxTouchPoints&&J.maxTouchPoints>2&&(W[l]="iPad",W[m]=T),W},this.getEngine=function(){var W={};return W[h]=s,W[g]=s,z.call(W,de,Ze.engine),W},this.getOS=function(){var W={};return W[h]=s,W[g]=s,z.call(W,de,Ze.os),te&&!W[h]&&lt&&lt.platform&&lt.platform!="Unknown"&&(W[h]=lt.platform.replace(/chrome os/i,Q).replace(/macos/i,fe)),W},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return de},this.setUA=function(W){return de=typeof W===d&&W.length>A?F(W,A):W,this},this.setUA(de),this};Ue.VERSION=i,Ue.BROWSER=Pe([h,g,p]),Ue.CPU=Pe([S]),Ue.DEVICE=Pe([l,f,m,C,y,k,T,I,R]),Ue.ENGINE=Ue.OS=Pe([h,g]),e.exports&&(t=e.exports=Ue),t.UAParser=Ue;var mt=typeof n!==c&&(n.jQuery||n.Zepto);if(mt&&!mt.ua){var kt=new Ue;mt.ua=kt.getResult(),mt.ua.get=function(){return kt.getUA()},mt.ua.set=function(K){kt.setUA(K);var ee=kt.getResult();for(var J in ee)mt.ua[J]=ee[J]}}})(typeof window=="object"?window:uf)}(Un,Un.exports)),Un.exports}var hf=df(),gt={},zi={},Yi={exports:{}},na;function Zr(){if(na)return Yi.exports;na=1;var e=Yi.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var n="candidate:%s %d %s %d %s %d typ %s";return n+=t.raddr!=null?" raddr %s rport %d":"%v%v",n+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(n+=" generation %d"),n+=t["network-id"]!=null?" network-id %d":"%v",n+=t["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var n="ssrc:%d";return t.attribute!=null&&(n+=" %s",t.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var n="mediaclk:";return n+=t.id!=null?"id=%s %s":"%v%s",n+=t.mediaClockValue!=null?"=%s":"",n+=t.rateNumerator!=null?" rate=%s":"",n+=t.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach(function(t){var n=e[t];n.forEach(function(s){s.reg||(s.reg=/(.*)/),s.format||(s.format="%s")})}),Yi.exports}var sa;function ff(){return sa||(sa=1,function(e){var t=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,u,d){if(d&&!u)c[d]=t(a[1]);else for(var p=0;p<u.length;p+=1)a[p+1]!=null&&(c[u[p]]=t(a[p+1]))},s=function(a,c,u){var d=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:d&&!c[a.name]&&(c[a.name]={});var p=a.push?{}:d?c[a.name]:c;n(u.match(a.reg),p,a.names,a.name),a.push&&c[a.push].push(p)},i=Zr(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(a){var c={},u=[],d=c;return a.split(/(\r\n|\r|\n)/).filter(r).forEach(function(p){var l=p[0],h=p.slice(2);l==="m"&&(u.push({rtp:[],fmtp:[]}),d=u[u.length-1]);for(var m=0;m<(i[l]||[]).length;m+=1){var f=i[l][m];if(f.reg.test(h))return s(f,d,h)}}),c.media=u,c};var o=function(a,c){var u=c.split(/=(.+)/,2);return u.length===2?a[u[0]]=t(u[1]):u.length===1&&c.length>1&&(a[u[0]]=void 0),a};e.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(a){return a.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(a){for(var c=[],u=a.split(" ").map(t),d=0;d<u.length;d+=3)c.push({component:u[d],ip:u[d+1],port:u[d+2]});return c},e.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},e.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(u){var d,p=!1;return u[0]!=="~"?d=t(u):(d=t(u.substring(1,u.length)),p=!0),{scid:d,paused:p}})})}}(zi)),zi}var Xi,ia;function pf(){if(ia)return Xi;ia=1;var e=Zr(),t=/%[sdv%]/g,n=function(o){var a=1,c=arguments,u=c.length;return o.replace(t,function(d){if(a>=u)return d;var p=c[a];switch(a+=1,d){case"%%":return"%";case"%s":return String(p);case"%d":return Number(p);case"%v":return""}})},s=function(o,a,c){var u=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,d=[o+"="+u];if(a.names)for(var p=0;p<a.names.length;p+=1){var l=a.names[p];a.name?d.push(c[a.name][l]):d.push(c[a.names[p]])}else d.push(c[a.name]);return n.apply(null,d)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],r=["i","c","b","a"];return Xi=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(p){p.payloads==null&&(p.payloads="")});var c=a.outerOrder||i,u=a.innerOrder||r,d=[];return c.forEach(function(p){e[p].forEach(function(l){l.name in o&&o[l.name]!=null?d.push(s(p,l,o)):l.push in o&&o[l.push]!=null&&o[l.push].forEach(function(h){d.push(s(p,l,h))})})}),o.media.forEach(function(p){d.push(s("m",e.m[0],p)),u.forEach(function(l){e[l].forEach(function(h){h.name in p&&p[h.name]!=null?d.push(s(l,h,p)):h.push in p&&p[h.push]!=null&&p[h.push].forEach(function(m){d.push(s(l,h,m))})})})}),d.join(`\r
`)+`\r
`},Xi}var ra;function mf(){if(ra)return gt;ra=1;var e=ff(),t=pf(),n=Zr();return gt.grammar=n,gt.write=t,gt.parse=e.parse,gt.parseParams=e.parseParams,gt.parseFmtpConfig=e.parseFmtpConfig,gt.parsePayloads=e.parsePayloads,gt.parseRemoteCandidates=e.parseRemoteCandidates,gt.parseImageAttributes=e.parseImageAttributes,gt.parseSimulcastStreamList=e.parseSimulcastStreamList,gt}var js=mf();const oa=()=>typeof navigator>"u"?!1:navigator.product?.toLowerCase()==="reactnative";var Xs;(function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error"})(Xs||(Xs={}));const gf=(e,t,...n)=>{let s;switch(e){case"error":if(oa()){t=`ERROR: ${t}`,s=console.info;break}s=console.error;break;case"warn":if(oa()){t=`WARN: ${t}`,s=console.info;break}s=console.warn;break;case"info":s=console.info;break;case"trace":s=console.trace;break;default:s=console.log;break}s(t,...n)},bf="info",vf=gf,aa=new Map([["default",vf]]),Cs=new Map([["default",bf]]),pl=(e,t={})=>{const n=(t.tags??[]).filter(Boolean).join(","),s=i=>(r,...o)=>{const a=Cs.get(e)??Cs.get("default");Xs[i]>=Xs[a]&&(aa.get(e)??aa.get("default"))(i,`[${e}]${n.length?`(${n})`:""}: ${r}`,...o)};return{withExtraTags:(...i)=>pl(e,{...t,tags:t.tags?t.tags.concat(i):i}),getLogLevel:()=>Cs.get(e)??Cs.get("default"),error:s("error"),trace:s("trace"),debug:s("debug"),info:s("info"),warn:s("warn")}},Sf={src:'const e=new Map;self.addEventListener("message",t=>{const s=t.data;switch(s.type){case"setTimeout":case"setInterval":e.set(s.id,("setTimeout"===s.type?setTimeout:setInterval)(()=>{!function(e){const t={type:"tick",id:e};self.postMessage(t)}(s.id),"setTimeout"===s.type&&e.delete(s.id)},s.timeout));break;case"clearTimeout":case"clearInterval":("clearTimeout"===s.type?clearTimeout:clearInterval)(e.get(s.id)),e.delete(s.id)}});'};class yf{constructor(t={}){this.currentTimerId=1,this.callbacks=new Map,this.fallback=!1,this.setup=({useWorker:n=!0,name:s="@stream-io/worker-timer"}={})=>{if(!n){this.fallback=!0;return}try{const i=Sf.src,r=new Blob([i],{type:"application/javascript; charset=utf-8"}),o=URL.createObjectURL(r);this.worker=new Worker(o,{name:s}),this.worker.addEventListener("message",a=>{const{type:c,id:u}=a.data;c==="tick"&&this.callbacks.get(u)?.()})}catch(i){pl("timer-worker").error(i),this.fallback=!0}},this.destroy=()=>{this.callbacks.clear(),this.worker?.terminate(),this.worker=void 0,this.fallback=!1},this.setInterval=(n,s)=>this.setTimer("setInterval",n,s),this.clearInterval=n=>{this.clearTimer("clearInterval",n)},this.setTimeout=(n,s)=>this.setTimer("setTimeout",n,s),this.clearTimeout=n=>{this.clearTimer("clearTimeout",n)},this.setTimer=(n,s,i)=>{if(this.ready||this.setup(),this.fallback)return(n==="setTimeout"?setTimeout:setInterval)(s,i);const r=this.getTimerId();return this.callbacks.set(r,()=>{s(),n==="setTimeout"&&this.callbacks.delete(r)}),this.sendMessage({type:n,id:r,timeout:i}),r},this.clearTimer=(n,s)=>{if(s){if(this.ready||this.setup(),this.fallback){(n==="clearTimeout"?clearTimeout:clearInterval)(s);return}this.callbacks.delete(s),this.sendMessage({type:n,id:s})}},this.getTimerId=()=>this.currentTimerId++,this.sendMessage=n=>{if(!this.worker)throw new Error("Cannot use timer worker before it's set up");this.worker.postMessage(n)},this.setup(t)}get ready(){return this.fallback||!!this.worker}}const Zi={AVAILABLE:"available",DISABLED:"disabled",AUTO_ON:"auto-on"},q={BLOCK_USERS:"block-users",CHANGE_MAX_DURATION:"change-max-duration",CREATE_CALL:"create-call",CREATE_REACTION:"create-reaction",ENABLE_NOISE_CANCELLATION:"enable-noise-cancellation",END_CALL:"end-call",JOIN_BACKSTAGE:"join-backstage",JOIN_CALL:"join-call",JOIN_ENDED_CALL:"join-ended-call",KICK_USER:"kick-user",MUTE_USERS:"mute-users",PIN_FOR_EVERYONE:"pin-for-everyone",READ_CALL:"read-call",REMOVE_CALL_MEMBER:"remove-call-member",SCREENSHARE:"screenshare",SEND_AUDIO:"send-audio",SEND_CLOSED_CAPTIONS_CALL:"send-closed-captions-call",SEND_VIDEO:"send-video",START_BROADCAST_CALL:"start-broadcast-call",START_CLOSED_CAPTIONS_CALL:"start-closed-captions-call",START_FRAME_RECORD_CALL:"start-frame-record-call",START_RECORD_CALL:"start-record-call",START_TRANSCRIPTION_CALL:"start-transcription-call",STOP_BROADCAST_CALL:"stop-broadcast-call",STOP_CLOSED_CAPTIONS_CALL:"stop-closed-captions-call",STOP_FRAME_RECORD_CALL:"stop-frame-record-call",STOP_RECORD_CALL:"stop-record-call",STOP_TRANSCRIPTION_CALL:"stop-transcription-call",UPDATE_CALL:"update-call",UPDATE_CALL_MEMBER:"update-call-member",UPDATE_CALL_PERMISSIONS:"update-call-permissions",UPDATE_CALL_SETTINGS:"update-call-settings"};class kr extends Error{constructor({message:t,code:n,status:s,response:i,unrecoverable:r}){super(t),this.name="ErrorFromResponse",this.code=n,this.response=i,this.status=s,this.unrecoverable=r}toJSON(){const t=[["status",this.status],["code",this.code],["unrecoverable",this.unrecoverable]],n=[];for(const[s,i]of t)typeof i<"u"&&i!==null&&n.push(`${s}: ${i}`);return{message:`(${n.join(", ")}) - ${this.message}`,stack:this.stack,name:this.name}}}var Zs;(function(e){e[e.NULL_VALUE=0]="NULL_VALUE"})(Zs||(Zs={}));class Cf extends x{constructor(){super("google.protobuf.Struct",[{no:1,name:"fields",kind:"map",K:9,V:{kind:"message",T:()=>yn}}])}internalJsonWrite(t,n){let s={};for(let[i,r]of Object.entries(t.fields))s[i]=yn.toJson(r);return s}internalJsonRead(t,n,s){if(!Hs(t))throw new globalThis.Error("Unable to parse message "+this.typeName+" from JSON "+On(t)+".");s||(s=this.create());for(let[i,r]of globalThis.Object.entries(t))s.fields[i]=yn.fromJson(r);return s}}const Qs=new Cf;class Tf extends x{constructor(){super("google.protobuf.Value",[{no:1,name:"null_value",kind:"enum",oneof:"kind",T:()=>["google.protobuf.NullValue",Zs]},{no:2,name:"number_value",kind:"scalar",oneof:"kind",T:1},{no:3,name:"string_value",kind:"scalar",oneof:"kind",T:9},{no:4,name:"bool_value",kind:"scalar",oneof:"kind",T:8},{no:5,name:"struct_value",kind:"message",oneof:"kind",T:()=>Qs},{no:6,name:"list_value",kind:"message",oneof:"kind",T:()=>ca}])}internalJsonWrite(t,n){if(t.kind.oneofKind===void 0)throw new globalThis.Error;switch(t.kind.oneofKind){case void 0:throw new globalThis.Error;case"boolValue":return t.kind.boolValue;case"nullValue":return null;case"numberValue":let s=t.kind.numberValue;if(typeof s=="number"&&!Number.isFinite(s))throw new globalThis.Error;return s;case"stringValue":return t.kind.stringValue;case"listValue":let i=this.fields.find(o=>o.no===6);if(i?.kind!=="message")throw new globalThis.Error;return i.T().toJson(t.kind.listValue);case"structValue":let r=this.fields.find(o=>o.no===5);if(r?.kind!=="message")throw new globalThis.Error;return r.T().toJson(t.kind.structValue)}}internalJsonRead(t,n,s){switch(s||(s=this.create()),typeof t){case"number":s.kind={oneofKind:"numberValue",numberValue:t};break;case"string":s.kind={oneofKind:"stringValue",stringValue:t};break;case"boolean":s.kind={oneofKind:"boolValue",boolValue:t};break;case"object":t===null?s.kind={oneofKind:"nullValue",nullValue:Zs.NULL_VALUE}:globalThis.Array.isArray(t)?s.kind={oneofKind:"listValue",listValue:ca.fromJson(t)}:s.kind={oneofKind:"structValue",structValue:Qs.fromJson(t)};break;default:throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+On(t))}return s}}const yn=new Tf;class kf extends x{constructor(){super("google.protobuf.ListValue",[{no:1,name:"values",kind:"message",repeat:2,T:()=>yn}])}internalJsonWrite(t,n){return t.values.map(s=>yn.toJson(s))}internalJsonRead(t,n,s){if(!globalThis.Array.isArray(t))throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+On(t));s||(s=this.create());let i=t.map(r=>yn.fromJson(r));return s.values.push(...i),s}}const ca=new kf;class wf extends x{constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}])}now(){const t=this.create(),n=Date.now();return t.seconds=ge.from(Math.floor(n/1e3)).toString(),t.nanos=n%1e3*1e6,t}toDate(t){return new Date(ge.from(t.seconds).toNumber()*1e3+Math.ceil(t.nanos/1e6))}fromDate(t){const n=this.create(),s=t.getTime();return n.seconds=ge.from(Math.floor(s/1e3)).toString(),n.nanos=(s%1e3+(s<0&&s%1e3!==0?1e3:0))*1e6,n}internalJsonWrite(t,n){let s=ge.from(t.seconds).toNumber()*1e3;if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(t.nanos<0)throw new Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let i="Z";if(t.nanos>0){let r=(t.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(s).toISOString().replace(".000Z",i)}internalJsonRead(t,n,s){if(typeof t!="string")throw new Error("Unable to parse Timestamp from JSON "+On(t)+".");let i=t.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("Unable to parse Timestamp from JSON. Invalid format.");let r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("Unable to parse Timestamp from JSON. Invalid value.");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return s||(s=this.create()),s.seconds=ge.from(r/1e3).toString(),s.nanos=0,i[7]&&(s.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),s}}const Yn=new wf;var Ne;(function(e){e[e.PUBLISHER_UNSPECIFIED=0]="PUBLISHER_UNSPECIFIED",e[e.SUBSCRIBER=1]="SUBSCRIBER"})(Ne||(Ne={}));var Xn;(function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.POOR=1]="POOR",e[e.GOOD=2]="GOOD",e[e.EXCELLENT=3]="EXCELLENT"})(Xn||(Xn={}));var zt;(function(e){e[e.LOW_UNSPECIFIED=0]="LOW_UNSPECIFIED",e[e.MID=1]="MID",e[e.HIGH=2]="HIGH",e[e.OFF=3]="OFF"})(zt||(zt={}));var P;(function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.AUDIO=1]="AUDIO",e[e.VIDEO=2]="VIDEO",e[e.SCREEN_SHARE=3]="SCREEN_SHARE",e[e.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"})(P||(P={}));var _t;(function(e){e[e.WEBRTC_UNSPECIFIED=0]="WEBRTC_UNSPECIFIED",e[e.RTMP=1]="RTMP",e[e.WHIP=2]="WHIP",e[e.SIP=3]="SIP",e[e.RTSP=4]="RTSP",e[e.SRT=5]="SRT"})(_t||(_t={}));var ft;(function(e){e[e.VOICE_STANDARD_UNSPECIFIED=0]="VOICE_STANDARD_UNSPECIFIED",e[e.VOICE_HIGH_QUALITY=1]="VOICE_HIGH_QUALITY",e[e.MUSIC_HIGH_QUALITY=2]="MUSIC_HIGH_QUALITY"})(ft||(ft={}));var an;(function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.PUBLISH_TRACK_NOT_FOUND=100]="PUBLISH_TRACK_NOT_FOUND",e[e.PUBLISH_TRACKS_MISMATCH=101]="PUBLISH_TRACKS_MISMATCH",e[e.PUBLISH_TRACK_OUT_OF_ORDER=102]="PUBLISH_TRACK_OUT_OF_ORDER",e[e.PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND=103]="PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND",e[e.LIVE_ENDED=104]="LIVE_ENDED",e[e.PARTICIPANT_NOT_FOUND=200]="PARTICIPANT_NOT_FOUND",e[e.PARTICIPANT_MIGRATING_OUT=201]="PARTICIPANT_MIGRATING_OUT",e[e.PARTICIPANT_MIGRATION_FAILED=202]="PARTICIPANT_MIGRATION_FAILED",e[e.PARTICIPANT_MIGRATING=203]="PARTICIPANT_MIGRATING",e[e.PARTICIPANT_RECONNECT_FAILED=204]="PARTICIPANT_RECONNECT_FAILED",e[e.PARTICIPANT_MEDIA_TRANSPORT_FAILURE=205]="PARTICIPANT_MEDIA_TRANSPORT_FAILURE",e[e.PARTICIPANT_SIGNAL_LOST=206]="PARTICIPANT_SIGNAL_LOST",e[e.CALL_NOT_FOUND=300]="CALL_NOT_FOUND",e[e.CALL_PARTICIPANT_LIMIT_REACHED=301]="CALL_PARTICIPANT_LIMIT_REACHED",e[e.REQUEST_VALIDATION_FAILED=400]="REQUEST_VALIDATION_FAILED",e[e.UNAUTHENTICATED=401]="UNAUTHENTICATED",e[e.PERMISSION_DENIED=403]="PERMISSION_DENIED",e[e.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",e[e.SFU_SHUTTING_DOWN=600]="SFU_SHUTTING_DOWN",e[e.SFU_FULL=700]="SFU_FULL"})(an||(an={}));var Qt;(function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.REACT=1]="REACT",e[e.ANGULAR=2]="ANGULAR",e[e.ANDROID=3]="ANDROID",e[e.IOS=4]="IOS",e[e.FLUTTER=5]="FLUTTER",e[e.REACT_NATIVE=6]="REACT_NATIVE",e[e.UNITY=7]="UNITY",e[e.GO=8]="GO",e[e.PLAIN_JAVASCRIPT=9]="PLAIN_JAVASCRIPT"})(Qt||(Qt={}));var Zn;(function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.USER_MUTED=1]="USER_MUTED",e[e.PERMISSION_REVOKED=2]="PERMISSION_REVOKED",e[e.MODERATION=3]="MODERATION"})(Zn||(Zn={}));var ei;(function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SHUTTING_DOWN=1]="SHUTTING_DOWN",e[e.REBALANCE=2]="REBALANCE"})(ei||(ei={}));var En;(function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ENDED=1]="ENDED",e[e.LIVE_ENDED=2]="LIVE_ENDED",e[e.KICKED=3]="KICKED",e[e.SESSION_ENDED=4]="SESSION_ENDED"})(En||(En={}));var Y;(function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.DISCONNECT=1]="DISCONNECT",e[e.FAST=2]="FAST",e[e.REJOIN=3]="REJOIN",e[e.MIGRATE=4]="MIGRATE"})(Y||(Y={}));var ti;(function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.NONE=1]="NONE",e[e.LIGHT=2]="LIGHT",e[e.MODERATE=3]="MODERATE",e[e.SEVERE=4]="SEVERE",e[e.CRITICAL=5]="CRITICAL",e[e.EMERGENCY=6]="EMERGENCY",e[e.SHUTDOWN=7]="SHUTDOWN"})(ti||(ti={}));var ni;(function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.NOMINAL=1]="NOMINAL",e[e.FAIR=2]="FAIR",e[e.SERIOUS=3]="SERIOUS",e[e.CRITICAL=4]="CRITICAL"})(ni||(ni={}));var Qn;(function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SUBSCRIBER_VIDEO_PAUSE=1]="SUBSCRIBER_VIDEO_PAUSE"})(Qn||(Qn={}));class Ef extends x{constructor(){super("stream.video.sfu.models.CallState",[{no:1,name:"participants",kind:"message",repeat:2,T:()=>hn},{no:2,name:"started_at",kind:"message",T:()=>Yn},{no:3,name:"participant_count",kind:"message",T:()=>Qr},{no:4,name:"pins",kind:"message",repeat:2,T:()=>eo}])}}const ml=new Ef;class _f extends x{constructor(){super("stream.video.sfu.models.ParticipantCount",[{no:1,name:"total",kind:"scalar",T:13},{no:2,name:"anonymous",kind:"scalar",T:13}])}}const Qr=new _f;class If extends x{constructor(){super("stream.video.sfu.models.Pin",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}const eo=new If;class Rf extends x{constructor(){super("stream.video.sfu.models.Participant",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"published_tracks",kind:"enum",repeat:1,T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:4,name:"joined_at",kind:"message",T:()=>Yn},{no:5,name:"track_lookup_prefix",kind:"scalar",T:9},{no:6,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",Xn,"CONNECTION_QUALITY_"]},{no:7,name:"is_speaking",kind:"scalar",T:8},{no:8,name:"is_dominant_speaker",kind:"scalar",T:8},{no:9,name:"audio_level",kind:"scalar",T:2},{no:10,name:"name",kind:"scalar",T:9},{no:11,name:"image",kind:"scalar",T:9},{no:12,name:"custom",kind:"message",T:()=>Qs},{no:13,name:"roles",kind:"scalar",repeat:2,T:9},{no:14,name:"source",kind:"enum",T:()=>["stream.video.sfu.models.ParticipantSource",_t,"PARTICIPANT_SOURCE_"]}])}}const hn=new Rf;class Pf extends x{constructor(){super("stream.video.sfu.models.StreamQuality",[{no:1,name:"video_quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",zt,"VIDEO_QUALITY_"]},{no:2,name:"user_id",kind:"scalar",T:9}])}}const xf=new Pf;class Of extends x{constructor(){super("stream.video.sfu.models.VideoDimension",[{no:1,name:"width",kind:"scalar",T:13},{no:2,name:"height",kind:"scalar",T:13}])}}const cs=new Of;class Af extends x{constructor(){super("stream.video.sfu.models.VideoLayer",[{no:1,name:"rid",kind:"scalar",T:9},{no:2,name:"video_dimension",kind:"message",T:()=>cs},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"fps",kind:"scalar",T:13},{no:6,name:"quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",zt,"VIDEO_QUALITY_"]}])}}const gl=new Af;class Df extends x{constructor(){super("stream.video.sfu.models.SubscribeOption",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:2,name:"codecs",kind:"message",repeat:2,T:()=>Ot}])}}const to=new Df;class Nf extends x{constructor(){super("stream.video.sfu.models.PublishOption",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:2,name:"codec",kind:"message",T:()=>Ot},{no:3,name:"bitrate",kind:"scalar",T:5},{no:4,name:"fps",kind:"scalar",T:5},{no:5,name:"max_spatial_layers",kind:"scalar",T:5},{no:6,name:"max_temporal_layers",kind:"scalar",T:5},{no:7,name:"video_dimension",kind:"message",T:()=>cs},{no:8,name:"id",kind:"scalar",T:5},{no:9,name:"use_single_layer",kind:"scalar",T:8},{no:10,name:"audio_bitrate_profiles",kind:"message",repeat:2,T:()=>bl}])}}const _n=new Nf;class Lf extends x{constructor(){super("stream.video.sfu.models.Codec",[{no:16,name:"payload_type",kind:"scalar",T:13},{no:10,name:"name",kind:"scalar",T:9},{no:14,name:"clock_rate",kind:"scalar",T:13},{no:15,name:"encoding_parameters",kind:"scalar",T:9},{no:12,name:"fmtp",kind:"scalar",T:9}])}}const Ot=new Lf;let Mf=class extends x{constructor(){super("stream.video.sfu.models.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Ne,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}};const no=new Mf;class jf extends x{constructor(){super("stream.video.sfu.models.AudioBitrate",[{no:1,name:"profile",kind:"enum",T:()=>["stream.video.sfu.models.AudioBitrateProfile",ft,"AUDIO_BITRATE_PROFILE_"]},{no:2,name:"bitrate",kind:"scalar",T:5}])}}const bl=new jf;class Ff extends x{constructor(){super("stream.video.sfu.models.TrackInfo",[{no:1,name:"track_id",kind:"scalar",T:9},{no:2,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:5,name:"layers",kind:"message",repeat:2,T:()=>gl},{no:6,name:"mid",kind:"scalar",T:9},{no:7,name:"dtx",kind:"scalar",T:8},{no:8,name:"stereo",kind:"scalar",T:8},{no:9,name:"red",kind:"scalar",T:8},{no:10,name:"muted",kind:"scalar",T:8},{no:11,name:"codec",kind:"message",T:()=>Ot},{no:12,name:"publish_option_id",kind:"scalar",T:5}])}}const Ci=new Ff;let Uf=class extends x{constructor(){super("stream.video.sfu.models.Error",[{no:1,name:"code",kind:"enum",T:()=>["stream.video.sfu.models.ErrorCode",an,"ERROR_CODE_"]},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"should_retry",kind:"scalar",T:8}])}};const Ct=new Uf;class $f extends x{constructor(){super("stream.video.sfu.models.ClientDetails",[{no:1,name:"sdk",kind:"message",T:()=>Sl},{no:2,name:"os",kind:"message",T:()=>yl},{no:3,name:"browser",kind:"message",T:()=>Cl},{no:4,name:"device",kind:"message",T:()=>kl}])}}const vl=new $f;class Vf extends x{constructor(){super("stream.video.sfu.models.Sdk",[{no:1,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.SdkType",Qt,"SDK_TYPE_"]},{no:2,name:"major",kind:"scalar",T:9},{no:3,name:"minor",kind:"scalar",T:9},{no:4,name:"patch",kind:"scalar",T:9}])}}const Sl=new Vf;class Bf extends x{constructor(){super("stream.video.sfu.models.OS",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"architecture",kind:"scalar",T:9}])}}const yl=new Bf;class Hf extends x{constructor(){super("stream.video.sfu.models.Browser",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}const Cl=new Hf;class qf extends x{constructor(){super("stream.video.sfu.models.RTMPIngress",[{no:1,name:"width",kind:"scalar",T:13},{no:2,name:"height",kind:"scalar",T:13},{no:3,name:"frame_rate",kind:"scalar",T:1},{no:4,name:"software",kind:"scalar",T:9},{no:5,name:"version",kind:"scalar",T:9},{no:6,name:"encoder",kind:"scalar",T:9},{no:7,name:"remote_addr",kind:"scalar",T:9}])}}const Tl=new qf;class Wf extends x{constructor(){super("stream.video.sfu.models.Device",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}const kl=new Wf;class Gf extends x{constructor(){super("stream.video.sfu.models.Call",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"created_by_user_id",kind:"scalar",T:9},{no:4,name:"host_user_id",kind:"scalar",T:9},{no:5,name:"custom",kind:"message",T:()=>Qs},{no:6,name:"created_at",kind:"message",T:()=>Yn},{no:7,name:"updated_at",kind:"message",T:()=>Yn}])}}const Kf=new Gf;class Jf extends x{constructor(){super("stream.video.sfu.models.CallGrants",[{no:1,name:"can_publish_audio",kind:"scalar",T:8},{no:2,name:"can_publish_video",kind:"scalar",T:8},{no:3,name:"can_screenshare",kind:"scalar",T:8}])}}const wl=new Jf;class zf extends x{constructor(){super("stream.video.sfu.models.InputDevices",[{no:1,name:"available_devices",kind:"scalar",repeat:2,T:9},{no:2,name:"current_device",kind:"scalar",T:9},{no:3,name:"is_permitted",kind:"scalar",T:8}])}}const wr=new zf;class Yf extends x{constructor(){super("stream.video.sfu.models.AndroidState",[{no:1,name:"thermal_state",kind:"enum",T:()=>["stream.video.sfu.models.AndroidThermalState",ti,"ANDROID_THERMAL_STATE_"]},{no:2,name:"is_power_saver_mode",kind:"scalar",T:8}])}}const El=new Yf;class Xf extends x{constructor(){super("stream.video.sfu.models.AppleState",[{no:1,name:"thermal_state",kind:"enum",T:()=>["stream.video.sfu.models.AppleThermalState",ni,"APPLE_THERMAL_STATE_"]},{no:2,name:"is_low_power_mode_enabled",kind:"scalar",T:8}])}}const _l=new Xf;class Zf extends x{constructor(){super("stream.video.sfu.models.PerformanceStats",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:2,name:"codec",kind:"message",T:()=>Ot},{no:3,name:"avg_frame_time_ms",kind:"scalar",T:2},{no:4,name:"avg_fps",kind:"scalar",T:2},{no:5,name:"video_dimension",kind:"message",T:()=>cs},{no:6,name:"target_bitrate",kind:"scalar",T:5}])}}const si=new Zf;var Er=Object.freeze({__proto__:null,AndroidState:El,get AndroidThermalState(){return ti},AppleState:_l,get AppleThermalState(){return ni},AudioBitrate:bl,get AudioBitrateProfile(){return ft},Browser:Cl,Call:Kf,get CallEndedReason(){return En},CallGrants:wl,CallState:ml,get ClientCapability(){return Qn},ClientDetails:vl,Codec:Ot,get ConnectionQuality(){return Xn},Device:kl,Error:Ct,get ErrorCode(){return an},get GoAwayReason(){return ei},ICETrickle:no,InputDevices:wr,OS:yl,Participant:hn,ParticipantCount:Qr,get ParticipantSource(){return _t},get PeerType(){return Ne},PerformanceStats:si,Pin:eo,PublishOption:_n,RTMPIngress:Tl,Sdk:Sl,get SdkType(){return Qt},StreamQuality:xf,SubscribeOption:to,TrackInfo:Ci,get TrackType(){return P},get TrackUnpublishReason(){return Zn},VideoDimension:cs,VideoLayer:gl,get VideoQuality(){return zt},get WebsocketReconnectStrategy(){return Y}});class Qf extends x{constructor(){super("stream.video.sfu.signal.StartNoiseCancellationRequest",[{no:1,name:"session_id",kind:"scalar",T:9}])}}const ep=new Qf;class tp extends x{constructor(){super("stream.video.sfu.signal.StartNoiseCancellationResponse",[{no:1,name:"error",kind:"message",T:()=>Ct}])}}const np=new tp;class sp extends x{constructor(){super("stream.video.sfu.signal.StopNoiseCancellationRequest",[{no:1,name:"session_id",kind:"scalar",T:9}])}}const ip=new sp;class rp extends x{constructor(){super("stream.video.sfu.signal.StopNoiseCancellationResponse",[{no:1,name:"error",kind:"message",T:()=>Ct}])}}const op=new rp;class ap extends x{constructor(){super("stream.video.sfu.signal.Reconnection",[{no:1,name:"time_seconds",kind:"scalar",T:2},{no:2,name:"strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",Y,"WEBSOCKET_RECONNECT_STRATEGY_"]}])}}const cp=new ap;class lp extends x{constructor(){super("stream.video.sfu.signal.Telemetry",[{no:1,name:"connection_time_seconds",kind:"scalar",oneof:"data",T:2},{no:2,name:"reconnection",kind:"message",oneof:"data",T:()=>cp}])}}const up=new lp;class dp extends x{constructor(){super("stream.video.sfu.signal.SendStatsRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"subscriber_stats",kind:"scalar",T:9},{no:3,name:"publisher_stats",kind:"scalar",T:9},{no:4,name:"webrtc_version",kind:"scalar",T:9},{no:5,name:"sdk",kind:"scalar",T:9},{no:6,name:"sdk_version",kind:"scalar",T:9},{no:7,name:"audio_devices",kind:"message",T:()=>wr},{no:8,name:"video_devices",kind:"message",T:()=>wr},{no:9,name:"android",kind:"message",oneof:"deviceState",T:()=>El},{no:10,name:"apple",kind:"message",oneof:"deviceState",T:()=>_l},{no:11,name:"telemetry",kind:"message",T:()=>up},{no:12,name:"rtmp",kind:"message",T:()=>Tl},{no:13,name:"subscriber_rtc_stats",kind:"scalar",T:9},{no:14,name:"publisher_rtc_stats",kind:"scalar",T:9},{no:15,name:"rtc_stats",kind:"scalar",T:9},{no:16,name:"encode_stats",kind:"message",repeat:2,T:()=>si},{no:17,name:"decode_stats",kind:"message",repeat:2,T:()=>si},{no:18,name:"unified_session_id",kind:"scalar",T:9}])}}const hp=new dp;class fp extends x{constructor(){super("stream.video.sfu.signal.SendStatsResponse",[{no:1,name:"error",kind:"message",T:()=>Ct}])}}const pp=new fp;class mp extends x{constructor(){super("stream.video.sfu.signal.ICERestartRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Ne,"PEER_TYPE_"]}])}}const gp=new mp;class bp extends x{constructor(){super("stream.video.sfu.signal.ICERestartResponse",[{no:1,name:"error",kind:"message",T:()=>Ct}])}}const vp=new bp;class Sp extends x{constructor(){super("stream.video.sfu.signal.UpdateMuteStatesRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:3,name:"mute_states",kind:"message",repeat:2,T:()=>wp}])}}const yp=new Sp;class Cp extends x{constructor(){super("stream.video.sfu.signal.UpdateMuteStatesResponse",[{no:4,name:"error",kind:"message",T:()=>Ct}])}}const Tp=new Cp;class kp extends x{constructor(){super("stream.video.sfu.signal.TrackMuteState",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:2,name:"muted",kind:"scalar",T:8}])}}const wp=new kp;class Ep extends x{constructor(){super("stream.video.sfu.signal.AudioMuteChanged",[{no:1,name:"muted",kind:"scalar",T:8}])}}new Ep;class _p extends x{constructor(){super("stream.video.sfu.signal.VideoMuteChanged",[{no:2,name:"muted",kind:"scalar",T:8}])}}new _p;class Ip extends x{constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsRequest",[{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:2,T:()=>so}])}}const Rp=new Ip;class Pp extends x{constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsResponse",[{no:4,name:"error",kind:"message",T:()=>Ct}])}}const xp=new Pp;class Op extends x{constructor(){super("stream.video.sfu.signal.TrackSubscriptionDetails",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:4,name:"dimension",kind:"message",T:()=>cs}])}}const so=new Op;class Ap extends x{constructor(){super("stream.video.sfu.signal.SendAnswerRequest",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Ne,"PEER_TYPE_"]},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}}const Dp=new Ap;class Np extends x{constructor(){super("stream.video.sfu.signal.SendAnswerResponse",[{no:4,name:"error",kind:"message",T:()=>Ct}])}}const Lp=new Np;class Mp extends x{constructor(){super("stream.video.sfu.signal.ICETrickleResponse",[{no:4,name:"error",kind:"message",T:()=>Ct}])}}const jp=new Mp;class Fp extends x{constructor(){super("stream.video.sfu.signal.SetPublisherRequest",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:2,T:()=>Ci}])}}const Up=new Fp;class $p extends x{constructor(){super("stream.video.sfu.signal.SetPublisherResponse",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"ice_restart",kind:"scalar",T:8},{no:4,name:"error",kind:"message",T:()=>Ct}])}}const Vp=new $p,Qi=new Qd("stream.video.sfu.signal.SignalServer",[{name:"SetPublisher",options:{},I:Up,O:Vp},{name:"SendAnswer",options:{},I:Dp,O:Lp},{name:"IceTrickle",options:{},I:no,O:jp},{name:"UpdateSubscriptions",options:{},I:Rp,O:xp},{name:"UpdateMuteStates",options:{},I:yp,O:Tp},{name:"IceRestart",options:{},I:gp,O:vp},{name:"SendStats",options:{},I:hp,O:pp},{name:"StartNoiseCancellation",options:{},I:ep,O:np},{name:"StopNoiseCancellation",options:{},I:ip,O:op}]);class Bp extends x{constructor(){super("stream.video.sfu.event.SfuEvent",[{no:1,name:"subscriber_offer",kind:"message",oneof:"eventPayload",T:()=>_m},{no:2,name:"publisher_answer",kind:"message",oneof:"eventPayload",T:()=>Rm},{no:3,name:"connection_quality_changed",kind:"message",oneof:"eventPayload",T:()=>xm},{no:4,name:"audio_level_changed",kind:"message",oneof:"eventPayload",T:()=>Fm},{no:5,name:"ice_trickle",kind:"message",oneof:"eventPayload",T:()=>no},{no:6,name:"change_publish_quality",kind:"message",oneof:"eventPayload",T:()=>Gm},{no:10,name:"participant_joined",kind:"message",oneof:"eventPayload",T:()=>ym},{no:11,name:"participant_left",kind:"message",oneof:"eventPayload",T:()=>Tm},{no:12,name:"dominant_speaker_changed",kind:"message",oneof:"eventPayload",T:()=>Nm},{no:13,name:"join_response",kind:"message",oneof:"eventPayload",T:()=>vm},{no:14,name:"health_check_response",kind:"message",oneof:"eventPayload",T:()=>am},{no:16,name:"track_published",kind:"message",oneof:"eventPayload",T:()=>lm},{no:17,name:"track_unpublished",kind:"message",oneof:"eventPayload",T:()=>dm},{no:18,name:"error",kind:"message",oneof:"eventPayload",T:()=>Xp},{no:19,name:"call_grants_updated",kind:"message",oneof:"eventPayload",T:()=>Jm},{no:20,name:"go_away",kind:"message",oneof:"eventPayload",T:()=>Ym},{no:21,name:"ice_restart",kind:"message",oneof:"eventPayload",T:()=>em},{no:22,name:"pins_updated",kind:"message",oneof:"eventPayload",T:()=>zp},{no:23,name:"call_ended",kind:"message",oneof:"eventPayload",T:()=>Zm},{no:24,name:"participant_updated",kind:"message",oneof:"eventPayload",T:()=>wm},{no:25,name:"participant_migration_complete",kind:"message",oneof:"eventPayload",T:()=>Kp},{no:27,name:"change_publish_options",kind:"message",oneof:"eventPayload",T:()=>qp},{no:28,name:"inbound_state_notification",kind:"message",oneof:"eventPayload",T:()=>eg}])}}const la=new Bp;class Hp extends x{constructor(){super("stream.video.sfu.event.ChangePublishOptions",[{no:1,name:"publish_options",kind:"message",repeat:2,T:()=>_n},{no:2,name:"reason",kind:"scalar",T:9}])}}const qp=new Hp;class Wp extends x{constructor(){super("stream.video.sfu.event.ChangePublishOptionsComplete",[])}}new Wp;class Gp extends x{constructor(){super("stream.video.sfu.event.ParticipantMigrationComplete",[])}}const Kp=new Gp;class Jp extends x{constructor(){super("stream.video.sfu.event.PinsChanged",[{no:1,name:"pins",kind:"message",repeat:2,T:()=>eo}])}}const zp=new Jp;class Yp extends x{constructor(){super("stream.video.sfu.event.Error",[{no:4,name:"error",kind:"message",T:()=>Ct},{no:5,name:"reconnect_strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",Y,"WEBSOCKET_RECONNECT_STRATEGY_"]}])}}const Xp=new Yp;class Zp extends x{constructor(){super("stream.video.sfu.event.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Ne,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9}])}}new Zp;class Qp extends x{constructor(){super("stream.video.sfu.event.ICERestart",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Ne,"PEER_TYPE_"]}])}}const em=new Qp;class tm extends x{constructor(){super("stream.video.sfu.event.SfuRequest",[{no:1,name:"join_request",kind:"message",oneof:"requestPayload",T:()=>Il},{no:2,name:"health_check_request",kind:"message",oneof:"requestPayload",T:()=>rm},{no:3,name:"leave_call_request",kind:"message",oneof:"requestPayload",T:()=>sm}])}}const Mn=new tm;class nm extends x{constructor(){super("stream.video.sfu.event.LeaveCallRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9}])}}const sm=new nm;class im extends x{constructor(){super("stream.video.sfu.event.HealthCheckRequest",[])}}const rm=new im;class om extends x{constructor(){super("stream.video.sfu.event.HealthCheckResponse",[{no:1,name:"participant_count",kind:"message",T:()=>Qr}])}}const am=new om;class cm extends x{constructor(){super("stream.video.sfu.event.TrackPublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:4,name:"participant",kind:"message",T:()=>hn}])}}const lm=new cm;class um extends x{constructor(){super("stream.video.sfu.event.TrackUnpublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:4,name:"cause",kind:"enum",T:()=>["stream.video.sfu.models.TrackUnpublishReason",Zn,"TRACK_UNPUBLISH_REASON_"]},{no:5,name:"participant",kind:"message",T:()=>hn}])}}const dm=new um;class hm extends x{constructor(){super("stream.video.sfu.event.JoinRequest",[{no:1,name:"token",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:13,name:"unified_session_id",kind:"scalar",T:9},{no:3,name:"subscriber_sdp",kind:"scalar",T:9},{no:8,name:"publisher_sdp",kind:"scalar",T:9},{no:4,name:"client_details",kind:"message",T:()=>vl},{no:5,name:"migration",kind:"message",T:()=>gm},{no:6,name:"fast_reconnect",kind:"scalar",T:8},{no:7,name:"reconnect_details",kind:"message",T:()=>pm},{no:9,name:"preferred_publish_options",kind:"message",repeat:2,T:()=>_n},{no:10,name:"preferred_subscribe_options",kind:"message",repeat:2,T:()=>to},{no:11,name:"capabilities",kind:"enum",repeat:1,T:()=>["stream.video.sfu.models.ClientCapability",Qn,"CLIENT_CAPABILITY_"]},{no:12,name:"source",kind:"enum",T:()=>["stream.video.sfu.models.ParticipantSource",_t,"PARTICIPANT_SOURCE_"]}])}}const Il=new hm;class fm extends x{constructor(){super("stream.video.sfu.event.ReconnectDetails",[{no:1,name:"strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",Y,"WEBSOCKET_RECONNECT_STRATEGY_"]},{no:3,name:"announced_tracks",kind:"message",repeat:2,T:()=>Ci},{no:4,name:"subscriptions",kind:"message",repeat:2,T:()=>so},{no:5,name:"reconnect_attempt",kind:"scalar",T:13},{no:6,name:"from_sfu_id",kind:"scalar",T:9},{no:7,name:"previous_session_id",kind:"scalar",T:9},{no:8,name:"reason",kind:"scalar",T:9}])}}const pm=new fm;class mm extends x{constructor(){super("stream.video.sfu.event.Migration",[{no:1,name:"from_sfu_id",kind:"scalar",T:9},{no:2,name:"announced_tracks",kind:"message",repeat:2,T:()=>Ci},{no:3,name:"subscriptions",kind:"message",repeat:2,T:()=>so}])}}const gm=new mm;class bm extends x{constructor(){super("stream.video.sfu.event.JoinResponse",[{no:1,name:"call_state",kind:"message",T:()=>ml},{no:2,name:"reconnected",kind:"scalar",T:8},{no:3,name:"fast_reconnect_deadline_seconds",kind:"scalar",T:5},{no:4,name:"publish_options",kind:"message",repeat:2,T:()=>_n}])}}const vm=new bm;class Sm extends x{constructor(){super("stream.video.sfu.event.ParticipantJoined",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>hn}])}}const ym=new Sm;class Cm extends x{constructor(){super("stream.video.sfu.event.ParticipantLeft",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>hn}])}}const Tm=new Cm;class km extends x{constructor(){super("stream.video.sfu.event.ParticipantUpdated",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>hn}])}}const wm=new km;class Em extends x{constructor(){super("stream.video.sfu.event.SubscriberOffer",[{no:1,name:"ice_restart",kind:"scalar",T:8},{no:2,name:"sdp",kind:"scalar",T:9}])}}const _m=new Em;class Im extends x{constructor(){super("stream.video.sfu.event.PublisherAnswer",[{no:1,name:"sdp",kind:"scalar",T:9}])}}const Rm=new Im;class Pm extends x{constructor(){super("stream.video.sfu.event.ConnectionQualityChanged",[{no:1,name:"connection_quality_updates",kind:"message",repeat:2,T:()=>Am}])}}const xm=new Pm;class Om extends x{constructor(){super("stream.video.sfu.event.ConnectionQualityInfo",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",Xn,"CONNECTION_QUALITY_"]}])}}const Am=new Om;class Dm extends x{constructor(){super("stream.video.sfu.event.DominantSpeakerChanged",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}const Nm=new Dm;class Lm extends x{constructor(){super("stream.video.sfu.event.AudioLevel",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"level",kind:"scalar",T:2},{no:4,name:"is_speaking",kind:"scalar",T:8}])}}const Mm=new Lm;class jm extends x{constructor(){super("stream.video.sfu.event.AudioLevelChanged",[{no:1,name:"audio_levels",kind:"message",repeat:2,T:()=>Mm}])}}const Fm=new jm;class Um extends x{constructor(){super("stream.video.sfu.event.AudioSender",[{no:2,name:"codec",kind:"message",T:()=>Ot},{no:3,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:4,name:"publish_option_id",kind:"scalar",T:5}])}}const $m=new Um;class Vm extends x{constructor(){super("stream.video.sfu.event.VideoLayerSetting",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"active",kind:"scalar",T:8},{no:3,name:"max_bitrate",kind:"scalar",T:5},{no:4,name:"scale_resolution_down_by",kind:"scalar",T:2},{no:6,name:"codec",kind:"message",T:()=>Ot},{no:7,name:"max_framerate",kind:"scalar",T:13},{no:8,name:"scalability_mode",kind:"scalar",T:9}])}}const Bm=new Vm;class Hm extends x{constructor(){super("stream.video.sfu.event.VideoSender",[{no:2,name:"codec",kind:"message",T:()=>Ot},{no:3,name:"layers",kind:"message",repeat:2,T:()=>Bm},{no:4,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:5,name:"publish_option_id",kind:"scalar",T:5}])}}const qm=new Hm;class Wm extends x{constructor(){super("stream.video.sfu.event.ChangePublishQuality",[{no:1,name:"audio_senders",kind:"message",repeat:2,T:()=>$m},{no:2,name:"video_senders",kind:"message",repeat:2,T:()=>qm}])}}const Gm=new Wm;class Km extends x{constructor(){super("stream.video.sfu.event.CallGrantsUpdated",[{no:1,name:"current_grants",kind:"message",T:()=>wl},{no:2,name:"message",kind:"scalar",T:9}])}}const Jm=new Km;class zm extends x{constructor(){super("stream.video.sfu.event.GoAway",[{no:1,name:"reason",kind:"enum",T:()=>["stream.video.sfu.models.GoAwayReason",ei,"GO_AWAY_REASON_"]}])}}const Ym=new zm;class Xm extends x{constructor(){super("stream.video.sfu.event.CallEnded",[{no:1,name:"reason",kind:"enum",T:()=>["stream.video.sfu.models.CallEndedReason",En,"CALL_ENDED_REASON_"]}])}}const Zm=new Xm;class Qm extends x{constructor(){super("stream.video.sfu.event.InboundStateNotification",[{no:1,name:"inbound_video_states",kind:"message",repeat:2,T:()=>ng}])}}const eg=new Qm;class tg extends x{constructor(){super("stream.video.sfu.event.InboundVideoState",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",P,"TRACK_TYPE_"]},{no:4,name:"paused",kind:"scalar",T:8}])}}const ng=new tg;var Ee;(function(e){e.UNKNOWN="UNKNOWN",e.VISIBLE="VISIBLE",e.INVISIBLE="INVISIBLE"})(Ee||(Ee={}));var wt;(function(e){e[e.IMMEDIATE=20]="IMMEDIATE",e[e.FAST=100]="FAST",e[e.MEDIUM=600]="MEDIUM",e[e.SLOW=1200]="SLOW"})(wt||(wt={}));class sg{constructor(t){this._transport=t,this.typeName=Qi.typeName,this.methods=Qi.methods,this.options=Qi.options}setPublisher(t,n){const s=this.methods[0],i=this._transport.mergeOptions(n);return Nt("unary",this._transport,s,i,t)}sendAnswer(t,n){const s=this.methods[1],i=this._transport.mergeOptions(n);return Nt("unary",this._transport,s,i,t)}iceTrickle(t,n){const s=this.methods[2],i=this._transport.mergeOptions(n);return Nt("unary",this._transport,s,i,t)}updateSubscriptions(t,n){const s=this.methods[3],i=this._transport.mergeOptions(n);return Nt("unary",this._transport,s,i,t)}updateMuteStates(t,n){const s=this.methods[4],i=this._transport.mergeOptions(n);return Nt("unary",this._transport,s,i,t)}iceRestart(t,n){const s=this.methods[5],i=this._transport.mergeOptions(n);return Nt("unary",this._transport,s,i,t)}sendStats(t,n){const s=this.methods[6],i=this._transport.mergeOptions(n);return Nt("unary",this._transport,s,i,t)}startNoiseCancellation(t,n){const s=this.methods[7],i=this._transport.mergeOptions(n);return Nt("unary",this._transport,s,i,t)}stopNoiseCancellation(t,n){const s=this.methods[8],i=this._transport.mergeOptions(n);return Nt("unary",this._transport,s,i,t)}}const ig={baseUrl:"",sendJson:!0,timeout:5*1e3,jsonOptions:{ignoreUnknownFields:!0}},rg=e=>({interceptUnary(t,n,s,i){return i.meta={...i.meta,...e},t(n,s,i)}}),og=(e,t)=>({interceptUnary:(n,s,i,r)=>{const o=n(s,i,r);return e(t,`Invoked SFU RPC method ${s.name}`,{request:o.request,headers:o.requestHeaders,response:o.response}),o}}),ag=e=>{const t=(s,i,r)=>e(`${s}OnFailure`,[r,i]),n={SendStats:!0};return{interceptUnary(s,i,r,o){if(n[i.name])return s(i,r,o);e(i.name,r);const a=s(i,r,o);return a.then(c=>{const u=c.response?.error;u&&t(i.name,r,u)},c=>t(i.name,r,c)),a}}},cg=e=>{const t=new oh({...ig,...e});return new sg(t)},Yt=e=>new Promise(t=>setTimeout(t,e));function _r(e){return e&&(Object.prototype.toString.call(e)==="[object Function]"||typeof e=="function"||e instanceof Function)}const bn={TOKEN_EXPIRED:40,WS_CLOSED_SUCCESS:1e3};function ls(e){const t=Math.min(500+e*2e3,5e3),n=Math.min(Math.max(250,(e-1)*2e3),5e3);return Math.floor(Math.random()*(t-n)+n)}function jn(e){let t="";for(let n=0;n<e.length;n++)t+=e[n].toString(16).padStart(2,"0");return t}function Ir(){const e=ug(16);return e[6]=e[6]&15|64,e[8]=e[8]&191|128,[jn(e.subarray(0,4)),jn(e.subarray(4,6)),jn(e.subarray(6,8)),jn(e.subarray(8,10)),jn(e.subarray(10,16))].join("-")}const lg=typeof crypto<"u"&&crypto.getRandomValues?crypto.getRandomValues.bind(crypto):function(t){const n=Math.pow(2,8*t.byteLength/t.length);for(let s=0;s<t.length;s++)t[s]=Math.random()*n};function ug(e){const t=new Uint8Array(e);return lg(t),t}function Rr(e){typeof window<"u"&&window.addEventListener&&(window.addEventListener("offline",e),window.addEventListener("online",e))}function Rl(e){typeof window<"u"&&window.removeEventListener&&(window.removeEventListener("offline",e),window.removeEventListener("online",e))}function dg(e){return!e.status||e.status<200||300<=e.status}function hg(e){return e.code!==void 0}const Fe=()=>typeof navigator>"u"?!1:navigator.product?.toLowerCase()==="reactnative",ua=Object.freeze({trace:0,debug:1,info:2,warn:3,error:4});let Pl,io="info";const xl=(e,t,...n)=>{let s;switch(e){case"error":if(Fe()){t=`ERROR: ${t}`,s=console.info;break}s=console.error;break;case"warn":if(Fe()){t=`WARN: ${t}`,s=console.info;break}s=console.warn;break;case"info":s=console.info;break;case"trace":s=console.trace;break;default:s=console.log;break}s(t,...n)},fg=(e,t)=>{Pl=e,pg(t)},pg=e=>{io=e},Pr=()=>io,le=e=>{const t=Pl||xl,n=(e||[]).filter(Boolean).join(":");return(i,r,...o)=>{ua[i]>=ua[io]&&t(i,`[${n}]: ${r}`,...o)}},Ht=async(e,t)=>{let n=0,s;do{n>0&&await Yt(ls(n));try{s=await e()}catch(i){const r=i instanceof tt&&i.code===ye[ye.cancelled],o=t?.aborted??!1;if(r||o)throw i;le(["sfu-client","rpc"])("debug",`rpc failed (${n})`,i),n++}}while(!s||s.response.error?.shouldRetry);return s},da=async e=>{const t=new RTCPeerConnection;t.addTransceiver("video",{direction:e}),t.addTransceiver("audio",{direction:e});const s=(await t.createOffer()).sdp??"";return t.getTransceivers().forEach(i=>{i.stop?.()}),t.close(),s},xr=e=>e?(e=e.toLowerCase(),e==="vp9"||e==="av1"||e==="video/vp9"||e==="video/av1"):!1,mg={subscriberOffer:void 0,publisherAnswer:void 0,connectionQualityChanged:void 0,audioLevelChanged:void 0,iceTrickle:void 0,changePublishQuality:void 0,participantJoined:void 0,participantLeft:void 0,dominantSpeakerChanged:void 0,joinResponse:void 0,healthCheckResponse:void 0,trackPublished:void 0,trackUnpublished:void 0,error:void 0,callGrantsUpdated:void 0,goAway:void 0,iceRestart:void 0,pinsUpdated:void 0,callEnded:void 0,participantUpdated:void 0,participantMigrationComplete:void 0,changePublishOptions:void 0,inboundStateNotification:void 0},ha=e=>Object.prototype.hasOwnProperty.call(mg,e);class gg{constructor(){this.logger=le(["Dispatcher"]),this.subscribers={},this.dispatch=(t,n="0")=>{const s=t.eventPayload.oneofKind;if(!s)return;const i=t.eventPayload[s];this.logger("debug",`Dispatching ${s}, tag=${n}`,i);const r=this.subscribers[s];if(r)for(const o of r)try{o(i)}catch(a){this.logger("warn","Listener failed with error",a)}},this.on=(t,n)=>{var s;return((s=this.subscribers)[t]??(s[t]=[])).push(n),()=>{this.off(t,n)}},this.off=(t,n)=>{this.subscribers[t]=(this.subscribers[t]||[]).filter(s=>s!==n)}}}class bg{constructor(){this.subscriberCandidates=new Ys,this.publisherCandidates=new Ys,this.push=t=>{const n=vg(t);n&&(t.peerType===Ne.SUBSCRIBER?this.subscriberCandidates.next(n):t.peerType===Ne.PUBLISHER_UNSPECIFIED?this.publisherCandidates.next(n):le(["sfu-client"])("warn","ICETrickle, Unknown peer type",t))},this.dispose=()=>{this.subscriberCandidates.complete(),this.publisherCandidates.complete()}}}const vg=e=>{try{return JSON.parse(e.iceCandidate)}catch(t){le(["sfu-client"])("error","Failed to parse ICE Trickle",t,e);return}},He=Ol(yg),er=Ol(Cg),In=new Map;function Sg(e){return In.has(e)}async function tr(e){let t;for(;t=In.get(e);)await t.promise}function Ol(e){return function(n,s){const{cb:i,onContinued:r}=e(n,s),o=In.get(n);o?.onContinued();const a=o?o.promise.then(i,i):i();return In.set(n,{promise:a,onContinued:r}),a}}function yg(e,t){let n=!1;return{cb:()=>t().finally(()=>{n||In.delete(e)}),onContinued:()=>n=!0}}function Cg(e,t){const n=new AbortController;return{cb:()=>n.signal.aborted?Promise.resolve("canceled"):t(n.signal).finally(()=>{n.signal.aborted||In.delete(e)}),onContinued:()=>n.abort()}}const Tg=e=>typeof e=="function",_e=e=>{let t,n;if(Zt([e]).subscribe({next:([s])=>{t=s},error:s=>{n=s}}).unsubscribe(),n)throw n;return t},Oe=(e,t)=>{const n=Tg(t)?t(_e(e)):t;return e.next(n),n},Al=(e,t)=>{const n=e.getValue(),s=Oe(e,t);return{lastValue:n,value:s,rollback:()=>Oe(e,n)}},ht=(e,t,n=s=>le(["RxUtils"])("warn","An observable emitted an error",s))=>{const s=e.subscribe({next:t,error:n});return()=>{s.unsubscribe()}},Ti=(e,t)=>{const n=Symbol();return ht(e,s=>{He(n,()=>t(s))})};var fa=Object.freeze({__proto__:null,createSafeAsyncSubscription:Ti,createSubscription:ht,getCurrentValue:_e,setCurrentValue:Oe,updateValue:Al}),L;(function(e){e.UNKNOWN="unknown",e.IDLE="idle",e.RINGING="ringing",e.JOINING="joining",e.JOINED="joined",e.LEFT="left",e.RECONNECTING="reconnecting",e.MIGRATING="migrating",e.RECONNECTING_FAILED="reconnecting-failed",e.OFFLINE="offline"})(L||(L={}));class kg{constructor(){this.connectedUserSubject=new Z(void 0),this.callsSubject=new Z([]),this.setConnectedUser=t=>Oe(this.connectedUserSubject,t),this.setCalls=t=>Oe(this.callsSubject,t),this.registerCall=t=>{this.calls.find(n=>n.cid===t.cid)||this.setCalls(n=>[...n,t])},this.unregisterCall=t=>(le(["client-state"])("trace",`Unregistering call: ${t.cid}`),this.setCalls(s=>s.filter(i=>i!==t))),this.findCall=(t,n)=>this.calls.find(s=>s.type===t&&s.id===n),this.connectedUserSubject.subscribe(async t=>{if(!t){const n=le(["client-state"]);for(const s of this.calls)s.state.callingState!==L.LEFT&&(n("info",`User disconnected, leaving call: ${s.cid}`),await s.leave({message:"client.disconnectUser() called"}).catch(i=>{n("error",`Error leaving call: ${s.cid}`,i)}))}})}get connectedUser(){return _e(this.connectedUserSubject)}get calls(){return _e(this.callsSubject)}}class wg{constructor(t){this.connectedUser$=t.connectedUserSubject.asObservable(),this.calls$=t.callsSubject.asObservable()}get connectedUser(){return _e(this.connectedUser$)}get calls(){return _e(this.calls$)}}const Ft=(...e)=>(t,n)=>{for(const s of e){const i=s(t,n);if(i!==0)return i}return 0},Dl=e=>t=>(n,s)=>e(n,s)?t(n,s):0,Ut=e=>e.publishedTracks.includes(P.VIDEO),cn=e=>e.publishedTracks.includes(P.AUDIO),$t=e=>e.publishedTracks.includes(P.SCREEN_SHARE),ki=e=>e.publishedTracks.includes(P.SCREEN_SHARE_AUDIO),Eg=e=>!!e.pin&&(e.pin.isLocalPin||e.pin.pinnedAt>0),Nl=(e,t)=>{if(!e.pausedTracks)return!1;const n=t==="videoTrack"?P.VIDEO:t==="screenShareTrack"?P.SCREEN_SHARE:void 0;return n?e.pausedTracks.includes(n):!1},wi=(e,t)=>e.isDominantSpeaker&&!t.isDominantSpeaker?-1:!e.isDominantSpeaker&&t.isDominantSpeaker?1:0,Ei=(e,t)=>e.isSpeaking&&!t.isSpeaking?-1:!e.isSpeaking&&t.isSpeaking?1:0,ro=(e,t)=>{const n=$t(e),s=$t(t);return n&&!s?-1:!n&&s?1:0},_i=(e,t)=>{const n=Ut(e),s=Ut(t);return n&&!s?-1:!n&&s?1:0},Ii=(e,t)=>{const n=cn(e),s=cn(t);return n&&!s?-1:!n&&s?1:0},oo=(e,t)=>{if(e.pin&&t.pin){if(!e.pin.isLocalPin&&t.pin.isLocalPin)return-1;if(e.pin.isLocalPin&&!t.pin.isLocalPin)return 1;if(e.pin.pinnedAt>t.pin.pinnedAt)return-1;if(e.pin.pinnedAt<t.pin.pinnedAt)return 1}return e.pin&&!t.pin?-1:!e.pin&&t.pin?1:0},_g=(...e)=>{const t=n=>n===-1?Number.MAX_SAFE_INTEGER:n;return(n,s)=>{const i=t(e.indexOf(n.source)),r=t(e.indexOf(s.source));return i<r?-1:i>r?1:0}},Ri=e=>(t,n)=>t.reaction?.type===e&&n.reaction?.type!==e?-1:t.reaction?.type!==e&&n.reaction?.type===e?1:0,Ig=(...e)=>(t,n)=>{const s=pa(t,e),i=pa(n,e);return s&&!i?-1:!s&&i?1:0},pa=(e,t)=>(e.roles||[]).some(n=>t.includes(n)),ao=Dl((e,t)=>e.viewportVisibilityState?.videoTrack===Ee.INVISIBLE||t.viewportVisibilityState?.videoTrack===Ee.INVISIBLE),Rg=Dl((e,t)=>e.viewportVisibilityState?.videoTrack===Ee.INVISIBLE||e.viewportVisibilityState?.videoTrack===Ee.UNKNOWN||t.viewportVisibilityState?.videoTrack===Ee.INVISIBLE||t.viewportVisibilityState?.videoTrack===Ee.UNKNOWN),co=_g(_t.RTMP,_t.SRT,_t.WHIP,_t.RTSP),es=Ft(ro,oo,ao(Ft(wi,Ei,Ri("raised-hand"),_i,Ii))),Pg=Ft(ro,oo,wi,ao(Ft(Ei,Ri("raised-hand"),co,_i,Ii)));Ft(oo,Rg(Ft(wi,Ei,Ri("raised-hand"),co,_i,Ii)));const ma=Ft(ao(Ft(wi,Ei,Ri("raised-hand"),co,_i,Ii)),Ig("admin","host","speaker")),ga={broadcasting:!1,hls:{playlist_url:"",status:""},rtmps:[]};class Ll{constructor(){this.backstageSubject=new Z(!0),this.blockedUserIdsSubject=new Z([]),this.createdAtSubject=new Z(new Date),this.endedAtSubject=new Z(void 0),this.startsAtSubject=new Z(void 0),this.updatedAtSubject=new Z(new Date),this.createdBySubject=new Z(void 0),this.customSubject=new Z({}),this.egressSubject=new Z(void 0),this.ingressSubject=new Z(void 0),this.recordingSubject=new Z(!1),this.sessionSubject=new Z(void 0),this.settingsSubject=new Z(void 0),this.transcribingSubject=new Z(!1),this.captioningSubject=new Z(!1),this.endedBySubject=new Z(void 0),this.thumbnailsSubject=new Z(void 0),this.membersSubject=new Z([]),this.ownCapabilitiesSubject=new Z([]),this.callingStateSubject=new Z(L.UNKNOWN),this.startedAtSubject=new Z(void 0),this.participantCountSubject=new Z(0),this.anonymousParticipantCountSubject=new Z(0),this.participantsSubject=new Z([]),this.callStatsReportSubject=new Z(void 0),this.closedCaptionsSubject=new Z([]),this.orphanedTracks=[],this.callGrantsSubject=new Ys(1),this.logger=le(["CallState"]),this.sortParticipantsBy=es,this.closedCaptionsTasks=new Map,this.dispose=()=>{for(const[s,i]of this.closedCaptionsTasks.entries())clearTimeout(i),this.closedCaptionsTasks.delete(s)},this.setSortParticipantsBy=s=>{this.sortParticipantsBy=s,this.setCurrentValue(this.participantsSubject,i=>i)},this.getCurrentValue=_e,this.setCurrentValue=Oe,this.setParticipantCount=s=>this.setCurrentValue(this.participantCountSubject,s),this.setStartedAt=s=>this.setCurrentValue(this.startedAtSubject,s),this.setCaptioning=s=>Al(this.captioningSubject,s),this.setAnonymousParticipantCount=s=>this.setCurrentValue(this.anonymousParticipantCountSubject,s),this.setParticipants=s=>this.setCurrentValue(this.participantsSubject,s),this.setCallingState=s=>this.setCurrentValue(this.callingStateSubject,s),this.setCallStatsReport=s=>this.setCurrentValue(this.callStatsReportSubject,s),this.setMembers=s=>{this.setCurrentValue(this.membersSubject,s)},this.setOwnCapabilities=s=>this.setCurrentValue(this.ownCapabilitiesSubject,s),this.setCallGrants=s=>this.setCurrentValue(this.callGrantsSubject,s),this.setBackstage=s=>this.setCurrentValue(this.backstageSubject,s),this.setEndedAt=s=>this.setCurrentValue(this.endedAtSubject,s),this.findParticipantBySessionId=s=>this.participants.find(i=>i.sessionId===s),this.getParticipantLookupBySessionId=()=>this.participants.reduce((s,i)=>(s[i.sessionId]=i,s),{}),this.updateParticipant=(s,i)=>{const r=this.findParticipantBySessionId(s);if(!r){this.logger("warn",`Participant with sessionId ${s} not found`);return}const o=typeof i=="function"?i(r):i,a={...r,...o};return this.setParticipants(c=>c.map(u=>u.sessionId===s?a:u))},this.updateOrAddParticipant=(s,i,r)=>this.setParticipants(o=>{let a=!0;const c=o.map(u=>{if(u.sessionId===s){a=!1;const d={...u,...i},p=typeof r=="function"?r(d):r;return Object.assign(d,p)}return u});return a&&c.push(i),c}),this.updateParticipants=s=>Object.keys(s).length===0?this.participants:this.setParticipants(i=>i.map(r=>{const o=s[r.sessionId];return o?{...r,...o}:r})),this.updateParticipantTracks=(s,i)=>this.updateParticipants(Object.entries(i).reduce((r,[o,a])=>{a.dimension&&(a.dimension.height=Math.ceil(a.dimension.height),a.dimension.width=Math.ceil(a.dimension.width));const c=s==="videoTrack"?"videoDimension":s==="screenShareTrack"?"screenShareDimension":void 0;return c&&(r[o]={[c]:a.dimension}),r},{})),this.updateFromEvent=s=>{const i=this.eventHandlers[s.type];i&&i(s)},this.setServerSidePins=s=>{const i=Date.now(),r=Symbol("unknown"),o=s.reduce((a,c,u)=>{var d;const p=i+(s.length-u);return a[c.userId]?a[c.userId]=r:a[c.userId]=p,a[d=c.sessionId]??(a[d]=p),a},{});return this.setParticipants(a=>a.map(c=>{const u=o[c.sessionId]??o[c.userId];return typeof u=="number"&&typeof c.pin?.pinnedAt!="number"?{...c,pin:{isLocalPin:!1,pinnedAt:u}}:typeof u!="number"&&c.pin?.isLocalPin===!1?{...c,pin:void 0}:c}))},this.registerOrphanedTrack=s=>{this.orphanedTracks.push(s)},this.removeOrphanedTrack=s=>{this.orphanedTracks=this.orphanedTracks.filter(i=>i.id!==s)},this.takeOrphanedTracks=s=>{const i=this.orphanedTracks.filter(r=>r.trackLookupPrefix===s);return i.length>0&&(this.orphanedTracks=this.orphanedTracks.filter(r=>r.trackLookupPrefix!==s)),i},this.updateClosedCaptionSettings=s=>{this.closedCaptionsSettings={...this.closedCaptionsSettings,...s}},this.updateFromCallResponse=s=>{this.setBackstage(s.backstage),this.setCurrentValue(this.blockedUserIdsSubject,s.blocked_user_ids),this.setCurrentValue(this.createdAtSubject,new Date(s.created_at)),this.setCurrentValue(this.updatedAtSubject,new Date(s.updated_at)),this.setCurrentValue(this.startsAtSubject,s.starts_at?new Date(s.starts_at):void 0),this.setEndedAt(s.ended_at?new Date(s.ended_at):void 0),this.setCurrentValue(this.createdBySubject,s.created_by),this.setCurrentValue(this.customSubject,s.custom),this.setCurrentValue(this.egressSubject,s.egress),this.setCurrentValue(this.ingressSubject,s.ingress),this.setCurrentValue(this.recordingSubject,s.recording);const i=this.setCurrentValue(this.sessionSubject,s.session);this.updateParticipantCountFromSession(i),this.setCurrentValue(this.settingsSubject,s.settings),this.setCurrentValue(this.transcribingSubject,s.transcribing),this.setCurrentValue(this.captioningSubject,s.captioning),this.setCurrentValue(this.thumbnailsSubject,s.thumbnails)},this.updateFromSfuCallState=(s,i,r)=>{const{participants:o,participantCount:a,startedAt:c,pins:u}=s,d=r?.announcedTracks.map(p=>p.trackType)??[];this.setParticipants(()=>{const p=this.getParticipantLookupBySessionId();return o.map(l=>{const h=p[l.sessionId],m=l.sessionId===i;return Object.assign({},h,l,{isLocalParticipant:m,publishedTracks:m?d:l.publishedTracks,viewportVisibilityState:h?.viewportVisibilityState??{videoTrack:Ee.UNKNOWN,screenShareTrack:Ee.UNKNOWN}})})}),this.setParticipantCount(a?.total||0),this.setAnonymousParticipantCount(a?.anonymous||0),this.setStartedAt(c?Yn.toDate(c):new Date),this.setServerSidePins(u)},this.updateFromMemberRemoved=s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.membersSubject,i=>i.filter(r=>s.members.indexOf(r.user_id)===-1))},this.updateFromMemberAdded=s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.membersSubject,i=>[...i,...s.members])},this.updateFromHLSBroadcastStopped=()=>{this.setCurrentValue(this.egressSubject,(s=ga)=>({...s,broadcasting:!1,hls:{...s.hls,status:""}}))},this.updateFromHLSBroadcastingFailed=()=>{this.setCurrentValue(this.egressSubject,(s=ga)=>({...s,broadcasting:!1,hls:{...s.hls,status:""}}))},this.updateParticipantCountFromSession=s=>{if(!s||this.callingState===L.JOINED)return;const i=Object.values(s.participants_count_by_role).reduce((o,a)=>o+a,0),r=Math.max(i,s.participants.length);this.setParticipantCount(r),this.setAnonymousParticipantCount(s.anonymous_participant_count||0)},this.updateFromSessionParticipantCountUpdate=s=>{const i=this.setCurrentValue(this.sessionSubject,r=>r&&{...r,anonymous_participant_count:s.anonymous_participant_count,participants_count_by_role:s.participants_count_by_role});this.updateParticipantCountFromSession(i)},this.updateFromSessionParticipantLeft=s=>{const i=this.setCurrentValue(this.sessionSubject,r=>{if(!r)return r;const{participants:o,participants_count_by_role:a}=r,{user:c,user_session_id:u}=s.participant;return{...r,participants:o.filter(d=>d.user_session_id!==u),participants_count_by_role:{...a,[c.role]:Math.max(0,(a[c.role]||0)-1)}}});this.updateParticipantCountFromSession(i)},this.updateFromSessionParticipantJoined=s=>{const i=this.setCurrentValue(this.sessionSubject,r=>{if(!r)return r;const{participants:o,participants_count_by_role:a}=r,{user:c,user_session_id:u}=s.participant;let d=!0;const p=o.map(h=>h.user_session_id===u?(d=!1,s.participant):h);d&&p.push(s.participant);const l=d?1:0;return{...r,participants:p,participants_count_by_role:{...a,[c.role]:(a[c.role]||0)+l}}});this.updateParticipantCountFromSession(i)},this.updateMembers=s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.membersSubject,i=>i.map(r=>{const o=s.members.find(a=>a.user_id===r.user_id);return o||r}))},this.updateParticipantReaction=s=>{const{user:i,custom:r,type:o,emoji_code:a}=s.reaction;this.setParticipants(c=>c.map(u=>u.userId!==i.id?u:{...u,reaction:{type:o,emoji_code:a,custom:r}}))},this.unblockUser=s=>{this.setCurrentValue(this.blockedUserIdsSubject,i=>i&&i.filter(r=>r!==s.user.id))},this.blockUser=s=>{this.setCurrentValue(this.blockedUserIdsSubject,i=>[...i||[],s.user.id])},this.updateOwnCapabilities=s=>{s.user.id===this.localParticipant?.userId&&this.setOwnCapabilities(s.own_capabilities)},this.updateFromClosedCaptions=s=>{this.setCurrentValue(this.closedCaptionsSubject,i=>{const{closed_caption:r}=s,o=l=>`${l.speaker_id}/${l.start_time}`,a=o(r);if(i.some(l=>o(l)===a))return i;const u=[...i,r],{visibilityDurationMs:d=2700,maxVisibleCaptions:p=2}=this.closedCaptionsSettings||{};if(d>0){const l=setTimeout(()=>{this.setCurrentValue(this.closedCaptionsSubject,h=>h.filter(m=>m!==r)),this.closedCaptionsTasks.delete(a)},d);this.closedCaptionsTasks.set(a,l);for(let h=0;h<u.length-p;h++){const m=o(u[h]),f=this.closedCaptionsTasks.get(m);clearTimeout(f),this.closedCaptionsTasks.delete(m)}}return u.slice(-p)})},this.rawParticipants$=this.participantsSubject.asObservable().pipe(je({bufferSize:1,refCount:!0})),this.participants$=this.participantsSubject.asObservable().pipe(Be(s=>s.sort(this.sortParticipantsBy)),je({bufferSize:1,refCount:!0})),this.localParticipant$=this.participants$.pipe(Be(s=>s.find(i=>i.isLocalParticipant)),je({bufferSize:1,refCount:!0})),this.remoteParticipants$=this.participants$.pipe(Be(s=>s.filter(i=>!i.isLocalParticipant)),je({bufferSize:1,refCount:!0})),this.pinnedParticipants$=this.participants$.pipe(Be(s=>s.filter(i=>!!i.pin)),je({bufferSize:1,refCount:!0})),this.dominantSpeaker$=this.participants$.pipe(Be(s=>s.find(i=>i.isDominantSpeaker)),je({bufferSize:1,refCount:!0})),this.hasOngoingScreenShare$=this.participants$.pipe(Be(s=>s.some(i=>$t(i))),We(),je({bufferSize:1,refCount:!0})),this.createdAt$=this.createdAtSubject.asObservable(),this.endedAt$=this.endedAtSubject.asObservable(),this.startsAt$=this.startsAtSubject.asObservable(),this.startedAt$=this.startedAtSubject.asObservable(),this.updatedAt$=this.updatedAtSubject.asObservable(),this.callStatsReport$=this.callStatsReportSubject.asObservable(),this.members$=this.membersSubject.asObservable(),this.createdBy$=this.createdBySubject.asObservable(),this.custom$=this.customSubject.asObservable(),this.egress$=this.egressSubject.asObservable(),this.ingress$=this.ingressSubject.asObservable(),this.session$=this.sessionSubject.asObservable(),this.settings$=this.settingsSubject.asObservable(),this.endedBy$=this.endedBySubject.asObservable(),this.thumbnails$=this.thumbnailsSubject.asObservable(),this.closedCaptions$=this.closedCaptionsSubject.asObservable();const t=(s,i)=>{if(s.length!==i.length)return!1;for(const r of s)if(!i.includes(r))return!1;for(const r of i)if(!s.includes(r))return!1;return!0},n=(s,i)=>s.pipe(We(i));this.anonymousParticipantCount$=n(this.anonymousParticipantCountSubject),this.blockedUserIds$=n(this.blockedUserIdsSubject,t),this.backstage$=n(this.backstageSubject),this.callingState$=n(this.callingStateSubject),this.ownCapabilities$=Zt([this.ownCapabilitiesSubject,this.callGrantsSubject.pipe(as(void 0))]).pipe(Be(([s,i])=>{if(!i)return s;const{canPublishAudio:r,canPublishVideo:o,canScreenshare:a}=i,c={[q.SEND_AUDIO]:r,[q.SEND_VIDEO]:o,[q.SCREENSHARE]:a},u=[...s];for(const d in c){const p=d,l=c[p];if(l&&!u.includes(p))u.push(p);else if(!l&&u.includes(p)){const h=u.indexOf(p);u.splice(h,1)}}return u}),We(t),je({bufferSize:1,refCount:!0})),this.participantCount$=n(this.participantCountSubject),this.recording$=n(this.recordingSubject),this.transcribing$=n(this.transcribingSubject),this.captioning$=n(this.captioningSubject),this.eventHandlers={"call.frame_recording_ready":void 0,"call.kicked_user":void 0,"call.moderation_blur":void 0,"call.moderation_warning":void 0,"call.permission_request":void 0,"call.recording_ready":void 0,"call.rtmp_broadcast_failed":void 0,"call.rtmp_broadcast_started":void 0,"call.rtmp_broadcast_stopped":void 0,"call.stats_report_ready":void 0,"call.transcription_ready":void 0,"call.user_feedback_submitted":void 0,"call.user_muted":void 0,"connection.error":void 0,"connection.ok":void 0,"health.check":void 0,"user.updated":void 0,custom:void 0,"call.accepted":s=>this.updateFromCallResponse(s.call),"call.blocked_user":this.blockUser,"call.closed_caption":this.updateFromClosedCaptions,"call.closed_captions_failed":()=>{this.setCurrentValue(this.captioningSubject,!1)},"call.closed_captions_started":()=>{this.setCurrentValue(this.captioningSubject,!0)},"call.closed_captions_stopped":()=>{this.setCurrentValue(this.captioningSubject,!1)},"call.created":s=>this.updateFromCallResponse(s.call),"call.deleted":s=>this.updateFromCallResponse(s.call),"call.ended":s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.endedBySubject,s.user)},"call.frame_recording_failed":s=>{this.updateFromCallResponse(s.call)},"call.frame_recording_started":s=>{this.updateFromCallResponse(s.call)},"call.frame_recording_stopped":s=>{this.updateFromCallResponse(s.call)},"call.hls_broadcasting_failed":this.updateFromHLSBroadcastingFailed,"call.hls_broadcasting_started":s=>{this.updateFromCallResponse(s.call)},"call.hls_broadcasting_stopped":this.updateFromHLSBroadcastStopped,"call.live_started":s=>this.updateFromCallResponse(s.call),"call.member_added":this.updateFromMemberAdded,"call.member_removed":this.updateFromMemberRemoved,"call.member_updated_permission":this.updateMembers,"call.member_updated":this.updateMembers,"call.notification":s=>{this.updateFromCallResponse(s.call),this.setMembers(s.members)},"call.permissions_updated":this.updateOwnCapabilities,"call.reaction_new":this.updateParticipantReaction,"call.recording_started":()=>this.setCurrentValue(this.recordingSubject,!0),"call.recording_stopped":()=>this.setCurrentValue(this.recordingSubject,!1),"call.recording_failed":()=>this.setCurrentValue(this.recordingSubject,!1),"call.rejected":s=>this.updateFromCallResponse(s.call),"call.ring":s=>this.updateFromCallResponse(s.call),"call.missed":s=>this.updateFromCallResponse(s.call),"call.session_ended":s=>this.updateFromCallResponse(s.call),"call.session_participant_count_updated":this.updateFromSessionParticipantCountUpdate,"call.session_participant_joined":this.updateFromSessionParticipantJoined,"call.session_participant_left":this.updateFromSessionParticipantLeft,"call.session_started":s=>this.updateFromCallResponse(s.call),"call.transcription_started":()=>{this.setCurrentValue(this.transcribingSubject,!0)},"call.transcription_stopped":()=>{this.setCurrentValue(this.transcribingSubject,!1)},"call.transcription_failed":()=>{this.setCurrentValue(this.transcribingSubject,!1)},"call.unblocked_user":this.unblockUser,"call.updated":s=>this.updateFromCallResponse(s.call)}}get participantCount(){return this.getCurrentValue(this.participantCount$)}get startedAt(){return this.getCurrentValue(this.startedAt$)}get captioning(){return this.getCurrentValue(this.captioning$)}get anonymousParticipantCount(){return this.getCurrentValue(this.anonymousParticipantCount$)}get participants(){return this.getCurrentValue(this.participants$)}get rawParticipants(){return this.getCurrentValue(this.rawParticipants$)}get localParticipant(){return this.getCurrentValue(this.localParticipant$)}get remoteParticipants(){return this.getCurrentValue(this.remoteParticipants$)}get dominantSpeaker(){return this.getCurrentValue(this.dominantSpeaker$)}get pinnedParticipants(){return this.getCurrentValue(this.pinnedParticipants$)}get hasOngoingScreenShare(){return this.getCurrentValue(this.hasOngoingScreenShare$)}get callingState(){return this.getCurrentValue(this.callingState$)}get callStatsReport(){return this.getCurrentValue(this.callStatsReport$)}get isCallStatsReportObserved(){return this.callStatsReportSubject.observed}get members(){return this.getCurrentValue(this.members$)}get ownCapabilities(){return this.getCurrentValue(this.ownCapabilities$)}get backstage(){return this.getCurrentValue(this.backstage$)}get blockedUserIds(){return this.getCurrentValue(this.blockedUserIds$)}get createdAt(){return this.getCurrentValue(this.createdAt$)}get endedAt(){return this.getCurrentValue(this.endedAt$)}get startsAt(){return this.getCurrentValue(this.startsAt$)}get updatedAt(){return this.getCurrentValue(this.updatedAt$)}get createdBy(){return this.getCurrentValue(this.createdBy$)}get custom(){return this.getCurrentValue(this.custom$)}get egress(){return this.getCurrentValue(this.egress$)}get ingress(){return this.getCurrentValue(this.ingress$)}get recording(){return this.getCurrentValue(this.recording$)}get session(){return this.getCurrentValue(this.session$)}get settings(){return this.getCurrentValue(this.settings$)}get transcribing(){return this.getCurrentValue(this.transcribing$)}get endedBy(){return this.getCurrentValue(this.endedBy$)}get thumbnails(){return this.getCurrentValue(this.thumbnails$)}get closedCaptions(){return this.getCurrentValue(this.closedCaptions$)}}class lo extends Error{constructor(t){super(t.message),this.name="NegotiationError",this.error=t}}const ii=e=>{const t=[];return e.forEach(n=>{t.push(n)}),t},Ml=e=>({id:e.id,tracks:e.getTracks().map(t=>({id:t.id,kind:t.kind,label:t.label,enabled:t.enabled,muted:t.muted,readyState:t.readyState}))}),xg=e=>{const{sdk:t,...n}=e,s=jl(t),i=Fl(t);return{sdkName:s,sdkVersion:i,...n}},jl=e=>e&&e.type===Qt.REACT?"stream-react":e&&e.type===Qt.REACT_NATIVE?"stream-react-native":"stream-js",Fl=e=>e?`${e.major}.${e.minor}.${e.patch}`:"0.0.0-development",Og="1.33.1",[Ag,Dg,Ng]=Og.split(".");let ri={type:Qt.PLAIN_JAVASCRIPT,major:Ag,minor:Dg,patch:Ng},Lg,Mg,jg={oneofKind:void 0};const Fg=e=>{ri=e},Ug=()=>ri,$g=()=>jg,Or=async()=>{if(Fe())return{sdk:ri,os:Lg,device:Mg};const e=navigator.userAgentData;let t;if(e&&e.getHighEntropyValues)try{t=await e.getHighEntropyValues(["platform","platformVersion","fullVersionList"])}catch{}const n=new hf.UAParser(navigator.userAgent),{browser:s,os:i,device:r,cpu:o}=n.getResult(),a=t?.fullVersionList?.find(c=>!c.brand.includes("Chromium")&&!c.brand.match(/[()\-./:;=?_]/g));return{sdk:ri,browser:{name:a?.brand||s.name||navigator.userAgent,version:a?.version||s.version||""},os:{name:t?.platform||i.name||"",version:t?.platformVersion||i.version||"",architecture:o.architecture||""},device:{name:[r.vendor,r.model,r.type].filter(Boolean).join(" "),version:""}}},Ar=()=>typeof navigator>"u"?!1:/^((?!chrome|android).)*safari/i.test(navigator.userAgent||""),Pi=()=>typeof navigator>"u"?!1:navigator.userAgent?.includes("Firefox"),Vg=()=>typeof navigator>"u"?!1:navigator.userAgent?.includes("Chrome"),Bg=async()=>{const{browser:e}=await Or();if(!e)return!1;const t=e.name.toLowerCase(),[n]=e.version.split("."),s=parseInt(n,10);return t.includes("chrome")&&s>=124||t.includes("edge")&&s>=124||t.includes("firefox")&&s>=124||t.includes("safari")&&s>=17||t.includes("webkit")&&s>=605||t.includes("webview")&&s>=124};var ba=Object.freeze({__proto__:null,isChrome:Vg,isFirefox:Pi,isSafari:Ar,isSupportedBrowser:Bg});const Hg=({subscriber:e,publisher:t,state:n,datacenter:s,pollingIntervalInMs:i=2e3})=>{const r=le(["stats"]),o=async(m,f)=>m==="subscriber"&&e?e.getStats(f):m==="publisher"&&t?t.getStats(f):void 0,a=async(m,f)=>{const g=m==="subscriber"?e:t;if(!g)return[];const S=[];for(const C of f){const y=await g.getStats(C),T=va(y,{trackKind:C.kind,kind:m,publisher:void 0});S.push(T)}return S},c=m=>{d.add(m),p()},u=m=>{d.delete(m),p()},d=new Set,p=async()=>{const m={};if(d.size>0){const T=new Set(d);for(const k of n.participants){if(!T.has(k.sessionId))continue;const{audioStream:I,isLocalParticipant:R,sessionId:A,userId:B,videoStream:N}=k,$=R?"publisher":"subscriber";try{const j=R?t?.getPublishedTracks()||[]:[...N?.getVideoTracks()||[],...I?.getAudioTracks()||[]];m[A]=await a($,j)}catch(j){r("warn",`Failed to collect ${$} stats for ${B}`,j)}}}const[f,g]=await Promise.all([o("subscriber"),t?o("publisher"):void 0]),S=(T,k)=>qg(va(T,{kind:k,trackKind:"video",publisher:t})),C=f?S(f,"subscriber"):Dr(),y=g?S(g,"publisher"):Dr();n.setCallStatsReport({datacenter:s,publisherStats:y,subscriberStats:C,subscriberRawStats:f,publisherRawStats:g,participants:m,timestamp:Date.now()})};let l;if(i>0){const m=async()=>{n.isCallStatsReportObserved&&await p().catch(f=>{r("debug","Failed to collect stats",f)}),l=setTimeout(m,i)};m()}return{getRawStatsForTrack:o,getStatsForStream:a,startReportingStatsFor:c,stopReportingStatsFor:u,stop:()=>{l&&clearTimeout(l)}}},va=(e,t)=>{const{trackKind:n,kind:s,publisher:i}=t,r=s==="subscriber"?"inbound-rtp":"outbound-rtp",o=ii(e),a=o.filter(c=>c.type===r&&c.kind===n).map(c=>{const u=c,d=o.find(m=>m.type==="codec"&&m.id===u.codecId),p=o.find(m=>m.type==="transport"&&m.id===u.transportId);let l;p&&p.dtlsState==="connected"&&(l=o.find(f=>f.type==="candidate-pair"&&f.id===p.selectedCandidatePairId)?.currentRoundTripTime);let h;if(s==="publisher"&&i){const m=Pi(),f=o.find(g=>g.type==="media-source"&&(m?!0:g.id===u.mediaSourceId));f&&(h=i.getTrackType(f.trackIdentifier))}return{bytesSent:u.bytesSent,bytesReceived:u.bytesReceived,codec:d?.mimeType,currentRoundTripTime:l,frameHeight:u.frameHeight,frameWidth:u.frameWidth,framesPerSecond:u.framesPerSecond,jitter:u.jitter,kind:u.kind,mediaSourceId:u.mediaSourceId,qualityLimitationReason:u.qualityLimitationReason,rid:u.rid,ssrc:u.ssrc,trackType:h}});return{rawStats:e,streams:a,timestamp:Date.now()}},Dr=e=>({rawReport:e??{streams:[],timestamp:Date.now()},totalBytesSent:0,totalBytesReceived:0,averageJitterInMs:0,averageRoundTripTimeInMs:0,qualityLimitationReasons:"none",highestFrameWidth:0,highestFrameHeight:0,highestFramesPerSecond:0,codec:"",codecPerTrackType:{},timestamp:Date.now()}),qg=e=>{const t=Dr(e);let n=-1;const s=(c,u)=>c*u,i=new Set,r=e.streams,o=r.reduce((c,u)=>{c.totalBytesSent+=u.bytesSent||0,c.totalBytesReceived+=u.bytesReceived||0,c.averageJitterInMs+=u.jitter||0,c.averageRoundTripTimeInMs+=u.currentRoundTripTime||0;const d=s(u.frameWidth||0,u.frameHeight||0);return d>n&&(c.highestFrameWidth=u.frameWidth||0,c.highestFrameHeight=u.frameHeight||0,c.highestFramesPerSecond=u.framesPerSecond||0,n=d),i.add(u.qualityLimitationReason||""),c},t);r.length>0&&(o.averageJitterInMs=Math.round(o.averageJitterInMs/r.length*1e3),o.averageRoundTripTimeInMs=Math.round(o.averageRoundTripTimeInMs/r.length*1e3),o.codec=r[0].codec||"",o.codecPerTrackType=r.reduce((c,u)=>(u.trackType&&(c[u.trackType]=u.codec||""),c),{}));const a=[i.has("cpu")&&"cpu",i.has("bandwidth")&&"bandwidth",i.has("other")&&"other"].filter(Boolean).join(", ");return a&&(o.qualityLimitationReasons=a),o};class Wg{constructor(t,{options:n,clientDetails:s,subscriber:i,publisher:r,microphone:o,camera:a,state:c,tracer:u,unifiedSessionId:d}){this.logger=le(["SfuStatsReporter"]),this.inputDevices=new Map,this.observeDevice=(h,m)=>{const{browserPermissionState$:f}=h.state;this.unsubscribeDevicePermissionsSubscription?.(),this.unsubscribeDevicePermissionsSubscription=ht(Zt([f,this.state.ownCapabilities$]),([g,S])=>{this.unsubscribeListDevicesSubscription?.();const C=m==="mic"?S.includes(q.SEND_AUDIO):S.includes(q.SEND_VIDEO);if(g!=="granted"||!C){this.inputDevices.set(m,{currentDevice:"",availableDevices:[],isPermitted:!1});return}this.unsubscribeListDevicesSubscription=ht(Zt([h.listDevices(),h.state.selectedDevice$]),([y,T])=>{const k=y.find(I=>I.deviceId===T);this.inputDevices.set(m,{currentDevice:k?.label||T||"",availableDevices:y.map(I=>I.label),isPermitted:!0})})})},this.sendConnectionTime=h=>{this.sendTelemetryData({data:{oneofKind:"connectionTimeSeconds",connectionTimeSeconds:h}})},this.sendReconnectionTime=(h,m)=>{this.sendTelemetryData({data:{oneofKind:"reconnection",reconnection:{strategy:h,timeSeconds:m}}})},this.sendTelemetryData=h=>{this.run(h).catch(m=>{this.logger("warn","Failed to send telemetry data",m)})},this.run=async h=>{const[m,f]=await Promise.all([this.subscriber.stats.get(),this.publisher?.stats.get()]);this.subscriber.tracer?.trace("getstats",m.delta),f&&this.publisher?.tracer?.trace("getstats",f.delta);const g=this.subscriber.tracer?.take(),S=this.publisher?.tracer?.take(),C=this.tracer.take(),y=this.sfuClient.getTrace(),T=[...C.snapshot,...y?.snapshot??[],...S?.snapshot??[],...g?.snapshot??[]];try{await this.sfuClient.sendStats({sdk:this.sdkName,sdkVersion:this.sdkVersion,webrtcVersion:this.webRTCVersion,subscriberStats:JSON.stringify(ii(m.stats)),publisherStats:f?JSON.stringify(ii(f.stats)):"[]",subscriberRtcStats:"",publisherRtcStats:"",rtcStats:JSON.stringify(T),encodeStats:f?.performanceStats??[],decodeStats:m.performanceStats,audioDevices:this.inputDevices.get("mic"),videoDevices:this.inputDevices.get("camera"),unifiedSessionId:this.unifiedSessionId,deviceState:$g(),telemetry:h})}catch(k){throw S?.rollback(),g?.rollback(),C.rollback(),y?.rollback(),k}},this.start=()=>{this.options.reporting_interval_ms<=0||(this.observeDevice(this.microphone,"mic"),this.observeDevice(this.camera,"camera"),clearInterval(this.intervalId),this.intervalId=setInterval(()=>{this.run().catch(h=>{this.logger("warn","Failed to report stats",h)})},this.options.reporting_interval_ms))},this.stop=()=>{this.unsubscribeDevicePermissionsSubscription?.(),this.unsubscribeDevicePermissionsSubscription=void 0,this.unsubscribeListDevicesSubscription?.(),this.unsubscribeListDevicesSubscription=void 0,this.inputDevices.clear(),clearInterval(this.intervalId),this.intervalId=void 0,clearTimeout(this.timeoutId),this.timeoutId=void 0},this.flush=()=>{this.run().catch(h=>{this.logger("warn","Failed to flush report stats",h)})},this.scheduleOne=h=>{clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.run().catch(m=>{this.logger("warn","Failed to report stats",m)})},h)},this.sfuClient=t,this.options=n,this.subscriber=i,this.publisher=r,this.microphone=o,this.camera=a,this.state=c,this.tracer=u,this.unifiedSessionId=d;const{sdk:p,browser:l}=s;this.sdkName=jl(p),this.sdkVersion=Fl(p),this.webRTCVersion=`${l?.name||""}-${l?.version||""}`||"N/A"}}const Gg=(e,t)=>{e.addEventListener("icecandidate",s=>{t("onicecandidate",s.candidate)}),e.addEventListener("track",s=>{const i=s.streams.map(r=>`stream:${r.id}`);t("ontrack",`${s.track.kind}:${s.track.id} ${i}`)}),e.addEventListener("signalingstatechange",()=>{t("signalingstatechange",e.signalingState)}),e.addEventListener("iceconnectionstatechange",()=>{t("iceconnectionstatechange",e.iceConnectionState)}),e.addEventListener("icegatheringstatechange",()=>{t("icegatheringstatechange",e.iceGatheringState)}),e.addEventListener("connectionstatechange",()=>{t("connectionstatechange",e.connectionState)}),e.addEventListener("negotiationneeded",()=>{t("negotiationneeded",void 0)}),e.addEventListener("datachannel",({channel:s})=>{t("datachannel",[s.id,s.label])});const n=e.close;e.close=function(){return t("close",void 0),n.call(this)};for(const s of["createOffer","createAnswer","setLocalDescription","setRemoteDescription","addIceCandidate"]){const i=e[s];i&&(e[s]=async function(...o){try{t(s,o);const a=await i.apply(this,o);return t(`${s}OnSuccess`,a),a}catch(a){throw t(`${s}OnFailure`,a.toString()),a}})}};class Kg{constructor(t,n,s){this.previousStats={},this.frameTimeHistory=[],this.fpsHistory=[],this.get=async()=>{const i=await this.pc.getStats(),r=Jg(i),o=this.withOverrides(this.peerType===Ne.SUBSCRIBER?this.getDecodeStats(r):this.getEncodeStats(r)),a=zg(this.previousStats,r);return this.previousStats=r,this.frameTimeHistory=this.frameTimeHistory.slice(-2),this.fpsHistory=this.fpsHistory.slice(-2),{performanceStats:o,delta:a,stats:i}},this.getEncodeStats=i=>{const r=[];for(const o of Object.values(i)){if(o.type!=="outbound-rtp")continue;const{codecId:a,framesSent:c=0,kind:u,id:d,totalEncodeTime:p=0,framesPerSecond:l=0,frameHeight:h=0,frameWidth:m=0,targetBitrate:f=0,mediaSourceId:g}=o;if(u==="audio"||!this.previousStats[d])continue;const S=this.previousStats[d],C=p-(S.totalEncodeTime||0),y=c-(S.framesSent||0),T=y>0?C/y*1e3:0;this.frameTimeHistory.push(T),this.fpsHistory.push(l);let k=P.VIDEO;if(g&&i[g]){const I=i[g];k=this.trackIdToTrackType.get(I.trackIdentifier)||k}r.push({trackType:k,codec:Sa(i,a),avgFrameTimeMs:Ts(this.frameTimeHistory),avgFps:Ts(this.fpsHistory),targetBitrate:Math.round(f),videoDimension:{width:m,height:h}})}return r},this.getDecodeStats=i=>{let r,o=0;for(const g of Object.values(i)){if(g.type!=="inbound-rtp")continue;const S=g,{kind:C,frameWidth:y=0,frameHeight:T=0}=S,k=y*T;C==="video"&&k>o&&(r=S,o=k)}if(!r||!this.previousStats[r.id])return[];const a=this.previousStats[r.id],{framesDecoded:c=0,framesPerSecond:u=0,totalDecodeTime:d=0,trackIdentifier:p}=r,l=d-(a.totalDecodeTime||0),h=c-(a.framesDecoded||0),m=h>0?l/h*1e3:0;this.frameTimeHistory.push(m),this.fpsHistory.push(u);const f=this.trackIdToTrackType.get(p)||P.VIDEO;return[si.create({trackType:f,codec:Sa(i,r.codecId),avgFrameTimeMs:Ts(this.frameTimeHistory),avgFps:Ts(this.fpsHistory),videoDimension:{width:r.frameWidth,height:r.frameHeight}})]},this.withOverrides=i=>{if(this.costOverrides)for(const r of i){const o=this.costOverrides.get(r.trackType);o!==void 0&&(r.avgFrameTimeMs=o+(r.avgFrameTimeMs||0)/1e3)}return i},this.setCost=(i,r=P.VIDEO)=>{this.costOverrides||(this.costOverrides=new Map),this.costOverrides.set(r,i)},this.pc=t,this.peerType=n,this.trackIdToTrackType=s}}const Jg=e=>{const t={};return e.forEach((n,s)=>{t[s]=n}),t},zg=(e,t)=>{t=JSON.parse(JSON.stringify(t));for(const[i,r]of Object.entries(t))if(delete r.id,!!e[i])for(const[o,a]of Object.entries(r))a===e[i][o]&&delete r[o];let n=-1/0;const s=Object.values(t);for(const i of s)i.timestamp>n&&(n=i.timestamp);for(const i of s)i.timestamp===n&&(i.timestamp=0);return t.timestamp=n,t},Ts=e=>e.reduce((t,n)=>t+n,0)/e.length,Sa=(e,t)=>{if(!t||!e[t])return;const n=e[t];return Ot.create({name:n.mimeType.split("/").pop(),clockRate:n.clockRate,payloadType:n.payloadType,fmtp:n.sdpFmtpLine})};class uo{constructor(t){this.buffer=[],this.enabled=!0,this.setEnabled=n=>{this.enabled!==n&&(this.enabled=n,this.buffer=[])},this.trace=(n,s)=>{this.enabled&&this.buffer.push([n,this.id,s,Date.now()])},this.traceOnce=(n,s,i)=>{this.keys?.has(n)||(this.trace(s,i),(this.keys??(this.keys=new Map)).set(n,!0))},this.resetTrace=n=>{this.keys?.delete(n)},this.take=()=>{const n=this.buffer;return this.buffer=[],{snapshot:n,rollback:()=>{this.buffer.unshift(...n)}}},this.dispose=()=>{this.buffer=[],this.keys?.clear()},this.id=t}}class Ul{constructor(t,{sfuClient:n,connectionConfig:s,state:i,dispatcher:r,onReconnectionNeeded:o,tag:a,enableTracing:c,iceRestartDelay:u=2500}){this.isIceRestarting=!1,this.isDisposed=!1,this.trackIdToTrackType=new Map,this.subscriptions=[],this.lock=Math.random().toString(36).slice(2),this.createPeerConnection=d=>{const p=new RTCPeerConnection(d);return p.addEventListener("icecandidate",this.onIceCandidate),p.addEventListener("icecandidateerror",this.onIceCandidateError),p.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),p.addEventListener("icegatheringstatechange",this.onIceGatherChange),p.addEventListener("signalingstatechange",this.onSignalingChange),p.addEventListener("connectionstatechange",this.onConnectionStateChange),p},this.tryRestartIce=()=>{this.restartIce().catch(d=>{const p="restartICE() failed, initiating reconnect";this.logger("error",p,d);const l=d instanceof lo&&d.error.code===an.PARTICIPANT_SIGNAL_LOST?Y.FAST:Y.REJOIN;this.onReconnectionNeeded?.(l,p)})},this.on=(d,p)=>{this.subscriptions.push(this.dispatcher.on(d,l=>{const h=`pc.${this.lock}.${d}`;He(h,async()=>p(l)).catch(m=>{this.isDisposed||this.logger("warn",`Error handling ${d}`,m)})}))},this.addTrickledIceCandidates=()=>{const{iceTrickleBuffer:d}=this.sfuClient,p=this.peerType===Ne.SUBSCRIBER?d.subscriberCandidates:d.publisherCandidates;this.unsubscribeIceTrickle?.(),this.unsubscribeIceTrickle=Ti(p,async l=>this.pc.addIceCandidate(l).catch(h=>{this.isDisposed||this.logger("warn","ICE candidate error",h,l)}))},this.setSfuClient=d=>{this.sfuClient=d},this.getStats=d=>this.pc.getStats(d),this.getTrackType=d=>this.trackIdToTrackType.get(d),this.isHealthy=()=>{const d=new Set(["failed","closed"]),p=this.pc.iceConnectionState,l=this.pc.connectionState;return!d.has(p)&&!d.has(l)},this.onIceCandidate=d=>{const{candidate:p}=d;if(!p){this.logger("debug","null ice candidate");return}const l=this.asJSON(p);this.sfuClient.iceTrickle({peerType:this.peerType,iceCandidate:l}).catch(h=>{this.isDisposed||this.logger("warn","ICETrickle failed",h)})},this.asJSON=d=>{if(!d.usernameFragment){const p=d.candidate.split(" "),l=p.findIndex(m=>m==="ufrag")+1,h=p[l];return JSON.stringify({...d,usernameFragment:h})}return JSON.stringify(d.toJSON())},this.onConnectionStateChange=async()=>{const d=this.pc.connectionState;if(this.logger("debug","Connection state changed",d),this.tracer&&(d==="connected"||d==="failed"))try{const p=await this.stats.get();this.tracer.trace("getstats",p.delta)}catch(p){this.tracer.trace("getstatsOnFailure",p.toString())}if(d==="failed"){this.onReconnectionNeeded?.(Y.REJOIN,"Connection failed");return}this.handleConnectionStateUpdate(d)},this.onIceConnectionStateChange=()=>{const d=this.pc.iceConnectionState;this.logger("debug","ICE connection state changed",d),this.handleConnectionStateUpdate(d)},this.handleConnectionStateUpdate=d=>{const{callingState:p}=this.state;if(p!==L.OFFLINE&&p!==L.RECONNECTING&&!this.isIceRestarting)switch(d){case"failed":this.logger("info","restartICE due to failed connection"),this.tryRestartIce();break;case"disconnected":this.logger("info","disconnected connection, scheduling restartICE"),clearTimeout(this.iceRestartTimeout),this.iceRestartTimeout=setTimeout(()=>{const l=this.pc.iceConnectionState;(l==="disconnected"||l==="failed")&&this.tryRestartIce()},this.iceRestartDelay);break;case"connected":this.iceRestartTimeout&&(this.logger("info","connected connection, canceling restartICE"),clearTimeout(this.iceRestartTimeout),this.iceRestartTimeout=void 0);break}},this.onIceCandidateError=d=>{const p=d instanceof RTCPeerConnectionIceErrorEvent?`${d.errorCode}: ${d.errorText}`:d;this.logger("debug","ICE Candidate error",p)},this.onIceGatherChange=()=>{this.logger("debug","ICE Gathering State",this.pc.iceGatheringState)},this.onSignalingChange=()=>{this.logger("debug","Signaling state changed",this.pc.signalingState)},this.peerType=t,this.sfuClient=n,this.state=i,this.dispatcher=r,this.iceRestartDelay=u,this.onReconnectionNeeded=o,this.logger=le([t===Ne.SUBSCRIBER?"Subscriber":"Publisher",a]),this.pc=this.createPeerConnection(s),this.stats=new Kg(this.pc,t,this.trackIdToTrackType),c&&(this.tracer=new uo(`${a}-${t===Ne.SUBSCRIBER?"sub":"pub"}`),this.tracer.trace("create",{url:n.edgeName,...s}),Gg(this.pc,this.tracer.trace))}dispose(){clearTimeout(this.iceRestartTimeout),this.iceRestartTimeout=void 0,this.onReconnectionNeeded=void 0,this.isDisposed=!0,this.detachEventHandlers(),this.pc.close(),this.tracer?.dispose()}detachEventHandlers(){const t=this.pc;t.removeEventListener("icecandidate",this.onIceCandidate),t.removeEventListener("icecandidateerror",this.onIceCandidateError),t.removeEventListener("signalingstatechange",this.onSignalingChange),t.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),t.removeEventListener("icegatheringstatechange",this.onIceGatherChange),this.unsubscribeIceTrickle?.(),this.subscriptions.forEach(n=>n())}}class Yg{constructor(){this.cache=[],this.layers=[],this.transceiverOrder=[],this.add=t=>{this.cache.push(t),this.transceiverOrder.push(t.transceiver)},this.get=t=>this.cache.find(n=>n.publishOption.id===t.id&&n.publishOption.trackType===t.trackType),this.update=(t,n)=>{const s=this.get(t);s&&Object.assign(s,n)},this.has=t=>!!this.get(t),this.find=t=>this.cache.find(t),this.items=()=>this.cache,this.indexOf=t=>this.transceiverOrder.indexOf(t),this.getLayers=t=>this.layers.find(s=>s.publishOption.id===t.id&&s.publishOption.trackType===t.trackType)?.layers,this.setLayers=(t,n=[])=>{const s=this.findLayer(t);s?s.layers=n:this.layers.push({publishOption:t,layers:n})},this.findLayer=t=>this.layers.find(n=>n.publishOption.id===t.id&&n.publishOption.trackType===t.trackType)}}const ts=(e,t)=>{le(["helpers"])("warn",t,e)},ho=e=>{switch(e){case P.SCREEN_SHARE:return"screenShareStream";case P.SCREEN_SHARE_AUDIO:return"screenShareAudioStream";case P.VIDEO:return"videoStream";case P.AUDIO:return"audioStream";case P.UNSPECIFIED:throw new Error("Track type is unspecified");default:ts(e,"Unknown track type")}},Xg=e=>{switch(e){case"audio":return P.AUDIO;case"video":return P.VIDEO;case"screenshare":return P.SCREEN_SHARE;case"screenshare_audio":return P.SCREEN_SHARE_AUDIO;default:ts(e,"Unknown mute type")}},Zg=e=>{switch(e){case"TRACK_TYPE_AUDIO":return P.AUDIO;case"TRACK_TYPE_VIDEO":return P.VIDEO;case"TRACK_TYPE_SCREEN_SHARE":return P.SCREEN_SHARE;case"TRACK_TYPE_SCREEN_SHARE_AUDIO":return P.SCREEN_SHARE_AUDIO;default:return}},qn=e=>e===P.AUDIO||e===P.SCREEN_SHARE_AUDIO,ya=(e,t)=>{const{audioBitrateProfile:n}=t;return[{maxBitrate:e.audioBitrateProfiles?.find(r=>r.profile===n)?.bitrate||{[ft.VOICE_STANDARD_UNSPECIFIED]:64e3,[ft.VOICE_HIGH_QUALITY]:128e3,[ft.MUSIC_HIGH_QUALITY]:128e3}[n||ft.VOICE_STANDARD_UNSPECIFIED]}]},Qg=e=>{if(!e)return;const t=s=>i=>i.rid===s;return[{...e.find(t("f"))||e.find(t("h"))||e.find(t("q")),rid:"q"}]},eb=e=>e==="q"?zt.LOW_UNSPECIFIED:e==="h"?zt.MID:zt.HIGH,tb=(e=[])=>e.map(t=>({rid:t.rid||"",bitrate:t.maxBitrate||0,fps:t.maxFramerate||0,quality:eb(t.rid||""),videoDimension:{width:t.width,height:t.height}})),nb=(e,t)=>`L${e}T${t}${e>1?"_KEY":""}`,Ca=(e,t)=>{if(qn(t.trackType))return;const n=[],{bitrate:s,codec:i,fps:r=30,maxSpatialLayers:o=3,maxTemporalLayers:a=3,videoDimension:c={width:1280,height:720},useSingleLayer:u}=t,{width:d=c.width,height:p=c.height}=e.getSettings(),l=sb(c,d,p,s);let h=1,m=1;const f=xr(i?.name);for(const g of["f","h","q"].slice(0,o)){const S={active:!0,rid:g,width:Math.round(d/h),height:Math.round(p/h),maxBitrate:Math.round(l/m)||{q:3e5,h:75e4,f:125e4}[g],maxFramerate:r};f?S.scalabilityMode=nb(u?1:o,a):S.scaleResolutionDownBy=h,h*=2,m*=2,n.unshift(S)}return ib(d,p,n,u)},sb=(e,t,n,s)=>{const{width:i,height:r}=e;if(t<i||n<r){const o=t*n,a=i*r,c=o/a;return Math.round(s*c)}return s},ib=(e,t,n,s)=>{let i;const r=Math.max(e,t);r<=320?i=n.filter(a=>a.rid==="f"):r<=640?i=n.filter(a=>a.rid!=="q"):i=n;const o=["q","h","f"];return i.map((a,c,u)=>({...a,rid:o[c],active:s&&c<u.length-1?!1:a.active}))},rb=(e,t,n)=>{if(e.mid)return e.mid;if(!n)return String(t);const s=e.sender.track,r=js.parse(n).media.find(o=>o.type===s.kind&&(o.msid?.includes(s.id)??!0));return typeof r?.mid<"u"?String(r.mid):t<0?"":String(t)},ob=(e,t)=>{const n=new Set,s=js.parse(e);for(const r of s.media){if(r.type!=="audio")continue;const o=r.rtp.find(a=>a.codec==="opus");if(o)for(const a of r.fmtp)a.payload===o.payload&&a.config.includes("stereo=1")&&n.add(r.mid)}if(n.size===0)return t;const i=js.parse(t);for(const r of i.media){if(r.type!=="audio"||!n.has(r.mid))continue;const o=r.rtp.find(a=>a.codec==="opus");if(o)for(const a of r.fmtp)a.payload===o.payload&&!a.config.includes("stereo=1")&&(a.config+=";stereo=1")}return js.write(i)};class ab extends Ul{constructor({publishOptions:t,...n}){super(Ne.PUBLISHER_UNSPECIFIED,n),this.transceiverCache=new Yg,this.clonedTracks=new Set,this.publish=async(s,i,r={})=>{if(!this.publishOptions.some(o=>o.trackType===i))throw new Error(`No publish options found for ${P[i]}`);for(const o of this.publishOptions){if(o.trackType!==i)continue;const a=this.cloneTrack(s),{transceiver:c}=this.transceiverCache.get(o)||{};if(!c)await this.addTransceiver(a,o,r);else{const u=c.sender.track;await this.updateTransceiver(c,a,i,r),Fe()||this.stopTrack(u)}}},this.addTransceiver=async(s,i,r)=>{const o=qn(i.trackType)?ya(i,r):Ca(s,i),a=xr(i.codec?.name)?Qg(o):o,c=this.pc.addTransceiver(s,{direction:"sendonly",sendEncodings:a}),u=c.sender.getParameters();u.degradationPreference="maintain-framerate",await c.sender.setParameters(u);const d=i.trackType;this.logger("debug",`Added ${P[d]} transceiver`),this.transceiverCache.add({publishOption:i,transceiver:c,options:r}),this.trackIdToTrackType.set(s.id,d),await this.negotiate()},this.updateTransceiver=async(s,i,r,o={})=>{const a=s.sender;a.track&&this.trackIdToTrackType.delete(a.track.id),await a.replaceTrack(i),i&&this.trackIdToTrackType.set(i.id,r),qn(r)&&await this.updateAudioPublishOptions(r,o)},this.updateAudioPublishOptions=async(s,i)=>{for(const r of this.publishOptions){if(r.trackType!==s)continue;const o=this.transceiverCache.get(r);if(!o)continue;const{transceiver:a,options:c}=o;if(c.audioBitrateProfile!==i.audioBitrateProfile){const u=ya(r,i);if(u&&u.length>0){const d=a.sender.getParameters(),[p]=d.encodings,[l]=u;p.maxBitrate!==l.maxBitrate&&(p.maxBitrate=l.maxBitrate),await a.sender.setParameters(d)}}this.transceiverCache.update(r,{options:i})}},this.syncPublishOptions=async()=>{for(const s of this.publishOptions){const{trackType:i}=s;if(!this.isPublishing(i)||this.transceiverCache.has(s))continue;const r=this.transceiverCache.find(a=>!!a.transceiver.sender.track&&a.publishOption.trackType===i);if(!r)continue;const o=this.cloneTrack(r.transceiver.sender.track);await this.addTransceiver(o,s,r.options)}for(const s of this.transceiverCache.items()){const{publishOption:i,transceiver:r}=s;this.publishOptions.some(a=>a.id===i.id&&a.trackType===i.trackType)||(this.stopTrack(r.sender.track),await this.updateTransceiver(r,null,i.trackType))}},this.isPublishing=s=>{for(const i of this.transceiverCache.items()){if(s&&i.publishOption.trackType!==s)continue;const r=i.transceiver.sender.track;if(r&&r.readyState==="live"&&r.enabled)return!0}return!1},this.stopTracks=(...s)=>{for(const i of this.transceiverCache.items()){const{publishOption:r,transceiver:o}=i;s.includes(r.trackType)&&this.stopTrack(o.sender.track)}},this.stopAllTracks=()=>{for(const{transceiver:s}of this.transceiverCache.items())this.stopTrack(s.sender.track);for(const s of this.clonedTracks)this.stopTrack(s)},this.changePublishQuality=async s=>{const{trackType:i,layers:r,publishOptionId:o}=s,a=r.filter(g=>g.active),c="Update publish quality:";this.logger("info",`${c} requested layers by SFU:`,a);const u=this.transceiverCache.find(g=>g.publishOption.id===o&&g.publishOption.trackType===i),d=u?.transceiver.sender;if(!d)return this.logger("warn",`${c} no video sender found.`);const p=d.getParameters();if(p.encodings.length===0)return this.logger("warn",`${c} there are no encodings set.`);const l=u?.publishOption.codec?.name,h=l&&xr(l);let m=!1;for(const g of p.encodings){const S=h?a[0]:a.find(R=>R.name===g.rid)??(p.encodings.length===1?a[0]:void 0),C=!!S?.active;if(C!==g.active&&(g.active=C,m=!0),!S)continue;const{maxFramerate:y,scaleResolutionDownBy:T,maxBitrate:k,scalabilityMode:I}=S;T>=1&&T!==g.scaleResolutionDownBy&&(g.scaleResolutionDownBy=T,m=!0),k>0&&k!==g.maxBitrate&&(g.maxBitrate=k,m=!0),y>0&&y!==g.maxFramerate&&(g.maxFramerate=y,m=!0),I&&I!==g.scalabilityMode&&(g.scalabilityMode=I,m=!0)}const f=p.encodings.filter(g=>g.active);if(!m)return this.logger("info",`${c} no change:`,f);await d.setParameters(p),this.logger("info",`${c} enabled rids:`,f)},this.restartIce=async()=>{this.logger("debug","Restarting ICE connection");const s=this.pc.signalingState;if(this.isIceRestarting||s==="have-local-offer"){this.logger("debug","ICE restart is already in progress");return}await this.negotiate({iceRestart:!0})},this.negotiate=async s=>He(`publisher.negotiate.${this.lock}`,async()=>{const i=await this.pc.createOffer(s),r=this.getAnnouncedTracks(i.sdp);if(!r.length)throw new Error("Can't negotiate without any tracks");try{this.isIceRestarting=s?.iceRestart??!1,await this.pc.setLocalDescription(i);const{sdp:o=""}=i,{response:a}=await this.sfuClient.setPublisher({sdp:o,tracks:r});if(a.error)throw new lo(a.error);const{sdp:c}=a;await this.pc.setRemoteDescription({type:"answer",sdp:c})}catch(o){throw this.pc.signalingState==="have-local-offer"&&await this.pc.setLocalDescription({type:"rollback"}),o}finally{this.isIceRestarting=!1}this.addTrickledIceCandidates()}),this.getPublishedTracks=()=>{const s=[];for(const{transceiver:i}of this.transceiverCache.items()){const r=i.sender.track;r&&r.readyState==="live"&&s.push(r)}return s},this.getAnnouncedTracks=s=>{const i=[];for(const r of this.transceiverCache.items())r.transceiver.sender.track&&i.push(this.toTrackInfo(r,s));return i},this.getAnnouncedTracksForReconnect=()=>{const s=this.pc.localDescription?.sdp,i=[];for(const r of this.publishOptions){const o=this.transceiverCache.get(r);!o||!o.transceiver.sender.track||i.push(this.toTrackInfo(o,s))}return i},this.toTrackInfo=(s,i)=>{const{transceiver:r,publishOption:o}=s,a=r.sender.track,c=a.readyState==="live",u=c?Ca(a,o):this.transceiverCache.getLayers(o);this.transceiverCache.setLayers(o,u);const d=qn(o.trackType),p=this.transceiverCache.indexOf(r),l=this.state.settings?.audio,h=o.trackType===P.SCREEN_SHARE_AUDIO||d&&!!l?.hifi_audio_enabled;return{trackId:a.id,layers:tb(u),trackType:o.trackType,mid:rb(r,p,i),stereo:h,dtx:d&&!!l?.opus_dtx_enabled,red:d&&!!l?.redundant_coding_enabled,muted:!c,codec:o.codec,publishOptionId:o.id}},this.cloneTrack=s=>{const i=s.clone();return this.clonedTracks.add(i),i},this.stopTrack=s=>{s&&(s.stop(),this.clonedTracks.delete(s))},this.publishOptions=t,this.on("iceRestart",s=>{s.peerType===Ne.PUBLISHER_UNSPECIFIED&&this.tryRestartIce()}),this.on("changePublishQuality",async s=>{for(const i of s.videoSenders)await this.changePublishQuality(i)}),this.on("changePublishOptions",s=>(this.publishOptions=s.publishOptions,this.syncPublishOptions()))}dispose(){super.dispose(),this.stopAllTracks(),this.clonedTracks.clear()}}class cb extends Ul{constructor(t){super(Ne.SUBSCRIBER,t),this.restartIce=async()=>{if(this.logger("debug","Restarting ICE connection"),this.pc.signalingState==="have-remote-offer"){this.logger("debug","ICE restart is already in progress");return}if(this.pc.connectionState==="new"){this.logger("debug","ICE connection is not yet established, skipping restart.");return}const n=this.isIceRestarting;this.isIceRestarting=!0;try{const{response:s}=await this.sfuClient.iceRestart({peerType:Ne.SUBSCRIBER});if(s.error)throw new lo(s.error)}catch(s){throw this.isIceRestarting=n,s}},this.handleOnTrack=n=>{const[s]=n.streams,[i,r]=s.id.split(":"),o=this.state.participants.find(p=>p.trackLookupPrefix===i);this.logger("debug",`[onTrack]: Got remote ${r} track for userId: ${o?.userId}`,n.track.id,n.track);const a=`${o?.userId} ${r}:${i}`;n.track.addEventListener("mute",()=>{this.logger("info",`[onTrack]: Track muted: ${a}`)}),n.track.addEventListener("unmute",()=>{this.logger("info",`[onTrack]: Track unmuted: ${a}`)}),n.track.addEventListener("ended",()=>{this.logger("info",`[onTrack]: Track ended: ${a}`),this.state.removeOrphanedTrack(s.id)});const c=Zg(r);if(!c)return this.logger("error",`Unknown track type: ${r}`);if(this.trackIdToTrackType.set(n.track.id,c),!o){this.logger("warn",`[onTrack]: Received track for unknown participant: ${i}`,n),this.state.registerOrphanedTrack({id:s.id,trackLookupPrefix:i,track:s,trackType:c});return}const u=ho(c);if(!u){this.logger("error",`Unknown track type: ${r}`);return}const d=o[u];this.state.updateParticipant(o.sessionId,{[u]:s}),d&&(this.logger("info",`[onTrack]: Cleaning up previous remote ${n.track.kind} tracks for userId: ${o.userId}`),d.getTracks().forEach(p=>{p.stop(),d.removeTrack(p)}))},this.negotiate=async n=>{await this.pc.setRemoteDescription({type:"offer",sdp:n.sdp}),this.addTrickledIceCandidates();const s=await this.pc.createAnswer();s.sdp&&(s.sdp=ob(n.sdp,s.sdp)),await this.pc.setLocalDescription(s),await this.sfuClient.sendAnswer({peerType:Ne.SUBSCRIBER,sdp:s.sdp||""}),this.isIceRestarting=!1},this.pc.addEventListener("track",this.handleOnTrack),this.on("subscriberOffer",async n=>this.negotiate(n).catch(s=>{this.logger("error","Negotiation failed.",s)}))}detachEventHandlers(){super.detachEventHandlers(),this.pc.removeEventListener("track",this.handleOnTrack)}}const lb=e=>{const{endpoint:t,onMessage:n,tag:s,tracer:i}=e,r=le(["SfuClientWS",s]);r("debug","Creating signaling WS channel:",t);const o=new WebSocket(t);return o.binaryType="arraybuffer",o.addEventListener("error",a=>{r("error","Signaling WS channel error",a),i?.trace("signal.ws.error",a)}),o.addEventListener("close",a=>{r("info","Signaling WS channel is closed",a),i?.trace("signal.ws.close",a)}),o.addEventListener("open",a=>{r("info","Signaling WS channel is open",a),i?.trace("signal.ws.open",a)}),o.addEventListener("message",a=>{try{const c=a.data instanceof ArrayBuffer?la.fromBinary(new Uint8Array(a.data)):la.fromJsonString(a.data.toString());n(c)}catch(c){const u="Failed to decode a message. Check whether the Proto models match.";r("error",u,{event:a,error:c}),i?.trace("signal.ws.message.error",u)}}),o},ub=e=>({bundlePolicy:"max-bundle",iceServers:e.map(t=>({urls:t.urls,username:t.username,credential:t.password}))});function ns(e){let t=!0;const n=e.then(i=>({status:"resolved",result:i}),i=>({status:"rejected",error:i})).finally(()=>t=!1),s=()=>n.then(i=>{if(i.status==="rejected")throw i.error;return i.result});return s.checkPending=()=>t,s}const $n=()=>{let e,t;const n=new Promise((a,c)=>{e=a,t=c});let s=!1,i=!1;return{promise:n,resolve:a=>{s=!0,e(a)},reject:a=>{i=!0,t(a)},isResolved:()=>s,isRejected:()=>i}},Ta=Symbol("uninitialized");function fn(e){let t=Ta;return(...n)=>(t===Ta&&(t=e(...n)),t)}let $l=!1;const db=()=>{$l=!0},oi=fn(()=>new yf({useWorker:$l}));class st{constructor({dispatcher:t,credentials:n,sessionId:s,cid:i,tag:r,joinResponseTimeout:o=5e3,onSignalClose:a,streamClient:c,enableTracing:u}){this.iceTrickleBuffer=new bg,this.isLeaving=!1,this.isClosingClean=!1,this.pingIntervalInMs=5*1e3,this.unhealthyTimeoutInMs=15*1e3,this.joinResponseTask=$n(),this.abortController=new AbortController,this.createWebSocket=l=>{const h={callEnded:!0,changePublishQuality:!0,changePublishOptions:!0,connectionQualityChanged:!0,error:!0,goAway:!0,inboundStateNotification:!0};this.signalWs=lb({tag:this.tag,endpoint:`${this.credentials.server.ws_endpoint}?${new URLSearchParams(l).toString()}`,tracer:this.tracer,onMessage:f=>{this.lastMessageTimestamp=new Date,this.scheduleConnectionCheck();const g=f.eventPayload.oneofKind;h[g]&&this.tracer?.trace(g,f),this.dispatcher.dispatch(f,this.tag)}});let m;this.signalReady=ns(Promise.race([new Promise((f,g)=>{let S=!1;const C=()=>{S=!0,clearTimeout(m),this.signalWs.removeEventListener("open",C),f(this.signalWs)};this.signalWs.addEventListener("open",C),this.signalWs.addEventListener("close",y=>{this.handleWebSocketClose(y);const T=S?`SFU WS closed: ${y.code} ${y.reason}`:`SFU WS connection can't be established: ${y.code} ${y.reason}`;this.tracer?.trace("signal.close",T),clearTimeout(m),g(new Error(T))})}),new Promise((f,g)=>{m=setTimeout(()=>{const S=`SFU WS connection failed to open after ${this.joinResponseTimeout}ms`;this.tracer?.trace("signal.timeout",S),g(new Error(S))},this.joinResponseTimeout)})]))},this.handleWebSocketClose=l=>{this.signalWs.removeEventListener("close",this.handleWebSocketClose),oi().clearInterval(this.keepAliveInterval),clearTimeout(this.connectionCheckTimeout),this.onSignalClose?.(`${l.code} ${l.reason}`)},this.close=(l=st.NORMAL_CLOSURE,h)=>{this.isClosingClean=l!==st.ERROR_CONNECTION_UNHEALTHY,this.signalWs.readyState===WebSocket.OPEN&&(this.logger("debug",`Closing SFU WS connection: ${l} - ${h}`),this.signalWs.close(l,`js-client: ${h}`),this.signalWs.removeEventListener("close",this.handleWebSocketClose)),this.dispose()},this.dispose=()=>{this.logger("debug","Disposing SFU client"),this.unsubscribeIceTrickle(),this.unsubscribeNetworkChanged(),clearInterval(this.keepAliveInterval),clearTimeout(this.connectionCheckTimeout),clearTimeout(this.migrateAwayTimeout),this.abortController.abort(),this.migrationTask?.resolve(),this.iceTrickleBuffer.dispose()},this.getTrace=()=>this.tracer?.take(),this.leaveAndClose=async l=>{try{this.isLeaving=!0,await this.joinTask,await this.notifyLeave(l)}catch(h){this.logger("debug","Error notifying SFU about leaving call",h)}this.close(st.NORMAL_CLOSURE,l.substring(0,115))},this.updateSubscriptions=async l=>(await this.joinTask,Ht(()=>this.rpc.updateSubscriptions({sessionId:this.sessionId,tracks:l}),this.abortController.signal)),this.setPublisher=async l=>(await this.joinTask,Ht(()=>this.rpc.setPublisher({...l,sessionId:this.sessionId}),this.abortController.signal)),this.sendAnswer=async l=>(await this.joinTask,Ht(()=>this.rpc.sendAnswer({...l,sessionId:this.sessionId}),this.abortController.signal)),this.iceTrickle=async l=>(await this.joinTask,Ht(()=>this.rpc.iceTrickle({...l,sessionId:this.sessionId}),this.abortController.signal)),this.iceRestart=async l=>(await this.joinTask,Ht(()=>this.rpc.iceRestart({...l,sessionId:this.sessionId}),this.abortController.signal)),this.updateMuteStates=async l=>(await this.joinTask,Ht(()=>this.rpc.updateMuteStates({muteStates:l,sessionId:this.sessionId}),this.abortController.signal)),this.sendStats=async l=>(await this.joinTask,this.rpc.sendStats({...l,sessionId:this.sessionId})),this.startNoiseCancellation=async()=>(await this.joinTask,Ht(()=>this.rpc.startNoiseCancellation({sessionId:this.sessionId}),this.abortController.signal)),this.stopNoiseCancellation=async()=>(await this.joinTask,Ht(()=>this.rpc.stopNoiseCancellation({sessionId:this.sessionId}),this.abortController.signal)),this.enterMigration=async(l={})=>{this.isLeaving=!0;const{timeout:h=7*1e3}=l;this.migrationTask?.reject(new Error("Cancelled previous migration"));const m=this.migrationTask=$n(),f=this.dispatcher.on("participantMigrationComplete",()=>{f(),clearTimeout(this.migrateAwayTimeout),m.resolve()});return this.migrateAwayTimeout=setTimeout(()=>{f(),m.reject(new Error(`Migration (${this.tag}) failed to complete in ${h}ms`))},h),m.promise},this.join=async l=>{await this.signalReady(),(this.joinResponseTask.isResolved()||this.joinResponseTask.isRejected())&&(this.joinResponseTask=$n());const h=this.joinResponseTask;let m;const f=this.dispatcher.on("joinResponse",S=>{clearTimeout(m),f(),this.keepAlive(),h.resolve(S)});m=setTimeout(()=>{f();const S=`Waiting for "joinResponse" has timed out after ${this.joinResponseTimeout}ms`;this.tracer?.trace("joinRequestTimeout",S),h.reject(new Error(S))},this.joinResponseTimeout);const g=Mn.create({requestPayload:{oneofKind:"joinRequest",joinRequest:Il.create({...l,sessionId:this.sessionId,token:this.credentials.token})}});return this.tracer?.trace("joinRequest",g),await this.send(g),h.promise},this.ping=async()=>this.send(Mn.create({requestPayload:{oneofKind:"healthCheckRequest",healthCheckRequest:{}}})),this.notifyLeave=async l=>this.send(Mn.create({requestPayload:{oneofKind:"leaveCallRequest",leaveCallRequest:{sessionId:this.sessionId,reason:l}}})),this.send=async l=>{await this.signalReady();const h=Mn.toJson(l);if(this.signalWs.readyState!==WebSocket.OPEN){this.logger("debug","Signal WS is not open. Skipping message",h);return}this.logger("debug",`Sending message to: ${this.edgeName}`,h),this.signalWs.send(Mn.toBinary(l))},this.keepAlive=()=>{const l=oi();l.clearInterval(this.keepAliveInterval),this.keepAliveInterval=l.setInterval(()=>{this.ping().catch(h=>{this.logger("error","Error sending healthCheckRequest to SFU",h)})},this.pingIntervalInMs)},this.scheduleConnectionCheck=()=>{clearTimeout(this.connectionCheckTimeout),this.connectionCheckTimeout=setTimeout(()=>{this.lastMessageTimestamp&&new Date().getTime()-this.lastMessageTimestamp.getTime()>this.unhealthyTimeoutInMs&&this.close(st.ERROR_CONNECTION_UNHEALTHY,`SFU connection unhealthy. Didn't receive any message for ${this.unhealthyTimeoutInMs}ms`)},this.unhealthyTimeoutInMs)},this.dispatcher=t,this.sessionId=s||Ir(),this.onSignalClose=a,this.credentials=n;const{server:d,token:p}=n;this.edgeName=d.edge_name,this.joinResponseTimeout=o,this.tag=r,this.logger=le(["SfuClient",r]),this.tracer=u?new uo(`${r}-${this.edgeName}`):void 0,this.rpc=cg({baseUrl:d.url,interceptors:[rg({Authorization:`Bearer ${p}`}),this.tracer&&ag(this.tracer.trace),Pr()==="trace"&&og(this.logger,"trace")].filter(l=>!!l)}),this.unsubscribeIceTrickle=t.on("iceTrickle",l=>{this.iceTrickleBuffer.push(l)}),this.unsubscribeNetworkChanged=c.on("network.changed",l=>{l.online?this.networkAvailableTask?.resolve():this.networkAvailableTask=$n()}),this.createWebSocket({attempt:r,user_id:c.user?.id||"",api_key:c.key,user_session_id:this.sessionId,cid:i})}get isHealthy(){return this.signalWs.readyState===WebSocket.OPEN&&this.joinResponseTask.isResolved()}get joinTask(){return this.joinResponseTask.promise}}st.NORMAL_CLOSURE=1e3;st.ERROR_CONNECTION_UNHEALTHY=4001;st.DISPOSE_OLD_SOCKET=4100;st.JOIN_FAILED=4101;const hb=e=>async function(n){if(n.user.id===e.currentUserId)return;const{state:s}=e;n.call.created_by.id===e.currentUserId&&s.callingState===L.RINGING&&await e.join()},fb=e=>async function(n){if(n.user.id===e.currentUserId)return;const{call:s}=n,{session:i}=s;if(!i){e.logger("warn","No call session provided. Ignoring call.rejected event.",n);return}const r=i.rejected_by,{members:o,callingState:a}=e.state;if(a!==L.RINGING){e.logger("info","Call is not in ringing mode (it is either accepted or rejected already). Ignoring call.rejected event.",n);return}e.isCreatedByMe?o.filter(u=>u.user_id!==e.currentUserId).every(u=>r[u.user_id])&&(e.logger("info","everyone rejected, leaving the call"),await e.leave({reject:!0,reason:"cancel",message:"ring: everyone rejected"})):r[s.created_by.id]&&(e.logger("info","call creator rejected, leaving call"),await e.leave({message:"ring: creator rejected"}))},pb=e=>function(){const{callingState:n}=e.state;n!==L.IDLE&&n!==L.LEFT&&e.leave({message:"call.ended event received",reject:!1}).catch(s=>{e.logger("error","Failed to leave call after call.ended ",s)})},mb=e=>e.on("callEnded",async t=>{if(e.state.callingState!==L.LEFT)try{if(t.reason===En.LIVE_ENDED){e.state.setBackstage(!0);const{hasPermission:s}=e.permissionsContext;if(s(q.JOIN_BACKSTAGE))return}e.state.setEndedAt(new Date);const n=En[t.reason];await e.leave({message:`callEnded received: ${n}`})}catch(n){e.logger("error","Failed to leave call after being ended by the SFU",n)}}),gb=e=>function(n){const{currentGrants:s}=n;s&&e.setCallGrants(s)},Wn=(e,...t)=>{for(const n of t)e.includes(n)||e.push(n);return e},bb=(e,...t)=>{for(const n of t){const s=e.indexOf(n);s!==-1&&e.splice(s,1)}return e},vb=(e,t)=>e.on("connectionQualityChanged",n=>{const{connectionQualityUpdates:s}=n;s&&t.updateParticipants(s.reduce((i,r)=>{const{sessionId:o,connectionQuality:a}=r;return i[o]={connectionQuality:a},i},{}))}),Sb=(e,t)=>e.on("healthCheckResponse",n=>{const{participantCount:s}=n;s&&(t.setParticipantCount(s.total),t.setAnonymousParticipantCount(s.anonymous))}),yb=(e,t)=>e.on("error",n=>{n.error&&n.error.code!==an.LIVE_ENDED||(t.state.setBackstage(!0),t.permissionsContext.hasPermission(q.JOIN_BACKSTAGE)||t.leave({message:"live ended"}).catch(s=>{t.logger("error","Failed to leave call after live ended",s)}))}),Cb=e=>e.on("error",t=>{if(!t.error)return;const n=le(["SfuClient"]),{error:s,reconnectStrategy:i}=t;n("error","SFU reported error",{code:an[s.code],reconnectStrategy:Y[i],message:s.message,shouldRetry:s.shouldRetry})}),Tb=e=>function(n){const{pins:s}=n;e.setServerSidePins(s)},kb=e=>function(n){const{inboundVideoStates:s}=n,i=e.getParticipantLookupBySessionId(),r={};for(const{sessionId:o,trackType:a,paused:c}of s){const u=[...i[o]?.pausedTracks??[]];c?Wn(u,a):bb(u,a),r[o]={pausedTracks:u}}e.updateParticipants(r)},wb=e=>e.on("trackUnpublished",async t=>{const{cause:n,type:s,sessionId:i}=t,{localParticipant:r}=e.state;if(n===Zn.MODERATION&&i===r?.sessionId){const o=e.logger;o("info",`Local participant's ${P[s]} track is muted remotely`);try{s===P.VIDEO?await e.camera.disable():s===P.AUDIO?await e.microphone.disable():s===P.SCREEN_SHARE||s===P.SCREEN_SHARE_AUDIO?await e.screenShare.disable():o("warn","Unsupported track type to soft mute",P[s])}catch(a){o("error","Failed to stop publishing",a)}}}),Eb=e=>function(n){const{participant:s}=n;if(!s)return;const i=fo(e,s);e.updateOrAddParticipant(s.sessionId,Object.assign(s,i,{viewportVisibilityState:{videoTrack:Ee.UNKNOWN,screenShareTrack:Ee.UNKNOWN}}))},_b=e=>function(n){const{participant:s}=n;s&&e.setParticipants(i=>i.filter(r=>r.sessionId!==s.sessionId))},Ib=e=>function(n){const{participant:s}=n;s&&e.updateParticipant(s.sessionId,s)},Rb=e=>function(n){const{type:s,sessionId:i}=n;if(n.participant){const r=fo(e,n.participant),o=Object.assign(n.participant,r);e.updateOrAddParticipant(i,o)}else e.updateParticipant(i,r=>({publishedTracks:Wn([...r.publishedTracks],s)}))},Pb=e=>function(n){const{type:s,sessionId:i}=n;if(n.participant){const r=fo(e,n.participant),o=Object.assign(n.participant,r);e.updateOrAddParticipant(i,o,a=>({pausedTracks:a.pausedTracks?.filter(c=>c!==s)}))}else e.updateParticipant(i,r=>({publishedTracks:r.publishedTracks.filter(o=>o!==s),pausedTracks:r.pausedTracks?.filter(o=>o!==s)}))},fo=(e,t)=>{const n=e.takeOrphanedTracks(t.trackLookupPrefix);if(!n.length)return;const s={};for(const i of n){const r=ho(i.trackType);r&&(s[r]=i.track)}return s},xb=(e,t)=>e.on("dominantSpeakerChanged",n=>{const{sessionId:s}=n;s!==t.dominantSpeaker?.sessionId&&t.setParticipants(i=>i.map(r=>r.sessionId===s?{...r,isDominantSpeaker:!0}:r.isDominantSpeaker?{...r,isDominantSpeaker:!1}:r))}),Ob=(e,t)=>e.on("audioLevelChanged",n=>{const{audioLevels:s}=n;t.updateParticipants(s.reduce((i,r)=>(i[r.sessionId]={audioLevel:r.level,isSpeaking:r.isSpeaking},i),{}))}),Ab=(e,t)=>{const n=e.state,s=[e.on("call.ended",pb(e)),mb(e),yb(t,e),Cb(t),vb(t,n),Sb(t,n),e.on("participantJoined",Eb(n)),e.on("participantLeft",_b(n)),e.on("participantUpdated",Ib(n)),e.on("trackPublished",Rb(n)),e.on("trackUnpublished",Pb(n)),Ob(t,n),xb(t,n),e.on("callGrantsUpdated",gb(n)),e.on("pinsUpdated",Tb(n)),e.on("inboundStateNotification",kb(n)),wb(e)];return()=>{s.forEach(i=>i())}},Db=e=>{const t={"call.accepted":hb(e),"call.rejected":fb(e)},n=Object.keys(t).map(s=>{const i=s;return e.on(i,t[i])});return()=>{n.forEach(s=>s())}},Nb=.35;class Lb{constructor(){this.elementHandlerMap=new Map,this.observer=null,this.queueSet=new Set,this.setViewport=(t,n)=>{const s=()=>{this.observer?.disconnect(),this.observer=null,this.elementHandlerMap.clear()};return this.observer=new IntersectionObserver(i=>{i.forEach(r=>{this.elementHandlerMap.get(r.target)?.(r)})},{root:t,...n,threshold:n?.threshold??Nb}),this.queueSet.size&&(this.queueSet.forEach(([i,r])=>{t.contains(i)&&(this.observer.observe(i),this.elementHandlerMap.set(i,r))}),this.queueSet.clear()),s},this.observe=(t,n)=>{const s=[t,n],i=()=>{this.elementHandlerMap.delete(t),this.observer?.unobserve(t),this.queueSet.delete(s)};return this.elementHandlerMap.has(t)?i:this.observer?(this.observer.root.contains(t)&&(this.elementHandlerMap.set(t,n),this.observer.observe(t)),i):(this.queueSet.add(s),i)}}}const ka={videoTrack:Ee.UNKNOWN,screenShareTrack:Ee.UNKNOWN},ks=Symbol("globalOverrideKey");class Mb{constructor(t,n){this.viewportTracker=new Lb,this.logger=le(["DynascaleManager"]),this.pendingSubscriptionsUpdate=null,this.videoTrackSubscriptionOverridesSubject=new Z({}),this.videoTrackSubscriptionOverrides$=this.videoTrackSubscriptionOverridesSubject.asObservable(),this.incomingVideoSettings$=this.videoTrackSubscriptionOverrides$.pipe(Be(s=>{const{[ks]:i,...r}=s;return{enabled:i?.enabled!==!1,preferredResolution:i?.enabled?i.dimension:void 0,participants:Object.fromEntries(Object.entries(r).map(([o,a])=>[o,{enabled:a?.enabled!==!1,preferredResolution:a?.enabled?a.dimension:void 0}])),isParticipantVideoEnabled:o=>s[o]?.enabled??s[ks]?.enabled??!0}}),je(1)),this.dispose=async()=>{this.pendingSubscriptionsUpdate&&clearTimeout(this.pendingSubscriptionsUpdate);const s=this.getOrCreateAudioContext();s&&s.state!=="closed"&&(document.removeEventListener("click",this.resumeAudioContext),await s.close(),this.audioContext=void 0)},this.setVideoTrackSubscriptionOverrides=(s,i)=>i?Oe(this.videoTrackSubscriptionOverridesSubject,r=>({...r,...Object.fromEntries(i.map(o=>[o,s]))})):Oe(this.videoTrackSubscriptionOverridesSubject,s?{[ks]:s}:{}),this.applyTrackSubscriptions=(s=wt.SLOW)=>{this.pendingSubscriptionsUpdate&&clearTimeout(this.pendingSubscriptionsUpdate);const i=()=>{this.pendingSubscriptionsUpdate=null,this.sfuClient?.updateSubscriptions(this.trackSubscriptions).catch(r=>{this.logger("debug","Failed to update track subscriptions",r)})};s?this.pendingSubscriptionsUpdate=setTimeout(i,s):i()},this.trackElementVisibility=(s,i,r)=>{const o=this.viewportTracker.observe(s,a=>{this.callState.updateParticipant(i,c=>{const u=c.viewportVisibilityState??ka,d=a.isIntersecting||document.fullscreenElement===s?Ee.VISIBLE:Ee.INVISIBLE;return{...c,viewportVisibilityState:{...u,[r]:d}}})});return()=>{o(),this.callState.updateParticipant(i,a=>{const c=a.viewportVisibilityState??ka;return{...a,viewportVisibilityState:{...c,[r]:Ee.UNKNOWN}}})}},this.setViewport=s=>this.viewportTracker.setViewport(s),this.bindVideoElement=(s,i,r)=>{const o=this.callState.findParticipantBySessionId(i);if(!o)return;const a=(f,g)=>{g&&(g.width===0||g.height===0)&&(this.logger("debug","Ignoring 0x0 dimension",o),g=void 0),this.callState.updateParticipantTracks(r,{[i]:{dimension:g}}),this.applyTrackSubscriptions(f)},c=this.callState.participants$.pipe(Be(f=>f.find(g=>g.sessionId===i)),Tr(f=>!!f),We(),je({bufferSize:1,refCount:!0}));let u;const d=o.isLocalParticipant?null:c.pipe(Be(f=>f.viewportVisibilityState?.[r]),We()).subscribe(f=>{if(!u){u=f??Ee.UNKNOWN;return}if(u=f??Ee.UNKNOWN,f===Ee.INVISIBLE)return a(wt.MEDIUM,void 0);a(wt.MEDIUM,{width:s.clientWidth,height:s.clientHeight})});let p;const l=o.isLocalParticipant?null:new ResizeObserver(()=>{const f={width:s.clientWidth,height:s.clientHeight};if(!p){p=f;return}if(p.width===f.width&&p.height===f.height||u===Ee.INVISIBLE)return;const S=Math.max(f.width/p.width,f.height/p.height)>1.2?wt.IMMEDIATE:wt.MEDIUM;a(S,{width:s.clientWidth,height:s.clientHeight}),p=f});l?.observe(s);const h=o.isLocalParticipant?null:c.pipe(ys("publishedTracks"),Be(f=>r==="videoTrack"?Ut(f):$t(f)),We()).subscribe(f=>{f?a(wt.IMMEDIATE,{width:s.clientWidth,height:s.clientHeight}):a(wt.FAST,void 0)});s.autoplay=!0,s.playsInline=!0,s.muted=!0;const m=c.pipe(ys(r==="videoTrack"?"videoStream":"screenShareStream")).subscribe(f=>{const g=r==="videoTrack"?f.videoStream:f.screenShareStream;s.srcObject!==g&&(s.srcObject=g??null,(Ar()||Pi())&&setTimeout(()=>{s.srcObject=g??null,s.play().catch(S=>{this.logger("warn","Failed to play stream",S)})},25))});return()=>{a(wt.FAST,void 0),d?.unsubscribe(),h?.unsubscribe(),m.unsubscribe(),l?.disconnect()}},this.bindAudioElement=(s,i,r)=>{const o=this.callState.findParticipantBySessionId(i);if(!o||o.isLocalParticipant)return;const a=this.callState.participants$.pipe(Be(m=>m.find(f=>f.sessionId===i)),Tr(m=>!!m),We(),je({bufferSize:1,refCount:!0})),c=(m,f)=>{m&&("setSinkId"in s&&s.setSinkId(m).catch(g=>{this.logger("warn","Can't to set AudioElement sinkId",g)}),f&&"setSinkId"in f&&f.setSinkId(m).catch(g=>{this.logger("warn","Can't to set AudioContext sinkId",g)}))};let u,d;const p=a.pipe(ys(r==="screenShareAudioTrack"?"screenShareAudioStream":"audioStream")).subscribe(m=>{const f=r==="screenShareAudioTrack"?m.screenShareAudioStream:m.audioStream;s.srcObject!==f&&setTimeout(()=>{if(s.srcObject=f??null,!f)return;const g=this.getOrCreateAudioContext();g?(s.muted=!0,u?.disconnect(),u=g.createMediaStreamSource(f),d??(d=g.createGain()),d.gain.value=m.audioVolume??this.speaker.state.volume,u.connect(d).connect(g.destination),this.resumeAudioContext()):(s.muted=!1,s.play().catch(C=>{this.logger("warn","Failed to play audio stream",C)}));const{selectedDevice:S}=this.speaker.state;S&&c(S,g)})}),l="setSinkId"in s?this.speaker.state.selectedDevice$.subscribe(m=>{const f=this.getOrCreateAudioContext();c(m,f)}):null,h=Zt([this.speaker.state.volume$,a.pipe(ys("audioVolume"))]).subscribe(([m,f])=>{const g=f.audioVolume??m;s.volume=g,d&&(d.gain.value=g)});return s.autoplay=!0,()=>{l?.unsubscribe(),h.unsubscribe(),p.unsubscribe(),s.srcObject=null,u?.disconnect(),d?.disconnect()}},this.getOrCreateAudioContext=()=>{if(this.audioContext||!Ar())return this.audioContext;const s=new AudioContext;s.state==="suspended"&&document.addEventListener("click",this.resumeAudioContext);const i=navigator.audioSession;return i&&(i.type="play-and-record"),this.audioContext=s},this.resumeAudioContext=()=>{this.audioContext?.state==="suspended"&&this.audioContext.resume().catch(s=>this.logger("warn","Can't resume audio context",s)).then(()=>{document.removeEventListener("click",this.resumeAudioContext)})},this.callState=t,this.speaker=n}setSfuClient(t){this.sfuClient=t}get trackSubscriptions(){const t=[];for(const n of this.callState.remoteParticipants){if(n.videoDimension&&Ut(n)){const s=this.videoTrackSubscriptionOverrides[n.sessionId]??this.videoTrackSubscriptionOverrides[ks];s?.enabled!==!1&&t.push({userId:n.userId,sessionId:n.sessionId,trackType:P.VIDEO,dimension:s?.dimension??n.videoDimension})}n.screenShareDimension&&$t(n)&&t.push({userId:n.userId,sessionId:n.sessionId,trackType:P.SCREEN_SHARE,dimension:n.screenShareDimension}),ki(n)&&t.push({userId:n.userId,sessionId:n.sessionId,trackType:P.SCREEN_SHARE_AUDIO})}return t}get videoTrackSubscriptionOverrides(){return _e(this.videoTrackSubscriptionOverrides$)}}class jb{constructor(){this.permissions=[],this.setPermissions=t=>{this.permissions=t||[]},this.setCallSettings=t=>{this.settings=t},this.hasPermission=t=>this.permissions.includes(t),this.canPublish=t=>{switch(t){case P.AUDIO:return this.hasPermission(q.SEND_AUDIO);case P.VIDEO:return this.hasPermission(q.SEND_VIDEO);case P.SCREEN_SHARE:case P.SCREEN_SHARE_AUDIO:return this.hasPermission(q.SCREENSHARE);case P.UNSPECIFIED:return!1;default:ts(t,"Unknown track type")}},this.canRequest=(t,n=this.settings)=>{if(!n)return!1;const{audio:s,video:i,screensharing:r}=n;switch(t){case q.SEND_AUDIO:return s.access_request_enabled;case q.SEND_VIDEO:return i.access_request_enabled;case q.SCREENSHARE:return r.access_request_enabled;default:return!1}}}}class Vn{constructor(t,n={sortParticipantsBy:es}){this.name=t,this.options=n}}class Fb{constructor(t){this.register=n=>{this.callTypes[n.name]=n},this.unregister=n=>{delete this.callTypes[n]},this.get=n=>(this.callTypes[n]||this.register(new Vn(n)),this.callTypes[n]),this.callTypes=t.reduce((n,s)=>(n[s.name]=s,n),{})}}const Vl=new Fb([new Vn("default",{sortParticipantsBy:es}),new Vn("development",{sortParticipantsBy:es}),new Vn("livestream",{sortParticipantsBy:ma}),new Vn("audio_room",{sortParticipantsBy:ma})]),Ub=e=>{e.active&&(e.getTracks().forEach(t=>{t.stop()}),typeof e.release=="function"&&e.release())};class Bl{constructor(t){this.permission=t,this.disposeController=new AbortController,this.wasPrompted=!1,this.listeners=new Set,this.logger=le(["permissions"]);const n=this.disposeController.signal;this.ready=(async()=>{const s=()=>{Fe()?this.setState("granted"):this.setState("prompt")};if(!$b())return s();try{const i=await navigator.permissions.query({name:t.queryName});n.aborted||(this.setState(i.state),i.addEventListener("change",()=>this.setState(i.state),{signal:n}))}catch(i){this.logger("debug","Failed to query permission status",i),s()}})()}dispose(){this.state=void 0,this.disposeController.abort()}async getState(){if(await this.ready,!this.state)throw new Error("BrowserPermission instance possibly disposed");return this.state}async prompt({forcePrompt:t=!1,throwOnNotAllowed:n=!1}={}){return await He(`permission-prompt-${this.permission.queryName}`,async()=>{if(await this.getState()!=="prompt"||this.wasPrompted&&!t){const s=this.state==="granted";if(!s&&n)throw new Error("Permission was not granted previously, and prompting again is not allowed");return s}try{this.wasPrompted=!0,this.setState("prompting");const s=await navigator.mediaDevices.getUserMedia(this.permission.constraints);return Ub(s),this.setState("granted"),!0}catch(s){if(s&&typeof s=="object"&&"name"in s&&(s.name==="NotAllowedError"||s.name==="SecurityError")){if(this.logger("info","Browser permission was not granted",{permission:this.permission}),this.setState("denied"),n)throw s;return!1}throw this.logger("error","Failed to getUserMedia",{error:s,permission:this.permission}),this.setState("prompt"),s}})}listen(t){return this.listeners.add(t),this.state&&t(this.state),()=>this.listeners.delete(t)}asObservable(){return this.getStateObservable().pipe(Be(t=>t!=="denied"))}asStateObservable(){return this.getStateObservable()}getIsPromptingObservable(){return this.getStateObservable().pipe(Be(t=>t==="prompting"))}getStateObservable(){return sf(t=>this.listen(t),(t,n)=>n())}setState(t){this.state!==t&&(this.state=t,this.listeners.forEach(n=>n(t)))}}function $b(){return!Fe()&&typeof navigator<"u"&&!!navigator.permissions?.query}const po=(e,t,n)=>dn((async()=>{let s=await navigator.mediaDevices.enumerateDevices();return s.some(r=>r.kind===t&&r.label==="")&&await e.prompt()&&(s=await navigator.mediaDevices.enumerateDevices()),n?.traceOnce("device-enumeration","navigator.mediaDevices.enumerateDevices",s),s.filter(r=>r.kind===t&&r.label!==""&&r.deviceId!=="default")})()),Vb=()=>typeof document>"u"?!1:"setSinkId"in document.createElement("audio"),Hl={audio:{autoGainControl:!0,noiseSuppression:!0,echoCancellation:!0}},ql={video:{width:1280,height:720}},Rn=fn(()=>new Bl({constraints:Hl,queryName:"microphone"})),ai=fn(()=>new Bl({constraints:ql,queryName:"camera"})),xi=fn(e=>navigator.mediaDevices.addEventListener?Cr(navigator.mediaDevices,"devicechange").pipe(lf(()=>e?.resetTrace("device-enumeration")),Be(()=>{}),rf(500)):dn([])),Bb=fn(e=>Xr(xi(e),Rn().asObservable()).pipe(as(void 0),yi(()=>po(Rn(),"audioinput",e)),je(1))),Hb=fn(e=>Xr(xi(e),ai().asObservable()).pipe(as(void 0),yi(()=>po(ai(),"videoinput",e)),je(1))),qb=fn(e=>Xr(xi(e),Rn().asObservable()).pipe(as(void 0),yi(()=>po(Rn(),"audiooutput",e)),je(1)));let Wb=0;const Wl=async(e,t)=>{const n=`navigator.mediaDevices.getUserMedia.${Wb++}.`;try{t?.trace(n,e);const s=await navigator.mediaDevices.getUserMedia(e);if(t?.trace(`${n}OnSuccess`,Ml(s)),Pi()&&navigator.mediaDevices.dispatchEvent(new Event("devicechange")),e.video){const[i]=s.getVideoTracks();if(i){const{width:r,height:o}=i.getSettings(),a=e.video;(r!==a.width||o!==a.height)&&t?.trace(`${n}Warn`,`Requested resolution ${a.width}x${a.height} but got ${r}x${o}`)}}return s}catch(s){throw t?.trace(`${n}OnFailure`,s.name),s}};function Gl(e){if(!e||typeof e!="object")return!1;if("name"in e&&typeof e.name=="string"){const t=e.name;if(["OverconstrainedError","NotFoundError"].includes(t))return!0}return!!("message"in e&&typeof e.message=="string"&&e.message.startsWith("OverconstrainedError"))}const Kl=async(e,t)=>{const n={audio:{...Hl.audio,...e}};try{return await Rn().prompt({throwOnNotAllowed:!0,forcePrompt:!0}),await Wl(n,t)}catch(s){if(Gl(s)&&e?.deviceId){const{deviceId:i,...r}=e;return le(["devices"])("warn","Failed to get audio stream, will try again with relaxed constraints",{error:s,constraints:n,relaxedConstraints:r}),Kl(r)}throw le(["devices"])("error","Failed to get audio stream",{error:s,constraints:n}),s}},Jl=async(e,t)=>{const n={video:{...ql.video,...e}};try{return await ai().prompt({throwOnNotAllowed:!0,forcePrompt:!0}),await Wl(n,t)}catch(s){if(Gl(s)&&e?.deviceId){const{deviceId:i,...r}=e;return le(["devices"])("warn","Failed to get video stream, will try again with relaxed constraints",{error:s,constraints:n,relaxedConstraints:r}),Jl(r)}throw le(["devices"])("error","Failed to get video stream",{error:s,constraints:n}),s}};let Gb=0;const Kb=async(e,t)=>{const n=`navigator.mediaDevices.getDisplayMedia.${Gb++}.`;try{const s={systemAudio:"include",...e,video:typeof e?.video=="boolean"?e.video:{width:{max:2560},height:{max:1440},frameRate:{ideal:30},...e?.video},audio:typeof e?.audio=="boolean"?e.audio:{channelCount:{ideal:2},echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1,...e?.audio}};t?.trace(n,s);const i=await navigator.mediaDevices.getDisplayMedia(s);return t?.trace(`${n}OnSuccess`,Ml(i)),i}catch(s){throw t?.trace(`${n}OnFailure`,s.name),le(["devices"])("error","Failed to get screen share stream",s),s}},Pn=typeof navigator<"u"&&typeof navigator.mediaDevices<"u"?xi().pipe(as(void 0),yi(()=>navigator.mediaDevices.enumerateDevices()),je(1)):void 0;function Jb(e,t){if(e!=="default")return e;const n=Pn&&_e(Pn);if(!n)return e;const s=n.find(o=>o.deviceId===e);if(!s)return e;const i=s.groupId,r=n.filter(o=>o.kind===t&&o.deviceId!=="default"&&o.groupId===i);return r.length===1?r[0].deviceId:e}const zl=()=>/Mobi/i.test(navigator.userAgent);class Yl{constructor(t,n,s){this.stopOnLeave=!0,this.subscriptions=[],this.areSubscriptionsSetUp=!1,this.isTrackStoppedDueToTrackEnd=!1,this.filters=[],this.statusChangeConcurrencyTag=Symbol("statusChangeConcurrencyTag"),this.filterRegistrationConcurrencyTag=Symbol("filterRegistrationConcurrencyTag"),this.dispose=()=>{this.subscriptions.forEach(i=>i()),this.subscriptions=[],this.areSubscriptionsSetUp=!1},this.call=t,this.state=n,this.trackType=s,this.logger=le([`${P[s].toLowerCase()} manager`]),this.setup()}setup(){this.areSubscriptionsSetUp||(this.areSubscriptionsSetUp=!0,Pn&&!Fe()&&(this.trackType===P.AUDIO||this.trackType===P.VIDEO)&&this.handleDisconnectedOrReplacedDevices())}listDevices(){return this.getDevices()}get enabled(){return this.state.status==="enabled"}async enable(){this.state.prevStatus=this.state.optimisticStatus,this.state.optimisticStatus!=="enabled"&&(this.state.setPendingStatus("enabled"),await er(this.statusChangeConcurrencyTag,async t=>{try{await this.unmuteStream(),this.state.setStatus("enabled")}finally{t.aborted||this.state.setPendingStatus(this.state.status)}}))}async disable(t){const n=typeof t=="boolean"?t:t?.forceStop??!1;this.state.prevStatus=this.state.optimisticStatus,!(!n&&this.state.optimisticStatus==="disabled")&&(this.state.setPendingStatus("disabled"),await er(this.statusChangeConcurrencyTag,async s=>{try{const i=n||this.state.disableMode==="stop-tracks";await this.muteStream(i),this.state.setStatus("disabled")}finally{s.aborted||this.state.setPendingStatus(this.state.status)}}))}async statusChangeSettled(){await tr(this.statusChangeConcurrencyTag)}async resume(){this.state.prevStatus==="enabled"&&this.state.status!=="enabled"&&await this.enable()}async toggle(){return this.state.optimisticStatus==="enabled"?await this.disable():await this.enable()}registerFilter(t){const n={start:t,stop:void 0};return this.call.tracer.trace(`registerFilter.${P[this.trackType]}`,null),{registered:He(this.filterRegistrationConcurrencyTag,async()=>{await tr(this.statusChangeConcurrencyTag),this.filters.push(n),await this.applySettingsToStream()}),unregister:()=>He(this.filterRegistrationConcurrencyTag,async()=>{await tr(this.statusChangeConcurrencyTag),n.stop?.(),this.filters=this.filters.filter(i=>i!==n),await this.applySettingsToStream(),this.call.tracer.trace(`unregisterFilter.${P[this.trackType]}`,null)})}}setDefaultConstraints(t){this.state.setDefaultConstraints(t)}async select(t){if(Fe())throw new Error("This method is not supported in React Native.");const n=this.state.selectedDevice;if(t!==n)try{this.state.setDevice(t),await this.applySettingsToStream()}catch(s){throw this.state.setDevice(n),s}}async applySettingsToStream(){await er(this.statusChangeConcurrencyTag,async t=>{if(this.enabled)try{if(await this.muteStream(),this.state.setStatus("disabled"),t.aborted)return;await this.unmuteStream(),this.state.setStatus("enabled")}finally{t.aborted||this.state.setPendingStatus(this.state.status)}})}publishStream(t,n){return this.call.publish(t,this.trackType,n)}stopPublishStream(){return this.call.stopPublish(this.trackType)}getTracks(){return this.state.mediaStream?.getTracks()??[]}async muteStream(t=!0){const n=this.state.mediaStream;if(!n)return;this.logger("debug",`${t?"Stopping":"Disabling"} stream`),this.call.state.callingState===L.JOINED&&await this.stopPublishStream(),this.muteLocalStream(t),this.getTracks().every(i=>i.readyState==="ended")&&(typeof n.release=="function"&&n.release(),this.state.setMediaStream(void 0,void 0),this.filters.forEach(i=>i.stop?.()))}disableTracks(){this.getTracks().forEach(t=>{t.enabled&&(t.enabled=!1)})}enableTracks(){this.getTracks().forEach(t=>{t.enabled||(t.enabled=!0)})}stopTracks(){this.getTracks().forEach(t=>{t.readyState==="live"&&t.stop()})}muteLocalStream(t){this.state.mediaStream&&(t?this.stopTracks():this.disableTracks())}async unmuteStream(){this.logger("debug","Starting stream");let t,n;if(this.state.mediaStream&&this.getTracks().every(s=>s.readyState==="live"))t=this.state.mediaStream,this.enableTracks();else{const i={...this.state.defaultConstraints,deviceId:this.state.selectedDevice?{exact:this.state.selectedDevice}:void 0},r=o=>async a=>{if(!o)return a;const c=await o;return a.getTracks().forEach(u=>{const d=u.stop;u.stop=function(){d.call(u),c.getTracks().forEach(l=>{l.kind===u.kind&&l.stop()})}}),c.getTracks().forEach(u=>{const d=()=>{a.getTracks().forEach(p=>{u.kind===p.kind&&(p.stop(),p.dispatchEvent(new Event("ended")))})};u.addEventListener("ended",d),this.subscriptions.push(()=>{u.removeEventListener("ended",d)})}),a};n=this.getStream(i),t=await this.filters.reduce((o,a)=>o.then(c=>{const{stop:u,output:d}=a.start(c);return a.stop=u,d}).then(r(o),c=>(this.logger("warn","Filter failed to start and will be ignored",c),o)),n)}if(this.call.state.callingState===L.JOINED&&await this.publishStream(t),this.state.mediaStream!==t){this.state.setMediaStream(t,await n);const s=async()=>{await this.statusChangeSettled(),this.enabled&&(this.isTrackStoppedDueToTrackEnd=!0,setTimeout(()=>{this.isTrackStoppedDueToTrackEnd=!1},2e3),await this.disable())},i=r=>()=>{!zl()||this.trackType!==P.VIDEO||this.call.notifyTrackMuteState(r,this.trackType).catch(o=>{this.logger("warn","Error while notifying track mute state",o)})};t.getTracks().forEach(r=>{const o=i(!0),a=i(!1);r.addEventListener("mute",o),r.addEventListener("unmute",a),r.addEventListener("ended",s),this.subscriptions.push(()=>{r.removeEventListener("mute",o),r.removeEventListener("unmute",a),r.removeEventListener("ended",s)})})}}get mediaDeviceKind(){return this.trackType===P.AUDIO?"audioinput":this.trackType===P.VIDEO?"videoinput":""}handleDisconnectedOrReplacedDevices(){this.subscriptions.push(ht(Zt([Pn.pipe(af()),this.state.selectedDevice$]),async([[t,n],s])=>{try{if(!s)return;await this.statusChangeSettled();let i=!1,r=!1;const o=this.findDevice(n,s),a=this.findDevice(t,s);!o&&a?i=!0:o&&a&&o.deviceId===a.deviceId&&o.groupId!==a.groupId&&(r=!0),i&&(await this.disable(),await this.select(void 0)),r&&(this.isTrackStoppedDueToTrackEnd&&this.state.status==="disabled"?(await this.enable(),this.isTrackStoppedDueToTrackEnd=!1):await this.applySettingsToStream())}catch(i){this.logger("warn","Unexpected error while handling disconnected or replaced device",i)}}))}findDevice(t,n){const s=this.mediaDeviceKind;return t.find(i=>i.deviceId===n&&i.kind===s)}}class Xl{constructor(t,n){this.statusSubject=new Z(void 0),this.optimisticStatusSubject=new Z(void 0),this.mediaStreamSubject=new Z(void 0),this.selectedDeviceSubject=new Z(void 0),this.defaultConstraintsSubject=new Z(void 0),this.mediaStream$=this.mediaStreamSubject.asObservable(),this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe(We()),this.status$=this.statusSubject.asObservable().pipe(We()),this.optimisticStatus$=this.optimisticStatusSubject.asObservable().pipe(We()),this.defaultConstraints$=this.defaultConstraintsSubject.asObservable(),this.disableMode=t,this.hasBrowserPermission$=n?n.asObservable().pipe(je(1)):Hn(!0),this.browserPermissionState$=n?n.asStateObservable().pipe(je(1)):Hn("prompt"),this.isPromptingPermission$=n?n.getIsPromptingObservable().pipe(je(1)):Hn(!1)}get status(){return _e(this.status$)}get optimisticStatus(){return _e(this.optimisticStatus$)}get selectedDevice(){return _e(this.selectedDevice$)}get mediaStream(){return _e(this.mediaStream$)}setStatus(t){Oe(this.statusSubject,t)}setPendingStatus(t){Oe(this.optimisticStatusSubject,t)}setMediaStream(t,n){Oe(this.mediaStreamSubject,t),n&&this.setDevice(this.getDeviceIdFromStream(n))}setDevice(t){Oe(this.selectedDeviceSubject,t)}get defaultConstraints(){return _e(this.defaultConstraints$)}setDefaultConstraints(t){Oe(this.defaultConstraintsSubject,t)}}class zb extends Xl{constructor(){super("stop-tracks",ai()),this.directionSubject=new Z(void 0),this.direction$=this.directionSubject.asObservable().pipe(We())}get direction(){return _e(this.direction$)}setDirection(t){Oe(this.directionSubject,t)}setMediaStream(t,n){if(super.setMediaStream(t,n),t){const s=Fe()?this.direction:t.getVideoTracks()[0]?.getSettings().facingMode==="environment"?"back":"front";this.setDirection(s)}}getDeviceIdFromStream(t){const[n]=t.getVideoTracks();return n?.getSettings().deviceId}}class Yb extends Yl{constructor(t){super(t,new zb,P.VIDEO),this.targetResolution={width:1280,height:720}}isDirectionSupportedByDevice(){return Fe()||zl()}async selectDirection(t){if(!this.isDirectionSupportedByDevice()){this.logger("warn","Setting direction is not supported on this device");return}if(Fe()){await this.getTracks()[0]?.applyConstraints({facingMode:t==="front"?"user":"environment"}),this.state.setDirection(t);return}this.state.setDirection(t),this.state.setDevice(void 0),this.getTracks().forEach(n=>n.stop());try{await this.unmuteStream()}catch(n){throw n instanceof Error&&n.name==="NotReadableError"&&(await this.muteStream(),await this.unmuteStream()),n}}async flip(){const t=this.state.direction==="front"?"back":"front";await this.selectDirection(t)}async selectTargetResolution(t){if(this.targetResolution.height=t.height,this.targetResolution.width=t.width,this.state.optimisticStatus==="enabled")try{await this.statusChangeSettled()}catch(n){this.logger("warn","could not apply target resolution",n)}if(this.enabled&&this.state.mediaStream){const[n]=this.state.mediaStream.getVideoTracks();if(!n)return;const{width:s,height:i}=n.getSettings();(s!==this.targetResolution.width||i!==this.targetResolution.height)&&(await this.applySettingsToStream(),this.logger("debug",`${s}x${i} target resolution applied to media stream`))}}async apply(t,n){const s=!!this.call.state.localParticipant?.videoStream,i=this.call.permissionsContext.hasPermission(q.SEND_AUDIO);if(s||!i)return;await this.statusChangeSettled();const{target_resolution:r,camera_facing:o,camera_default_on:a,enabled:c}=t;let{width:u,height:d}=r;if(u<d&&([u,d]=[d,u]),await this.selectTargetResolution({width:u,height:d}),!this.state.direction&&!this.state.selectedDevice&&this.state.setDirection(o==="front"?"front":"back"),!n)return;const{mediaStream:p}=this.state;this.enabled&&p?await this.publishStream(p):this.state.status===void 0&&a&&c&&await this.enable()}getDevices(){return Hb(this.call.tracer)}getStream(t){return t.width=this.targetResolution.width,t.height=this.targetResolution.height,!t.deviceId&&this.state.direction&&this.isDirectionSupportedByDevice()&&(t.facingMode=this.state.direction==="front"?"user":"environment"),Jl(t,this.call.tracer)}}class Zl extends Yl{async setAudioBitrateProfile(t){if(!this.call.state.settings?.audio.hifi_audio_enabled)throw new Error("High Fidelity audio is not enabled for this call");this.doSetAudioBitrateProfile(t),this.state.setAudioBitrateProfile(t),this.enabled&&await this.applySettingsToStream()}publishStream(t,n){return super.publishStream(t,{audioBitrateProfile:this.state.audioBitrateProfile,...n})}}const Ql=e=>{const t=e===ft.MUSIC_HIGH_QUALITY;return{echoCancellation:!t,noiseSuppression:!t,autoGainControl:!t,channelCount:{ideal:t?2:1}}};class eu extends Xl{constructor(t,n,s){super(t,n),this.audioBitrateProfileSubject=new Z(s),this.audioBitrateProfile$=this.audioBitrateProfileSubject.asObservable().pipe(We())}get audioBitrateProfile(){return _e(this.audioBitrateProfile$)}setAudioBitrateProfile(t){Oe(this.audioBitrateProfileSubject,t)}}class Xb extends eu{constructor(t){super(t,Rn(),ft.VOICE_STANDARD_UNSPECIFIED),this.speakingWhileMutedSubject=new Z(!1),this.speakingWhileMuted$=this.speakingWhileMutedSubject.asObservable().pipe(We())}get speakingWhileMuted(){return _e(this.speakingWhileMuted$)}setSpeakingWhileMuted(t){Oe(this.speakingWhileMutedSubject,t)}getDeviceIdFromStream(t){const[n]=t.getAudioTracks(),s=n?.getSettings().deviceId;return Jb(s,"audioinput")}}const Zb=500,Qb=150,ev=128,tv=(e,t,n={})=>{const{detectionFrequencyInMs:s=Zb,audioLevelThreshold:i=Qb,fftSize:r=ev,destroyStreamOnStop:o=!0}=n,a=new AudioContext,c=a.createAnalyser();c.fftSize=r;const u=a.createMediaStreamSource(e);u.connect(c);const d=setInterval(()=>{const p=new Uint8Array(c.frequencyBinCount);c.getByteFrequencyData(p);const l=p.some(f=>f>=i),h=p.reduce((f,g)=>f+g,0)/p.length,m=h>i?100:Math.round(h/i*100);e.getAudioTracks()[0]?.enabled?t({isSoundDetected:l,audioLevel:m}):t({isSoundDetected:!1,audioLevel:0})},s);return async function(){clearInterval(d),u.disconnect(),c.disconnect(),a.state!=="closed"&&await a.close(),o&&e.getTracks().forEach(l=>{l.stop(),e.removeTrack(l)})}};class nv{constructor(t){this.pc1=new RTCPeerConnection({}),this.pc2=new RTCPeerConnection({}),this.externalAudioStream=t}async start(t){try{let n;this.externalAudioStream!=null?n=this.externalAudioStream:(n=await navigator.mediaDevices.getUserMedia({audio:!0}),this.audioStream=n),this.pc1.addEventListener("icecandidate",async o=>{await this.pc2.addIceCandidate(o.candidate)}),this.pc2.addEventListener("icecandidate",async o=>{await this.pc1.addIceCandidate(o.candidate)}),this.pc2.addEventListener("track",o=>{o.streams[0].getTracks().forEach(a=>{a._setVolume(0)})}),n.getTracks().forEach(o=>this.pc1.addTrack(o,n));const s=await this.pc1.createOffer({});await this.pc2.setRemoteDescription(s),await this.pc1.setLocalDescription(s);const i=await this.pc2.createAnswer();await this.pc1.setRemoteDescription(i),await this.pc2.setLocalDescription(i);const r=this.onSpeakingDetectedStateChange(t);return()=>{r(),this.stop()}}catch(n){return le(["RNSpeechDetector"])("error","error handling permissions: ",n),()=>{}}}stop(){this.pc1.close(),this.pc2.close(),this.externalAudioStream!=null?this.externalAudioStream=void 0:this.cleanupAudioStream()}onSpeakingDetectedStateChange(t){let s=.13,i=!1,r,o;const a=[],c=10,u=1.1,d=.9,p=500,l=5e3,m=setInterval(async()=>{try{const f=await this.pc1.getStats(),S=ii(f).find(C=>C.type==="media-source"&&C.kind==="audio");if(S){const{audioLevel:C}=S;if(C){a.push(C),a.length>c&&a.shift();const y=a.reduce((T,k)=>T+k,0)/a.length;y<s*u?o||(o=setTimeout(()=>{s=Math.min(y*d,.13)},l)):(clearTimeout(o),o=void 0),y>s*1.5&&(i||(i=!0,t({isSoundDetected:!0,audioLevel:C})),clearTimeout(r),r=setTimeout(()=>{i=!1,t({isSoundDetected:!1,audioLevel:0})},p))}}}catch(f){le(["RNSpeechDetector"])("error","error checking audio level from stats",f)}},100);return()=>{clearInterval(m),clearTimeout(r),clearTimeout(o)}}cleanupAudioStream(){this.audioStream&&(this.audioStream.getTracks().forEach(t=>t.stop()),typeof this.audioStream.release=="function"&&this.audioStream.release())}}class sv extends Zl{constructor(t,n="stop-tracks"){super(t,new Xb(n),P.AUDIO),this.speakingWhileMutedNotificationEnabled=!0,this.soundDetectorConcurrencyTag=Symbol("soundDetectorConcurrencyTag")}setup(){super.setup(),this.subscriptions.push(Ti(Zt([this.call.state.callingState$,this.call.state.ownCapabilities$,this.state.selectedDevice$,this.state.status$]),async([t,n,s,i])=>{try{if(t===L.LEFT&&await this.stopSpeakingWhileMutedDetection(),t!==L.JOINED||!this.speakingWhileMutedNotificationEnabled)return;n.includes(q.SEND_AUDIO)?i==="disabled"?await this.startSpeakingWhileMutedDetection(s):await this.stopSpeakingWhileMutedDetection():await this.stopSpeakingWhileMutedDetection()}catch(r){this.logger("warn","Could not enable speaking while muted",r)}})),this.subscriptions.push(ht(this.call.state.callingState$,t=>{if(!this.noiseCancellationRegistration||!this.noiseCancellation)return;this.call.state.settings?.audio.noise_cancellation?.mode===Zi.AUTO_ON&&t===L.JOINED?this.noiseCancellationRegistration.then(()=>this.noiseCancellation?.canAutoEnable?this.noiseCancellation.canAutoEnable():!0).then(s=>{s&&this.noiseCancellation?.enable()}).catch(s=>(this.logger("warn","Failed to enable noise cancellation",s),this.call.notifyNoiseCancellationStopped())):t===L.LEFT&&this.noiseCancellationRegistration.then(()=>this.noiseCancellation?.disable()).catch(s=>{this.logger("warn","Failed to disable noise cancellation",s)})}))}async enableNoiseCancellation(t){const{ownCapabilities:n,settings:s}=this.call.state;if(!n.includes(q.ENABLE_NOISE_CANCELLATION))throw new Error("Noise cancellation is not available.");const r=s?.audio.noise_cancellation;if(!r||r.mode===Zi.DISABLED)throw new Error("Noise cancellation is disabled for this call type.");try{if(this.noiseCancellation=t,this.noiseCancellationChangeUnsubscribe=this.noiseCancellation.on("change",o=>{this.call.tracer.trace("noiseCancellation.enabled",o),o?this.call.notifyNoiseCancellationStarting().catch(a=>{this.logger("warn","notifyNoiseCancellationStart failed",a)}):this.call.notifyNoiseCancellationStopped().catch(a=>{this.logger("warn","notifyNoiseCancellationStop failed",a)})}),Fe())this.noiseCancellationRegistration=Promise.resolve();else{const o=this.registerFilter(t.toFilter());this.noiseCancellationRegistration=o.registered,this.unregisterNoiseCancellation=o.unregister,await this.noiseCancellationRegistration}if(r.mode===Zi.AUTO_ON&&this.call.state.callingState===L.JOINED){let o=!0;t.canAutoEnable&&(o=await t.canAutoEnable()),o&&t.enable()}}catch(o){throw this.logger("warn","Failed to enable noise cancellation",o),await this.disableNoiseCancellation().catch(a=>{this.logger("warn","Failed to disable noise cancellation",a)}),o}}async disableNoiseCancellation(){await(this.unregisterNoiseCancellation?.()??Promise.resolve()).then(()=>this.noiseCancellation?.disable()).then(()=>this.noiseCancellationChangeUnsubscribe?.()).catch(t=>{this.logger("warn","Failed to unregister noise cancellation",t)}),this.call.tracer.trace("noiseCancellation.disabled",!0),await this.call.notifyNoiseCancellationStopped()}async enableSpeakingWhileMutedNotification(){this.speakingWhileMutedNotificationEnabled=!0,this.state.status==="disabled"&&await this.startSpeakingWhileMutedDetection(this.state.selectedDevice)}async disableSpeakingWhileMutedNotification(){this.speakingWhileMutedNotificationEnabled=!1,await this.stopSpeakingWhileMutedDetection()}async apply(t,n){if(!n)return;const s=!!this.call.state.localParticipant?.audioStream,i=this.call.permissionsContext.hasPermission(q.SEND_AUDIO);if(s||!i)return;await this.statusChangeSettled();const{mediaStream:r}=this.state;this.enabled&&r?await this.publishStream(r):this.state.status===void 0&&t.mic_default_on&&await this.enable()}getDevices(){return Bb(this.call.tracer)}getStream(t){return Kl(t,this.call.tracer)}doSetAudioBitrateProfile(t){this.setDefaultConstraints({...this.state.defaultConstraints,...Ql(t)}),this.noiseCancellation&&(t===ft.MUSIC_HIGH_QUALITY?this.noiseCancellation.disable():this.noiseCancellation.enable())}async startSpeakingWhileMutedDetection(t){await He(this.soundDetectorConcurrencyTag,async()=>{if(await this.stopSpeakingWhileMutedDetection(),Fe()){this.rnSpeechDetector=new nv;const n=await this.rnSpeechDetector.start(s=>{this.state.setSpeakingWhileMuted(s.isSoundDetected)});this.soundDetectorCleanup=()=>{n(),this.rnSpeechDetector=void 0}}else{const n=await this.getStream({deviceId:{exact:t}});this.soundDetectorCleanup=tv(n,s=>{this.state.setSpeakingWhileMuted(s.isSoundDetected)})}})}async stopSpeakingWhileMutedDetection(){await He(this.soundDetectorConcurrencyTag,async()=>{if(!this.soundDetectorCleanup)return;const t=this.soundDetectorCleanup;this.soundDetectorCleanup=void 0,this.state.setSpeakingWhileMuted(!1),await t()})}}class iv extends eu{constructor(){super("stop-tracks",void 0,ft.MUSIC_HIGH_QUALITY),this.audioEnabledSubject=new Z(!0),this.settingsSubject=new Z(void 0),this.audioEnabled$=this.audioEnabledSubject.asObservable().pipe(We()),this.settings$=this.settingsSubject.asObservable(),this.getDeviceIdFromStream=t=>{const[n]=t.getTracks();return n?.getSettings().deviceId}}get audioEnabled(){return _e(this.audioEnabled$)}setAudioEnabled(t){Oe(this.audioEnabledSubject,t)}get settings(){return _e(this.settings$)}setSettings(t){Oe(this.settingsSubject,t)}}class rv extends Zl{constructor(t){super(t,new iv,P.SCREEN_SHARE)}setup(){super.setup(),this.subscriptions.push(ht(this.call.state.settings$,t=>{const n=t?.screensharing.target_resolution;n&&this.setDefaultConstraints({...this.state.defaultConstraints,video:{width:n.width,height:n.height}})}))}enableScreenShareAudio(){this.state.setAudioEnabled(!0)}async disableScreenShareAudio(){this.state.setAudioEnabled(!1),this.call.publisher?.isPublishing(P.SCREEN_SHARE_AUDIO)&&await this.call.stopPublish(P.SCREEN_SHARE_AUDIO)}getSettings(){return this.state.settings}setSettings(t){this.state.setSettings(t)}getDevices(){return Hn([])}async getStream(t){this.state.audioEnabled||(t.audio=!1);const n=await Kb(t,this.call.tracer),[s]=n.getVideoTracks(),{contentHint:i}=this.state.settings||{};return typeof i<"u"&&s&&"contentHint"in s&&(this.call.tracer.trace("navigator.mediaDevices.getDisplayMedia.contentHint",i),s.contentHint=i),n}doSetAudioBitrateProfile(t){const{defaultConstraints:n}=this.state,s=typeof n?.audio!="boolean"?n?.audio:null;this.setDefaultConstraints({...n,audio:{...s,...Ql(t)}})}async stopPublishStream(){return this.call.stopPublish(P.SCREEN_SHARE,P.SCREEN_SHARE_AUDIO)}async select(){throw new Error("Not supported")}}class ov{constructor(t){this.tracer=t,this.selectedDeviceSubject=new Z(""),this.volumeSubject=new Z(1),this.isDeviceSelectionSupported=Vb(),this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe(We()),this.volume$=this.volumeSubject.asObservable().pipe(We())}get selectedDevice(){return _e(this.selectedDevice$)}get volume(){return _e(this.volume$)}setDevice(t){Oe(this.selectedDeviceSubject,t),this.tracer.trace("navigator.mediaDevices.setSinkId",t)}setVolume(t){Oe(this.volumeSubject,t)}}class av{constructor(t){this.subscriptions=[],this.areSubscriptionsSetUp=!1,this.dispose=()=>{this.subscriptions.forEach(n=>n.unsubscribe()),this.subscriptions=[],this.areSubscriptionsSetUp=!1},this.call=t,this.state=new ov(t.tracer),this.setup()}setup(){this.areSubscriptionsSetUp||(this.areSubscriptionsSetUp=!0,Pn&&!Fe()&&this.subscriptions.push(Zt([Pn,this.state.selectedDevice$]).subscribe(([t,n])=>{if(!n)return;t.find(i=>i.deviceId===n&&i.kind==="audiooutput")||this.select("")})))}listDevices(){if(Fe())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");return qb(this.call.tracer)}select(t){if(Fe())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");this.state.setDevice(t)}setVolume(t){if(Fe())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");if(t&&(t<0||t>1))throw new Error("Volume must be between 0 and 1");this.state.setVolume(t)}setParticipantVolume(t,n){if(Fe())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");if(n&&(n<0||n>1))throw new Error("Volume must be between 0 and 1, or undefined");this.call.state.updateParticipant(t,{audioVolume:n})}}class ws{constructor({type:t,id:n,streamClient:s,members:i,ownCapabilities:r,sortParticipantsBy:o,clientStore:a,ringing:c=!1,watching:u=!1}){this.state=new Ll,this.permissionsContext=new jb,this.tracer=new uo(null),this.dispatcher=new gg,this.statsReportingIntervalInMs=2e3,this.sfuClientTag=0,this.reconnectConcurrencyTag=Symbol("reconnectConcurrencyTag"),this.reconnectAttempts=0,this.reconnectStrategy=Y.UNSPECIFIED,this.reconnectReason="",this.fastReconnectDeadlineSeconds=0,this.disconnectionTimeoutSeconds=0,this.lastOfflineTimestamp=0,this.trackPublishOrder=[],this.hasJoinedOnce=!1,this.deviceSettingsAppliedOnce=!1,this.initialized=!1,this.joinLeaveConcurrencyTag=Symbol("joinLeaveConcurrencyTag"),this.leaveCallHooks=new Set,this.streamClientEventHandlers=new Map,this.clientCapabilities=new Set([Qn.SUBSCRIBER_VIDEO_PAUSE]),this.setup=async()=>{await He(this.joinLeaveConcurrencyTag,async()=>{this.initialized||(this.leaveCallHooks.add(this.on("all",l=>{this.state.updateFromEvent(l)})),this.leaveCallHooks.add(this.on("changePublishOptions",l=>{this.currentPublishOptions=l.publishOptions})),this.leaveCallHooks.add(Ab(this,this.dispatcher)),this.registerEffects(),this.registerReconnectHandlers(),this.camera.setup(),this.microphone.setup(),this.screenShare.setup(),this.speaker.setup(),this.state.callingState===L.LEFT&&this.state.setCallingState(L.IDLE),this.initialized=!0)})},this.registerEffects=()=>{this.leaveCallHooks.add(ht(this.state.settings$,l=>{l&&this.permissionsContext.setCallSettings(l)})),this.leaveCallHooks.add(Ti(this.state.ownCapabilities$,this.handleOwnCapabilitiesUpdated)),this.leaveCallHooks.add(ht(this.state.blockedUserIds$,async l=>{if(!l||l.length===0)return;const h=this.currentUserId;h&&l.includes(h)&&(this.logger("info","Leaving call because of being blocked"),await this.leave({message:"user blocked"}).catch(m=>{this.logger("error","Error leaving call after being blocked",m)}))})),this.ringing?this.handleRingingCall():this.leaveCallHooks.add(ht(this.ringingSubject,l=>{l&&this.handleRingingCall()})),this.leaveCallHooks.add(ht(this.state.session$,l=>{if(!this.ringing)return;const h=this.clientStore.connectedUser?.id;if(!h)return;const m=!!l?.accepted_by[h],f=!!l?.rejected_by[h];(m||f)&&this.cancelAutoDrop(),(m&&this.state.callingState===L.RINGING||f)&&!Sg(this.joinLeaveConcurrencyTag)&&this.leave().catch(()=>{this.logger("error","Could not leave a call that was accepted or rejected elsewhere")})}))},this.handleRingingCall=()=>{const l=this.state.session,h=this.clientStore.connectedUser?.id,m=l?.ended_at,f=this.state.createdBy?.id,g=l?.rejected_by,S=l?.accepted_by;let C=!1;m?C=!0:f&&g?g[f]&&(C=!0):h&&g?g[h]&&(C=!0):h&&S&&S[h]&&(C=!0),C?this.state.callingState!==L.IDLE&&this.state.setCallingState(L.IDLE):(this.state.callingState===L.IDLE&&this.state.setCallingState(L.RINGING),this.scheduleAutoDrop(),this.leaveCallHooks.add(Db(this)))},this.handleOwnCapabilitiesUpdated=async l=>{if(this.permissionsContext.setPermissions(l),!this.publisher)return;const h={[q.SEND_AUDIO]:P.AUDIO,[q.SEND_VIDEO]:P.VIDEO,[q.SCREENSHARE]:P.SCREEN_SHARE};for(const[m,f]of Object.entries(h))if(!this.permissionsContext.hasPermission(m))try{switch(f){case P.AUDIO:this.microphone.enabled&&await this.microphone.disable();break;case P.VIDEO:this.camera.enabled&&await this.camera.disable();break;case P.SCREEN_SHARE:this.screenShare.enabled&&await this.screenShare.disable();break}}catch(S){this.logger("error","Can't disable mic/camera/screenshare after revoked permissions",S)}},this.on=(l,h)=>{if(ha(l))return this.dispatcher.on(l,h);const m=this.streamClient.on(l,f=>{const g=f;g.call_cid&&g.call_cid===this.cid&&h(g)});return this.streamClientEventHandlers.set(h,m),()=>{this.off(l,h)}},this.off=(l,h)=>{if(ha(l))return this.dispatcher.off(l,h);const m=this.streamClientEventHandlers.get(h);m&&m()},this.leave=async({reject:l,reason:h,message:m}={})=>{if(this.state.callingState===L.LEFT)throw new Error("Cannot leave call that has already been left.");await He(this.joinLeaveConcurrencyTag,async()=>{const f=this.state.callingState;if(f===L.LEFT)return;if(f===L.JOINING&&await new Promise(C=>{this.state.callingState$.pipe(Tr(y=>y!==L.JOINED,!0)).subscribe(()=>C())}),f===L.RINGING&&l!==!1)if(l)await this.reject(h??"decline");else{const S=this.state.remoteParticipants.length>0;this.isCreatedByMe&&!S&&await this.reject("cancel")}this.statsReporter?.stop(),this.statsReporter=void 0,this.sfuStatsReporter?.flush(),this.sfuStatsReporter?.stop(),this.sfuStatsReporter=void 0,this.subscriber?.dispose(),this.subscriber=void 0,this.publisher?.dispose(),this.publisher=void 0,await this.sfuClient?.leaveAndClose(m??h??"user is leaving the call"),this.sfuClient=void 0,this.dynascaleManager.setSfuClient(void 0),await this.dynascaleManager.dispose(),this.state.setCallingState(L.LEFT),this.state.setParticipants([]),this.state.dispose(),this.leaveCallHooks.forEach(S=>S()),this.initialized=!1,this.hasJoinedOnce=!1,this.unifiedSessionId=void 0,this.ringingSubject.next(!1),this.cancelAutoDrop(),this.clientStore.unregisterCall(this),this.camera.dispose(),this.microphone.dispose(),this.screenShare.dispose(),this.speaker.dispose(),this.deviceSettingsAppliedOnce=!1;const g=[];this.camera.stopOnLeave&&g.push(this.camera.disable(!0)),this.microphone.stopOnLeave&&g.push(this.microphone.disable(!0)),this.screenShare.stopOnLeave&&g.push(this.screenShare.disable(!0)),await Promise.all(g)})},this.updateFromRingingEvent=async l=>{await this.setup();const{created_by:h,settings:m}=l.call,f=this.state.members.find(S=>S.user.id===h.id);f?this.state.setMembers([f,...l.members]):this.state.setMembers(l.members),this.state.updateFromCallResponse(l.call),this.watching=!0,this.ringingSubject.next(!0);const g=this.clientStore.calls.filter(S=>S.cid!==this.cid);this.clientStore.setCalls([this,...g]),await this.applyDeviceConfig(m,!1)},this.get=async l=>{await this.setup();const h=await this.streamClient.get(this.streamClientBasePath,l);return this.state.updateFromCallResponse(h.call),this.state.setMembers(h.members),this.state.setOwnCapabilities(h.own_capabilities),l?.ring&&this.ringingSubject.next(!0),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),await this.applyDeviceConfig(h.call.settings,!1),h},this.getOrCreate=async l=>{await this.setup();const h=await this.streamClient.post(this.streamClientBasePath,l);return this.state.updateFromCallResponse(h.call),this.state.setMembers(h.members),this.state.setOwnCapabilities(h.own_capabilities),l?.ring&&this.ringingSubject.next(!0),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),await this.applyDeviceConfig(h.call.settings,!1),h},this.create=async l=>this.getOrCreate(l),this.delete=async(l={})=>this.streamClient.post(`${this.streamClientBasePath}/delete`,l),this.ring=async()=>await this.get({ring:!0}),this.notify=async()=>await this.get({notify:!0}),this.accept=async()=>this.streamClient.post(`${this.streamClientBasePath}/accept`),this.reject=async(l="decline")=>this.streamClient.post(`${this.streamClientBasePath}/reject`,{reason:l}),this.join=async({maxJoinRetries:l=3,...h}={})=>{await this.setup();const m=this.state.callingState;if([L.JOINED,L.JOINING].includes(m))throw new Error("Illegal State: call.join() shall be called only once");const f=new Map,g=h;l=Math.max(l,1);for(let S=0;S<l;S++){try{this.logger("trace",`Joining call (${S})`,this.cid),await this.doJoin(h),delete g.migrating_from;break}catch(C){if(this.logger("warn",`Failed to join call (${S})`,this.cid),C instanceof kr&&C.unrecoverable)throw C;const y=this.credentials?.server.edge_name||"",T=(f.get(y)||0)+1;if(f.set(y,T),T>=2&&(g.migrating_from=y),S===l-1)throw C}await Yt(ls(S))}},this.doJoin=async l=>{const h=Date.now(),m=this.state.callingState;this.joinCallData=l,this.logger("debug","Starting join flow"),this.state.setCallingState(L.JOINING);const f=this.reconnectStrategy===Y.MIGRATE,g=this.reconnectStrategy===Y.REJOIN,S=this.reconnectStrategy===Y.FAST;let C=this.sfuStatsReporter?.options;if(!this.credentials||!C||g||f)try{const A=await this.doJoinRequest(l);this.credentials=A.credentials,C=A.stats_options}catch(A){throw this.state.callingState===L.OFFLINE||this.state.setCallingState(m),A}const y=this.sfuClient,T=y?.sessionId,k=!!y?.isHealthy,I=g||f||!k?new st({tag:String(this.sfuClientTag++),cid:this.cid,dispatcher:this.dispatcher,credentials:this.credentials,streamClient:this.streamClient,enableTracing:C.enable_rtc_stats,sessionId:g?void 0:T,onSignalClose:A=>this.handleSfuSignalClose(I,A)}):y;this.sfuClient=I,this.unifiedSessionId??(this.unifiedSessionId=I.sessionId),this.dynascaleManager.setSfuClient(I);const R=await Or();if(y!==I){const[A,B]=await Promise.all([da("recvonly"),da("sendonly")]),N=this.reconnectStrategy!==Y.UNSPECIFIED,$=N?this.getReconnectDetails(l?.migrating_from,T):void 0,j=N?this.currentPublishOptions||[]:this.getPreferredPublishOptions(),D=N?[]:this.getPreferredSubscribeOptions();try{const{callState:E,fastReconnectDeadlineSeconds:O,publishOptions:U}=await I.join({unifiedSessionId:this.unifiedSessionId,subscriberSdp:A,publisherSdp:B,clientDetails:R,fastReconnect:S,reconnectDetails:$,preferredPublishOptions:j,preferredSubscribeOptions:D,capabilities:Array.from(this.clientCapabilities),source:_t.WEBRTC_UNSPECIFIED});this.currentPublishOptions=U,this.fastReconnectDeadlineSeconds=O,E&&this.state.updateFromSfuCallState(E,I.sessionId,$)}catch(E){throw this.logger("warn","Join SFU request failed",E),I.close(st.JOIN_FAILED,"Join request failed, connection considered unhealthy"),this.state.setCallingState(m),E}}if(f||this.state.setCallingState(L.JOINED),this.hasJoinedOnce=!0,S)await this.restoreICE(I,{includeSubscriber:!1});else{const A=ub(this.credentials.ice_servers);this.initPublisherAndSubscriber({sfuClient:I,connectionConfig:A,clientDetails:R,statsOptions:C,publishOptions:this.currentPublishOptions||[],closePreviousInstances:!f,unifiedSessionId:this.unifiedSessionId})}if(!g&&!S&&!f&&this.sfuStatsReporter?.sendConnectionTime((Date.now()-h)/1e3),g&&k){const A=Y[this.reconnectStrategy];await y?.leaveAndClose(`Closing previous WS after reconnect with strategy: ${A}`)}else k||y?.close(st.DISPOSE_OLD_SOCKET,"Closing unhealthy WS after reconnect");!this.deviceSettingsAppliedOnce&&this.state.settings&&(await this.applyDeviceConfig(this.state.settings,!0),this.deviceSettingsAppliedOnce=!0),delete this.joinCallData?.ring,delete this.joinCallData?.notify,this.reconnectStrategy=Y.UNSPECIFIED,this.reconnectReason="",this.logger("info",`Joined call ${this.cid}`)},this.getReconnectDetails=(l,h)=>{const m=this.reconnectStrategy,f=m===Y.REJOIN,g=this.publisher?.getAnnouncedTracksForReconnect()||[];return{strategy:m,announcedTracks:g,subscriptions:this.dynascaleManager.trackSubscriptions,reconnectAttempt:this.reconnectAttempts,fromSfuId:l||"",previousSessionId:f&&h||"",reason:this.reconnectReason}},this.getPreferredPublishOptions=()=>{const{preferredCodec:l,fmtpLine:h,preferredBitrate:m,maxSimulcastLayers:f}=this.clientPublishOptions||{};if(!l&&!m&&!f)return[];const g=l?Ot.create({name:l.split("/").pop(),fmtp:h}):void 0,S=[_n.create({trackType:P.VIDEO,codec:g,bitrate:m,maxSpatialLayers:f})],C=this.screenShare.getSettings();return C&&S.push(_n.create({trackType:P.SCREEN_SHARE,fps:C.maxFramerate,bitrate:C.maxBitrate})),S},this.getPreferredSubscribeOptions=()=>{const{subscriberCodec:l,subscriberFmtpLine:h}=this.clientPublishOptions||{};return!l||!h?[]:[to.create({trackType:P.VIDEO,codecs:[{name:l.split("/").pop(),fmtp:h}]})]},this.restoreICE=async(l,h={})=>{const{includeSubscriber:m=!0,includePublisher:f=!0}=h;this.subscriber&&(this.subscriber.setSfuClient(l),m&&await this.subscriber.restartIce()),this.publisher&&(this.publisher.setSfuClient(l),f&&this.publisher.isPublishing()&&await this.publisher.restartIce())},this.initPublisherAndSubscriber=l=>{const{sfuClient:h,connectionConfig:m,clientDetails:f,statsOptions:g,publishOptions:S,closePreviousInstances:C,unifiedSessionId:y}=l,{enable_rtc_stats:T}=g;C&&this.subscriber&&this.subscriber.dispose(),this.subscriber=new cb({sfuClient:h,dispatcher:this.dispatcher,state:this.state,connectionConfig:m,tag:h.tag,enableTracing:T,onReconnectionNeeded:(I,R)=>{this.reconnect(I,R).catch(A=>{const B=`[Reconnect] Error reconnecting after a subscriber error: ${R}`;this.logger("warn",B,A)})}}),this.streamClient.user?.type==="anonymous"||(C&&this.publisher&&this.publisher.dispose(),this.publisher=new ab({sfuClient:h,dispatcher:this.dispatcher,state:this.state,connectionConfig:m,publishOptions:S,tag:h.tag,enableTracing:T,onReconnectionNeeded:(I,R)=>{this.reconnect(I,R).catch(A=>{const B=`[Reconnect] Error reconnecting after a publisher error: ${R}`;this.logger("warn",B,A)})}})),this.statsReporter?.stop(),this.statsReportingIntervalInMs>0&&(this.statsReporter=Hg({subscriber:this.subscriber,publisher:this.publisher,state:this.state,datacenter:h.edgeName,pollingIntervalInMs:this.statsReportingIntervalInMs})),this.tracer.setEnabled(T),this.sfuStatsReporter?.stop(),g?.reporting_interval_ms>0&&(this.sfuStatsReporter=new Wg(h,{clientDetails:f,options:g,subscriber:this.subscriber,publisher:this.publisher,microphone:this.microphone,camera:this.camera,state:this.state,tracer:this.tracer,unifiedSessionId:y}),this.sfuStatsReporter.start())},this.doJoinRequest=async l=>{const h=await this.streamClient.getLocationHint(),m={...l,location:h},f=await this.streamClient.post(`${this.streamClientBasePath}/join`,m);return this.state.updateFromCallResponse(f.call),this.state.setMembers(f.members),this.state.setOwnCapabilities(f.own_capabilities),l?.ring&&this.ringingSubject.next(!0),!(this.reconnectStrategy!==Y.UNSPECIFIED)&&this.ringing&&!this.isCreatedByMe&&await this.accept(),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),f},this.handleSfuSignalClose=(l,h)=>{this.logger("debug","[Reconnect] SFU signal connection closed");const{callingState:m}=this.state;if(m===L.JOINING||m===L.RECONNECTING||m===L.IDLE||m===L.LEFT||l.isLeaving||l.isClosingClean)return;const f=this.publisher?.isHealthy()&&this.subscriber?.isHealthy()?Y.FAST:Y.REJOIN;this.reconnect(f,h).catch(g=>{this.logger("warn","[Reconnect] Error reconnecting",g)})},this.reconnect=async(l,h)=>{if(!(this.state.callingState===L.RECONNECTING||this.state.callingState===L.MIGRATING||this.state.callingState===L.RECONNECTING_FAILED))return He(this.reconnectConcurrencyTag,async()=>{const m=Date.now();this.reconnectStrategy=l,this.reconnectReason=h;const f=async()=>{try{await this.get()}finally{this.state.setCallingState(L.RECONNECTING_FAILED)}};let g=0;do{const S=Date.now()-m;if(this.disconnectionTimeoutSeconds>0&&S/1e3>this.disconnectionTimeoutSeconds){this.logger("warn","[Reconnect] Stopping reconnection attempts after reaching disconnection timeout"),await f();return}this.reconnectStrategy!==Y.FAST&&this.reconnectAttempts++;const y=Y[this.reconnectStrategy];try{switch(await this.networkAvailableTask?.promise,this.logger("info",`[Reconnect] Reconnecting with strategy ${Y[this.reconnectStrategy]}`),this.reconnectStrategy){case Y.UNSPECIFIED:case Y.DISCONNECT:this.logger("debug",`[Reconnect] No-op strategy ${y}`);break;case Y.FAST:await this.reconnectFast();break;case Y.REJOIN:await this.reconnectRejoin();break;case Y.MIGRATE:await this.reconnectMigrate();break;default:ts(this.reconnectStrategy,"Unknown reconnection strategy");break}break}catch(T){if(this.state.callingState===L.OFFLINE){this.logger("debug","[Reconnect] Can't reconnect while offline, stopping reconnection attempts");break}if(T instanceof kr&&T.unrecoverable){this.logger("warn","[Reconnect] Can't reconnect due to coordinator unrecoverable error",T),await f();return}await Yt(500);const k=this.reconnectStrategy===Y.MIGRATE,R=(Date.now()-m)/1e3>this.fastReconnectDeadlineSeconds||k||g>=3||!(this.publisher?.isHealthy()??!0)||!(this.subscriber?.isHealthy()??!0);g++;const A=R?Y.REJOIN:Y.FAST;this.reconnectStrategy=A,this.logger("info",`[Reconnect] ${y} (${this.reconnectAttempts}) failed. Attempting with ${Y[A]}`,T)}}while(this.state.callingState!==L.JOINED&&this.state.callingState!==L.RECONNECTING_FAILED&&this.state.callingState!==L.LEFT);this.logger("info","[Reconnect] Reconnection flow finished")})},this.reconnectFast=async()=>{const l=Date.now();this.reconnectStrategy=Y.FAST,this.state.setCallingState(L.RECONNECTING),await this.doJoin(this.joinCallData),await this.get(),this.sfuStatsReporter?.sendReconnectionTime(Y.FAST,(Date.now()-l)/1e3)},this.reconnectRejoin=async()=>{const l=Date.now();this.reconnectStrategy=Y.REJOIN,this.state.setCallingState(L.RECONNECTING),await this.doJoin(this.joinCallData),await this.restorePublishedTracks(),this.restoreSubscribedTracks(),this.sfuStatsReporter?.sendReconnectionTime(Y.REJOIN,(Date.now()-l)/1e3)},this.reconnectMigrate=async()=>{const l=Date.now(),h=this.sfuClient;if(!h)throw new Error("Cannot migrate without an active SFU client");this.reconnectStrategy=Y.MIGRATE,this.state.setCallingState(L.MIGRATING);const m=this.subscriber,f=this.publisher;m?.detachEventHandlers(),f?.detachEventHandlers();const g=ns(h.enterMigration());try{const S=h.edgeName;await this.doJoin({...this.joinCallData,migrating_from:S})}finally{delete this.joinCallData?.migrating_from}await this.restorePublishedTracks(),this.restoreSubscribedTracks();try{await g(),this.state.setCallingState(L.JOINED)}finally{m?.dispose(),f?.dispose(),h.close(st.NORMAL_CLOSURE,"Migrating away")}this.sfuStatsReporter?.sendReconnectionTime(Y.MIGRATE,(Date.now()-l)/1e3)},this.registerReconnectHandlers=()=>{const l=this.on("goAway",()=>{this.reconnect(Y.MIGRATE,"goAway").catch(f=>this.logger("warn","[Reconnect] Error reconnecting",f))}),h=this.on("error",f=>{const{reconnectStrategy:g,error:S}=f;g!==Y.UNSPECIFIED&&(g===Y.DISCONNECT?this.leave({message:"SFU instructed to disconnect"}).catch(C=>{this.logger("warn","Can't leave call after disconnect request",C)}):this.reconnect(g,S?.message||"SFU Error").catch(C=>{this.logger("warn","[Reconnect] Error reconnecting",C)}))}),m=this.streamClient.on("network.changed",f=>{if(this.tracer.trace("network.changed",f),f.online)this.logger("debug","[Reconnect] Going online"),this.sfuClient?.close(st.DISPOSE_OLD_SOCKET,"Closing WS to reconnect after going online"),this.networkAvailableTask?.resolve(),this.networkAvailableTask=void 0,this.sfuStatsReporter?.start();else{if(this.logger("debug","[Reconnect] Going offline"),!this.hasJoinedOnce)return;this.lastOfflineTimestamp=Date.now();const g=$n();g.promise.then(()=>{let S=Y.FAST;this.lastOfflineTimestamp&&(Date.now()-this.lastOfflineTimestamp)/1e3>this.fastReconnectDeadlineSeconds&&(S=Y.REJOIN),this.reconnect(S,"Going online").catch(C=>{this.logger("warn","[Reconnect] Error reconnecting after going online",C)})}),this.networkAvailableTask=g,this.sfuStatsReporter?.stop(),this.state.setCallingState(L.OFFLINE)}});this.leaveCallHooks.add(l).add(h).add(m)},this.restorePublishedTracks=async()=>{for(const l of this.trackPublishOrder){let h;switch(l){case P.AUDIO:h=this.microphone.state.mediaStream;break;case P.VIDEO:h=this.camera.state.mediaStream;break;case P.SCREEN_SHARE:h=this.screenShare.state.mediaStream;break;case P.SCREEN_SHARE_AUDIO:case P.UNSPECIFIED:break;default:ts(l,"Unknown track type");break}h&&await this.publish(h,l)}},this.restoreSubscribedTracks=()=>{const{remoteParticipants:l}=this.state;l.length<=0||this.dynascaleManager.applyTrackSubscriptions(void 0)},this.publishVideoStream=async l=>{await this.publish(l,P.VIDEO)},this.publishAudioStream=async l=>{await this.publish(l,P.AUDIO)},this.publishScreenShareStream=async l=>{await this.publish(l,P.SCREEN_SHARE)},this.publish=async(l,h,m)=>{if(!this.sfuClient)throw new Error("Call is not joined yet");if(await this.sfuClient.joinTask,!this.permissionsContext.canPublish(h))throw new Error(`No permission to publish ${P[h]}`);if(!this.publisher)throw new Error("Publisher is not initialized");const[f]=qn(h)?l.getAudioTracks():l.getVideoTracks();if(!f)throw new Error(`There is no ${P[h]} track in the stream`);if(f.readyState==="ended")throw new Error("Can't publish ended tracks.");Wn(this.trackPublishOrder,h),await this.publisher.publish(f,h,m);const g=[h];if(h===P.SCREEN_SHARE){const[S]=l.getAudioTracks();if(S){const C=P.SCREEN_SHARE_AUDIO;Wn(this.trackPublishOrder,C),await this.publisher.publish(S,C,m),g.push(C)}}f.kind==="video"&&this.sfuStatsReporter?.scheduleOne(3e3),await this.updateLocalStreamState(l,...g)},this.stopPublish=async(...l)=>{!this.sfuClient||!this.publisher||(this.publisher.stopTracks(...l),await this.updateLocalStreamState(void 0,...l))},this.updateLocalStreamState=async(l,...h)=>{if(!this.sfuClient||!this.sfuClient.sessionId)return;await this.notifyTrackMuteState(!l,...h);const{sessionId:m}=this.sfuClient;for(const f of h){const g=ho(f);g&&this.state.updateParticipant(m,S=>({publishedTracks:l?Wn([...S.publishedTracks],f):S.publishedTracks.filter(C=>C!==f),[g]:l}))}},this.updatePublishOptions=l=>{this.logger("warn","[call.updatePublishOptions]: You are manually overriding the publish options for this call. This is not recommended, and it can cause call stability/compatibility issues. Use with caution."),this.state.callingState===L.JOINED&&this.logger("warn","Updating publish options after joining the call does not have an effect"),this.clientPublishOptions={...this.clientPublishOptions,...l}},this.notifyNoiseCancellationStarting=async()=>this.sfuClient?.startNoiseCancellation().catch(l=>{this.logger("warn","Failed to notify start of noise cancellation",l)}),this.notifyNoiseCancellationStopped=async()=>this.sfuClient?.stopNoiseCancellation().catch(l=>{this.logger("warn","Failed to notify stop of noise cancellation",l)}),this.notifyTrackMuteState=async(l,...h)=>{const m=`muteState.${this.cid}.${h.join("-")}`;await He(m,async()=>{this.sfuClient&&await this.sfuClient.updateMuteStates(h.map(f=>({trackType:f,muted:l})))})},this.startReportingStatsFor=l=>this.statsReporter?.startReportingStatsFor(l),this.stopReportingStatsFor=l=>this.statsReporter?.stopReportingStatsFor(l),this.setStatsReportingIntervalInMs=l=>{this.statsReportingIntervalInMs=l},this.resetReaction=l=>{this.state.updateParticipant(l,{reaction:void 0})},this.setSortParticipantsBy=l=>this.state.setSortParticipantsBy(l),this.sendReaction=async l=>this.streamClient.post(`${this.streamClientBasePath}/reaction`,l),this.blockUser=async l=>this.streamClient.post(`${this.streamClientBasePath}/block`,{user_id:l}),this.unblockUser=async l=>this.streamClient.post(`${this.streamClientBasePath}/unblock`,{user_id:l}),this.kickUser=async l=>this.streamClient.post(`${this.streamClientBasePath}/kick`,l),this.muteSelf=l=>{const h=this.currentUserId;if(h)return this.muteUser(h,l)},this.muteOthers=l=>{const h=Xg(l);if(!h)return;const m=[];for(const f of this.state.remoteParticipants)f.publishedTracks.includes(h)&&m.push(f.userId);if(m.length>0)return this.muteUser(m,l)},this.muteUser=(l,h)=>this.streamClient.post(`${this.streamClientBasePath}/mute_users`,{user_ids:Array.isArray(l)?l:[l],[h]:!0}),this.muteAllUsers=l=>this.streamClient.post(`${this.streamClientBasePath}/mute_users`,{mute_all_users:!0,[l]:!0}),this.startRecording=async l=>this.streamClient.post(`${this.streamClientBasePath}/start_recording`,l||{}),this.stopRecording=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_recording`,{}),this.startTranscription=async l=>this.streamClient.post(`${this.streamClientBasePath}/start_transcription`,l),this.stopTranscription=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_transcription`),this.startClosedCaptions=async l=>{const h=this.state.setCaptioning(!0);try{return await this.streamClient.post(`${this.streamClientBasePath}/start_closed_captions`,l)}catch(m){throw h.rollback(),m}},this.stopClosedCaptions=async l=>{const h=this.state.setCaptioning(!1);try{return await this.streamClient.post(`${this.streamClientBasePath}/stop_closed_captions`,l)}catch(m){throw h.rollback(),m}},this.updateClosedCaptionSettings=l=>{this.state.updateClosedCaptionSettings(l)},this.requestPermissions=async l=>{const{permissions:h}=l;if(!h.every(f=>this.permissionsContext.canRequest(f)))throw new Error(`You are not allowed to request permissions: ${h.join(", ")}`);return this.streamClient.post(`${this.streamClientBasePath}/request_permission`,l)},this.grantPermissions=async(l,h)=>this.updateUserPermissions({user_id:l,grant_permissions:h}),this.revokePermissions=async(l,h)=>this.updateUserPermissions({user_id:l,revoke_permissions:h}),this.updateUserPermissions=async l=>this.streamClient.post(`${this.streamClientBasePath}/user_permissions`,l),this.goLive=async(l={},h)=>this.streamClient.post(`${this.streamClientBasePath}/go_live`,l,h),this.stopLive=async(l={})=>this.streamClient.post(`${this.streamClientBasePath}/stop_live`,l),this.startHLS=async()=>this.streamClient.post(`${this.streamClientBasePath}/start_broadcasting`,{}),this.stopHLS=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_broadcasting`,{}),this.startRTMPBroadcasts=async l=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts`,l),this.stopAllRTMPBroadcasts=async()=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts/stop`),this.stopRTMPBroadcast=async l=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts/${l}/stop`),this.startFrameRecording=async l=>this.streamClient.post(`${this.streamClientBasePath}/start_frame_recording`,l),this.stopFrameRecording=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_frame_recording`),this.update=async l=>{const h=await this.streamClient.patch(`${this.streamClientBasePath}`,l),{call:m,members:f,own_capabilities:g}=h;return this.state.updateFromCallResponse(m),this.state.setMembers(f),this.state.setOwnCapabilities(g),h},this.endCall=async()=>this.streamClient.post(`${this.streamClientBasePath}/mark_ended`),this.pin=l=>{this.state.updateParticipant(l,{pin:{isLocalPin:!0,pinnedAt:Date.now()}})},this.unpin=l=>{this.state.updateParticipant(l,{pin:void 0})},this.pinForEveryone=async l=>this.streamClient.post(`${this.streamClientBasePath}/pin`,l),this.unpinForEveryone=async l=>this.streamClient.post(`${this.streamClientBasePath}/unpin`,l),this.queryMembers=l=>this.streamClient.post("/call/members",{...l||{},id:this.id,type:this.type}),this.updateCallMembers=async l=>this.streamClient.post(`${this.streamClientBasePath}/members`,l),this.scheduleAutoDrop=()=>{this.cancelAutoDrop();const l=this.state.settings;if(!l||this.state.callingState!==L.RINGING)return;const h=this.isCreatedByMe?l.ring.auto_cancel_timeout_ms:l.ring.incoming_call_timeout_ms;h<=0||(this.dropTimeout=setTimeout(()=>{this.state.callingState===L.RINGING&&this.leave({reject:!0,reason:"timeout",message:`ringing timeout - ${this.isCreatedByMe?"no one accepted":"user didn't interact with incoming call screen"}`}).catch(m=>{this.logger("error","Failed to drop call",m)})},h))},this.cancelAutoDrop=()=>{clearTimeout(this.dropTimeout),this.dropTimeout=void 0},this.queryRecordings=async l=>{let h=this.streamClientBasePath;return l&&(h=`${h}/${l}`),this.streamClient.get(`${h}/recordings`)},this.queryTranscriptions=async()=>this.streamClient.get(`${this.streamClientBasePath}/transcriptions`),this.getCallStats=async l=>{const h=`${this.streamClientBasePath}/stats/${l}`;return this.streamClient.get(h)},this.getCallReport=async(l="")=>{const h=`${this.streamClientBasePath}/report`,m=l!==""?{session_id:l}:{};return this.streamClient.get(h,m)},this.submitFeedback=async(l,{reason:h,custom:m}={})=>{const{sdkName:f,sdkVersion:g,...S}=xg(await Or());return this.streamClient.post(`${this.streamClientBasePath}/feedback`,{rating:l,reason:h,user_session_id:this.sfuClient?.sessionId,sdk:f,sdk_version:g,custom:{...m,"x-stream-platform-data":S}})},this.sendCustomEvent=async l=>this.streamClient.post(`${this.streamClientBasePath}/event`,{custom:l}),this.applyDeviceConfig=async(l,h)=>{await this.camera.apply(l.video,h).catch(m=>{this.logger("warn","Camera init failed",m)}),await this.microphone.apply(l.audio,h).catch(m=>{this.logger("warn","Mic init failed",m)})},this.trackElementVisibility=(l,h,m)=>this.dynascaleManager.trackElementVisibility(l,h,m),this.setViewport=l=>this.dynascaleManager.setViewport(l),this.bindVideoElement=(l,h,m)=>{const f=this.dynascaleManager.bindVideoElement(l,h,m);if(f)return this.leaveCallHooks.add(f),()=>{this.leaveCallHooks.delete(f),f()}},this.bindAudioElement=(l,h,m="audioTrack")=>{const f=this.dynascaleManager.bindAudioElement(l,h,m);if(f)return this.leaveCallHooks.add(f),()=>{this.leaveCallHooks.delete(f),f()}},this.bindCallThumbnailElement=(l,h={})=>{const m=()=>{l.src=h.fallbackImageSource||"https://getstream.io/random_svg/?name=x&id=x"},f=ht(this.state.thumbnails$,g=>{if(!g)return;l.addEventListener("error",m);const S=new URL(g.image_url);S.searchParams.set("w",String(l.clientWidth)),S.searchParams.set("h",String(l.clientHeight)),l.src=S.toString()});return()=>{f(),l.removeEventListener("error",m)}},this.setPreferredIncomingVideoResolution=(l,h)=>{this.dynascaleManager.setVideoTrackSubscriptionOverrides(l?{enabled:!0,dimension:l}:void 0,h),this.dynascaleManager.applyTrackSubscriptions()},this.setIncomingVideoEnabled=l=>{this.dynascaleManager.setVideoTrackSubscriptionOverrides(l?void 0:{enabled:!1}),this.dynascaleManager.applyTrackSubscriptions()},this.setDisconnectionTimeout=l=>{this.disconnectionTimeoutSeconds=l},this.enableClientCapabilities=(...l)=>{for(const h of l)this.clientCapabilities.add(h)},this.disableClientCapabilities=(...l)=>{for(const h of l)this.clientCapabilities.delete(h)},this.type=t,this.id=n,this.cid=`${t}:${n}`,this.ringingSubject=new Z(c),this.watching=u,this.streamClient=s,this.clientStore=a,this.streamClientBasePath=`/call/${this.type}/${this.id}`,this.logger=le(["Call"]);const d=Vl.get(t),p=o||d.options.sortParticipantsBy;p&&this.state.setSortParticipantsBy(p),this.state.setMembers(i||[]),this.state.setOwnCapabilities(r||[]),this.state.setCallingState(c?L.RINGING:L.IDLE),this.camera=new Yb(this),this.microphone=new sv(this),this.speaker=new av(this),this.screenShare=new rv(this),this.dynascaleManager=new Mb(this.state,this.speaker)}get ringing(){return _e(this.ringingSubject)}get currentUserId(){return this.clientStore.connectedUser?.id}get isCreatedByMe(){return this.state.createdBy?.id===this.currentUserId}}var cv=null;const lv={[-1]:"InternalSystemError",2:"AccessKeyError",3:"AuthenticationFailedError",4:"InputError",5:"AuthenticationError",6:"DuplicateUsernameError",9:"RateLimitError",16:"DoesNotExistError",17:"NotAllowedError",18:"EventNotSupportedError",19:"ChannelFeatureNotSupportedError",20:"MessageTooLongError",21:"MultipleNestingLevelError",22:"PayloadTooBigError",23:"RequestTimeoutError",24:"MaxHeaderSizeExceededError",40:"AuthErrorTokenExpired",41:"AuthErrorTokenNotValidYet",42:"AuthErrorTokenUsedBeforeIssuedAt",43:"AuthErrorTokenSignatureInvalid",44:"CustomCommandEndpointMissingError",45:"CustomCommandEndpointCallError",46:"ConnectionIDNotFoundError",60:"CoolDownError",69:"ErrWrongRegion",70:"ErrQueryChannelPermissions",71:"ErrTooManyConnections",73:"MessageModerationFailedError",99:"AppSuspendedError"};class uv{constructor(t){this._log=(n,s={},i="info")=>{this.client.logger(i,`connection:${n}`,s)},this.setClient=n=>{this.client=n},this._buildUrl=()=>{const n=new URLSearchParams;return n.set("api_key",this.client.key),n.set("stream-auth-type",this.client.getAuthType()),n.set("X-Stream-Client",this.client.getUserAgent()),`${this.client.wsBaseURL}/connect?${n.toString()}`},this.onlineStatusChanged=n=>{n.type==="offline"?(this._log("onlineStatusChanged() - Status changing to offline"),this._setHealth(!1,!0)):n.type==="online"&&(this._log(`onlineStatusChanged() - Status changing to online. isHealthy: ${this.isHealthy}`),this.isHealthy||this._reconnect({interval:10}))},this.onopen=n=>{if(this.wsID!==n)return;const s=this.client.user;if(!s){this.client.logger("error","User not set, can't connect to WS");return}const i=this.client._getToken();if(!i){this.client.logger("error","Token not set, can't connect authenticate");return}const r=JSON.stringify({token:i,user_details:{id:s.id,name:s.name,image:s.image,custom:s.custom}});this._log(`onopen() - Sending auth message ${r}`,{},"trace"),this.ws?.send(r),this._log("onopen() - onopen callback",{wsID:n})},this.onmessage=(n,s)=>{if(this.wsID!==n)return;const i=typeof s.data=="string"?JSON.parse(s.data):null;if(!this.isConnectionOpenResolved&&i&&i.type==="connection.error"&&(this.isConnectionOpenResolved=!0,i.error)){this.rejectConnectionOpen?.(this._errorFromWSEvent(i,!1));return}if(this.lastEvent=new Date,i&&(i.type==="health.check"||i.type==="connection.ok")&&this.scheduleNextPing(),i&&i.type==="connection.ok"&&(this.resolveConnectionOpen?.(i),this._setHealth(!0)),i&&i.type==="connection.error"&&i.error){const{code:r}=i.error;this.isHealthy=!1,this.isConnecting=!1,this.consecutiveFailures+=1,r===bn.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic()&&(clearTimeout(this.connectionCheckTimeoutRef),this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0}))}i&&(i.received_at=new Date,this.client.dispatchEvent(i)),this.scheduleConnectionCheck()},this.onclose=(n,s)=>{if(this.wsID===n)if(this._log("onclose() - onclose callback - "+s.code,{event:s,wsID:n}),s.code===bn.WS_CLOSED_SUCCESS){const i=new Error(`WS connection reject with error ${s.reason}`);i.reason=s.reason,i.code=s.code,i.wasClean=s.wasClean,i.target=s.target,this.rejectConnectionOpen?.(i),this._log(`onclose() - WS connection reject with error ${s.reason}`,{event:s})}else this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,this.rejectConnectionOpen?.(this._errorFromWSEvent(s)),this._log("onclose() - WS connection closed. Calling reconnect ...",{event:s}),this._reconnect()},this.onerror=(n,s)=>{this.wsID===n&&(this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,this._log("onerror() - WS connection resulted into error",{event:s}),this._reconnect())},this._setHealth=(n,s=!1)=>{if(n!==this.isHealthy){if(this.isHealthy=n,this.isHealthy||s){this.client.dispatchEvent({type:"connection.changed",online:this.isHealthy});return}setTimeout(()=>{this.isHealthy||this.client.dispatchEvent({type:"connection.changed",online:this.isHealthy})},5e3)}},this._errorFromWSEvent=(n,s=!0)=>{let i,r,o;if(hg(n))i=n.code,o=n.reason,r=0;else{const{error:u}=n;i=u.code,o=u.message,r=u.StatusCode}const a=`WS failed with code: ${i}: ${lv[i]||i} and reason: ${o}`;this._log(a,{event:n},"warn");const c=new Error(a);return c.code=i,c.StatusCode=r,c.isWSFailure=s,c},this._setupConnectionPromise=()=>{this.isConnectionOpenResolved=!1,this.connectionOpenSafe=ns(new Promise((n,s)=>{this.resolveConnectionOpen=n,this.rejectConnectionOpen=s}))},this.scheduleNextPing=()=>{const n=oi();this.healthCheckTimeoutRef&&n.clearTimeout(this.healthCheckTimeoutRef),this.healthCheckTimeoutRef=n.setTimeout(()=>{const s=[{type:"health.check",client_id:this.client.clientID}];try{this.ws?.send(JSON.stringify(s))}catch{}},this.pingInterval)},this.scheduleConnectionCheck=()=>{clearTimeout(this.connectionCheckTimeoutRef),this.connectionCheckTimeoutRef=setTimeout(()=>{const n=new Date;this.lastEvent&&n.getTime()-this.lastEvent.getTime()>this.connectionCheckTimeout&&(this._log("scheduleConnectionCheck - going to reconnect"),this._setHealth(!1),this._reconnect())},this.connectionCheckTimeout)},this.client=t,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.isDisconnected=!1,this.isConnectionOpenResolved=!1,this.isHealthy=!1,this.wsID=1,this.lastEvent=null,this.pingInterval=25*1e3,this.connectionCheckTimeout=this.pingInterval+10*1e3,Rr(this.onlineStatusChanged)}async connect(t=15e3){if(this.isConnecting)throw Error("You've called connect twice, can only attempt 1 connection at the time");this.isDisconnected=!1;try{const n=await this._connect();this.consecutiveFailures=0,this._log(`connect() - Established ws connection with healthcheck: ${n}`)}catch(n){if(this.isHealthy=!1,this.consecutiveFailures+=1,n.code===bn.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic())this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0});else if(!n.isWSFailure)throw new Error(JSON.stringify({code:n.code,StatusCode:n.StatusCode,message:n.message,isWSFailure:n.isWSFailure}))}return await this._waitForHealthy(t)}async _waitForHealthy(t=15e3){return Promise.race([(async()=>{for(let s=0;s<=t;s+=50)try{return await this.connectionOpen}catch(i){if(s===t)throw new Error(JSON.stringify({code:i.code,StatusCode:i.StatusCode,message:i.message,isWSFailure:i.isWSFailure}));await Yt(50)}})(),(async()=>{throw await Yt(t),this.isConnecting=!1,new Error(JSON.stringify({code:"",StatusCode:"",message:"initial WS connection could not be established",isWSFailure:!0}))})()])}disconnect(t){this._log(`disconnect() - Closing the websocket connection for wsID ${this.wsID}`),this.wsID+=1,this.isConnecting=!1,this.isDisconnected=!0,this.healthCheckTimeoutRef&&oi().clearInterval(this.healthCheckTimeoutRef),this.connectionCheckTimeoutRef&&clearInterval(this.connectionCheckTimeoutRef),Rl(this.onlineStatusChanged),this.isHealthy=!1;let n;const{ws:s}=this;return s&&s.close&&s.readyState===s.OPEN?(n=new Promise(i=>{const r=o=>{this._log(`disconnect() - resolving isClosedPromise ${o?"with":"without"} close frame`,{event:o}),i()};s.onclose=r,setTimeout(r,t??1e3)}),this._log("disconnect() - Manually closed connection by calling client.disconnect()"),s.close(bn.WS_CLOSED_SUCCESS,"Manually closed connection by calling client.disconnect()")):(this._log("disconnect() - ws connection doesn't exist or it is already closed."),n=Promise.resolve()),delete this.ws,n}async _connect(){if(this.isConnecting)return;this.isConnecting=!0;let t=!1;try{this._log("_connect() - waiting for token"),await this.client.tokenManager.tokenReady(),t=!0}catch{}try{t||(this._log("_connect() - tokenProvider failed before, so going to retry"),await this.client.tokenManager.loadToken()),this.client.isConnectionIsPromisePending||this.client._setupConnectionIdPromise(),this._setupConnectionPromise();const n=this._buildUrl();this._log(`_connect() - Connecting to ${n}`);const s=this.client.options.WebSocketImpl??WebSocket;this.ws=new s(n),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID);const i=await this.connectionOpen;if(this.isConnecting=!1,i)return this.connectionID=i.connection_id,this.client.resolveConnectionId?.(this.connectionID),i}catch(n){throw this.client._setupConnectionIdPromise(),this.isConnecting=!1,this._log("_connect() - Error - ",n),this.client.rejectConnectionId?.(n),n}}async _reconnect(t={}){if(this._log("_reconnect() - Initiating the reconnect"),this.isConnecting||this.isHealthy){this._log("_reconnect() - Abort (1) since already connecting or healthy");return}let n=t.interval;if(n||(n=ls(this.consecutiveFailures)),await Yt(n),this.isConnecting||this.isHealthy){this._log("_reconnect() - Abort (2) since already connecting or healthy");return}if(this.isDisconnected){this._log("_reconnect() - Abort (3) since disconnect() is called");return}this._log("_reconnect() - Destroying current WS connection"),this._destroyCurrentWSConnection(),t.refreshToken&&await this.client.tokenManager.loadToken();try{await this._connect(),this._log("_reconnect() - Waiting for recoverCallBack"),this._log("_reconnect() - Finished recoverCallBack"),this.consecutiveFailures=0}catch(s){if(this.isHealthy=!1,this.consecutiveFailures+=1,s.code===bn.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic())return this._log("_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0});s.isWSFailure&&(this._log("_reconnect() - WS failure, so going to try to reconnect"),this._reconnect())}this._log("_reconnect() - == END ==")}_destroyCurrentWSConnection(){this.wsID+=1;try{this?.ws?.close()}catch{}}get connectionOpen(){return this.connectionOpenSafe?.()}}function dv(e){const t=e.split(".");if(t.length!==3)return"";const n=t[1],s=hv(n);return JSON.parse(s).user_id}const hv=e=>{const t={},n=String.fromCharCode,s=e.length;let i,r=0,o,a,c=0,u,d="";const p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(i=0;i<64;i++)t[p.charAt(i)]=i;for(a=0;a<s;a++)for(o=t[e.charAt(a)],r=(r<<6)+o,c+=6;c>=8;)((u=r>>>(c-=8)&255)||a<s-2)&&(d+=n(u));return d};class fv{constructor(t){this.loadTokenPromise=null,this.type="static",this.setTokenOrProvider=async(n,s,i)=>{this.user=s,this.isAnonymous=i,this.validateToken(n),_r(n)&&(this.tokenProvider=n,this.type="provider"),typeof n=="string"&&(this.token=n,this.type="static"),await this.loadToken()},this.reset=()=>{this.token=void 0,this.tokenProvider=void 0,this.type="static",this.user=void 0,this.loadTokenPromise=null},this.validateToken=n=>{if(!(this.user&&this.isAnonymous&&!n)){if(!this.secret&&!n)throw new Error("User token can not be empty");if(typeof n!="string"&&!_r(n))throw new Error("User token should either be a string or a function");if(typeof n=="string"){if(this.isAnonymous&&n==="")return;const s=dv(n);if(n!=null&&(s==null||s===""||!this.isAnonymous&&s!==this.user.id))throw new Error("userToken does not have a user_id or is not matching with user.id")}}},this.tokenReady=()=>this.loadTokenPromise,this.loadToken=()=>(this.loadTokenPromise=new Promise(async(n,s)=>{if(this.type==="static")return n(this.token);if(this.tokenProvider&&typeof this.tokenProvider!="string"){try{const i=await this.tokenProvider();this.validateToken(i),this.token=i}catch(i){return s(new Error(`Call to tokenProvider failed with message: ${i}`,{cause:i}))}n(this.token)}}),this.loadTokenPromise),this.getToken=()=>{if(this.token)return this.token;if(this.user&&!this.token)return this.token;throw new Error("User token is not set. Either client.connectUser wasn't called or client.disconnect was called")},this.isStatic=()=>this.type==="static",this.secret=t}}const wa=async(e="https://hint.stream-io-video.com/",t=2e3,n=3)=>{const s=le(["location-hint"]);let i=0,r="ERR";do{const o=new AbortController,a=setTimeout(()=>o.abort(),t);try{const u=(await fetch(e,{method:"HEAD",signal:o.signal})).headers.get("x-amz-cf-pop")||"ERR";s("debug",`Location header: ${u}`),r=u.substring(0,3)}catch(c){s("warn",`Failed to get location hint from ${e}`,c),r="ERR"}finally{clearTimeout(a)}}while(r==="ERR"&&++i<n);return r};class pv{constructor(t,n){this.listeners={},this.getAuthType=()=>this.anonymous?"anonymous":"jwt",this.setBaseURL=i=>{this.baseURL=i,this.wsBaseURL=this.baseURL.replace("http","ws").replace(":3030",":8800")},this.getLocationHint=async(i,r)=>{const o=await this.locationHint;return!o||o==="ERR"?(this.locationHint=wa(i??this.options.locationHintUrl,r??this.options.locationHintTimeout),this.locationHint):o},this._getConnectionID=()=>this.wsConnection?.connectionID,this._hasConnectionID=()=>!!this._getConnectionID(),this.connectUser=async(i,r)=>{if(!i.id)throw new Error('The "id" field on the user is missing');if(this.userID===i.id&&this.connectUserTask)return this.logger("warn","Consecutive calls to connectUser is detected, ideally you should only call this function once in your app."),this.connectUserTask;if(this.userID)throw new Error("Use client.disconnect() before trying to connect as a different user. connectUser was called twice.");(this.secret||this.node)&&!this.options.allowServerSideConnect&&this.logger("warn","Please do not use connectUser server side. Use our @stream-io/node-sdk instead: https://getstream.io/video/docs/api/"),this.userID=i.id,this.anonymous=!1,await this.tokenManager.setTokenOrProvider(r,i,!1),this._setUser(i),this.connectUserTask=this.openConnection();try{return Rr(this.updateNetworkConnectionStatus),await this.connectUserTask}catch(o){throw this.persistUserOnConnectionFailure?await this.closeConnection():await this.disconnectUser(),o}},this._setUser=i=>{this.user=i,this.userID=i.id,this._user={...i}},this.closeConnection=async i=>{await this.wsConnection?.disconnect(i)},this.openConnection=async()=>{if(!this.userID)throw Error("UserWithId is not set on client, use client.connectUser or client.connectAnonymousUser instead");const i=this.wsPromiseSafe?.();if(this.wsConnection?.isConnecting&&i)return this.logger("info","client:openConnection() - connection already in progress"),await i;if(this.wsConnection?.isHealthy&&this._hasConnectionID()){this.logger("info","client:openConnection() - openConnection called twice, healthy connection already exists");return}this._setupConnectionIdPromise(),this.clientID=`${this.userID}--${Ir()}`;const r=this.connect();return this.wsPromiseSafe=ns(r),await r},this.disconnectUser=async i=>{this.logger("info","client:disconnect() - Disconnecting the client"),delete this.user,delete this._user,delete this.userID,this.anonymous=!1,await this.closeConnection(i),Rl(this.updateNetworkConnectionStatus),this.tokenManager.reset(),this.connectionIdPromiseSafe=void 0,this.rejectConnectionId=void 0,this.resolveConnectionId=void 0},this.connectGuestUser=async i=>{this.guestUserCreatePromise=this.doAxiosRequest("post","/guest",{user:i},{publicEndpoint:!0});const r=await this.guestUserCreatePromise;return this.guestUserCreatePromise.finally(()=>this.guestUserCreatePromise=void 0),this.connectUser(r.user,r.access_token)},this.connectAnonymousUser=async(i,r)=>{Rr(this.updateNetworkConnectionStatus),this._setupConnectionIdPromise(),this.anonymous=!0,await this.tokenManager.setTokenOrProvider(r,i,!0),this._setUser(i),this.resolveConnectionId?.()},this.on=(i,r)=>(this.listeners[i]||(this.listeners[i]=[]),this.logger("debug",`Adding listener for ${i} event`),this.listeners[i]?.push(r),()=>{this.off(i,r)}),this.off=(i,r)=>{this.listeners[i]||(this.listeners[i]=[]),this.logger("debug",`Removing listener for ${i} event`),this.listeners[i]=this.listeners[i]?.filter(o=>o!==r)},this._setupConnectionIdPromise=()=>{this.connectionIdPromiseSafe=ns(new Promise((i,r)=>{this.resolveConnectionId=i,this.rejectConnectionId=r}))},this._logApiRequest=(i,r,o,a)=>{Pr()==="trace"&&this.logger("trace",`client: ${i} - Request - ${r}`,{payload:o,config:a})},this._logApiResponse=(i,r,o)=>{Pr()==="trace"&&this.logger("trace",`client:${i} - Response - url: ${r} > status ${o.status}`,{response:o})},this.doAxiosRequest=async(i,r,o,a={})=>{if(!a.publicEndpoint){await Promise.all([this.tokenManager.tokenReady(),this.guestUserCreatePromise]);try{await this.connectionIdPromise}catch{await this.wsConnection?._waitForHealthy(),await this.connectionIdPromise}}const c=this._enrichAxiosOptions(a);try{let u;switch(this._logApiRequest(i,r,o,c),i){case"get":u=await this.axiosInstance.get(r,c);break;case"delete":u=await this.axiosInstance.delete(r,c);break;case"post":u=await this.axiosInstance.post(r,o,c);break;case"put":u=await this.axiosInstance.put(r,o,c);break;case"patch":u=await this.axiosInstance.patch(r,o,c);break;case"options":u=await this.axiosInstance.options(r,c);break;default:throw new Error("Invalid request type")}return this._logApiResponse(i,r,u),this.consecutiveFailures=0,u.data}catch(u){u.client_request_id=c.headers?.["x-client-request-id"],this.consecutiveFailures+=1;const{response:d}=u;if(!d||!dg(d))throw this.logger("error",`client:${i} url: ${r}`,u),u;const{data:p,status:l}=d;if(p.code===bn.TOKEN_EXPIRED&&!this.tokenManager.isStatic())return this.logger("warn",`client:${i}: url: ${r}`,d),this.consecutiveFailures>1&&await Yt(ls(this.consecutiveFailures)),await this.tokenManager.loadToken(),await this.doAxiosRequest(i,r,o,a);throw this.logger("error",`client:${i} url: ${r}`,d),new kr({message:`Stream error code ${p.code}: ${p.message}`,code:p.code??null,unrecoverable:p.unrecoverable??null,response:d,status:l})}},this.get=(i,r)=>this.doAxiosRequest("get",i,null,{params:r}),this.put=(i,r,o)=>this.doAxiosRequest("put",i,r,{params:o}),this.post=(i,r,o)=>this.doAxiosRequest("post",i,r,{params:o}),this.patch=(i,r,o)=>this.doAxiosRequest("patch",i,r,{params:o}),this.delete=(i,r)=>this.doAxiosRequest("delete",i,null,{params:r}),this.dispatchEvent=i=>{if(this.logger("debug",`Dispatching event: ${i.type}`,i),!!this.listeners){for(const r of this.listeners.all||[])r(i);for(const r of this.listeners[i.type]||[])r(i)}},this.connect=async()=>{if(!this.userID||!this._user)throw Error("Call connectUser or connectAnonymousUser before starting the connection");if(!this.wsBaseURL)throw Error("Websocket base url not set");if(!this.clientID)throw Error("clientID is not set");return this.wsConnection=new uv(this),this.logger("info","StreamClient.connect: this.wsConnection.connect()"),await this.wsConnection.connect(this.defaultWSTimeout)},this.getUserAgent=()=>{if(!this.cachedUserAgent){const{clientAppIdentifier:i={}}=this.options,{sdkName:r="js",sdkVersion:o="1.33.1",...a}=i;this.cachedUserAgent=[`stream-video-${r}-v${o}`,...Object.entries(a).map(([c,u])=>`${c}=${u}`),"client_bundle=browser-esm"].join("|")}return this.cachedUserAgent},this._enrichAxiosOptions=(i={params:{},headers:{},config:{}})=>{const r=i.publicEndpoint&&!this.user?void 0:this._getToken(),o=r?{Authorization:r}:void 0;i.headers?.["x-client-request-id"]||(i.headers={...i.headers,"x-client-request-id":Ir()});const{params:a,headers:c,...u}=this.options.axiosRequestConfig||{};return{params:{user_id:this.userID,connection_id:this._getConnectionID(),api_key:this.key,...i.params,...a},headers:{...o,"stream-auth-type":i.publicEndpoint&&!this.user?"anonymous":this.getAuthType(),"X-Stream-Client":this.getUserAgent(),...i.headers,...c},...i.config,...u}},this._getToken=()=>this.tokenManager?this.tokenManager.getToken():null,this.updateNetworkConnectionStatus=i=>{i.type==="offline"?(this.logger("debug","device went offline"),this.dispatchEvent({type:"network.changed",online:!1})):i.type==="online"&&(this.logger("debug","device went online"),this.dispatchEvent({type:"network.changed",online:!0}))},this.key=t,this.secret=n?.secret;const s=n||{browser:typeof window<"u"};this.browser=s.browser||typeof window<"u",this.node=!this.browser,this.browser&&(this.locationHint=wa(n?.locationHintUrl,n?.locationHintTimeout,n?.locationHintMaxAttempts)),this.options={timeout:5e3,withCredentials:!1,...s},this.node&&!this.options.httpsAgent&&(this.options.httpsAgent=new cv.Agent({keepAlive:!0,keepAliveMsecs:3e3})),this.setBaseURL(this.options.baseURL||"https://video.stream-io-api.com/video"),this.axiosInstance=od.create({...this.options,baseURL:this.baseURL}),this.wsConnection=null,this.wsPromiseSafe=null,this.connectUserTask=null,this.anonymous=!1,this.persistUserOnConnectionFailure=this.options?.persistUserOnConnectionFailure,this.tokenManager=new fv(this.secret),this.consecutiveFailures=0,this.defaultWSTimeout=this.options.defaultWsTimeout??15e3,this.logger=_r(s.logger)?s.logger:()=>null}get connectionIdPromise(){return this.connectionIdPromiseSafe?.()}get isConnectionIsPromisePending(){return this.connectionIdPromiseSafe?.checkPending()??!1}get wsPromise(){return this.wsPromiseSafe?.()}}const nr=(e,t)=>`${e}/${t.id}`,Ea=e=>`call.init-${e}`,mv=e=>{const t=e?.clientAppIdentifier||{},n=Ug();return n&&(t.sdkName=Qt[n.type].toLowerCase(),t.sdkVersion=`${n.major}.${n.minor}.${n.patch}`),t},gv=(e,t)=>{const n=mv(t),s=le(["coordinator"]);return new pv(e,{persistUserOnConnectionFailure:!0,...t,clientAppIdentifier:n,logger:s})},bv=e=>{const{token:t,tokenProvider:n}=e;if(t&&n){let s=!1;return async function(){return s?n():(s=!0,t)}}return t||n};class qt{constructor(t,n){this.effectsRegistered=!1,this.eventHandlersToUnregister=[],this.connectionConcurrencyTag=Symbol("connectionConcurrencyTag"),this.rejectCallWhenBusy=!1,this.registerClientInstance=(o,a)=>{const c=nr(o,a);qt._instances.has(c)&&this.logger("warn",`A StreamVideoClient already exists for ${a.id}; Prefer using getOrCreateInstance method`),qt._instances.set(c,this)},this.registerEffects=()=>{this.effectsRegistered||(this.eventHandlersToUnregister.push(this.on("call.created",o=>this.initCallFromEvent(o)),this.on("call.ring",o=>this.initCallFromEvent(o)),this.on("connection.changed",o=>{if(!o.online)return;const a=this.writeableStateStore.calls.filter(c=>c.watching).map(c=>c.cid);a.length<=0||(this.logger("info",`Rewatching calls ${a.join(", ")}`),this.queryCalls({watch:!0,filter_conditions:{cid:{$in:a}},sort:[{field:"cid",direction:1}]}).catch(c=>{this.logger("error","Failed to re-watch calls",c)}))})),this.effectsRegistered=!0)},this.initCallFromEvent=async o=>{if(this.state.connectedUser?.id===o.call.created_by.id){this.logger("debug",`Ignoring ${o.type} event sent by the current user`);return}try{const a=Ea(o.call_cid);await He(a,async()=>{const c=o.type==="call.ring";let u=this.writeableStateStore.findCall(o.call.type,o.call.id);if(u){c?this.shouldRejectCall(u.cid)?(this.logger("info",`Leaving call with busy reject reason ${u.cid} because user is busy`),await u.leave(),await u.reject("busy")):await u.updateFromRingingEvent(o):u.state.updateFromCallResponse(o.call);return}u=new ws({streamClient:this.streamClient,type:o.call.type,id:o.call.id,members:o.members,clientStore:this.writeableStateStore,ringing:c}),c?this.shouldRejectCall(u.cid)?(this.logger("info",`Rejecting call ${u.cid} because user is busy`),await u.reject("busy")):(await u.updateFromRingingEvent(o),await u.get()):(u.state.updateFromCallResponse(o.call),this.writeableStateStore.registerCall(u),this.logger("info",`New call created and registered: ${u.cid}`))})}catch(a){this.logger("error",`Failed to init call from event ${o.type}`,a)}},this.connectUser=async(o,a)=>{if(o.type==="anonymous")return o.id="!anon",this.connectAnonymousUser(o,a);const c=await He(this.connectionConcurrencyTag,async()=>{const u=this.streamClient,{onConnectUserError:d,persistUserOnConnectionFailure:p}=u.options;let{maxConnectUserRetries:l=5}=u.options;l=Math.max(l,1);const h=[];for(let m=0;m<l;m++)try{return this.logger("trace",`Connecting user (${m})`,o),o.type==="guest"?await u.connectGuestUser(o):await u.connectUser(o,a)}catch(f){if(this.logger("warn",`Failed to connect a user (${m})`,f),h.push(f),m===l-1)throw d?.(f,h),f;p&&await u.disconnectUser(),await Yt(ls(m))}});return c?.me&&this.writeableStateStore.setConnectedUser(c.me),this.registerEffects(),c},this.disconnectUser=async o=>{await He(this.connectionConcurrencyTag,async()=>{const{user:a,key:c}=this.streamClient;a&&(await this.streamClient.disconnectUser(o),a.id&&qt._instances.delete(nr(c,a)),this.eventHandlersToUnregister.forEach(u=>u()),this.eventHandlersToUnregister=[],this.effectsRegistered=!1,this.writeableStateStore.setConnectedUser(void 0))})},this.on=(o,a)=>this.streamClient.on(o,a),this.off=(o,a)=>this.streamClient.off(o,a),this.call=(o,a,c={})=>(c.reuseInstance?this.writeableStateStore.findCall(o,a):void 0)??new ws({streamClient:this.streamClient,id:a,type:o,clientStore:this.writeableStateStore}),this.createGuestUser=async o=>this.streamClient.doAxiosRequest("post","/guest",o,{publicEndpoint:!0}),this.queryCalls=async(o={})=>{const a=await this.streamClient.post("/calls",o),c=[];for(const u of a.calls){const d=new ws({streamClient:this.streamClient,id:u.call.id,type:u.call.type,members:u.members,ownCapabilities:u.own_capabilities,watching:o.watch,clientStore:this.writeableStateStore});d.state.updateFromCallResponse(u.call),await d.applyDeviceConfig(u.call.settings,!1),o.watch&&(await d.setup(),this.writeableStateStore.registerCall(d)),c.push(d)}return{...a,calls:c}},this.queryCallStats=async(o={})=>this.streamClient.post("/call/stats",o),this.queryAggregateCallStats=async(o={})=>this.streamClient.post("/stats",o),this.edges=async()=>this.streamClient.get("/edges"),this.addDevice=async(o,a,c,u,d)=>await this.streamClient.post("/devices",{id:o,push_provider:a,voip_token:d,...u!=null?{user_id:u}:{},...c!=null?{push_provider_name:c}:{}}),this.addVoipDevice=async(o,a,c,u)=>await this.addDevice(o,a,c,u,!0),this.getDevices=async o=>await this.streamClient.get("/devices",o?{user_id:o}:{}),this.removeDevice=async(o,a)=>await this.streamClient.delete("/devices",{id:o,...a?{user_id:a}:{}}),this.onRingingCall=async o=>He(Ea(o),async()=>{let a=this.state.calls.find(c=>c.cid===o&&c.ringing);if(!a){const[c,u]=o.split(":");a=new ws({streamClient:this.streamClient,type:c,id:u,clientStore:this.writeableStateStore,ringing:!0}),await a.get()}return a}),this.connectAnonymousUser=async(o,a)=>He(this.connectionConcurrencyTag,()=>this.streamClient.connectAnonymousUser(o,a)),this.shouldRejectCall=o=>this.rejectCallWhenBusy?this.state.calls.some(c=>c.cid!==o&&c.ringing&&c.state.callingState!==L.IDLE&&c.state.callingState!==L.LEFT&&c.state.callingState!==L.RECONNECTING_FAILED):!1;const s=typeof t=="string"?t:t.apiKey,i=typeof t=="string"?n:t.options;i?.enableTimerWorker&&db();const r=i?.logger||xl;if(fg(r,i?.logLevel||"warn"),this.logger=le(["client"]),this.rejectCallWhenBusy=i?.rejectCallWhenBusy??!1,this.streamClient=gv(s,i),this.writeableStateStore=new kg,this.readOnlyStateStore=new wg(this.writeableStateStore),typeof t!="string"&&t.user){const o=t.user;o.type==="anonymous"&&(o.id="!anon"),o.id&&this.registerClientInstance(s,o);const a=bv(t);this.connectUser(o,a).catch(c=>{this.logger("error","Failed to connect",c)})}}static getOrCreateInstance(t){const{apiKey:n,user:s,token:i,tokenProvider:r}=t;if(!s.id&&s.type!=="anonymous")throw new Error("user.id is required for a non-anonymous user");if(!i&&!r&&s.type!=="anonymous"&&s.type!=="guest")throw new Error("tokenProvider or token is required for a authenticated users");return qt._instances.get(nr(n,s))||new qt(t)}get state(){return this.readOnlyStateStore}}qt._instances=new Map;const tu=v.createContext(void 0),vv=e=>{const{call:t,children:n}=e;return b.jsx(tu.Provider,{value:t,children:n})},Me=()=>v.useContext(tu),Sv=(e,t)=>Object.entries(e).reduce((n,[s,i])=>(n[s]={[t]:i},n),{}),Nr=e=>e;class yv{constructor({debug:t=!1,currentLanguage:n="en",fallbackLanguage:s,translationsOverrides:i={en:{}}}={}){this.t=Nr,this.init=async()=>(this.t=await this.i18nInstance.init(),this.t),this.changeLanguage=async o=>(this.t=await this.i18nInstance.changeLanguage(o),this.t);const r="stream-video";this.i18nInstance=dd.createInstance({debug:t,defaultNS:r,fallbackLng:s,interpolation:{escapeValue:!1},keySeparator:!1,lng:n,nsSeparator:!1,parseMissingKeyHandler:Nr,resources:Sv(i,r)})}get currentLanguage(){return this.i18nInstance.language}get isInitialized(){return this.i18nInstance.isInitialized}}const nu=v.createContext({t:Nr}),Cv=({children:e,...t})=>{const n=Tv(t);return b.jsx(nu.Provider,{value:n,children:e})},Tv=({i18nInstance:e,language:t,fallbackLanguage:n,translationsOverrides:s})=>{const[i]=v.useState(()=>e||new yv({currentLanguage:t,fallbackLanguage:n,translationsOverrides:s})),[r,o]=v.useState(()=>i.t);return v.useEffect(()=>{i.isInitialized?i.currentLanguage!==t&&i.changeLanguage(t).then(()=>o(()=>i.t)):i.init().then(()=>o(()=>i.t))},[i,t]),v.useMemo(()=>({i18n:i,t:r}),[i,r])},Ge=()=>v.useContext(nu),kv=v.createContext(void 0),wv=({children:e,client:t,i18nInstance:n,language:s,translationsOverrides:i})=>b.jsx(kv.Provider,{value:t,children:b.jsx(Cv,{i18nInstance:n,language:s,translationsOverrides:i,children:e})}),Ev=()=>typeof navigator>"u"?!1:navigator.product?.toLowerCase()==="reactnative",V=(e,t)=>{const[n,s]=v.useState(()=>{try{return fa.getCurrentValue(e)}catch(i){if(typeof t>"u")throw i;return t}});return v.useEffect(()=>fa.createSubscription(e,s,i=>{console.log("An error occurred while reading an observable",i),t&&s(t)}),[t,e]),n},_a=Object.freeze([]),oe=()=>{const e=Me();return e?e.state:(console.warn('You are using useCallState() outside a Call context. Please wrap your component in <StreamCall /> and provide a "call" instance.'),new Ll)},su=()=>{const{recording$:e}=oe();return V(e)},_v=()=>{const{egress$:e}=oe(),t=V(e);return t?t.broadcasting:!1},Iv=()=>{const{backstage$:e}=oe();return!V(e)},Rv=()=>{const{blockedUserIds$:e}=oe();return V(e)},Pv=()=>{const{createdAt$:e}=oe();return V(e)},xv=()=>{const{endedAt$:e}=oe();return V(e)},Ov=()=>{const{startsAt$:e}=oe();return V(e)},Av=()=>{const{updatedAt$:e}=oe();return V(e)},Dv=()=>{const{createdBy$:e}=oe();return V(e)},Nv=()=>{const{custom$:e}=oe();return V(e)},Lv=()=>{const{egress$:e}=oe();return V(e)},Mv=()=>{const{ingress$:e}=oe();return V(e)},jv=()=>{const{session$:e}=oe();return V(e)},Fv=()=>{const{settings$:e}=oe();return V(e)},Uv=()=>{const{transcribing$:e}=oe();return V(e)},$v=()=>{const{endedBy$:e}=oe();return V(e)},Vv=()=>{const{hasOngoingScreenShare$:e}=oe();return V(e)},Bv=()=>{const{callStatsReport$:e}=oe();return V(e)},Hv=()=>{const{dominantSpeaker$:e}=oe();return V(e)},qv=()=>{const{members$:e}=oe();return V(e)},Wv=()=>{const{callingState$:e}=oe();return V(e)},Gv=()=>{const{startedAt$:e}=oe();return V(e)},Kv=({sortBy:e}={})=>{const{participants$:t}=oe(),n=V(t);return v.useMemo(()=>e?[...n].sort(e):n,[n,e])},Jv=()=>{const{rawParticipants$:e}=oe();return V(e)},zv=()=>{const{localParticipant$:e}=oe();return V(e)},Yv=()=>{const{remoteParticipants$:e}=oe();return V(e)},Xv=()=>{const{participantCount$:e}=oe();return V(e)},Zv=()=>{const{anonymousParticipantCount$:e}=oe();return V(e)},Qv=()=>{const{thumbnails$:e}=oe();return V(e)},iu=()=>{const{ownCapabilities$:e}=oe();return V(e)},eS=(...e)=>{const t=iu();return e.every(n=>t?.includes(n))},tS=({optimisticUpdates:e=!0}={})=>{const t=Me(),{camera:n}=t,{state:s}=n,i=V(s.direction$),r=V(s.mediaStream$),o=V(s.selectedDevice$),{getDevices:a}=go(n),c=V(s.hasBrowserPermission$),u=V(s.isPromptingPermission$);return{camera:n,direction:i,mediaStream:r,get devices(){return a()},hasBrowserPermission:c,isPromptingPermission:u,selectedDevice:o,...mo(V(s.status$),V(s.optimisticStatus$),{optimisticUpdates:e})}},nS=({optimisticUpdates:e=!0}={})=>{const t=Me(),{microphone:n}=t,{state:s}=n,i=V(s.mediaStream$),r=V(s.selectedDevice$),{getDevices:o}=go(n),a=V(s.hasBrowserPermission$),c=V(s.isPromptingPermission$),u=V(s.speakingWhileMuted$),d=V(s.audioBitrateProfile$);return{microphone:n,mediaStream:i,get devices(){return o()},selectedDevice:r,hasBrowserPermission:a,isPromptingPermission:c,isSpeakingWhileMuted:u,audioBitrateProfile:d,...mo(V(s.status$),V(s.optimisticStatus$),{optimisticUpdates:e})}},sS=()=>{if(Ev())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");const e=Me(),{speaker:t}=e,{getDevices:n}=go(t),s=V(t.state.selectedDevice$);return{speaker:t,get devices(){return n()},selectedDevice:s,isDeviceSelectionSupported:t.state.isDeviceSelectionSupported}},iS=({optimisticUpdates:e=!0}={})=>{const t=Me(),{screenShare:n}=t,{state:s}=n;return{screenShare:n,mediaStream:V(s.mediaStream$),audioBitrateProfile:V(s.audioBitrateProfile$),...mo(V(s.status$),V(s.optimisticStatus$),{optimisticUpdates:e})}},rS=()=>{const e=Me();return V(e.dynascaleManager.incomingVideoSettings$)},oS=()=>{const{closedCaptions$:e}=oe();return V(e)},aS=()=>{const{captioning$:e}=oe();return V(e)};function mo(e,t,n){const s=t??e;return{status:e,optimisticStatus:s,isEnabled:e==="enabled",isMute:e!=="enabled",optimisticIsMute:s!=="enabled",isTogglePending:s!==e,optionsAwareIsMute:n.optimisticUpdates?s!=="enabled":e!=="enabled"}}function go(e){const t=v.useMemo(()=>Hn(_a),[]),[n,s]=v.useState(t),i=V(n,_a);return{getDevices:()=>(n===t&&s(e.listDevices()),i)}}var cS=Object.freeze({__proto__:null,useAnonymousParticipantCount:Zv,useCallBlockedUserIds:Rv,useCallCallingState:Wv,useCallClosedCaptions:oS,useCallCreatedAt:Pv,useCallCreatedBy:Dv,useCallCustomData:Nv,useCallEgress:Lv,useCallEndedAt:xv,useCallEndedBy:$v,useCallIngress:Mv,useCallMembers:qv,useCallSession:jv,useCallSettings:Fv,useCallStartedAt:Gv,useCallStartsAt:Ov,useCallState:oe,useCallStatsReport:Bv,useCallThumbnail:Qv,useCallUpdatedAt:Av,useCameraState:tS,useDominantSpeaker:Hv,useHasOngoingScreenShare:Vv,useHasPermissions:eS,useIncomingVideoSettings:rS,useIsCallCaptioningInProgress:aS,useIsCallHLSBroadcastingInProgress:_v,useIsCallLive:Iv,useIsCallRecordingInProgress:su,useIsCallTranscribingInProgress:Uv,useLocalParticipant:zv,useMicrophoneState:nS,useOwnCapabilities:iu,useParticipantCount:Xv,useParticipants:Kv,useRawParticipants:Jv,useRemoteParticipants:Yv,useScreenShareState:iS,useSpeakerState:sS});const lS=()=>{const e=Me(),t=su(),[n,s]=v.useState(!1);return v.useEffect(()=>{s(r=>r&&!1)},[t]),{toggleCallRecording:v.useCallback(async()=>{try{s(!0),t?await e?.stopRecording():await e?.startRecording()}catch(r){throw console.error("Failed start recording",r),r}},[e,t]),isAwaitingResponse:n,isCallRecordingInProgress:t}},it=()=>cS,Qe=({canRequestOnly:e,hasPermissionsOnly:t,requiredGrants:n,requireAll:s=!0,children:i})=>{const r=Me(),{useCallSettings:o,useOwnCapabilities:a}=it(),c=a(),u=o(),d=n[s?"every":"some"](l=>c?.includes(l));if(t)return d?b.jsx(b.Fragment,{children:i}):null;const p=n.some(l=>r?.permissionsContext.canRequest(l,u));return e?p?b.jsx(b.Fragment,{children:i}):null:d||p?b.jsx(b.Fragment,{children:i}):null};function Oi(){return typeof window<"u"}function nn(e){return bo(e)?(e.nodeName||"").toLowerCase():"#document"}function ot(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function At(e){var t;return(t=(bo(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function bo(e){return Oi()?e instanceof Node||e instanceof ot(e).Node:!1}function Re(e){return Oi()?e instanceof Element||e instanceof ot(e).Element:!1}function Ae(e){return Oi()?e instanceof HTMLElement||e instanceof ot(e).HTMLElement:!1}function Lr(e){return!Oi()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof ot(e).ShadowRoot}const uS=new Set(["inline","contents"]);function us(e){const{overflow:t,overflowX:n,overflowY:s,display:i}=at(e);return/auto|scroll|overlay|hidden|clip/.test(t+s+n)&&!uS.has(i)}const dS=new Set(["table","td","th"]);function hS(e){return dS.has(nn(e))}const fS=[":popover-open",":modal"];function Ai(e){return fS.some(t=>{try{return e.matches(t)}catch{return!1}})}const pS=["transform","translate","scale","rotate","perspective"],mS=["transform","translate","scale","rotate","perspective","filter"],gS=["paint","layout","strict","content"];function vo(e){const t=Di(),n=Re(e)?at(e):e;return pS.some(s=>n[s]?n[s]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||mS.some(s=>(n.willChange||"").includes(s))||gS.some(s=>(n.contain||"").includes(s))}function bS(e){let t=Vt(e);for(;Ae(t)&&!jt(t);){if(vo(t))return t;if(Ai(t))return null;t=Vt(t)}return null}function Di(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const vS=new Set(["html","body","#document"]);function jt(e){return vS.has(nn(e))}function at(e){return ot(e).getComputedStyle(e)}function Ni(e){return Re(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Vt(e){if(nn(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Lr(e)&&e.host||At(e);return Lr(t)?t.host:t}function ru(e){const t=Vt(e);return jt(t)?e.ownerDocument?e.ownerDocument.body:e.body:Ae(t)&&us(t)?t:ru(t)}function Xt(e,t,n){var s;t===void 0&&(t=[]),n===void 0&&(n=!0);const i=ru(e),r=i===((s=e.ownerDocument)==null?void 0:s.body),o=ot(i);if(r){const a=Mr(o);return t.concat(o,o.visualViewport||[],us(i)?i:[],a&&n?Xt(a):[])}return t.concat(i,Xt(i,[],n))}function Mr(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}const en=Math.min,rt=Math.max,ci=Math.round,vn=Math.floor,Rt=e=>({x:e,y:e}),SS={left:"right",right:"left",bottom:"top",top:"bottom"},yS={start:"end",end:"start"};function jr(e,t,n){return rt(e,en(t,n))}function Dn(e,t){return typeof e=="function"?e(t):e}function tn(e){return e.split("-")[0]}function Nn(e){return e.split("-")[1]}function ou(e){return e==="x"?"y":"x"}function So(e){return e==="y"?"height":"width"}const CS=new Set(["top","bottom"]);function Mt(e){return CS.has(tn(e))?"y":"x"}function yo(e){return ou(Mt(e))}function TS(e,t,n){n===void 0&&(n=!1);const s=Nn(e),i=yo(e),r=So(i);let o=i==="x"?s===(n?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[r]>t.floating[r]&&(o=li(o)),[o,li(o)]}function kS(e){const t=li(e);return[Fr(e),t,Fr(t)]}function Fr(e){return e.replace(/start|end/g,t=>yS[t])}const Ia=["left","right"],Ra=["right","left"],wS=["top","bottom"],ES=["bottom","top"];function _S(e,t,n){switch(e){case"top":case"bottom":return n?t?Ra:Ia:t?Ia:Ra;case"left":case"right":return t?wS:ES;default:return[]}}function IS(e,t,n,s){const i=Nn(e);let r=_S(tn(e),n==="start",s);return i&&(r=r.map(o=>o+"-"+i),t&&(r=r.concat(r.map(Fr)))),r}function li(e){return e.replace(/left|right|bottom|top/g,t=>SS[t])}function RS(e){return{top:0,right:0,bottom:0,left:0,...e}}function au(e){return typeof e!="number"?RS(e):{top:e,right:e,bottom:e,left:e}}function ui(e){const{x:t,y:n,width:s,height:i}=e;return{width:s,height:i,top:n,left:t,right:t+s,bottom:n+i,x:t,y:n}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var PS=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],di=PS.join(","),cu=typeof Element>"u",xn=cu?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,hi=!cu&&Element.prototype.getRootNode?function(e){var t;return e==null||(t=e.getRootNode)===null||t===void 0?void 0:t.call(e)}:function(e){return e?.ownerDocument},fi=function e(t,n){var s;n===void 0&&(n=!0);var i=t==null||(s=t.getAttribute)===null||s===void 0?void 0:s.call(t,"inert"),r=i===""||i==="true",o=r||n&&t&&e(t.parentNode);return o},xS=function(t){var n,s=t==null||(n=t.getAttribute)===null||n===void 0?void 0:n.call(t,"contenteditable");return s===""||s==="true"},lu=function(t,n,s){if(fi(t))return[];var i=Array.prototype.slice.apply(t.querySelectorAll(di));return n&&xn.call(t,di)&&i.unshift(t),i=i.filter(s),i},uu=function e(t,n,s){for(var i=[],r=Array.from(t);r.length;){var o=r.shift();if(!fi(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),c=a.length?a:o.children,u=e(c,!0,s);s.flatten?i.push.apply(i,u):i.push({scopeParent:o,candidates:u})}else{var d=xn.call(o,di);d&&s.filter(o)&&(n||!t.includes(o))&&i.push(o);var p=o.shadowRoot||typeof s.getShadowRoot=="function"&&s.getShadowRoot(o),l=!fi(p,!1)&&(!s.shadowRootFilter||s.shadowRootFilter(o));if(p&&l){var h=e(p===!0?o.children:p.children,!0,s);s.flatten?i.push.apply(i,h):i.push({scopeParent:o,candidates:h})}else r.unshift.apply(r,o.children)}}return i},du=function(t){return!isNaN(parseInt(t.getAttribute("tabindex"),10))},hu=function(t){if(!t)throw new Error("No node provided");return t.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||xS(t))&&!du(t)?0:t.tabIndex},OS=function(t,n){var s=hu(t);return s<0&&n&&!du(t)?0:s},AS=function(t,n){return t.tabIndex===n.tabIndex?t.documentOrder-n.documentOrder:t.tabIndex-n.tabIndex},fu=function(t){return t.tagName==="INPUT"},DS=function(t){return fu(t)&&t.type==="hidden"},NS=function(t){var n=t.tagName==="DETAILS"&&Array.prototype.slice.apply(t.children).some(function(s){return s.tagName==="SUMMARY"});return n},LS=function(t,n){for(var s=0;s<t.length;s++)if(t[s].checked&&t[s].form===n)return t[s]},MS=function(t){if(!t.name)return!0;var n=t.form||hi(t),s=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=s(window.CSS.escape(t.name));else try{i=s(t.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var r=LS(i,t.form);return!r||r===t},jS=function(t){return fu(t)&&t.type==="radio"},FS=function(t){return jS(t)&&!MS(t)},US=function(t){var n,s=t&&hi(t),i=(n=s)===null||n===void 0?void 0:n.host,r=!1;if(s&&s!==t){var o,a,c;for(r=!!((o=i)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(i)||t!=null&&(c=t.ownerDocument)!==null&&c!==void 0&&c.contains(t));!r&&i;){var u,d,p;s=hi(i),i=(u=s)===null||u===void 0?void 0:u.host,r=!!((d=i)!==null&&d!==void 0&&(p=d.ownerDocument)!==null&&p!==void 0&&p.contains(i))}}return r},Pa=function(t){var n=t.getBoundingClientRect(),s=n.width,i=n.height;return s===0&&i===0},$S=function(t,n){var s=n.displayCheck,i=n.getShadowRoot;if(getComputedStyle(t).visibility==="hidden")return!0;var r=xn.call(t,"details>summary:first-of-type"),o=r?t.parentElement:t;if(xn.call(o,"details:not([open]) *"))return!0;if(!s||s==="full"||s==="legacy-full"){if(typeof i=="function"){for(var a=t;t;){var c=t.parentElement,u=hi(t);if(c&&!c.shadowRoot&&i(c)===!0)return Pa(t);t.assignedSlot?t=t.assignedSlot:!c&&u!==t.ownerDocument?t=u.host:t=c}t=a}if(US(t))return!t.getClientRects().length;if(s!=="legacy-full")return!0}else if(s==="non-zero-area")return Pa(t);return!1},VS=function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var n=t.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var s=0;s<n.children.length;s++){var i=n.children.item(s);if(i.tagName==="LEGEND")return xn.call(n,"fieldset[disabled] *")?!0:!i.contains(t)}return!0}n=n.parentElement}return!1},Ur=function(t,n){return!(n.disabled||fi(n)||DS(n)||$S(n,t)||NS(n)||VS(n))},$r=function(t,n){return!(FS(n)||hu(n)<0||!Ur(t,n))},BS=function(t){var n=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},HS=function e(t){var n=[],s=[];return t.forEach(function(i,r){var o=!!i.scopeParent,a=o?i.scopeParent:i,c=OS(a,o),u=o?e(i.candidates):a;c===0?o?n.push.apply(n,u):n.push(a):s.push({documentOrder:r,tabIndex:c,item:i,isScope:o,content:u})}),s.sort(AS).reduce(function(i,r){return r.isScope?i.push.apply(i,r.content):i.push(r.content),i},[]).concat(n)},Li=function(t,n){n=n||{};var s;return n.getShadowRoot?s=uu([t],n.includeContainer,{filter:$r.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:BS}):s=lu(t,n.includeContainer,$r.bind(null,n)),HS(s)},qS=function(t,n){n=n||{};var s;return n.getShadowRoot?s=uu([t],n.includeContainer,{filter:Ur.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):s=lu(t,n.includeContainer,Ur.bind(null,n)),s},pu=function(t,n){if(n=n||{},!t)throw new Error("No node provided");return xn.call(t,di)===!1?!1:$r(n,t)};function mu(){const e=navigator.userAgentData;return e!=null&&e.platform?e.platform:navigator.platform}function gu(){const e=navigator.userAgentData;return e&&Array.isArray(e.brands)?e.brands.map(t=>{let{brand:n,version:s}=t;return n+"/"+s}).join(" "):navigator.userAgent}function WS(){return/apple/i.test(navigator.vendor)}function Vr(){const e=/android/i;return e.test(mu())||e.test(gu())}function GS(){return gu().includes("jsdom/")}const xa="data-floating-ui-focusable",KS="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])",sr="ArrowLeft",ir="ArrowRight",JS="ArrowUp",zS="ArrowDown";function Wt(e){let t=e.activeElement;for(;((n=t)==null||(n=n.shadowRoot)==null?void 0:n.activeElement)!=null;){var n;t=t.shadowRoot.activeElement}return t}function nt(e,t){if(!e||!t)return!1;const n=t.getRootNode==null?void 0:t.getRootNode();if(e.contains(t))return!0;if(n&&Lr(n)){let s=t;for(;s;){if(e===s)return!0;s=s.parentNode||s.host}}return!1}function Gt(e){return"composedPath"in e?e.composedPath()[0]:e.target}function rr(e,t){if(t==null)return!1;if("composedPath"in e)return e.composedPath().includes(t);const n=e;return n.target!=null&&t.contains(n.target)}function YS(e){return e.matches("html,body")}function dt(e){return e?.ownerDocument||document}function bu(e){return Ae(e)&&e.matches(KS)}function Br(e){return e?e.getAttribute("role")==="combobox"&&bu(e):!1}function pi(e){return e?e.hasAttribute(xa)?e:e.querySelector("["+xa+"]")||e:null}function rn(e,t,n){return n===void 0&&(n=!0),e.filter(i=>{var r;return i.parentId===t&&(!n||((r=i.context)==null?void 0:r.open))}).flatMap(i=>[i,...rn(e,i.id,n)])}function XS(e,t){let n,s=-1;function i(r,o){o>s&&(n=r,s=o),rn(e,r).forEach(c=>{i(c.id,o+1)})}return i(t,0),e.find(r=>r.id===n)}function Oa(e,t){var n;let s=[],i=(n=e.find(r=>r.id===t))==null?void 0:n.parentId;for(;i;){const r=e.find(o=>o.id===i);i=r?.parentId,r&&(s=s.concat(r))}return s}function Ve(e){e.preventDefault(),e.stopPropagation()}function ZS(e){return"nativeEvent"in e}function vu(e){return e.mozInputSource===0&&e.isTrusted?!0:Vr()&&e.pointerType?e.type==="click"&&e.buttons===1:e.detail===0&&!e.pointerType}function Su(e){return GS()?!1:!Vr()&&e.width===0&&e.height===0||Vr()&&e.width===1&&e.height===1&&e.pressure===0&&e.detail===0&&e.pointerType==="mouse"||e.width<1&&e.height<1&&e.pressure===0&&e.detail===0&&e.pointerType==="touch"}function Aa(e,t){return["mouse","pen"].includes(e)}var QS=typeof document<"u",ey=function(){},be=QS?v.useLayoutEffect:ey;const ty={...ac};function Et(e){const t=v.useRef(e);return be(()=>{t.current=e}),t}const ny=ty.useInsertionEffect,sy=ny||(e=>e());function qe(e){const t=v.useRef(()=>{});return sy(()=>{t.current=e}),v.useCallback(function(){for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return t.current==null?void 0:t.current(...s)},[])}function Es(e,t,n){return Math.floor(e/t)!==n}function Gn(e,t){return t<0||t>=e.current.length}function or(e,t){return ze(e,{disabledIndices:t})}function Da(e,t){return ze(e,{decrement:!0,startingIndex:e.current.length,disabledIndices:t})}function ze(e,t){let{startingIndex:n=-1,decrement:s=!1,disabledIndices:i,amount:r=1}=t===void 0?{}:t,o=n;do o+=s?-r:r;while(o>=0&&o<=e.current.length-1&&Fs(e,o,i));return o}function iy(e,t){let{event:n,orientation:s,loop:i,rtl:r,cols:o,disabledIndices:a,minIndex:c,maxIndex:u,prevIndex:d,stopEvent:p=!1}=t,l=d;if(n.key===JS){if(p&&Ve(n),d===-1)l=u;else if(l=ze(e,{startingIndex:l,amount:o,decrement:!0,disabledIndices:a}),i&&(d-o<c||l<0)){const h=d%o,m=u%o,f=u-(m-h);m===h?l=u:l=m>h?f:f-o}Gn(e,l)&&(l=d)}if(n.key===zS&&(p&&Ve(n),d===-1?l=c:(l=ze(e,{startingIndex:d,amount:o,disabledIndices:a}),i&&d+o>u&&(l=ze(e,{startingIndex:d%o-o,amount:o,disabledIndices:a}))),Gn(e,l)&&(l=d)),s==="both"){const h=vn(d/o);n.key===(r?sr:ir)&&(p&&Ve(n),d%o!==o-1?(l=ze(e,{startingIndex:d,disabledIndices:a}),i&&Es(l,o,h)&&(l=ze(e,{startingIndex:d-d%o-1,disabledIndices:a}))):i&&(l=ze(e,{startingIndex:d-d%o-1,disabledIndices:a})),Es(l,o,h)&&(l=d)),n.key===(r?ir:sr)&&(p&&Ve(n),d%o!==0?(l=ze(e,{startingIndex:d,decrement:!0,disabledIndices:a}),i&&Es(l,o,h)&&(l=ze(e,{startingIndex:d+(o-d%o),decrement:!0,disabledIndices:a}))):i&&(l=ze(e,{startingIndex:d+(o-d%o),decrement:!0,disabledIndices:a})),Es(l,o,h)&&(l=d));const m=vn(u/o)===h;Gn(e,l)&&(i&&m?l=n.key===(r?ir:sr)?u:ze(e,{startingIndex:d-d%o-1,disabledIndices:a}):l=d)}return l}function ry(e,t,n){const s=[];let i=0;return e.forEach((r,o)=>{let{width:a,height:c}=r,u=!1;for(n&&(i=0);!u;){const d=[];for(let p=0;p<a;p++)for(let l=0;l<c;l++)d.push(i+p+l*t);i%t+a<=t&&d.every(p=>s[p]==null)?(d.forEach(p=>{s[p]=o}),u=!0):i++}}),[...s]}function oy(e,t,n,s,i){if(e===-1)return-1;const r=n.indexOf(e),o=t[e];switch(i){case"tl":return r;case"tr":return o?r+o.width-1:r;case"bl":return o?r+(o.height-1)*s:r;case"br":return n.lastIndexOf(e)}}function ay(e,t){return t.flatMap((n,s)=>e.includes(n)?[s]:[])}function Fs(e,t,n){if(typeof n=="function")return n(t);if(n)return n.includes(t);const s=e.current[t];return s==null||s.hasAttribute("disabled")||s.getAttribute("aria-disabled")==="true"}const ds=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function yu(e,t){const n=Li(e,ds()),s=n.length;if(s===0)return;const i=Wt(dt(e)),r=n.indexOf(i),o=r===-1?t===1?0:s-1:r+t;return n[o]}function Cu(e){return yu(dt(e).body,1)||e}function Tu(e){return yu(dt(e).body,-1)||e}function Kn(e,t){const n=t||e.currentTarget,s=e.relatedTarget;return!s||!nt(n,s)}function cy(e){Li(e,ds()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function Na(e){e.querySelectorAll("[data-tabindex]").forEach(n=>{const s=n.dataset.tabindex;delete n.dataset.tabindex,s?n.setAttribute("tabindex",s):n.removeAttribute("tabindex")})}function La(e,t,n){let{reference:s,floating:i}=e;const r=Mt(t),o=yo(t),a=So(o),c=tn(t),u=r==="y",d=s.x+s.width/2-i.width/2,p=s.y+s.height/2-i.height/2,l=s[a]/2-i[a]/2;let h;switch(c){case"top":h={x:d,y:s.y-i.height};break;case"bottom":h={x:d,y:s.y+s.height};break;case"right":h={x:s.x+s.width,y:p};break;case"left":h={x:s.x-i.width,y:p};break;default:h={x:s.x,y:s.y}}switch(Nn(t)){case"start":h[o]-=l*(n&&u?-1:1);break;case"end":h[o]+=l*(n&&u?-1:1);break}return h}const ly=async(e,t,n)=>{const{placement:s="bottom",strategy:i="absolute",middleware:r=[],platform:o}=n,a=r.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(t));let u=await o.getElementRects({reference:e,floating:t,strategy:i}),{x:d,y:p}=La(u,s,c),l=s,h={},m=0;for(let f=0;f<a.length;f++){const{name:g,fn:S}=a[f],{x:C,y,data:T,reset:k}=await S({x:d,y:p,initialPlacement:s,placement:l,strategy:i,middlewareData:h,rects:u,platform:o,elements:{reference:e,floating:t}});d=C??d,p=y??p,h={...h,[g]:{...h[g],...T}},k&&m<=50&&(m++,typeof k=="object"&&(k.placement&&(l=k.placement),k.rects&&(u=k.rects===!0?await o.getElementRects({reference:e,floating:t,strategy:i}):k.rects),{x:d,y:p}=La(u,l,c)),f=-1)}return{x:d,y:p,placement:l,strategy:i,middlewareData:h}};async function Co(e,t){var n;t===void 0&&(t={});const{x:s,y:i,platform:r,rects:o,elements:a,strategy:c}=e,{boundary:u="clippingAncestors",rootBoundary:d="viewport",elementContext:p="floating",altBoundary:l=!1,padding:h=0}=Dn(t,e),m=au(h),g=a[l?p==="floating"?"reference":"floating":p],S=ui(await r.getClippingRect({element:(n=await(r.isElement==null?void 0:r.isElement(g)))==null||n?g:g.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:u,rootBoundary:d,strategy:c})),C=p==="floating"?{x:s,y:i,width:o.floating.width,height:o.floating.height}:o.reference,y=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),T=await(r.isElement==null?void 0:r.isElement(y))?await(r.getScale==null?void 0:r.getScale(y))||{x:1,y:1}:{x:1,y:1},k=ui(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:C,offsetParent:y,strategy:c}):C);return{top:(S.top-k.top+m.top)/T.y,bottom:(k.bottom-S.bottom+m.bottom)/T.y,left:(S.left-k.left+m.left)/T.x,right:(k.right-S.right+m.right)/T.x}}const uy=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:s,placement:i,rects:r,platform:o,elements:a,middlewareData:c}=t,{element:u,padding:d=0}=Dn(e,t)||{};if(u==null)return{};const p=au(d),l={x:n,y:s},h=yo(i),m=So(h),f=await o.getDimensions(u),g=h==="y",S=g?"top":"left",C=g?"bottom":"right",y=g?"clientHeight":"clientWidth",T=r.reference[m]+r.reference[h]-l[h]-r.floating[m],k=l[h]-r.reference[h],I=await(o.getOffsetParent==null?void 0:o.getOffsetParent(u));let R=I?I[y]:0;(!R||!await(o.isElement==null?void 0:o.isElement(I)))&&(R=a.floating[y]||r.floating[m]);const A=T/2-k/2,B=R/2-f[m]/2-1,N=en(p[S],B),$=en(p[C],B),j=N,D=R-f[m]-$,E=R/2-f[m]/2+A,O=jr(j,E,D),U=!c.arrow&&Nn(i)!=null&&E!==O&&r.reference[m]/2-(E<j?N:$)-f[m]/2<0,H=U?E<j?E-j:E-D:0;return{[h]:l[h]+H,data:{[h]:O,centerOffset:E-O-H,...U&&{alignmentOffset:H}},reset:U}}}),dy=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,s;const{placement:i,middlewareData:r,rects:o,initialPlacement:a,platform:c,elements:u}=t,{mainAxis:d=!0,crossAxis:p=!0,fallbackPlacements:l,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:f=!0,...g}=Dn(e,t);if((n=r.arrow)!=null&&n.alignmentOffset)return{};const S=tn(i),C=Mt(a),y=tn(a)===a,T=await(c.isRTL==null?void 0:c.isRTL(u.floating)),k=l||(y||!f?[li(a)]:kS(a)),I=m!=="none";!l&&I&&k.push(...IS(a,f,m,T));const R=[a,...k],A=await Co(t,g),B=[];let N=((s=r.flip)==null?void 0:s.overflows)||[];if(d&&B.push(A[S]),p){const E=TS(i,o,T);B.push(A[E[0]],A[E[1]])}if(N=[...N,{placement:i,overflows:B}],!B.every(E=>E<=0)){var $,j;const E=((($=r.flip)==null?void 0:$.index)||0)+1,O=R[E];if(O&&(!(p==="alignment"?C!==Mt(O):!1)||N.every(_=>Mt(_.placement)===C?_.overflows[0]>0:!0)))return{data:{index:E,overflows:N},reset:{placement:O}};let U=(j=N.filter(H=>H.overflows[0]<=0).sort((H,_)=>H.overflows[1]-_.overflows[1])[0])==null?void 0:j.placement;if(!U)switch(h){case"bestFit":{var D;const H=(D=N.filter(_=>{if(I){const G=Mt(_.placement);return G===C||G==="y"}return!0}).map(_=>[_.placement,_.overflows.filter(G=>G>0).reduce((G,se)=>G+se,0)]).sort((_,G)=>_[1]-G[1])[0])==null?void 0:D[0];H&&(U=H);break}case"initialPlacement":U=a;break}if(i!==U)return{reset:{placement:U}}}return{}}}},hy=new Set(["left","top"]);async function fy(e,t){const{placement:n,platform:s,elements:i}=e,r=await(s.isRTL==null?void 0:s.isRTL(i.floating)),o=tn(n),a=Nn(n),c=Mt(n)==="y",u=hy.has(o)?-1:1,d=r&&c?-1:1,p=Dn(t,e);let{mainAxis:l,crossAxis:h,alignmentAxis:m}=typeof p=="number"?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:p.mainAxis||0,crossAxis:p.crossAxis||0,alignmentAxis:p.alignmentAxis};return a&&typeof m=="number"&&(h=a==="end"?m*-1:m),c?{x:h*d,y:l*u}:{x:l*u,y:h*d}}const py=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,s;const{x:i,y:r,placement:o,middlewareData:a}=t,c=await fy(t,e);return o===((n=a.offset)==null?void 0:n.placement)&&(s=a.arrow)!=null&&s.alignmentOffset?{}:{x:i+c.x,y:r+c.y,data:{...c,placement:o}}}}},my=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:s,placement:i}=t,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:g=>{let{x:S,y:C}=g;return{x:S,y:C}}},...c}=Dn(e,t),u={x:n,y:s},d=await Co(t,c),p=Mt(tn(i)),l=ou(p);let h=u[l],m=u[p];if(r){const g=l==="y"?"top":"left",S=l==="y"?"bottom":"right",C=h+d[g],y=h-d[S];h=jr(C,h,y)}if(o){const g=p==="y"?"top":"left",S=p==="y"?"bottom":"right",C=m+d[g],y=m-d[S];m=jr(C,m,y)}const f=a.fn({...t,[l]:h,[p]:m});return{...f,data:{x:f.x-n,y:f.y-s,enabled:{[l]:r,[p]:o}}}}}},gy=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,s;const{placement:i,rects:r,platform:o,elements:a}=t,{apply:c=()=>{},...u}=Dn(e,t),d=await Co(t,u),p=tn(i),l=Nn(i),h=Mt(i)==="y",{width:m,height:f}=r.floating;let g,S;p==="top"||p==="bottom"?(g=p,S=l===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(S=p,g=l==="end"?"top":"bottom");const C=f-d.top-d.bottom,y=m-d.left-d.right,T=en(f-d[g],C),k=en(m-d[S],y),I=!t.middlewareData.shift;let R=T,A=k;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(A=y),(s=t.middlewareData.shift)!=null&&s.enabled.y&&(R=C),I&&!l){const N=rt(d.left,0),$=rt(d.right,0),j=rt(d.top,0),D=rt(d.bottom,0);h?A=m-2*(N!==0||$!==0?N+$:rt(d.left,d.right)):R=f-2*(j!==0||D!==0?j+D:rt(d.top,d.bottom))}await c({...t,availableWidth:A,availableHeight:R});const B=await o.getDimensions(a.floating);return m!==B.width||f!==B.height?{reset:{rects:!0}}:{}}}};function ku(e){const t=at(e);let n=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const i=Ae(e),r=i?e.offsetWidth:n,o=i?e.offsetHeight:s,a=ci(n)!==r||ci(s)!==o;return a&&(n=r,s=o),{width:n,height:s,$:a}}function To(e){return Re(e)?e:e.contextElement}function Cn(e){const t=To(e);if(!Ae(t))return Rt(1);const n=t.getBoundingClientRect(),{width:s,height:i,$:r}=ku(t);let o=(r?ci(n.width):n.width)/s,a=(r?ci(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const by=Rt(0);function wu(e){const t=ot(e);return!Di()||!t.visualViewport?by:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function vy(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==ot(e)?!1:t}function ln(e,t,n,s){t===void 0&&(t=!1),n===void 0&&(n=!1);const i=e.getBoundingClientRect(),r=To(e);let o=Rt(1);t&&(s?Re(s)&&(o=Cn(s)):o=Cn(e));const a=vy(r,n,s)?wu(r):Rt(0);let c=(i.left+a.x)/o.x,u=(i.top+a.y)/o.y,d=i.width/o.x,p=i.height/o.y;if(r){const l=ot(r),h=s&&Re(s)?ot(s):s;let m=l,f=Mr(m);for(;f&&s&&h!==m;){const g=Cn(f),S=f.getBoundingClientRect(),C=at(f),y=S.left+(f.clientLeft+parseFloat(C.paddingLeft))*g.x,T=S.top+(f.clientTop+parseFloat(C.paddingTop))*g.y;c*=g.x,u*=g.y,d*=g.x,p*=g.y,c+=y,u+=T,m=ot(f),f=Mr(m)}}return ui({width:d,height:p,x:c,y:u})}function Mi(e,t){const n=Ni(e).scrollLeft;return t?t.left+n:ln(At(e)).left+n}function Eu(e,t){const n=e.getBoundingClientRect(),s=n.left+t.scrollLeft-Mi(e,n),i=n.top+t.scrollTop;return{x:s,y:i}}function Sy(e){let{elements:t,rect:n,offsetParent:s,strategy:i}=e;const r=i==="fixed",o=At(s),a=t?Ai(t.floating):!1;if(s===o||a&&r)return n;let c={scrollLeft:0,scrollTop:0},u=Rt(1);const d=Rt(0),p=Ae(s);if((p||!p&&!r)&&((nn(s)!=="body"||us(o))&&(c=Ni(s)),Ae(s))){const h=ln(s);u=Cn(s),d.x=h.x+s.clientLeft,d.y=h.y+s.clientTop}const l=o&&!p&&!r?Eu(o,c):Rt(0);return{width:n.width*u.x,height:n.height*u.y,x:n.x*u.x-c.scrollLeft*u.x+d.x+l.x,y:n.y*u.y-c.scrollTop*u.y+d.y+l.y}}function yy(e){return Array.from(e.getClientRects())}function Cy(e){const t=At(e),n=Ni(e),s=e.ownerDocument.body,i=rt(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),r=rt(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let o=-n.scrollLeft+Mi(e);const a=-n.scrollTop;return at(s).direction==="rtl"&&(o+=rt(t.clientWidth,s.clientWidth)-i),{width:i,height:r,x:o,y:a}}const Ma=25;function Ty(e,t){const n=ot(e),s=At(e),i=n.visualViewport;let r=s.clientWidth,o=s.clientHeight,a=0,c=0;if(i){r=i.width,o=i.height;const d=Di();(!d||d&&t==="fixed")&&(a=i.offsetLeft,c=i.offsetTop)}const u=Mi(s);if(u<=0){const d=s.ownerDocument,p=d.body,l=getComputedStyle(p),h=d.compatMode==="CSS1Compat"&&parseFloat(l.marginLeft)+parseFloat(l.marginRight)||0,m=Math.abs(s.clientWidth-p.clientWidth-h);m<=Ma&&(r-=m)}else u<=Ma&&(r+=u);return{width:r,height:o,x:a,y:c}}const ky=new Set(["absolute","fixed"]);function wy(e,t){const n=ln(e,!0,t==="fixed"),s=n.top+e.clientTop,i=n.left+e.clientLeft,r=Ae(e)?Cn(e):Rt(1),o=e.clientWidth*r.x,a=e.clientHeight*r.y,c=i*r.x,u=s*r.y;return{width:o,height:a,x:c,y:u}}function ja(e,t,n){let s;if(t==="viewport")s=Ty(e,n);else if(t==="document")s=Cy(At(e));else if(Re(t))s=wy(t,n);else{const i=wu(e);s={x:t.x-i.x,y:t.y-i.y,width:t.width,height:t.height}}return ui(s)}function _u(e,t){const n=Vt(e);return n===t||!Re(n)||jt(n)?!1:at(n).position==="fixed"||_u(n,t)}function Ey(e,t){const n=t.get(e);if(n)return n;let s=Xt(e,[],!1).filter(a=>Re(a)&&nn(a)!=="body"),i=null;const r=at(e).position==="fixed";let o=r?Vt(e):e;for(;Re(o)&&!jt(o);){const a=at(o),c=vo(o);!c&&a.position==="fixed"&&(i=null),(r?!c&&!i:!c&&a.position==="static"&&!!i&&ky.has(i.position)||us(o)&&!c&&_u(e,o))?s=s.filter(d=>d!==o):i=a,o=Vt(o)}return t.set(e,s),s}function _y(e){let{element:t,boundary:n,rootBoundary:s,strategy:i}=e;const o=[...n==="clippingAncestors"?Ai(t)?[]:Ey(t,this._c):[].concat(n),s],a=o[0],c=o.reduce((u,d)=>{const p=ja(t,d,i);return u.top=rt(p.top,u.top),u.right=en(p.right,u.right),u.bottom=en(p.bottom,u.bottom),u.left=rt(p.left,u.left),u},ja(t,a,i));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function Iy(e){const{width:t,height:n}=ku(e);return{width:t,height:n}}function Ry(e,t,n){const s=Ae(t),i=At(t),r=n==="fixed",o=ln(e,!0,r,t);let a={scrollLeft:0,scrollTop:0};const c=Rt(0);function u(){c.x=Mi(i)}if(s||!s&&!r)if((nn(t)!=="body"||us(i))&&(a=Ni(t)),s){const h=ln(t,!0,r,t);c.x=h.x+t.clientLeft,c.y=h.y+t.clientTop}else i&&u();r&&!s&&i&&u();const d=i&&!s&&!r?Eu(i,a):Rt(0),p=o.left+a.scrollLeft-c.x-d.x,l=o.top+a.scrollTop-c.y-d.y;return{x:p,y:l,width:o.width,height:o.height}}function ar(e){return at(e).position==="static"}function Fa(e,t){if(!Ae(e)||at(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return At(e)===n&&(n=n.ownerDocument.body),n}function Iu(e,t){const n=ot(e);if(Ai(e))return n;if(!Ae(e)){let i=Vt(e);for(;i&&!jt(i);){if(Re(i)&&!ar(i))return i;i=Vt(i)}return n}let s=Fa(e,t);for(;s&&hS(s)&&ar(s);)s=Fa(s,t);return s&&jt(s)&&ar(s)&&!vo(s)?n:s||bS(e)||n}const Py=async function(e){const t=this.getOffsetParent||Iu,n=this.getDimensions,s=await n(e.floating);return{reference:Ry(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function xy(e){return at(e).direction==="rtl"}const Oy={convertOffsetParentRelativeRectToViewportRelativeRect:Sy,getDocumentElement:At,getClippingRect:_y,getOffsetParent:Iu,getElementRects:Py,getClientRects:yy,getDimensions:Iy,getScale:Cn,isElement:Re,isRTL:xy};function Ru(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Ay(e,t){let n=null,s;const i=At(e);function r(){var a;clearTimeout(s),(a=n)==null||a.disconnect(),n=null}function o(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),r();const u=e.getBoundingClientRect(),{left:d,top:p,width:l,height:h}=u;if(a||t(),!l||!h)return;const m=vn(p),f=vn(i.clientWidth-(d+l)),g=vn(i.clientHeight-(p+h)),S=vn(d),y={rootMargin:-m+"px "+-f+"px "+-g+"px "+-S+"px",threshold:rt(0,en(1,c))||1};let T=!0;function k(I){const R=I[0].intersectionRatio;if(R!==c){if(!T)return o();R?o(!1,R):s=setTimeout(()=>{o(!1,1e-7)},1e3)}R===1&&!Ru(u,e.getBoundingClientRect())&&o(),T=!1}try{n=new IntersectionObserver(k,{...y,root:i.ownerDocument})}catch{n=new IntersectionObserver(k,y)}n.observe(e)}return o(!0),r}function Pu(e,t,n,s){s===void 0&&(s={});const{ancestorScroll:i=!0,ancestorResize:r=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=s,u=To(e),d=i||r?[...u?Xt(u):[],...Xt(t)]:[];d.forEach(S=>{i&&S.addEventListener("scroll",n,{passive:!0}),r&&S.addEventListener("resize",n)});const p=u&&a?Ay(u,n):null;let l=-1,h=null;o&&(h=new ResizeObserver(S=>{let[C]=S;C&&C.target===u&&h&&(h.unobserve(t),cancelAnimationFrame(l),l=requestAnimationFrame(()=>{var y;(y=h)==null||y.observe(t)})),n()}),u&&!c&&h.observe(u),h.observe(t));let m,f=c?ln(e):null;c&&g();function g(){const S=ln(e);f&&!Ru(f,S)&&n(),f=S,m=requestAnimationFrame(g)}return n(),()=>{var S;d.forEach(C=>{i&&C.removeEventListener("scroll",n),r&&C.removeEventListener("resize",n)}),p?.(),(S=h)==null||S.disconnect(),h=null,c&&cancelAnimationFrame(m)}}const Dy=py,Ny=my,Ly=dy,My=gy,Ua=uy,jy=(e,t,n)=>{const s=new Map,i={platform:Oy,...n},r={...i.platform,_c:s};return ly(e,t,{...i,platform:r})};var Fy=typeof document<"u",Uy=function(){},Us=Fy?v.useLayoutEffect:Uy;function mi(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,s,i;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(s=n;s--!==0;)if(!mi(e[s],t[s]))return!1;return!0}if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(s=n;s--!==0;)if(!{}.hasOwnProperty.call(t,i[s]))return!1;for(s=n;s--!==0;){const r=i[s];if(!(r==="_owner"&&e.$$typeof)&&!mi(e[r],t[r]))return!1}return!0}return e!==e&&t!==t}function xu(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function $a(e,t){const n=xu(e);return Math.round(t*n)/n}function cr(e){const t=v.useRef(e);return Us(()=>{t.current=e}),t}function $y(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:s=[],platform:i,elements:{reference:r,floating:o}={},transform:a=!0,whileElementsMounted:c,open:u}=e,[d,p]=v.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[l,h]=v.useState(s);mi(l,s)||h(s);const[m,f]=v.useState(null),[g,S]=v.useState(null),C=v.useCallback(_=>{_!==I.current&&(I.current=_,f(_))},[]),y=v.useCallback(_=>{_!==R.current&&(R.current=_,S(_))},[]),T=r||m,k=o||g,I=v.useRef(null),R=v.useRef(null),A=v.useRef(d),B=c!=null,N=cr(c),$=cr(i),j=cr(u),D=v.useCallback(()=>{if(!I.current||!R.current)return;const _={placement:t,strategy:n,middleware:l};$.current&&(_.platform=$.current),jy(I.current,R.current,_).then(G=>{const se={...G,isPositioned:j.current!==!1};E.current&&!mi(A.current,se)&&(A.current=se,cc.flushSync(()=>{p(se)}))})},[l,t,n,$,j]);Us(()=>{u===!1&&A.current.isPositioned&&(A.current.isPositioned=!1,p(_=>({..._,isPositioned:!1})))},[u]);const E=v.useRef(!1);Us(()=>(E.current=!0,()=>{E.current=!1}),[]),Us(()=>{if(T&&(I.current=T),k&&(R.current=k),T&&k){if(N.current)return N.current(T,k,D);D()}},[T,k,D,N,B]);const O=v.useMemo(()=>({reference:I,floating:R,setReference:C,setFloating:y}),[C,y]),U=v.useMemo(()=>({reference:T,floating:k}),[T,k]),H=v.useMemo(()=>{const _={position:n,left:0,top:0};if(!U.floating)return _;const G=$a(U.floating,d.x),se=$a(U.floating,d.y);return a?{..._,transform:"translate("+G+"px, "+se+"px)",...xu(U.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:G,top:se}},[n,a,U.floating,d.x,d.y]);return v.useMemo(()=>({...d,update:D,refs:O,elements:U,floatingStyles:H}),[d,D,O,U,H])}const Vy=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:s,padding:i}=typeof e=="function"?e(n):e;return s&&t(s)?s.current!=null?Ua({element:s.current,padding:i}).fn(n):{}:s?Ua({element:s,padding:i}).fn(n):{}}}},By=(e,t)=>({...Dy(e),options:[e,t]}),Hy=(e,t)=>({...Ny(e),options:[e,t]}),Ou=(e,t)=>({...Ly(e),options:[e,t]}),qy=(e,t)=>({...My(e),options:[e,t]}),Wy=(e,t)=>({...Vy(e),options:[e,t]});function Gy(e,t){const n=e.compareDocumentPosition(t);return n&Node.DOCUMENT_POSITION_FOLLOWING||n&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:n&Node.DOCUMENT_POSITION_PRECEDING||n&Node.DOCUMENT_POSITION_CONTAINS?1:0}const Au=v.createContext({register:()=>{},unregister:()=>{},map:new Map,elementsRef:{current:[]}});function Ky(e){const{children:t,elementsRef:n,labelsRef:s}=e,[i,r]=v.useState(()=>new Set),o=v.useCallback(u=>{r(d=>new Set(d).add(u))},[]),a=v.useCallback(u=>{r(d=>{const p=new Set(d);return p.delete(u),p})},[]),c=v.useMemo(()=>{const u=new Map;return Array.from(i.keys()).sort(Gy).forEach((p,l)=>{u.set(p,l)}),u},[i]);return b.jsx(Au.Provider,{value:v.useMemo(()=>({register:o,unregister:a,map:c,elementsRef:n,labelsRef:s}),[o,a,c,n,s]),children:t})}function Jy(e){e===void 0&&(e={});const{label:t}=e,{register:n,unregister:s,map:i,elementsRef:r,labelsRef:o}=v.useContext(Au),[a,c]=v.useState(null),u=v.useRef(null),d=v.useCallback(p=>{if(u.current=p,a!==null&&(r.current[a]=p,o)){var l;const h=t!==void 0;o.current[a]=h?t:(l=p?.textContent)!=null?l:null}},[a,r,o,t]);return be(()=>{const p=u.current;if(p)return n(p),()=>{s(p)}},[n,s]),be(()=>{const p=u.current?i.get(u.current):null;p!=null&&c(p)},[i]),v.useMemo(()=>({ref:d,index:a??-1}),[a,d])}const zy="data-floating-ui-focusable",Va="active",Ba="selected",hs="ArrowLeft",fs="ArrowRight",Du="ArrowUp",ji="ArrowDown",Yy={...ac};let Ha=!1,Xy=0;const qa=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+Xy++;function Zy(){const[e,t]=v.useState(()=>Ha?qa():void 0);return be(()=>{e==null&&t(qa())},[]),v.useEffect(()=>{Ha=!0},[]),e}const Qy=Yy.useId,Fi=Qy||Zy,eC=v.forwardRef(function(t,n){const{context:{placement:s,elements:{floating:i},middlewareData:{arrow:r,shift:o}},width:a=14,height:c=7,tipRadius:u=0,strokeWidth:d=0,staticOffset:p,stroke:l,d:h,style:{transform:m,...f}={},...g}=t,S=Fi(),[C,y]=v.useState(!1);if(be(()=>{if(!i)return;at(i).direction==="rtl"&&y(!0)},[i]),!i)return null;const[T,k]=s.split("-"),I=T==="top"||T==="bottom";let R=p;(I&&o!=null&&o.x||!I&&o!=null&&o.y)&&(R=null);const A=d*2,B=A/2,N=a/2*(u/-8+1),$=c/2*u/4,j=!!h,D=R&&k==="end"?"bottom":"top";let E=R&&k==="end"?"right":"left";R&&C&&(E=k==="end"?"left":"right");const O=r?.x!=null?R||r.x:"",U=r?.y!=null?R||r.y:"",H=h||"M0,0"+(" H"+a)+(" L"+(a-N)+","+(c-$))+(" Q"+a/2+","+c+" "+N+","+(c-$))+" Z",_={top:j?"rotate(180deg)":"",left:j?"rotate(90deg)":"rotate(-90deg)",bottom:j?"":"rotate(180deg)",right:j?"rotate(-90deg)":"rotate(90deg)"}[T];return b.jsxs("svg",{...g,"aria-hidden":!0,ref:n,width:j?a:a+A,height:a,viewBox:"0 0 "+a+" "+(c>a?c:a),style:{position:"absolute",pointerEvents:"none",[E]:O,[D]:U,[T]:I||j?"100%":"calc(100% - "+A/2+"px)",transform:[_,m].filter(G=>!!G).join(" "),...f},children:[A>0&&b.jsx("path",{clipPath:"url(#"+S+")",fill:"none",stroke:l,strokeWidth:A+(h?0:1),d:H}),b.jsx("path",{stroke:A&&!h?g.fill:"none",d:H}),b.jsx("clipPath",{id:S,children:b.jsx("rect",{x:-B,y:B*(j?-1:1),width:a+A,height:a})})]})});function tC(){const e=new Map;return{emit(t,n){var s;(s=e.get(t))==null||s.forEach(i=>i(n))},on(t,n){e.has(t)||e.set(t,new Set),e.get(t).add(n)},off(t,n){var s;(s=e.get(t))==null||s.delete(n)}}}const nC=v.createContext(null),sC=v.createContext(null),ko=()=>{var e;return((e=v.useContext(nC))==null?void 0:e.id)||null},Ui=()=>v.useContext(sC);function ss(e){return"data-floating-ui-"+e}function Hr(e){e.current!==-1&&(clearTimeout(e.current),e.current=-1)}let Wa=0;function sn(e,t){t===void 0&&(t={});const{preventScroll:n=!1,cancelPrevious:s=!0,sync:i=!1}=t;s&&cancelAnimationFrame(Wa);const r=()=>e?.focus({preventScroll:n});i?r():Wa=requestAnimationFrame(r)}function iC(e){return e?.ownerDocument||document}const Tn={inert:new WeakMap,"aria-hidden":new WeakMap,none:new WeakMap};function Ga(e){return e==="inert"?Tn.inert:e==="aria-hidden"?Tn["aria-hidden"]:Tn.none}let _s=new WeakSet,Is={},lr=0;const rC=()=>typeof HTMLElement<"u"&&"inert"in HTMLElement.prototype,Nu=e=>e&&(e.host||Nu(e.parentNode)),oC=(e,t)=>t.map(n=>{if(e.contains(n))return n;const s=Nu(n);return e.contains(s)?s:null}).filter(n=>n!=null);function aC(e,t,n,s){const i="data-floating-ui-inert",r=s?"inert":n?"aria-hidden":null,o=oC(t,e),a=new Set,c=new Set(o),u=[];Is[i]||(Is[i]=new WeakMap);const d=Is[i];o.forEach(p),l(t),a.clear();function p(h){!h||a.has(h)||(a.add(h),h.parentNode&&p(h.parentNode))}function l(h){!h||c.has(h)||[].forEach.call(h.children,m=>{if(nn(m)!=="script")if(a.has(m))l(m);else{const f=r?m.getAttribute(r):null,g=f!==null&&f!=="false",S=Ga(r),C=(S.get(m)||0)+1,y=(d.get(m)||0)+1;S.set(m,C),d.set(m,y),u.push(m),C===1&&g&&_s.add(m),y===1&&m.setAttribute(i,""),!g&&r&&m.setAttribute(r,r==="inert"?"":"true")}})}return lr++,()=>{u.forEach(h=>{const m=Ga(r),g=(m.get(h)||0)-1,S=(d.get(h)||0)-1;m.set(h,g),d.set(h,S),g||(!_s.has(h)&&r&&h.removeAttribute(r),_s.delete(h)),S||h.removeAttribute(i)}),lr--,lr||(Tn.inert=new WeakMap,Tn["aria-hidden"]=new WeakMap,Tn.none=new WeakMap,_s=new WeakSet,Is={})}}function Ka(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);const s=iC(e[0]).body;return aC(e.concat(Array.from(s.querySelectorAll('[aria-live],[role="status"],output'))),s,t,n)}const $i={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0},gi=v.forwardRef(function(t,n){const[s,i]=v.useState();be(()=>{WS()&&i("button")},[]);const r={ref:n,tabIndex:0,role:s,"aria-hidden":s?void 0:!0,[ss("focus-guard")]:"",style:$i};return b.jsx("span",{...t,...r})}),Lu=v.createContext(null),Ja=ss("portal");function cC(e){e===void 0&&(e={});const{id:t,root:n}=e,s=Fi(),i=Mu(),[r,o]=v.useState(null),a=v.useRef(null);return be(()=>()=>{r?.remove(),queueMicrotask(()=>{a.current=null})},[r]),be(()=>{if(!s||a.current)return;const c=t?document.getElementById(t):null;if(!c)return;const u=document.createElement("div");u.id=s,u.setAttribute(Ja,""),c.appendChild(u),a.current=u,o(u)},[t,s]),be(()=>{if(n===null||!s||a.current)return;let c=n||i?.portalNode;c&&!bo(c)&&(c=c.current),c=c||document.body;let u=null;t&&(u=document.createElement("div"),u.id=t,c.appendChild(u));const d=document.createElement("div");d.id=s,d.setAttribute(Ja,""),c=u||c,c.appendChild(d),a.current=d,o(d)},[t,n,s,i]),r}function lC(e){const{children:t,id:n,root:s,preserveTabOrder:i=!0}=e,r=cC({id:n,root:s}),[o,a]=v.useState(null),c=v.useRef(null),u=v.useRef(null),d=v.useRef(null),p=v.useRef(null),l=o?.modal,h=o?.open,m=!!o&&!o.modal&&o.open&&i&&!!(s||r);return v.useEffect(()=>{if(!r||!i||l)return;function f(g){r&&Kn(g)&&(g.type==="focusin"?Na:cy)(r)}return r.addEventListener("focusin",f,!0),r.addEventListener("focusout",f,!0),()=>{r.removeEventListener("focusin",f,!0),r.removeEventListener("focusout",f,!0)}},[r,i,l]),v.useEffect(()=>{r&&(h||Na(r))},[h,r]),b.jsxs(Lu.Provider,{value:v.useMemo(()=>({preserveTabOrder:i,beforeOutsideRef:c,afterOutsideRef:u,beforeInsideRef:d,afterInsideRef:p,portalNode:r,setFocusManagerState:a}),[i,r]),children:[m&&r&&b.jsx(gi,{"data-type":"outside",ref:c,onFocus:f=>{if(Kn(f,r)){var g;(g=d.current)==null||g.focus()}else{const S=o?o.domReference:null,C=Tu(S);C?.focus()}}}),m&&r&&b.jsx("span",{"aria-owns":r.id,style:$i}),r&&cc.createPortal(t,r),m&&r&&b.jsx(gi,{"data-type":"outside",ref:u,onFocus:f=>{if(Kn(f,r)){var g;(g=p.current)==null||g.focus()}else{const S=o?o.domReference:null,C=Cu(S);C?.focus(),o?.closeOnFocusOut&&o?.onOpenChange(!1,f.nativeEvent,"focus-out")}}})]})}const Mu=()=>v.useContext(Lu);function za(e){return v.useMemo(()=>t=>{e.forEach(n=>{n&&(n.current=t)})},e)}const uC=20;let Kt=[];function wo(){Kt=Kt.filter(e=>e.isConnected)}function dC(e){wo(),e&&nn(e)!=="body"&&(Kt.push(e),Kt.length>uC&&(Kt=Kt.slice(-20)))}function Ya(){return wo(),Kt[Kt.length-1]}function hC(e){const t=ds();return pu(e,t)?e:Li(e,t)[0]||e}function Xa(e,t){var n;if(!t.current.includes("floating")&&!((n=e.getAttribute("role"))!=null&&n.includes("dialog")))return;const s=ds(),r=qS(e,s).filter(a=>{const c=a.getAttribute("data-tabindex")||"";return pu(a,s)||a.hasAttribute("data-tabindex")&&!c.startsWith("-")}),o=e.getAttribute("tabindex");t.current.includes("floating")||r.length===0?o!=="0"&&e.setAttribute("tabindex","0"):(o!=="-1"||e.hasAttribute("data-tabindex")&&e.getAttribute("data-tabindex")!=="-1")&&(e.setAttribute("tabindex","-1"),e.setAttribute("data-tabindex","-1"))}const fC=v.forwardRef(function(t,n){return b.jsx("button",{...t,type:"button",ref:n,tabIndex:-1,style:$i})});function pC(e){const{context:t,children:n,disabled:s=!1,order:i=["content"],guards:r=!0,initialFocus:o=0,returnFocus:a=!0,restoreFocus:c=!1,modal:u=!0,visuallyHiddenDismiss:d=!1,closeOnFocusOut:p=!0,outsideElementsInert:l=!1,getInsideElements:h=()=>[]}=e,{open:m,onOpenChange:f,events:g,dataRef:S,elements:{domReference:C,floating:y}}=t,T=qe(()=>{var X;return(X=S.current.floatingContext)==null?void 0:X.nodeId}),k=qe(h),I=typeof o=="number"&&o<0,R=Br(C)&&I,A=rC(),B=A?r:!0,N=!B||A&&l,$=Et(i),j=Et(o),D=Et(a),E=Ui(),O=Mu(),U=v.useRef(null),H=v.useRef(null),_=v.useRef(!1),G=v.useRef(!1),se=v.useRef(-1),De=v.useRef(-1),Ke=O!=null,ne=pi(y),Te=qe(function(X){return X===void 0&&(X=ne),X?Li(X,ds()):[]}),he=qe(X=>{const ie=Te(X);return $.current.map(Q=>C&&Q==="reference"?C:ne&&Q==="floating"?ne:ie).filter(Boolean).flat()});v.useEffect(()=>{if(s||!u)return;function X(Q){if(Q.key==="Tab"){nt(ne,Wt(dt(ne)))&&Te().length===0&&!R&&Ve(Q);const fe=he(),Se=Gt(Q);$.current[0]==="reference"&&Se===C&&(Ve(Q),Q.shiftKey?sn(fe[fe.length-1]):sn(fe[1])),$.current[1]==="floating"&&Se===ne&&Q.shiftKey&&(Ve(Q),sn(fe[0]))}}const ie=dt(ne);return ie.addEventListener("keydown",X),()=>{ie.removeEventListener("keydown",X)}},[s,C,ne,u,$,R,Te,he]),v.useEffect(()=>{if(s||!y)return;function X(ie){const Q=Gt(ie),Se=Te().indexOf(Q);Se!==-1&&(se.current=Se)}return y.addEventListener("focusin",X),()=>{y.removeEventListener("focusin",X)}},[s,y,Te]),v.useEffect(()=>{if(s||!p)return;function X(){G.current=!0,setTimeout(()=>{G.current=!1})}function ie(Se){const re=Se.relatedTarget,Pe=Se.currentTarget,xe=Gt(Se);queueMicrotask(()=>{const ke=T(),ct=!(nt(C,re)||nt(y,re)||nt(re,y)||nt(O?.portalNode,re)||re!=null&&re.hasAttribute(ss("focus-guard"))||E&&(rn(E.nodesRef.current,ke).find(F=>{var z,M;return nt((z=F.context)==null?void 0:z.elements.floating,re)||nt((M=F.context)==null?void 0:M.elements.domReference,re)})||Oa(E.nodesRef.current,ke).find(F=>{var z,M,ue;return[(z=F.context)==null?void 0:z.elements.floating,pi((M=F.context)==null?void 0:M.elements.floating)].includes(re)||((ue=F.context)==null?void 0:ue.elements.domReference)===re})));if(Pe===C&&ne&&Xa(ne,$),c&&Pe!==C&&!(xe!=null&&xe.isConnected)&&Wt(dt(ne))===dt(ne).body){Ae(ne)&&ne.focus();const F=se.current,z=Te(),M=z[F]||z[z.length-1]||ne;Ae(M)&&M.focus()}if(S.current.insideReactTree){S.current.insideReactTree=!1;return}(R||!u)&&re&&ct&&!G.current&&re!==Ya()&&(_.current=!0,f(!1,Se,"focus-out"))})}const Q=!!(!E&&O);function fe(){Hr(De),S.current.insideReactTree=!0,De.current=window.setTimeout(()=>{S.current.insideReactTree=!1})}if(y&&Ae(C))return C.addEventListener("focusout",ie),C.addEventListener("pointerdown",X),y.addEventListener("focusout",ie),Q&&y.addEventListener("focusout",fe,!0),()=>{C.removeEventListener("focusout",ie),C.removeEventListener("pointerdown",X),y.removeEventListener("focusout",ie),Q&&y.removeEventListener("focusout",fe,!0)}},[s,C,y,ne,u,E,O,f,p,c,Te,R,T,$,S]);const ve=v.useRef(null),Je=v.useRef(null),pt=za([ve,O?.beforeInsideRef]),Dt=za([Je,O?.afterInsideRef]);v.useEffect(()=>{var X,ie;if(s||!y)return;const Q=Array.from((O==null||(X=O.portalNode)==null?void 0:X.querySelectorAll("["+ss("portal")+"]"))||[]),Se=(ie=(E?Oa(E.nodesRef.current,T()):[]).find(xe=>{var ke;return Br(((ke=xe.context)==null?void 0:ke.elements.domReference)||null)}))==null||(ie=ie.context)==null?void 0:ie.elements.domReference,re=[y,Se,...Q,...k(),U.current,H.current,ve.current,Je.current,O?.beforeOutsideRef.current,O?.afterOutsideRef.current,$.current.includes("reference")||R?C:null].filter(xe=>xe!=null),Pe=u||R?Ka(re,!N,N):Ka(re);return()=>{Pe()}},[s,C,y,u,$,O,R,B,N,E,T,k]),be(()=>{if(s||!Ae(ne))return;const X=dt(ne),ie=Wt(X);queueMicrotask(()=>{const Q=he(ne),fe=j.current,Se=(typeof fe=="number"?Q[fe]:fe.current)||ne,re=nt(ne,ie);!I&&!re&&m&&sn(Se,{preventScroll:Se===ne})})},[s,m,ne,I,he,j]),be(()=>{if(s||!ne)return;const X=dt(ne),ie=Wt(X);dC(ie);function Q(re){let{reason:Pe,event:xe,nested:ke}=re;if(["hover","safe-polygon"].includes(Pe)&&xe.type==="mouseleave"&&(_.current=!0),Pe==="outside-press")if(ke)_.current=!1;else if(vu(xe)||Su(xe))_.current=!1;else{let ct=!1;document.createElement("div").focus({get preventScroll(){return ct=!0,!1}}),ct?_.current=!1:_.current=!0}}g.on("openchange",Q);const fe=X.createElement("span");fe.setAttribute("tabindex","-1"),fe.setAttribute("aria-hidden","true"),Object.assign(fe.style,$i),Ke&&C&&C.insertAdjacentElement("afterend",fe);function Se(){if(typeof D.current=="boolean"){const re=C||Ya();return re&&re.isConnected?re:fe}return D.current.current||fe}return()=>{g.off("openchange",Q);const re=Wt(X),Pe=nt(y,re)||E&&rn(E.nodesRef.current,T(),!1).some(ke=>{var ct;return nt((ct=ke.context)==null?void 0:ct.elements.floating,re)}),xe=Se();queueMicrotask(()=>{const ke=hC(xe);D.current&&!_.current&&Ae(ke)&&(!(ke!==re&&re!==X.body)||Pe)&&ke.focus({preventScroll:!0}),fe.remove()})}},[s,y,ne,D,S,g,E,Ke,C,T]),v.useEffect(()=>(queueMicrotask(()=>{_.current=!1}),()=>{queueMicrotask(wo)}),[s]),be(()=>{if(!s&&O)return O.setFocusManagerState({modal:u,closeOnFocusOut:p,open:m,onOpenChange:f,domReference:C}),()=>{O.setFocusManagerState(null)}},[s,O,u,m,f,p,C]),be(()=>{s||ne&&Xa(ne,$)},[s,ne,$]);function Xe(X){return s||!d||!u?null:b.jsx(fC,{ref:X==="start"?U:H,onClick:ie=>f(!1,ie.nativeEvent),children:typeof d=="string"?d:"Dismiss"})}const Tt=!s&&B&&(u?!R:!0)&&(Ke||u);return b.jsxs(b.Fragment,{children:[Tt&&b.jsx(gi,{"data-type":"inside",ref:pt,onFocus:X=>{if(u){const Q=he();sn(i[0]==="reference"?Q[0]:Q[Q.length-1])}else if(O!=null&&O.preserveTabOrder&&O.portalNode)if(_.current=!1,Kn(X,O.portalNode)){const Q=Cu(C);Q?.focus()}else{var ie;(ie=O.beforeOutsideRef.current)==null||ie.focus()}}}),!R&&Xe("start"),n,Xe("end"),Tt&&b.jsx(gi,{"data-type":"inside",ref:Dt,onFocus:X=>{if(u)sn(he()[0]);else if(O!=null&&O.preserveTabOrder&&O.portalNode)if(p&&(_.current=!0),Kn(X,O.portalNode)){const Q=Tu(C);Q?.focus()}else{var ie;(ie=O.afterOutsideRef.current)==null||ie.focus()}}})]})}let Rs=0;const Za="--floating-ui-scrollbar-width";function mC(){const e=mu(),t=/iP(hone|ad|od)|iOS/.test(e)||e==="MacIntel"&&navigator.maxTouchPoints>1,n=document.body.style,i=Math.round(document.documentElement.getBoundingClientRect().left)+document.documentElement.scrollLeft?"paddingLeft":"paddingRight",r=window.innerWidth-document.documentElement.clientWidth,o=n.left?parseFloat(n.left):window.scrollX,a=n.top?parseFloat(n.top):window.scrollY;if(n.overflow="hidden",n.setProperty(Za,r+"px"),r&&(n[i]=r+"px"),t){var c,u;const d=((c=window.visualViewport)==null?void 0:c.offsetLeft)||0,p=((u=window.visualViewport)==null?void 0:u.offsetTop)||0;Object.assign(n,{position:"fixed",top:-(a-Math.floor(p))+"px",left:-(o-Math.floor(d))+"px",right:"0"})}return()=>{Object.assign(n,{overflow:"",[i]:""}),n.removeProperty(Za),t&&(Object.assign(n,{position:"",top:"",left:"",right:""}),window.scrollTo(o,a))}}let Qa=()=>{};const gC=v.forwardRef(function(t,n){const{lockScroll:s=!1,...i}=t;return be(()=>{if(s)return Rs++,Rs===1&&(Qa=mC()),()=>{Rs--,Rs===0&&Qa()}},[s]),b.jsx("div",{ref:n,...i,style:{position:"fixed",overflow:"auto",top:0,right:0,bottom:0,left:0,...i.style}})});function ec(e){return Ae(e.target)&&e.target.tagName==="BUTTON"}function bC(e){return Ae(e.target)&&e.target.tagName==="A"}function tc(e){return bu(e)}function vC(e,t){t===void 0&&(t={});const{open:n,onOpenChange:s,dataRef:i,elements:{domReference:r}}=e,{enabled:o=!0,event:a="click",toggle:c=!0,ignoreMouse:u=!1,keyboardHandlers:d=!0,stickIfOpen:p=!0}=t,l=v.useRef(),h=v.useRef(!1),m=v.useMemo(()=>({onPointerDown(f){l.current=f.pointerType},onMouseDown(f){const g=l.current;f.button===0&&a!=="click"&&(Aa(g)&&u||(n&&c&&(!(i.current.openEvent&&p)||i.current.openEvent.type==="mousedown")?s(!1,f.nativeEvent,"click"):(f.preventDefault(),s(!0,f.nativeEvent,"click"))))},onClick(f){const g=l.current;if(a==="mousedown"&&l.current){l.current=void 0;return}Aa(g)&&u||(n&&c&&(!(i.current.openEvent&&p)||i.current.openEvent.type==="click")?s(!1,f.nativeEvent,"click"):s(!0,f.nativeEvent,"click"))},onKeyDown(f){l.current=void 0,!(f.defaultPrevented||!d||ec(f))&&(f.key===" "&&!tc(r)&&(f.preventDefault(),h.current=!0),!bC(f)&&f.key==="Enter"&&s(!(n&&c),f.nativeEvent,"click"))},onKeyUp(f){f.defaultPrevented||!d||ec(f)||tc(r)||f.key===" "&&h.current&&(h.current=!1,s(!(n&&c),f.nativeEvent,"click"))}}),[i,r,a,u,d,s,n,p,c]);return v.useMemo(()=>o?{reference:m}:{},[o,m])}const SC={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},yC={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},nc=e=>{var t,n;return{escapeKey:typeof e=="boolean"?e:(t=e?.escapeKey)!=null?t:!1,outsidePress:typeof e=="boolean"?e:(n=e?.outsidePress)!=null?n:!0}};function CC(e,t){t===void 0&&(t={});const{open:n,onOpenChange:s,elements:i,dataRef:r}=e,{enabled:o=!0,escapeKey:a=!0,outsidePress:c=!0,outsidePressEvent:u="pointerdown",referencePress:d=!1,referencePressEvent:p="pointerdown",ancestorScroll:l=!1,bubbles:h,capture:m}=t,f=Ui(),g=qe(typeof c=="function"?c:()=>!1),S=typeof c=="function"?g:c,C=v.useRef(!1),{escapeKey:y,outsidePress:T}=nc(h),{escapeKey:k,outsidePress:I}=nc(m),R=v.useRef(!1),A=qe(E=>{var O;if(!n||!o||!a||E.key!=="Escape"||R.current)return;const U=(O=r.current.floatingContext)==null?void 0:O.nodeId,H=f?rn(f.nodesRef.current,U):[];if(!y&&(E.stopPropagation(),H.length>0)){let _=!0;if(H.forEach(G=>{var se;if((se=G.context)!=null&&se.open&&!G.context.dataRef.current.__escapeKeyBubbles){_=!1;return}}),!_)return}s(!1,ZS(E)?E.nativeEvent:E,"escape-key")}),B=qe(E=>{var O;const U=()=>{var H;A(E),(H=Gt(E))==null||H.removeEventListener("keydown",U)};(O=Gt(E))==null||O.addEventListener("keydown",U)}),N=qe(E=>{var O;const U=r.current.insideReactTree;r.current.insideReactTree=!1;const H=C.current;if(C.current=!1,u==="click"&&H||U||typeof S=="function"&&!S(E))return;const _=Gt(E),G="["+ss("inert")+"]",se=dt(i.floating).querySelectorAll(G);let De=Re(_)?_:null;for(;De&&!jt(De);){const he=Vt(De);if(jt(he)||!Re(he))break;De=he}if(se.length&&Re(_)&&!YS(_)&&!nt(_,i.floating)&&Array.from(se).every(he=>!nt(De,he)))return;if(Ae(_)&&D){const he=jt(_),ve=at(_),Je=/auto|scroll/,pt=he||Je.test(ve.overflowX),Dt=he||Je.test(ve.overflowY),Xe=pt&&_.clientWidth>0&&_.scrollWidth>_.clientWidth,Tt=Dt&&_.clientHeight>0&&_.scrollHeight>_.clientHeight,X=ve.direction==="rtl",ie=Tt&&(X?E.offsetX<=_.offsetWidth-_.clientWidth:E.offsetX>_.clientWidth),Q=Xe&&E.offsetY>_.clientHeight;if(ie||Q)return}const Ke=(O=r.current.floatingContext)==null?void 0:O.nodeId,ne=f&&rn(f.nodesRef.current,Ke).some(he=>{var ve;return rr(E,(ve=he.context)==null?void 0:ve.elements.floating)});if(rr(E,i.floating)||rr(E,i.domReference)||ne)return;const Te=f?rn(f.nodesRef.current,Ke):[];if(Te.length>0){let he=!0;if(Te.forEach(ve=>{var Je;if((Je=ve.context)!=null&&Je.open&&!ve.context.dataRef.current.__outsidePressBubbles){he=!1;return}}),!he)return}s(!1,E,"outside-press")}),$=qe(E=>{var O;const U=()=>{var H;N(E),(H=Gt(E))==null||H.removeEventListener(u,U)};(O=Gt(E))==null||O.addEventListener(u,U)});v.useEffect(()=>{if(!n||!o)return;r.current.__escapeKeyBubbles=y,r.current.__outsidePressBubbles=T;let E=-1;function O(se){s(!1,se,"ancestor-scroll")}function U(){window.clearTimeout(E),R.current=!0}function H(){E=window.setTimeout(()=>{R.current=!1},Di()?5:0)}const _=dt(i.floating);a&&(_.addEventListener("keydown",k?B:A,k),_.addEventListener("compositionstart",U),_.addEventListener("compositionend",H)),S&&_.addEventListener(u,I?$:N,I);let G=[];return l&&(Re(i.domReference)&&(G=Xt(i.domReference)),Re(i.floating)&&(G=G.concat(Xt(i.floating))),!Re(i.reference)&&i.reference&&i.reference.contextElement&&(G=G.concat(Xt(i.reference.contextElement)))),G=G.filter(se=>{var De;return se!==((De=_.defaultView)==null?void 0:De.visualViewport)}),G.forEach(se=>{se.addEventListener("scroll",O,{passive:!0})}),()=>{a&&(_.removeEventListener("keydown",k?B:A,k),_.removeEventListener("compositionstart",U),_.removeEventListener("compositionend",H)),S&&_.removeEventListener(u,I?$:N,I),G.forEach(se=>{se.removeEventListener("scroll",O)}),window.clearTimeout(E)}},[r,i,a,S,u,n,s,l,o,y,T,A,k,B,N,I,$]),v.useEffect(()=>{r.current.insideReactTree=!1},[r,S,u]);const j=v.useMemo(()=>({onKeyDown:A,...d&&{[SC[p]]:E=>{s(!1,E.nativeEvent,"reference-press")},...p!=="click"&&{onClick(E){s(!1,E.nativeEvent,"reference-press")}}}}),[A,s,d,p]),D=v.useMemo(()=>({onKeyDown:A,onMouseDown(){C.current=!0},onMouseUp(){C.current=!0},[yC[u]]:()=>{r.current.insideReactTree=!0}}),[A,u,r]);return v.useMemo(()=>o?{reference:j,floating:D}:{},[o,j,D])}function TC(e){const{open:t=!1,onOpenChange:n,elements:s}=e,i=Fi(),r=v.useRef({}),[o]=v.useState(()=>tC()),a=ko()!=null,[c,u]=v.useState(s.reference),d=qe((h,m,f)=>{r.current.openEvent=h?m:void 0,o.emit("openchange",{open:h,event:m,reason:f,nested:a}),n?.(h,m,f)}),p=v.useMemo(()=>({setPositionReference:u}),[]),l=v.useMemo(()=>({reference:c||s.reference||null,floating:s.floating||null,domReference:s.reference}),[c,s.reference,s.floating]);return v.useMemo(()=>({dataRef:r,open:t,onOpenChange:d,elements:l,events:o,floatingId:i,refs:p}),[t,d,l,o,i,p])}function ju(e){e===void 0&&(e={});const{nodeId:t}=e,n=TC({...e,elements:{reference:null,floating:null,...e.elements}}),s=e.rootContext||n,i=s.elements,[r,o]=v.useState(null),[a,c]=v.useState(null),d=i?.domReference||r,p=v.useRef(null),l=Ui();be(()=>{d&&(p.current=d)},[d]);const h=$y({...e,elements:{...i,...a&&{reference:a}}}),m=v.useCallback(y=>{const T=Re(y)?{getBoundingClientRect:()=>y.getBoundingClientRect(),getClientRects:()=>y.getClientRects(),contextElement:y}:y;c(T),h.refs.setReference(T)},[h.refs]),f=v.useCallback(y=>{(Re(y)||y===null)&&(p.current=y,o(y)),(Re(h.refs.reference.current)||h.refs.reference.current===null||y!==null&&!Re(y))&&h.refs.setReference(y)},[h.refs]),g=v.useMemo(()=>({...h.refs,setReference:f,setPositionReference:m,domReference:p}),[h.refs,f,m]),S=v.useMemo(()=>({...h.elements,domReference:d}),[h.elements,d]),C=v.useMemo(()=>({...h,...s,refs:g,elements:S,nodeId:t}),[h,g,S,t,s]);return be(()=>{s.dataRef.current.floatingContext=C;const y=l?.nodesRef.current.find(T=>T.id===t);y&&(y.context=C)}),v.useMemo(()=>({...h,context:C,refs:g,elements:S}),[h,g,S,C])}function ur(e,t,n){const s=new Map,i=n==="item";let r=e;if(i&&e){const{[Va]:o,[Ba]:a,...c}=e;r=c}return{...n==="floating"&&{tabIndex:-1,[zy]:""},...r,...t.map(o=>{const a=o?o[n]:null;return typeof a=="function"?e?a(e):null:a}).concat(e).reduce((o,a)=>(a&&Object.entries(a).forEach(c=>{let[u,d]=c;if(!(i&&[Va,Ba].includes(u)))if(u.indexOf("on")===0){if(s.has(u)||s.set(u,[]),typeof d=="function"){var p;(p=s.get(u))==null||p.push(d),o[u]=function(){for(var l,h=arguments.length,m=new Array(h),f=0;f<h;f++)m[f]=arguments[f];return(l=s.get(u))==null?void 0:l.map(g=>g(...m)).find(g=>g!==void 0)}}}else o[u]=d}),o),{})}}function kC(e){e===void 0&&(e=[]);const t=e.map(a=>a?.reference),n=e.map(a=>a?.floating),s=e.map(a=>a?.item),i=v.useCallback(a=>ur(a,e,"reference"),t),r=v.useCallback(a=>ur(a,e,"floating"),n),o=v.useCallback(a=>ur(a,e,"item"),s);return v.useMemo(()=>({getReferenceProps:i,getFloatingProps:r,getItemProps:o}),[i,r,o])}const wC="Escape";function Vi(e,t,n){switch(e){case"vertical":return t;case"horizontal":return n;default:return t||n}}function Ps(e,t){return Vi(t,e===Du||e===ji,e===hs||e===fs)}function dr(e,t,n){return Vi(t,e===ji,n?e===hs:e===fs)||e==="Enter"||e===" "||e===""}function sc(e,t,n){return Vi(t,n?e===hs:e===fs,e===ji)}function ic(e,t,n,s){const i=n?e===fs:e===hs,r=e===Du;return t==="both"||t==="horizontal"&&s&&s>1?e===wC:Vi(t,i,r)}function EC(e,t){const{open:n,onOpenChange:s,elements:i,floatingId:r}=e,{listRef:o,activeIndex:a,onNavigate:c=()=>{},enabled:u=!0,selectedIndex:d=null,allowEscape:p=!1,loop:l=!1,nested:h=!1,rtl:m=!1,virtual:f=!1,focusItemOnOpen:g="auto",focusItemOnHover:S=!0,openOnArrowKeyDown:C=!0,disabledIndices:y=void 0,orientation:T="vertical",parentOrientation:k,cols:I=1,scrollItemIntoView:R=!0,virtualItemRef:A,itemSizes:B,dense:N=!1}=t,$=pi(i.floating),j=Et($),D=ko(),E=Ui();be(()=>{e.dataRef.current.orientation=T},[e,T]);const O=qe(()=>{c(_.current===-1?null:_.current)}),U=Br(i.domReference),H=v.useRef(g),_=v.useRef(d??-1),G=v.useRef(null),se=v.useRef(!0),De=v.useRef(O),Ke=v.useRef(!!i.floating),ne=v.useRef(n),Te=v.useRef(!1),he=v.useRef(!1),ve=Et(y),Je=Et(n),pt=Et(R),Dt=Et(d),[Xe,Tt]=v.useState(),[X,ie]=v.useState(),Q=qe(()=>{function F(pe){if(f){var Ce;(Ce=pe.id)!=null&&Ce.endsWith("-fui-option")&&(pe.id=r+"-"+Math.random().toString(16).slice(2,10)),Tt(pe.id),E?.events.emit("virtualfocus",pe),A&&(A.current=pe)}else sn(pe,{sync:Te.current,preventScroll:!0})}const z=o.current[_.current],M=he.current;z&&F(z),(Te.current?pe=>pe():requestAnimationFrame)(()=>{const pe=o.current[_.current]||z;if(!pe)return;z||F(pe);const Ce=pt.current;Ce&&Se&&(M||!se.current)&&(pe.scrollIntoView==null||pe.scrollIntoView(typeof Ce=="boolean"?{block:"nearest",inline:"nearest"}:Ce))})});be(()=>{u&&(n&&i.floating?H.current&&d!=null&&(he.current=!0,_.current=d,O()):Ke.current&&(_.current=-1,De.current()))},[u,n,i.floating,d,O]),be(()=>{if(u&&n&&i.floating)if(a==null){if(Te.current=!1,Dt.current!=null)return;if(Ke.current&&(_.current=-1,Q()),(!ne.current||!Ke.current)&&H.current&&(G.current!=null||H.current===!0&&G.current==null)){let F=0;const z=()=>{o.current[0]==null?(F<2&&(F?requestAnimationFrame:queueMicrotask)(z),F++):(_.current=G.current==null||dr(G.current,T,m)||h?or(o,ve.current):Da(o,ve.current),G.current=null,O())};z()}}else Gn(o,a)||(_.current=a,Q(),he.current=!1)},[u,n,i.floating,a,Dt,h,o,T,m,O,Q,ve]),be(()=>{var F;if(!u||i.floating||!E||f||!Ke.current)return;const z=E.nodesRef.current,M=(F=z.find(Ce=>Ce.id===D))==null||(F=F.context)==null?void 0:F.elements.floating,ue=Wt(dt(i.floating)),pe=z.some(Ce=>Ce.context&&nt(Ce.context.elements.floating,ue));M&&!pe&&se.current&&M.focus({preventScroll:!0})},[u,i.floating,E,D,f]),be(()=>{if(!u||!E||!f||D)return;function F(z){ie(z.id),A&&(A.current=z)}return E.events.on("virtualfocus",F),()=>{E.events.off("virtualfocus",F)}},[u,E,f,D,A]),be(()=>{De.current=O,ne.current=n,Ke.current=!!i.floating}),be(()=>{n||(G.current=null,H.current=g)},[n,g]);const fe=a!=null,Se=v.useMemo(()=>{function F(M){if(!Je.current)return;const ue=o.current.indexOf(M);ue!==-1&&_.current!==ue&&(_.current=ue,O())}return{onFocus(M){let{currentTarget:ue}=M;Te.current=!0,F(ue)},onClick:M=>{let{currentTarget:ue}=M;return ue.focus({preventScroll:!0})},onMouseMove(M){let{currentTarget:ue}=M;Te.current=!0,he.current=!1,S&&F(ue)},onPointerLeave(M){let{pointerType:ue}=M;if(!(!se.current||ue==="touch")&&(Te.current=!0,!!S&&(_.current=-1,O(),!f))){var pe;(pe=j.current)==null||pe.focus({preventScroll:!0})}}}},[Je,j,S,o,O,f]),re=v.useCallback(()=>{var F;return k??(E==null||(F=E.nodesRef.current.find(z=>z.id===D))==null||(F=F.context)==null||(F=F.dataRef)==null?void 0:F.current.orientation)},[D,E,k]),Pe=qe(F=>{if(se.current=!1,Te.current=!0,F.which===229||!Je.current&&F.currentTarget===j.current)return;if(h&&ic(F.key,T,m,I)){Ps(F.key,re())||Ve(F),s(!1,F.nativeEvent,"list-navigation"),Ae(i.domReference)&&(f?E?.events.emit("virtualfocus",i.domReference):i.domReference.focus());return}const z=_.current,M=or(o,y),ue=Da(o,y);if(U||(F.key==="Home"&&(Ve(F),_.current=M,O()),F.key==="End"&&(Ve(F),_.current=ue,O())),I>1){const pe=B||Array.from({length:o.current.length},()=>({width:1,height:1})),Ce=ry(pe,I,N),Ue=Ce.findIndex(K=>K!=null&&!Fs(o,K,y)),mt=Ce.reduce((K,ee,J)=>ee!=null&&!Fs(o,ee,y)?J:K,-1),kt=Ce[iy({current:Ce.map(K=>K!=null?o.current[K]:null)},{event:F,orientation:T,loop:l,rtl:m,cols:I,disabledIndices:ay([...(typeof y!="function"?y:null)||o.current.map((K,ee)=>Fs(o,ee,y)?ee:void 0),void 0],Ce),minIndex:Ue,maxIndex:mt,prevIndex:oy(_.current>ue?M:_.current,pe,Ce,I,F.key===ji?"bl":F.key===(m?hs:fs)?"tr":"tl"),stopEvent:!0})];if(kt!=null&&(_.current=kt,O()),T==="both")return}if(Ps(F.key,T)){if(Ve(F),n&&!f&&Wt(F.currentTarget.ownerDocument)===F.currentTarget){_.current=dr(F.key,T,m)?M:ue,O();return}dr(F.key,T,m)?l?_.current=z>=ue?p&&z!==o.current.length?-1:M:ze(o,{startingIndex:z,disabledIndices:y}):_.current=Math.min(ue,ze(o,{startingIndex:z,disabledIndices:y})):l?_.current=z<=M?p&&z!==-1?o.current.length:ue:ze(o,{startingIndex:z,decrement:!0,disabledIndices:y}):_.current=Math.max(M,ze(o,{startingIndex:z,decrement:!0,disabledIndices:y})),Gn(o,_.current)&&(_.current=-1),O()}}),xe=v.useMemo(()=>f&&n&&fe&&{"aria-activedescendant":X||Xe},[f,n,fe,X,Xe]),ke=v.useMemo(()=>({"aria-orientation":T==="both"?void 0:T,...U?{}:xe,onKeyDown:Pe,onPointerMove(){se.current=!0}}),[xe,Pe,T,U]),ct=v.useMemo(()=>{function F(M){g==="auto"&&vu(M.nativeEvent)&&(H.current=!0)}function z(M){H.current=g,g==="auto"&&Su(M.nativeEvent)&&(H.current=!0)}return{...xe,onKeyDown(M){se.current=!1;const ue=M.key.startsWith("Arrow"),pe=["Home","End"].includes(M.key),Ce=ue||pe,Ue=sc(M.key,T,m),mt=ic(M.key,T,m,I),kt=sc(M.key,re(),m),K=Ps(M.key,T),ee=(h?kt:K)||M.key==="Enter"||M.key.trim()==="";if(f&&n){const Ze=E?.nodesRef.current.find(W=>W.parentId==null),te=E&&Ze?XS(E.nodesRef.current,Ze.id):null;if(Ce&&te&&A){const W=new KeyboardEvent("keydown",{key:M.key,bubbles:!0});if(Ue||mt){var J,de;const ut=((J=te.context)==null?void 0:J.elements.domReference)===M.currentTarget,mn=mt&&!ut?(de=te.context)==null?void 0:de.elements.domReference:Ue?o.current.find(Ln=>Ln?.id===Xe):null;mn&&(Ve(M),mn.dispatchEvent(W),ie(void 0))}if((K||pe)&&te.context&&te.context.open&&te.parentId&&M.currentTarget!==te.context.elements.domReference){var lt;Ve(M),(lt=te.context.elements.domReference)==null||lt.dispatchEvent(W);return}}return Pe(M)}if(!(!n&&!C&&ue)){if(ee){const Ze=Ps(M.key,re());G.current=h&&Ze?null:M.key}if(h){kt&&(Ve(M),n?(_.current=or(o,ve.current),O()):s(!0,M.nativeEvent,"list-navigation"));return}K&&(d!=null&&(_.current=d),Ve(M),!n&&C?s(!0,M.nativeEvent,"list-navigation"):Pe(M),n&&O())}},onFocus(){n&&!f&&(_.current=-1,O())},onPointerDown:z,onPointerEnter:z,onMouseDown:F,onClick:F}},[Xe,xe,I,Pe,ve,g,o,h,O,s,n,C,T,re,m,d,E,f,A]);return v.useMemo(()=>u?{reference:ct,floating:ke,item:Se}:{},[u,ct,ke,Se])}const _C=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function IC(e,t){var n,s;t===void 0&&(t={});const{open:i,elements:r,floatingId:o}=e,{enabled:a=!0,role:c="dialog"}=t,u=Fi(),d=((n=r.domReference)==null?void 0:n.id)||u,p=v.useMemo(()=>{var C;return((C=pi(r.floating))==null?void 0:C.id)||o},[r.floating,o]),l=(s=_C.get(c))!=null?s:c,m=ko()!=null,f=v.useMemo(()=>l==="tooltip"||c==="label"?{["aria-"+(c==="label"?"labelledby":"describedby")]:i?p:void 0}:{"aria-expanded":i?"true":"false","aria-haspopup":l==="alertdialog"?"dialog":l,"aria-controls":i?p:void 0,...l==="listbox"&&{role:"combobox"},...l==="menu"&&{id:d},...l==="menu"&&m&&{role:"menuitem"},...c==="select"&&{"aria-autocomplete":"none"},...c==="combobox"&&{"aria-autocomplete":"list"}},[l,p,m,i,d,c]),g=v.useMemo(()=>{const C={id:p,...l&&{role:l}};return l==="tooltip"||c==="label"?C:{...C,...l==="menu"&&{"aria-labelledby":d}}},[l,p,d,c]),S=v.useCallback(C=>{let{active:y,selected:T}=C;const k={role:"option",...y&&{id:p+"-fui-option"}};switch(c){case"select":case"combobox":return{...k,"aria-selected":T}}return{}},[p,c]);return v.useMemo(()=>a?{reference:f,floating:g,item:S}:{},[a,f,g,S])}function RC(e,t){var n;const{open:s,dataRef:i}=e,{listRef:r,activeIndex:o,onMatch:a,onTypingChange:c,enabled:u=!0,findMatch:d=null,resetMs:p=750,ignoreKeys:l=[],selectedIndex:h=null}=t,m=v.useRef(-1),f=v.useRef(""),g=v.useRef((n=h??o)!=null?n:-1),S=v.useRef(null),C=qe(a),y=qe(c),T=Et(d),k=Et(l);be(()=>{s&&(Hr(m),S.current=null,f.current="")},[s]),be(()=>{if(s&&f.current===""){var N;g.current=(N=h??o)!=null?N:-1}},[s,h,o]);const I=qe(N=>{N?i.current.typing||(i.current.typing=N,y(N)):i.current.typing&&(i.current.typing=N,y(N))}),R=qe(N=>{function $(U,H,_){const G=T.current?T.current(H,_):H.find(se=>se?.toLocaleLowerCase().indexOf(_.toLocaleLowerCase())===0);return G?U.indexOf(G):-1}const j=r.current;if(f.current.length>0&&f.current[0]!==" "&&($(j,j,f.current)===-1?I(!1):N.key===" "&&Ve(N)),j==null||k.current.includes(N.key)||N.key.length!==1||N.ctrlKey||N.metaKey||N.altKey)return;s&&N.key!==" "&&(Ve(N),I(!0)),j.every(U=>{var H,_;return U?((H=U[0])==null?void 0:H.toLocaleLowerCase())!==((_=U[1])==null?void 0:_.toLocaleLowerCase()):!0})&&f.current===N.key&&(f.current="",g.current=S.current),f.current+=N.key,Hr(m),m.current=window.setTimeout(()=>{f.current="",g.current=S.current,I(!1)},p);const E=g.current,O=$(j,[...j.slice((E||0)+1),...j.slice(0,(E||0)+1)],f.current);O!==-1?(C(O),S.current=O):N.key!==" "&&(f.current="",I(!1))}),A=v.useMemo(()=>({onKeyDown:R}),[R]),B=v.useMemo(()=>({onKeyDown:R,onKeyUp(N){N.key===" "&&I(!1)}}),[R,I]);return v.useMemo(()=>u?{reference:A,floating:B}:{},[u,A,B])}const is=({participant:e,trackType:t="audioTrack",...n})=>{const s=Me(),[i,r]=v.useState(null),{userId:o,sessionId:a}=e;return v.useEffect(()=>{if(!s||!i)return;const c=s.bindAudioElement(i,a,t);return()=>{c?.()}},[s,a,i,t]),b.jsx("audio",{autoPlay:!0,...n,ref:r,"data-user-id":o,"data-session-id":a,"data-track-type":t})};is.displayName="Audio";const Fu=e=>{const{participants:t,audioProps:n}=e;return b.jsx(b.Fragment,{children:t.map(s=>{if(s.isLocalParticipant)return null;const{audioStream:i,screenShareAudioStream:r,sessionId:o}=s,c=cn(s)&&i&&b.jsx(is,{...n,trackType:"audioTrack",participant:s}),d=ki(s)&&r&&b.jsx(is,{...n,trackType:"screenShareAudioTrack",participant:s});return b.jsxs(v.Fragment,{children:[c,d]},o)})})};Fu.displayName="ParticipantsAudio";const Uu=v.createContext(void 0),Bi=()=>v.useContext(Uu),Eo=({middleware:e=[],placement:t,strategy:n,offset:s=10})=>{const{refs:i,x:r,y:o,update:a,elements:{domReference:c,floating:u},context:d}=ju({placement:t,strategy:n,middleware:[By(s),Hy(),Ou(),qy({padding:10,apply:({availableHeight:p,elements:l})=>{Object.assign(l.floating.style,{maxHeight:`${p}px`})}}),...e]});return v.useEffect(()=>{if(!c||!u)return;const p=Pu(c,u,a);return()=>p()},[c,u,a]),{refs:i,x:r,y:o,domReference:c,floating:u,strategy:n,context:d}},$u=10,PC=(e,t=$u)=>{const[n,s]=v.useState(null);return v.useEffect(()=>{if(!e)return;const i=()=>{const o=e;if(!(o.scrollHeight>o.clientHeight))return s(null);if(o.scrollTop<=t)return s("top");if(Math.abs(o.scrollHeight-o.scrollTop-o.clientHeight)<=t)return s("bottom");s("between")},r=new ResizeObserver(i);return r.observe(e),e.addEventListener("scroll",i),()=>{e.removeEventListener("scroll",i),r.disconnect()}},[e,t]),n},xC=(e,t=$u)=>{const[n,s]=v.useState(null);return v.useEffect(()=>{if(!e)return;const i=()=>{const o=e;if(!(o.scrollWidth>o.clientWidth))return s(null);if(o.scrollLeft<=t)return s("start");if(Math.abs(o.scrollWidth-o.scrollLeft-o.clientWidth)<=t)return s("end");s("between")},r=new ResizeObserver(i);return r.observe(e),e.addEventListener("scroll",i),()=>{e.removeEventListener("scroll",i),r.disconnect()}},[e,t]),n},_o=e=>{const t=Me(),{useHasPermissions:n}=it(),s=n(e),[i,r]=v.useState(!1);return v.useEffect(()=>{s&&r(!1)},[s]),{requestPermission:v.useCallback(async()=>{if(s)return!0;const a=!!t?.permissionsContext.canRequest(e);if(i||!a)return!1;r(!0);try{await t?.requestPermissions({permissions:[e]})}catch(c){throw r(!1),new Error(`requestPermission failed: ${c}`)}return!1},[t,s,i,e]),hasPermission:s,canRequestPermission:!!t?.permissionsContext.canRequest(e),isAwaitingPermission:i}};function Vu(e,t){const{t:n}=Ge();return v.useMemo(()=>{let s=null,i=null;const r=e.map((o,a)=>{const c=o.deviceId===t,u={deviceId:o.deviceId,label:o.label,isSelected:c};return c&&(s=u,i=a),u});if(s===null||i===null){const o={deviceId:"default",label:n("Default"),isSelected:!0};s=o,i=0,r.unshift(o)}return{deviceList:r,selectedDeviceInfo:s,selectedIndex:i}},[e,t,n])}var kn;(function(e){e.PORTAL="portal",e.MENU="menu"})(kn||(kn={}));const Bu=v.createContext({}),Io=()=>v.useContext(Bu),OC=({children:e,refs:t})=>{const n=v.useMemo(()=>`str-video-portal-${Math.random().toString(36).substring(2,9)}`,[]);return b.jsxs(b.Fragment,{children:[b.jsx("div",{id:n,className:"str-video__portal"}),b.jsx(gC,{children:b.jsx(lC,{id:n,children:b.jsx("div",{className:"str-video__portal-content",ref:t.setFloating,children:e})})})]})},Ro=({ToggleButton:e,placement:t="top-start",strategy:n="absolute",offset:s,visualType:i=kn.MENU,children:r,onToggle:o})=>{const[a,c]=v.useState(!1),u=v.useRef(o);u.current=o;const{floating:d,domReference:p,refs:l,x:h,y:m}=Eo({placement:t,strategy:n,offset:s});return v.useEffect(()=>{const f=p?.ownerDocument,g=C=>{!d&&p?.contains(C.target)?(c(!0),u.current?.(!0)):d&&!d?.contains(C.target)&&(c(!1),u.current?.(!1))},S=C=>{C.key&&C.key.toLowerCase()==="escape"&&!C.altKey&&!C.ctrlKey&&(c(!1),u.current?.(!1))};return f?.addEventListener("click",g,{capture:!0}),f?.addEventListener("keydown",S),()=>{f?.removeEventListener("click",g,{capture:!0}),f?.removeEventListener("keydown",S)}},[d,p]),b.jsxs(b.Fragment,{children:[a&&b.jsx(Bu.Provider,{value:{close:()=>c(!1)},children:i===kn.PORTAL?b.jsx(OC,{refs:l,children:r}):i===kn.MENU?b.jsx("div",{className:"str-video__menu-container",ref:l.setFloating,style:{position:n,top:m??0,left:h??0,overflowY:"auto"},role:"menu",children:r}):null}),b.jsx(e,{menuShown:a,ref:l.setReference})]})},AC=({children:e,onItemClick:t})=>{const n=v.useRef(null);return b.jsx("ul",{className:"str-video__generic-menu",ref:n,onClick:s=>{t&&s.target!==n.current&&n.current?.contains(s.target)&&t(s)},children:e})},$e=({children:e,...t})=>b.jsx("li",{className:"str-video__generic-menu--item",children:b.jsx("button",{...t,children:e})}),we=({className:e,icon:t})=>b.jsx("span",{className:Le("str-video__icon",t&&`str-video__icon--${t}`,e)});function Hu(e){const[t,n]=v.useState(document.pictureInPictureElement===e);return!e&&t&&n(!1),v.useEffect(()=>{if(!e)return;const s=()=>{n(document.pictureInPictureElement===e)};return e.addEventListener("enterpictureinpicture",s),e.addEventListener("leavepictureinpicture",s),()=>{e.removeEventListener("enterpictureinpicture",s),e.removeEventListener("leavepictureinpicture",s)}},[e]),t}const DC=()=>{const{participant:e,participantViewElement:t,videoElement:n}=Bi(),[s,i]=v.useState(!!document.fullscreenElement),r=Me(),o=Hu(n??void 0),{t:a}=Ge(),{pin:c,sessionId:u,userId:d}=e,p=cn(e),l=Ut(e),h=$t(e),m=ki(e),f=()=>r?.blockUser(d),g=()=>r?.kickUser({user_id:d}),S=()=>r?.muteUser(d,"audio"),C=()=>r?.muteUser(d,"video"),y=()=>r?.muteUser(d,"screenshare"),T=()=>r?.muteUser(d,"screenshare_audio"),k=D=>()=>{r?.updateUserPermissions({user_id:d,grant_permissions:[D]})},I=D=>()=>{r?.updateUserPermissions({user_id:d,revoke_permissions:[D]})},R=()=>{c?r?.unpin(u):r?.pin(u)},A=()=>{r?.pinForEveryone({user_id:d,session_id:u}).catch(D=>{console.error(`Failed to pin participant ${d}`,D)})},B=()=>{r?.unpinForEveryone({user_id:d,session_id:u}).catch(D=>{console.error(`Failed to unpin participant ${d}`,D)})},N=()=>s?document.exitFullscreen().catch(console.error):t?.requestFullscreen().catch(console.error);v.useEffect(()=>{const D=()=>{i(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",D),()=>{document.removeEventListener("fullscreenchange",D)}},[]);const $=()=>n&&!o?n.requestPictureInPicture().catch(console.error):document.exitPictureInPicture().catch(console.error),{close:j}=Io()||{};return b.jsxs(AC,{onItemClick:j,children:[b.jsxs($e,{onClick:R,disabled:c&&!c.isLocalPin,children:[b.jsx(we,{icon:"pin"}),a(c?"Unpin":"Pin")]}),b.jsxs(Qe,{requiredGrants:[q.PIN_FOR_EVERYONE],children:[b.jsxs($e,{onClick:A,disabled:c&&!c.isLocalPin,children:[b.jsx(we,{icon:"pin"}),a("Pin for everyone")]}),b.jsxs($e,{onClick:B,disabled:!c||c.isLocalPin,children:[b.jsx(we,{icon:"pin"}),a("Unpin for everyone")]})]}),b.jsx(Qe,{requiredGrants:[q.BLOCK_USERS],children:b.jsxs($e,{onClick:f,children:[b.jsx(we,{icon:"not-allowed"}),a("Block")]})}),b.jsx(Qe,{requiredGrants:[q.KICK_USER],children:b.jsxs($e,{onClick:g,children:[b.jsx(we,{icon:"kick-user"}),a("Kick")]})}),b.jsxs(Qe,{requiredGrants:[q.MUTE_USERS],children:[l&&b.jsxs($e,{onClick:C,children:[b.jsx(we,{icon:"camera-off-outline"}),a("Turn off video")]}),h&&b.jsxs($e,{onClick:y,children:[b.jsx(we,{icon:"screen-share-off"}),a("Turn off screen share")]}),p&&b.jsxs($e,{onClick:S,children:[b.jsx(we,{icon:"no-audio"}),a("Mute audio")]}),m&&b.jsxs($e,{onClick:T,children:[b.jsx(we,{icon:"no-audio"}),a("Mute screen share audio")]})]}),t&&typeof t.requestFullscreen<"u"&&b.jsx($e,{onClick:N,children:a("{{ direction }} fullscreen",{direction:a(s?"Leave":"Enter")})}),n&&document.pictureInPictureEnabled&&b.jsx($e,{onClick:$,children:a("{{ direction }} picture-in-picture",{direction:a(o?"Leave":"Enter")})}),b.jsxs(Qe,{requiredGrants:[q.UPDATE_CALL_PERMISSIONS],children:[b.jsx($e,{onClick:k(q.SEND_AUDIO),children:a("Allow audio")}),b.jsx($e,{onClick:k(q.SEND_VIDEO),children:a("Allow video")}),b.jsx($e,{onClick:k(q.SCREENSHARE),children:a("Allow screen sharing")}),b.jsx($e,{onClick:I(q.SEND_AUDIO),children:a("Disable audio")}),b.jsx($e,{onClick:I(q.SEND_VIDEO),children:a("Disable video")}),b.jsx($e,{onClick:I(q.SCREENSHARE),children:a("Disable screen sharing")})]})]})},qu=e=>e===null?!1:!v.isValidElement(e),Wu=(e,t)=>{if(e){if(typeof e=="function")return e(t);e.current=t}};v.forwardRef(function({stream:t,...n},s){const[i,r]=v.useState(null);return v.useEffect(()=>{if(!(!i||!t)&&t!==i.srcObject)return i.srcObject=t,(ba.isSafari()||ba.isFirefox())&&setTimeout(()=>{i.srcObject=t,i.play().catch(o=>{console.error("Failed to play stream",o)})},0),()=>{i.pause(),i.srcObject=null}},[t,i]),b.jsx("video",{autoPlay:!0,playsInline:!0,...n,ref:o=>{Wu(s,o),r(o)}})});const Gu=v.forwardRef(function({participant:t,style:n,children:s},i){const[r,o]=v.useState(!1),a=t.name||t.userId;return b.jsxs("div",{className:"str-video__video-placeholder",style:n,ref:i,children:[(!t.image||r)&&(a?b.jsx(NC,{name:a}):b.jsx("div",{className:"str-video__video-placeholder__no-video-label",children:s})),t.image&&!r&&b.jsx("img",{onError:()=>o(!0),alt:a,className:"str-video__video-placeholder__avatar",src:t.image})]})}),NC=e=>{const{name:t}=e,n=t.split(" ").slice(0,2).map(s=>s[0]).join("");return b.jsx("div",{className:"str-video__video-placeholder__initials-fallback",children:n})},LC=v.forwardRef(function(t,n){const{t:s}=Ge();return b.jsx(Gu,{ref:n,...t,children:s("Video is disabled")})}),MC=v.forwardRef(function(t,n){const{t:s}=Ge();return b.jsx(Gu,{ref:n,...t,children:s("Video is playing in a popup")})}),Ku=({enabled:e=!0,mirror:t,trackType:n,participant:s,className:i,VideoPlaceholder:r=LC,PictureInPicturePlaceholder:o=MC,refs:a,...c})=>{const{sessionId:u,videoStream:d,screenShareStream:p,viewportVisibilityState:l,isLocalParticipant:h,userId:m}=s,f=Me(),[g,S]=v.useState(null),[C,y]=v.useState(!0),[T,k]=v.useState(!0),I=Hu(g??void 0),R=n==="videoTrack"?d:n==="screenShareTrack"?p:void 0;if(v.useLayoutEffect(()=>{if(!f||!g||n==="none")return;const D=f.bindVideoElement(g,u,n);return()=>{D?.()}},[f,n,u,g]),v.useEffect(()=>{if(!R||!g)return;const[D]=R.getVideoTracks();if(!D)return;const E=()=>{y(g.paused);const{width:O=0,height:U=0}=D.getSettings();k(O>=U)};return y(g.paused),g.addEventListener("play",E),g.addEventListener("pause",E),D.addEventListener("unmute",E),()=>{g.removeEventListener("play",E),g.removeEventListener("pause",E),D.removeEventListener("unmute",E),y(!0)}},[R,g]),!f)return null;const A=n==="videoTrack"?Ut(s):n==="screenShareTrack"?$t(s):!1,B=n==="none"||l?.[n]===Ee.INVISIBLE,N=!e||!A||B||Nl(s,n),$=t===void 0?h&&n==="videoTrack":t,j=n==="screenShareTrack";return b.jsxs(b.Fragment,{children:[!N&&b.jsx("video",{...c,className:Le("str-video__video",i,{"str-video__video--not-playing":C,"str-video__video--tall":!T,"str-video__video--mirror":$,"str-video__video--screen-share":j}),"data-user-id":m,"data-session-id":u,ref:D=>{S(D),a?.setVideoElement?.(D)}}),I&&o&&b.jsx(o,{style:{position:"absolute"},participant:s}),(N||C)&&r&&b.jsx(r,{style:{position:"absolute"},participant:s,ref:a?.setVideoPlaceholderElement})]})};Ku.displayName="Video";const jC=({trackedElement:e,dynascaleManager:t,sessionId:n,trackType:s})=>{const i=Me(),r=t??i?.dynascaleManager;v.useEffect(()=>{if(!e||!r||!i||s==="none")return;const o=r.trackElementVisibility(e,n,s);return()=>{o()}},[e,r,i,n,s])};v.createContext(void 0);const St=v.forwardRef(function(t,n){const{icon:s,enabled:i,variant:r,onClick:o,className:a,...c}=t;return b.jsx("button",{className:Le("str-video__call-controls__button",a,{[`str-video__call-controls__button--variant-${r}`]:r,"str-video__call-controls__button--enabled":i}),onClick:u=>{u.preventDefault(),o?.(u)},ref:n,...c,children:b.jsx(we,{icon:s})})}),pn=v.forwardRef(function({disabled:t,caption:n,children:s,className:i,active:r,Menu:o,menuPlacement:a,menuOffset:c,title:u,ToggleMenuButton:d=FC,variant:p,onClick:l,onMenuToggle:h,...m},f){return b.jsxs("div",{className:Le("str-video__composite-button",i,{"str-video__composite-button--caption":n,"str-video__composite-button--menu":o}),title:u,ref:f,children:[b.jsxs("div",{className:Le("str-video__composite-button__button-group",{"str-video__composite-button__button-group--active":r,"str-video__composite-button__button-group--active-primary":r&&p==="primary","str-video__composite-button__button-group--active-secondary":r&&p==="secondary","str-video__composite-button__button-group--disabled":t}),children:[b.jsx("button",{type:"button",className:"str-video__composite-button__button",onClick:g=>{g.preventDefault(),l?.(g)},disabled:t,...m,children:s}),o&&b.jsx(Ro,{offset:c,placement:a,ToggleButton:d,onToggle:h,children:qu(o)?b.jsx(o,{}):o})]}),n&&b.jsx("div",{className:"str-video__composite-button__caption",children:n})]})}),FC=v.forwardRef(function({menuShown:t},n){return b.jsx(St,{className:Le("str-video__menu-toggle-button",{"str-video__menu-toggle-button--active":t}),icon:t?"caret-down":"caret-up",ref:n})}),bi=e=>{const{isVisible:t,message:n,children:s,visibilityTimeout:i,resetIsVisible:r,placement:o="top",iconClassName:a="str-video__notification__icon",close:c}=e,{refs:u,x:d,y:p,strategy:l}=Eo({placement:o,strategy:"absolute"});return v.useEffect(()=>{if(!t||!i||!r)return;const h=setTimeout(()=>{r()},i);return()=>clearTimeout(h)},[t,r,i]),b.jsxs("div",{ref:u.setReference,children:[t&&b.jsxs("div",{className:"str-video__notification",ref:u.setFloating,style:{position:l,top:p??0,left:d??0,overflowY:"auto"},children:[a&&b.jsx("i",{className:a}),b.jsx("span",{className:"str-video__notification__message",children:n}),c?b.jsx("i",{className:"str-video__icon str-video__icon--close str-video__notification__close",onClick:c}):null]}),s]})},Po=e=>{const{permission:t,isAwaitingApproval:n,messageApproved:s,messageAwaitingApproval:i,messageRevoked:r,visibilityTimeout:o=3500,children:a}=e,{useHasPermissions:c}=it(),u=c(t),d=v.useRef(u),[p,l]=v.useState();v.useEffect(()=>{d.current!==u&&(u?(l("granted"),d.current=!0):(l("revoked"),d.current=!1))},[u]);const h=v.useCallback(()=>l(void 0),[]);return n?b.jsx(bi,{isVisible:n&&!u,message:i,children:a}):b.jsx(bi,{isVisible:!!p,visibilityTimeout:o,resetIsVisible:h,message:p==="granted"?s:r,children:a})},UC=({children:e,text:t,placement:n})=>{const{useMicrophoneState:s}=it(),{isSpeakingWhileMuted:i}=s(),{t:r}=Ge(),o=t??r("You are muted. Unmute to speak.");return b.jsx(bi,{message:o,isVisible:i,placement:n||"top-start",children:e})},$C=({className:e,type:t="spinner",text:n,tooltip:s})=>b.jsxs("div",{className:Le("str-video__loading-indicator",e),title:s,children:[b.jsx("div",{className:Le("str-video__loading-indicator__icon",t)}),n&&b.jsx("p",{className:"str-video__loading-indicator-text",children:n})]}),VC=({children:e,referenceElement:t,tooltipClassName:n,tooltipPlacement:s="top",visible:i=!1})=>{const r=v.useRef(null),{refs:o,x:a,y:c,strategy:u,context:d}=Eo({placement:s,strategy:"absolute",middleware:[Wy({element:r})]});return v.useEffect(()=>{o.setReference(t)},[t,o]),i?b.jsxs("div",{className:Le("str-video__tooltip",n),ref:o.setFloating,style:{position:u,top:c??0,left:a??0},children:[b.jsx(eC,{ref:r,context:d,fill:"var(--str-video__tooltip--background-color)"}),e]}):null},BC=({onMouseEnter:e,onMouseLeave:t}={})=>{const[n,s]=v.useState(!1),i=v.useCallback(o=>{s(!0),e?.(o)},[e]),r=v.useCallback(o=>{s(!1),t?.(o)},[t]);return{handleMouseEnter:i,handleMouseLeave:r,tooltipVisible:n}},ps=({title:e,tooltipClassName:t,tooltipPlacement:n,tooltipDisabled:s,...i})=>{const{handleMouseEnter:r,handleMouseLeave:o,tooltipVisible:a}=BC(),[c,u]=v.useState(null),d=!s&&!!e&&a;return b.jsxs(b.Fragment,{children:[b.jsx(VC,{referenceElement:c,visible:d,tooltipClassName:t,tooltipPlacement:n,children:e||""}),b.jsx("div",{ref:u,onMouseEnter:r,onMouseLeave:o,...i})]})};v.forwardRef(function(t,n){return b.jsx(pn,{ref:n,active:!0,variant:"secondary","data-testid":"recording-stop-button",children:b.jsx(we,{icon:"recording-off"})})});const HC=({caption:e})=>{const{t}=Ge(),{toggleCallRecording:n,isAwaitingResponse:s,isCallRecordingInProgress:i}=lS();let r=e??t("Record call");return s&&(r=t(i?"Waiting for recording to stop...":"Waiting for recording to start...")),b.jsx(Qe,{requiredGrants:[q.START_RECORD_CALL,q.STOP_RECORD_CALL],children:b.jsx(pn,{active:i,caption:e,variant:"secondary","data-testid":i?"recording-stop-button":"recording-start-button",title:r,onClick:s?void 0:n,children:s?b.jsx($C,{}):b.jsx(we,{icon:i?"recording-on":"recording-off"})})})},Ju={":like:":"👍",":raise-hand:":"✋",":fireworks:":"🎉",":dislike:":"👎",":heart:":"❤️",":smile:":"😀"},qC=({participant:{reaction:e,sessionId:t},hideAfterTimeoutInMs:n=5500,emojiReactionMap:s=Ju})=>{const i=Me();if(v.useEffect(()=>{if(!i||!e)return;const o=setTimeout(()=>{i.resetReaction(t)},n);return()=>{clearTimeout(o)}},[i,n,e,t]),!e)return null;const{emoji_code:r}=e;return b.jsx("div",{className:"str-video__reaction",children:b.jsx("span",{className:"str-video__reaction__emoji",children:r&&s[r]})})},WC=[{type:"reaction",emoji_code:":like:"},{type:"raised-hand",emoji_code:":raise-hand:"},{type:"reaction",emoji_code:":fireworks:"},{type:"reaction",emoji_code:":dislike:"},{type:"reaction",emoji_code:":heart:"},{type:"reaction",emoji_code:":smile:"}],GC=({reactions:e=WC})=>b.jsx(Qe,{requiredGrants:[q.CREATE_REACTION],children:b.jsx(Ro,{placement:"top",ToggleButton:KC,visualType:kn.MENU,children:b.jsx(JC,{reactions:e})})}),KC=v.forwardRef(function({menuShown:t},n){const{t:s}=Ge();return b.jsx(ps,{title:s("Reactions"),tooltipDisabled:t,children:b.jsx(pn,{ref:n,active:t,variant:"primary",children:b.jsx(we,{icon:"reactions"})})})}),JC=({reactions:e,layout:t="horizontal"})=>{const n=Me(),{close:s}=Io();return b.jsx("div",{className:Le("str-video__reactions-menu",{"str-video__reactions-menu--horizontal":t==="horizontal","str-video__reactions-menu--vertical":t==="vertical"}),children:e.map(i=>b.jsx("button",{type:"button",className:"str-video__reactions-menu__button",onClick:()=>{n?.sendReaction(i),s?.()},children:i.emoji_code&&Ju[i.emoji_code]},i.emoji_code))})},xo=(e,t)=>{const n=le(["react-sdk"]);return async()=>{try{await t()}catch(s){if(e.onError){e.onError(s);return}zC(s)||n("error","Call control handler failed",s)}}};function zC(e){return e instanceof DOMException&&e.name==="NotAllowedError"}const YC=e=>{const{t}=Ge(),{caption:n,optimisticUpdates:s}=e,{useHasOngoingScreenShare:i,useScreenShareState:r,useCallSettings:o}=it(),a=i(),{hasPermission:c,requestPermission:u,isAwaitingPermission:d}=_o(q.SCREENSHARE),l=o()?.screensharing.enabled,{screenShare:h,optionsAwareIsMute:m,isTogglePending:f}=r({optimisticUpdates:s}),g=!m,S=!g&&(a||l===!1)||!s&&f,C=xo(e,async()=>{c?await h.toggle():await u()});return b.jsx(Qe,{requiredGrants:[q.SCREENSHARE],children:b.jsx(Po,{permission:q.SCREENSHARE,isAwaitingApproval:d,messageApproved:t("You can now share your screen."),messageAwaitingApproval:t("Awaiting for an approval to share screen."),messageRevoked:t("You can no longer share your screen."),children:b.jsx(ps,{title:n??t("Share screen"),children:b.jsx(pn,{active:a||g,caption:n,variant:"primary","data-testid":a?"screen-share-stop-button":"screen-share-start-button",disabled:S,onClick:C,children:b.jsx(we,{icon:a?"screen-share-on":"screen-share-off"})})})})})},zu=v.createContext({}),XC=e=>{const{children:t,icon:n,defaultSelectedLabel:s,defaultSelectedIndex:i,handleSelect:r}=e,[o,a]=v.useState(!1),[c,u]=v.useState(null),[d,p]=v.useState(i),[l,h]=v.useState(s),{refs:m,context:f}=ju({placement:"bottom-start",open:o,onOpenChange:a,whileElementsMounted:Pu,middleware:[Ou()]}),g=v.useRef([]),S=v.useRef([]),C=v.useCallback(D=>{p(D),r(D||0),a(!1),D!==null&&h(S.current[D])},[r]),y=D=>{o?u(D):C(D)},T=EC(f,{listRef:g,activeIndex:c,selectedIndex:d,onNavigate:u}),k=RC(f,{listRef:S,activeIndex:c,selectedIndex:d,onMatch:y}),I=vC(f),R=CC(f),A=IC(f,{role:"listbox"}),{getReferenceProps:B,getFloatingProps:N,getItemProps:$}=kC([T,k,I,R,A]),j=v.useMemo(()=>({activeIndex:c,selectedIndex:d,getItemProps:$,handleSelect:C}),[c,d,$,C]);return b.jsxs("div",{className:"str-video__dropdown",children:[b.jsxs("div",{className:"str-video__dropdown-selected",ref:m.setReference,tabIndex:0,...B(),children:[b.jsxs("label",{className:"str-video__dropdown-selected__label",children:[n&&b.jsx(we,{className:"str-video__dropdown-selected__icon",icon:n}),l]}),b.jsx(we,{className:"str-video__dropdown-selected__chevron",icon:o?"chevron-up":"chevron-down"})]}),b.jsx(zu.Provider,{value:j,children:o&&b.jsx(pC,{context:f,modal:!1,children:b.jsx("div",{className:"str-video__dropdown-list",ref:m.setFloating,...N(),children:b.jsx(Ky,{elementsRef:g,labelsRef:S,children:t})})})})]})},ZC=e=>{const{selected:t,label:n,icon:s}=e,{getItemProps:i,handleSelect:r}=v.useContext(zu),{ref:o,index:a}=Jy();return b.jsxs("div",{className:Le("str-video__dropdown-option",{"str-video__dropdown-option--selected":t}),ref:o,...i({onClick:()=>r(a)}),children:[s&&b.jsx(we,{className:"str-video__dropdown-icon",icon:s}),b.jsx("span",{className:"str-video__dropdown-label",children:n})]})},QC=e=>{const{children:t,icon:n,handleSelect:s,defaultSelectedLabel:i,defaultSelectedIndex:r}=e;return b.jsx(XC,{icon:n,handleSelect:s,defaultSelectedIndex:r,defaultSelectedLabel:i,children:t})},eT=({disabled:e,id:t,label:n,onChange:s,name:i,selected:r,defaultChecked:o,value:a})=>b.jsxs("label",{className:Le("str-video__device-settings__option",{"str-video__device-settings__option--selected":r,"str-video__device-settings__option--disabled":e}),htmlFor:t,children:[b.jsx("input",{type:"radio",name:i,onChange:s,value:a,id:t,checked:r,defaultChecked:o,disabled:e}),n]}),tT=e=>{const{devices:t=[],selectedDeviceId:n,title:s,type:i,onChange:r}=e,{close:o}=Io(),{deviceList:a}=Vu(t,n);return b.jsxs("div",{className:"str-video__device-settings__device-kind",children:[s&&b.jsx("div",{className:"str-video__device-settings__device-selector-title",children:s}),a.map(c=>b.jsx(eT,{id:`${i}--${c.deviceId}`,value:c.deviceId,label:c.label,onChange:u=>{const d=u.target.value;d!=="default"&&r?.(d),o?.()},name:i,selected:c.isSelected},c.deviceId))]})},nT=e=>{const{devices:t=[],selectedDeviceId:n,title:s,onChange:i,icon:r}=e,{deviceList:o,selectedDeviceInfo:a,selectedIndex:c}=Vu(t,n),u=v.useCallback(d=>{const p=o[d].deviceId;p!=="default"&&i?.(p)},[o,i]);return b.jsxs("div",{className:"str-video__device-settings__device-kind",children:[b.jsx("div",{className:"str-video__device-settings__device-selector-title",children:s}),b.jsx(QC,{icon:r,defaultSelectedIndex:c,defaultSelectedLabel:a.label,handleSelect:u,children:o.map(d=>b.jsx(ZC,{icon:r,label:d.label,selected:d.isSelected},d.deviceId))})]})},Yu=e=>{const{visualType:t="list",icon:n,...s}=e;return t==="list"?b.jsx(tT,{...s}):b.jsx(nT,{...s,icon:n})},sT=({title:e,visualType:t})=>{const{useMicrophoneState:n}=it(),{microphone:s,selectedDevice:i,devices:r}=n();return b.jsx(Yu,{devices:r||[],selectedDeviceId:i,type:"audioinput",onChange:async o=>{await s.select(o)},title:e,visualType:t,icon:"mic"})},iT=({title:e,visualType:t})=>{const{useCameraState:n}=it(),{camera:s,devices:i,selectedDevice:r}=n();return b.jsx(Yu,{devices:i||[],type:"videoinput",selectedDeviceId:r,onChange:async o=>{await s.select(o)},title:e,visualType:t,icon:"camera"})};v.forwardRef(function({menuShown:t},n){const{t:s}=Ge();return b.jsx(St,{className:Le("str-video__device-settings__button",{"str-video__device-settings__button--active":t}),title:s("Toggle device menu"),icon:"device-settings",ref:n})});const rT=e=>{const{t}=Ge(),{caption:n,Menu:s=b.jsx(sT,{visualType:"list"}),menuPlacement:i="top",onMenuToggle:r,optimisticUpdates:o,...a}=e,{hasPermission:c,requestPermission:u,isAwaitingPermission:d}=_o(q.SEND_AUDIO),{useMicrophoneState:p}=it(),{microphone:l,hasBrowserPermission:h,isPromptingPermission:m,isTogglePending:f,optionsAwareIsMute:g}=p({optimisticUpdates:o}),[S,C]=v.useState(!1),y=xo(e,async()=>{c?await l.toggle():await u()});return b.jsx(Qe,{requiredGrants:[q.SEND_AUDIO],children:b.jsx(Po,{permission:q.SEND_AUDIO,isAwaitingApproval:d,messageApproved:t("You can now speak."),messageAwaitingApproval:t("Awaiting for an approval to speak."),messageRevoked:t("You can no longer speak."),children:b.jsx(ps,{title:c?h?n??t("Mic"):t("Check your browser mic permissions"):t("You have no permission to share your audio"),tooltipDisabled:S,children:b.jsxs(pn,{active:g,caption:n,variant:"secondary",disabled:!h||!c||!o&&f,"data-testid":g?"audio-unmute-button":"audio-mute-button",onClick:y,Menu:s,menuPlacement:i,menuOffset:16,...a,onMenuToggle:T=>{C(T),r?.(T)},children:[b.jsx(we,{icon:g?"mic-off":"mic"}),(!h||!c)&&b.jsx("span",{className:"str-video__no-media-permission",children:"!"}),m&&b.jsx("span",{className:"str-video__pending-permission",title:t("Waiting for permission"),children:"?"})]})})})})},oT=e=>{const{t}=Ge(),{caption:n,Menu:s=b.jsx(iT,{visualType:"list"}),menuPlacement:i="top",onMenuToggle:r,optimisticUpdates:o,...a}=e,{hasPermission:c,requestPermission:u,isAwaitingPermission:d}=_o(q.SEND_VIDEO),{useCameraState:p,useCallSettings:l}=it(),{camera:h,optionsAwareIsMute:m,hasBrowserPermission:f,isPromptingPermission:g,isTogglePending:S}=p({optimisticUpdates:o}),y=l()?.video.enabled,[T,k]=v.useState(!1),I=xo(e,async()=>{c?await h.toggle():await u()});return b.jsx(Qe,{requiredGrants:[q.SEND_VIDEO],children:b.jsx(Po,{permission:q.SEND_VIDEO,isAwaitingApproval:d,messageApproved:t("You can now share your video."),messageAwaitingApproval:t("Awaiting for an approval to share your video."),messageRevoked:t("You can no longer share your video."),children:b.jsx(ps,{title:c?f?y?n||t("Video"):t("Video publishing is disabled by the system"):t("Check your browser video permissions"):t("You have no permission to share your video"),tooltipDisabled:T,children:b.jsxs(pn,{active:m,caption:n,variant:"secondary",disabled:!f||!c||!y||!o&&S,"data-testid":m?"video-unmute-button":"video-mute-button",onClick:I,Menu:s,menuPlacement:i,menuOffset:16,...a,onMenuToggle:R=>{k(R),r?.(R)},children:[b.jsx(we,{icon:m?"camera-off":"camera"}),(!f||!c||!y)&&b.jsx("span",{className:"str-video__no-media-permission",children:"!"}),g&&b.jsx("span",{className:"str-video__pending-permission",title:t("Waiting for permission"),children:"?"})]})})})})};v.forwardRef(function({menuShown:t},n){const{t:s}=Ge();return b.jsx(ps,{title:s("Leave call"),tooltipDisabled:t,children:b.jsx(St,{icon:t?"close":"call-end",variant:t?"active":"danger","data-testid":"leave-call-button",ref:n})})});const aT=({disabled:e,caption:t,onClick:n,onLeave:s})=>{const i=Me(),{t:r}=Ge(),o=v.useCallback(async a=>{n?n(a):i&&(await i.leave(),s?.())},[n,s,i]);return b.jsx(St,{disabled:e,icon:"call-end",variant:"danger",title:t??r("Leave call"),"data-testid":"cancel-call-button",onClick:o})},cT=({onLeave:e})=>b.jsxs("div",{className:"str-video__call-controls",children:[b.jsx(Qe,{requiredGrants:[q.SEND_AUDIO],children:b.jsx(UC,{children:b.jsx(rT,{})})}),b.jsx(Qe,{requiredGrants:[q.SEND_VIDEO],children:b.jsx(oT,{})}),b.jsx(Qe,{requiredGrants:[q.CREATE_REACTION],children:b.jsx(GC,{})}),b.jsx(Qe,{requiredGrants:[q.SCREENSHARE],children:b.jsx(YC,{})}),b.jsx(Qe,{requiredGrants:[q.START_RECORD_CALL,q.STOP_RECORD_CALL],children:b.jsx(HC,{})}),b.jsx(aT,{onLeave:e})]});v.lazy(()=>td(()=>import("./latency-chart-Bj5OSYzg.es-BSmZYl0D.js"),__vite__mapDeps([0,1,2])));var rc;(function(e){e.GOOD="Good",e.OK="Ok",e.BAD="Bad"})(rc||(rc={}));v.forwardRef(function(t,n){const{t:s}=Ge(),{caption:i,menuShown:r}=t;return b.jsx(pn,{ref:n,active:r,caption:i,title:i||s("Statistics"),"data-testid":"stats-button",children:b.jsx(we,{icon:"stats"})})});v.forwardRef(function(t,n){return b.jsx(St,{enabled:t.menuShown,icon:"ellipsis",ref:n})});v.forwardRef(function(t,n){return b.jsx(St,{enabled:t.menuShown,icon:"filter",ref:n})});v.createContext(null);L.JOINING+"",L.RINGING+"",L.MIGRATING+"",L.RECONNECTING+"",L.RECONNECTING_FAILED+"",L.OFFLINE+"",L.IDLE+"",L.UNKNOWN+"",L.JOINED+"",L.LEFT+"";v.forwardRef(function(t,n){const{permissionRequests:s,handleUpdatePermission:i,...r}=t,{t:o}=Ge();return b.jsx("div",{className:"str-video__permission-requests-list",ref:n,...r,children:s.map((a,c)=>{const{user:u,permissions:d}=a;return b.jsx(v.Fragment,{children:d.map(p=>b.jsxs("div",{className:"str-video__permission-request",children:[b.jsx("div",{className:"str-video__permission-request__message",children:lT(u.name||u.id,p,o)}),b.jsx(hr,{className:"str-video__permission-request__button--allow",type:"button",onClick:i(a,"grant"),children:o("Allow")}),b.jsx(hr,{className:"str-video__permission-request__button--reject",type:"button",onClick:i(a,"revoke"),children:o("Revoke")}),b.jsx(hr,{className:"str-video__permission-request__button--reject",type:"button",onClick:i(a,"dismiss"),children:o("Dismiss")})]},p))},`${u.id}/${c}`)})})});const hr=e=>{const{className:t,...n}=e;return b.jsx("button",{className:Le("str-video__permission-request__button",t),...n})},lT=(e,t,n)=>{switch(t){case q.SEND_AUDIO:return n("{{ userName }} is requesting to speak",{userName:e});case q.SEND_VIDEO:return n("{{ userName }} is requesting to share their camera",{userName:e});case q.SCREENSHARE:return n("{{ userName }} is requesting to present their screen",{userName:e});default:return n("{{ userName }} is requesting permission: {{ permission }}",{userName:e,permission:t})}},uT=({as:e="div",className:t,children:n,...s})=>b.jsx(e,{...s,className:Le("str-video",t),children:n}),dT=v.forwardRef(function(t,n){return b.jsx(St,{enabled:t.menuShown,icon:"ellipsis",ref:n})}),hT=()=>{const e=Me(),{t}=Ge(),n=()=>{e?.screenShare.disable().catch(s=>{console.error("Failed to stop screen sharing:",s)})};return b.jsxs("div",{className:"str-video__screen-share-overlay",children:[b.jsx(we,{icon:"screen-share-off"}),b.jsx("span",{className:"str-video__screen-share-overlay__title",children:t("You are presenting your screen")}),b.jsxs("button",{onClick:n,type:"button",className:"str-video__screen-share-overlay__button",children:[b.jsx(we,{icon:"close"})," ",t("Stop Screen Sharing")]})]})},Oo=({indicatorsVisible:e=!0,menuPlacement:t="bottom-start",showMenuButton:n=!0,ParticipantActionsContextMenu:s=DC})=>{const{participant:i,trackType:r}=Bi(),o=$t(i);return i.isLocalParticipant&&o&&r==="screenShareTrack"?b.jsxs(b.Fragment,{children:[b.jsx(hT,{}),b.jsx(oc,{indicatorsVisible:e})]}):b.jsxs(b.Fragment,{children:[n&&b.jsx(Ro,{strategy:"fixed",placement:t,ToggleButton:dT,children:b.jsx(s,{})}),b.jsx(qC,{participant:i}),b.jsx(oc,{indicatorsVisible:e})]})},oc=({indicatorsVisible:e=!0})=>{const{participant:t,trackType:n}=Bi(),{isLocalParticipant:s,connectionQuality:i,pin:r,sessionId:o,name:a,userId:c}=t,u=Me(),{t:d}=Ge(),p=!!i&&Er.ConnectionQuality[i].toLowerCase(),l=cn(t),h=Ut(t),m=!!r&&r.isLocalPin,f=n!=="none"?Nl(t,n):!1;return b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"str-video__participant-details",children:b.jsxs("span",{className:"str-video__participant-details__name",children:[a||c,e&&!l&&b.jsx("span",{className:"str-video__participant-details__name--audio-muted"}),e&&!h&&b.jsx("span",{className:"str-video__participant-details__name--video-muted"}),e&&f&&b.jsx("span",{title:d("Video paused due to insufficient bandwidth"),className:"str-video__participant-details__name--track-paused"}),e&&m&&b.jsx("span",{title:d("Unpin"),onClick:()=>u?.unpin(o),className:"str-video__participant-details__name--pinned"}),e&&b.jsx(fT,{})]})}),e&&b.jsx(bi,{isVisible:s&&i===Er.ConnectionQuality.POOR,message:d("Poor connection quality"),children:p&&b.jsx("span",{className:Le("str-video__participant-details__connection-quality",`str-video__participant-details__connection-quality--${p}`),title:p})})]})},fT=()=>{const{participant:e}=Bi(),{isSpeaking:t,isDominantSpeaker:n}=e;return b.jsxs("span",{className:Le("str-video__speech-indicator",t&&"str-video__speech-indicator--speaking",n&&"str-video__speech-indicator--dominant"),children:[b.jsx("span",{className:"str-video__speech-indicator__bar"}),b.jsx("span",{className:"str-video__speech-indicator__bar"}),b.jsx("span",{className:"str-video__speech-indicator__bar"})]})},$s=v.forwardRef(function({participant:t,trackType:n="videoTrack",mirror:s,muteAudio:i,refs:{setVideoElement:r,setVideoPlaceholderElement:o}={},className:a,VideoPlaceholder:c,PictureInPicturePlaceholder:u,ParticipantViewUI:d=Oo},p){const{isLocalParticipant:l,isSpeaking:h,isDominantSpeaker:m,sessionId:f}=t,g=cn(t),S=Ut(t),C=ki(t),[y,T]=v.useState(null),[k,I]=v.useState(null),[R,A]=v.useState(null);jC({sessionId:f,trackedElement:y,trackType:n});const{useIncomingVideoSettings:B}=it(),{isParticipantVideoEnabled:N}=B(),$=v.useMemo(()=>({participant:t,participantViewElement:y,videoElement:k,videoPlaceholderElement:R,trackType:n}),[k,R,t,y,n]),j=v.useMemo(()=>({setVideoElement:D=>{r?.(D),I(D)},setVideoPlaceholderElement:D=>{o?.(D),A(D)}}),[r,o]);return b.jsx("div",{"data-testid":"participant-view",ref:D=>{Wu(p,D),T(D)},className:Le("str-video__participant-view",m&&"str-video__participant-view--dominant-speaker",h&&"str-video__participant-view--speaking",!S&&"str-video__participant-view--no-video",!g&&"str-video__participant-view--no-audio",a),children:b.jsxs(Uu.Provider,{value:$,children:[!l&&!i&&b.jsxs(b.Fragment,{children:[g&&b.jsx(is,{participant:t,trackType:"audioTrack"}),C&&b.jsx(is,{participant:t,trackType:"screenShareAudioTrack"})]}),b.jsx(Ku,{VideoPlaceholder:c,PictureInPicturePlaceholder:u,participant:t,trackType:n,refs:j,enabled:l||n!=="videoTrack"||N(t.sessionId),mirror:s,autoPlay:!0}),qu(d)?b.jsx(d,{}):d]})})});$s.displayName="ParticipantView";const Xu=vv;Xu.displayName="StreamCall";var pT="Joining",mT="Mic",gT="Ringing",bT="Speakers",vT="Video",ST="Live",yT="Reactions",CT="Statistics",TT="Invite",kT="Join",wT="You",ET="Me",_T="Unknown",IT="Default",RT="Refresh",PT="Allow",xT="Revoke",OT="Dismiss",AT="Pinned",DT="Unpin",NT="Pin",LT="Block",MT="Kick",jT="Enter",FT="Leave",UT="Participants",$T=", and ({{ count }}) anonymous",VT={Joining:pT,Mic:mT,"No internet connection":"No internet connection","Re-connecting":"Re-connecting",Ringing:gT,"Screen Share":"Screen Share","Select a Camera":"Select a Camera","Select a Mic":"Select a Mic","Select Speakers":"Select Speakers",Speakers:bT,Video:vT,"You are muted. Unmute to speak.":"You are muted. Unmute to speak.",Live:ST,"Livestream starts soon":"Livestream starts soon","Livestream starts at {{ startsAt }}":"Livestream starts at {{ startsAt, datetime }}","{{ count }} participants joined early_one":"{{ count }} participant joined early","{{ count }} participants joined early_other":"{{ count }} participants joined early","You can now speak.":"You can now speak.","Awaiting for an approval to speak.":"Awaiting for an approval to speak.","You can no longer speak.":"You can no longer speak.","You can now share your video.":"You can now share your video.","Awaiting for an approval to share your video.":"Awaiting for an approval to share your video.","You can no longer share your video.":"You can no longer share your video.","Waiting for recording to stop...":"Waiting for recording to stop...","Waiting for recording to start...":"Waiting for recording to start...","Record call":"Record call",Reactions:yT,Statistics:CT,"You can now share your screen.":"You can now share your screen.","Awaiting for an approval to share screen.":"Awaiting for an approval to share screen.","You can no longer share your screen.":"You can no longer share your screen.","Share screen":"Share screen","Incoming Call...":"Incoming Call...","Calling...":"Calling...","Mute All":"Mute All",Invite:TT,Join:kT,You:wT,Me:ET,Unknown:_T,"Toggle device menu":"Toggle device menu",Default:IT,"Call Recordings":"Call Recordings",Refresh:RT,"Check your browser video permissions":"Check your browser video permissions","Video publishing is disabled by the system":"Video publishing is disabled by the system","You have no permission to share your video":"You have no permission to share your video","You have no permission to share your audio":"You have no permission to share your audio","You are presenting your screen":"You are presenting your screen","Stop Screen Sharing":"Stop Screen Sharing",Allow:PT,Revoke:xT,Dismiss:OT,"Microphone on":"Microphone on","Microphone off":"Microphone off","Camera on":"Camera on","Camera off":"Camera off","No camera found":"No camera found","Video is disabled":"Video is disabled",Pinned:AT,Unpin:DT,Pin:NT,"Pin for everyone":"Pin for everyone","Unpin for everyone":"Unpin for everyone",Block:LT,Kick:MT,"Turn off video":"Turn off video","Turn off screen share":"Turn off screen share","Mute audio":"Mute audio","Mute screen share audio":"Mute screen share audio","Allow audio":"Allow audio","Allow video":"Allow video","Allow screen sharing":"Allow screen sharing","Disable audio":"Disable audio","Disable video":"Disable video","Disable screen sharing":"Disable screen sharing",Enter:jT,Leave:FT,"Leave call":"Leave call","End call for all":"End call for all","{{ direction }} fullscreen":"{{ direction }} fullscreen","{{ direction }} picture-in-picture":"{{ direction }} picture-in-picture","Dominant Speaker":"Dominant Speaker","Poor connection quality":"Poor connection quality. Please check your internet connection.","Video paused due to insufficient bandwidth":"Video paused due to insufficient bandwidth",Participants:UT,Anonymous:$T,"No participants found":"No participants found","Participants ({{ numberOfParticipants }})":"Participants ({{ numberOfParticipants }})","{{ userName }} is sharing their screen":"{{ userName }} is sharing their screen","{{ userName }} is requesting to speak":"{{ userName }} is requesting to speak","{{ userName }} is requesting to share their camera":"{{ userName }} is requesting to share their camera","{{ userName }} is requesting to present their screen":"{{ userName }} is requesting to present their screen","{{ userName }} is requesting permission: {{ permission }}":"{{ userName }} is requesting permission: {{ permission }}"};const BT={en:VT},Zu=e=>b.jsx(wv,{translationsOverrides:BT,...e});Zu.displayName="StreamVideo";function Vs(e,t){return"$and"in t?t.$and.every(n=>Vs(e,n)):"$or"in t?t.$or.some(n=>Vs(e,n)):"$not"in t?!Vs(e,t.$not):HT(e,t)}const gn=e=>typeof e=="string"&&/^((?:(\d{4}-\d{2}-\d{2})T(\d{2}:\d{2}:\d{2}(?:\.\d+)?))(Z|[+-]\d{2}:\d{2})?)$/.test(e);function HT(e,t){let n=!0;for(const s of Object.keys(t)){const i=t[s],r=i&&typeof i=="object";let o=e[s];if(o instanceof Date?o=o.getTime():gn(o)&&(o=new Date(o).getTime()),r&&"$eq"in i){const a=i,c=gn(a.$eq)?new Date(a.$eq).getTime():a.$eq;n&&(n=c===o)}else if(r&&"$neq"in i)n&&(n=i.$neq!==o);else if(r&&"$in"in i)n&&(n=i.$in.includes(o));else if(r&&"$contains"in i)if(Array.isArray(o)){const a=i;n&&(n=o.includes(a.$contains))}else n=!1;else if(r&&"$gt"in i){const a=i,c=gn(a.$gt)?new Date(a.$gt).getTime():a.$gt;n&&(n=o>c)}else if(r&&"$gte"in i){const a=i,c=gn(a.$gte)?new Date(a.$gte).getTime():a.$gte;n&&(n=o>=c)}else if(r&&"$lt"in i){const a=i,c=gn(a.$lt)?new Date(a.$lt).getTime():a.$lt;n&&(n=o<c)}else if(r&&"$lte"in i){const a=i,c=gn(a.$lte)?new Date(a.$lte).getTime():a.$lte;n&&(n=o<=c)}else n&&(n=i===o);if(!n)return!1}return!0}const qT=({excludeLocalParticipant:e=!1,filterParticipants:t})=>{const{useParticipants:n,useRemoteParticipants:s}=it(),i=n(),r=s();return v.useMemo(()=>{const o=e?r:i;return t?WT(o,t):o},[i,r,e,t])},WT=(e,t)=>{const n=typeof t=="function"?t:s=>Vs({userId:s.userId,isSpeaking:s.isSpeaking,isDominantSpeaker:s.isDominantSpeaker,name:s.name,roles:s.roles,isPinned:Eg(s),hasVideo:Ut(s),hasAudio:cn(s)},t);return e.filter(n)},GT=(e,t)=>{v.useEffect(()=>{if(e)return t?e.setSortParticipantsBy(Ft(ro,zT)):e.setSortParticipantsBy(Pg),()=>{JT(e)}},[e,t])},KT=()=>{const{useRawParticipants:e}=it(),t=e();return v.useMemo(()=>t.filter(n=>!n.isLocalParticipant),[t])},JT=e=>{const t=Vl.get(e.type);e.setSortParticipantsBy(t.options.sortParticipantsBy||es)},zT=(e,t)=>e.isLocalParticipant?1:t.isLocalParticipant?-1:0,YT=(e,t,n)=>{const[s,i]=v.useState({vertical:typeof n=="number"?n:null,horizontal:typeof n=="number"?n:null});return v.useEffect(()=>{if(!t||!e||typeof n=="number"||typeof n>"u")return;let r=null,o=null;const a=new ResizeObserver((c,u)=>{if(c.length>1){const l=t.firstChild;l&&(o=l.clientHeight,r=l.clientWidth,u.unobserve(t))}if(o===null||r===null)return;const d=Math.floor(e.clientHeight/o),p=Math.floor(e.clientWidth/r);i(l=>l.vertical!==d||l.horizontal!==p?{vertical:d,horizontal:p}:l)});return a.observe(e),a.observe(t),()=>{a.disconnect()}},[t,n,e]),s},XT=()=>b.jsx(Oo,{menuPlacement:"top-end"}),Qu=({ParticipantViewUIBar:e=XT,ParticipantViewUISpotlight:t=Oo,VideoPlaceholder:n,PictureInPicturePlaceholder:s,participantsBarPosition:i="bottom",participantsBarLimit:r,mirrorLocalParticipantVideo:o=!0,excludeLocalParticipant:a=!1,filterParticipants:c,pageArrowsVisible:u=!0,muted:d})=>{const p=Me(),{useParticipants:l}=it(),h=l(),m=KT(),[f,...g]=qT({excludeLocalParticipant:a,filterParticipants:c}),[S,C]=v.useState(null),[y,T]=v.useState(null),[k,I]=v.useState(null),R=f&&$t(f),A=YT(k,y,r),B=i==="left"||i==="right",N=i==="top"||i==="bottom";v.useEffect(()=>{if(!S||!p)return;const U=p.setViewport(S);return()=>U()},[S,p]);const $=h.length===2;GT(p,$);let j=g;const D=B?A.vertical:A.horizontal;typeof r<"u"&&D!==null&&(j=g.slice(0,D-(R?1:0)));const E=o?void 0:!1;if(!p)return null;const O=i&&(j.length>0||R);return b.jsxs("div",{className:"str-video__speaker-layout__wrapper",children:[!d&&b.jsx(Fu,{participants:m}),b.jsxs("div",{className:Le("str-video__speaker-layout",i&&`str-video__speaker-layout--variant-${i}`),children:[b.jsx("div",{className:"str-video__speaker-layout__spotlight",children:f&&b.jsx($s,{participant:f,muteAudio:!0,mirror:E,trackType:R?"screenShareTrack":"videoTrack",ParticipantViewUI:t,VideoPlaceholder:n,PictureInPicturePlaceholder:s})}),O&&b.jsxs("div",{ref:I,className:"str-video__speaker-layout__participants-bar-buttons-wrapper",children:[b.jsx("div",{className:"str-video__speaker-layout__participants-bar-wrapper",ref:C,children:b.jsxs("div",{ref:T,className:"str-video__speaker-layout__participants-bar",children:[R&&b.jsx("div",{className:"str-video__speaker-layout__participant-tile",children:b.jsx($s,{participant:f,ParticipantViewUI:e,VideoPlaceholder:n,PictureInPicturePlaceholder:s,mirror:E,muteAudio:!0})},f.sessionId),j.map(U=>b.jsx("div",{className:"str-video__speaker-layout__participant-tile",children:b.jsx($s,{participant:U,ParticipantViewUI:e,VideoPlaceholder:n,PictureInPicturePlaceholder:s,mirror:E,muteAudio:!0})},U.sessionId))]})}),u&&B&&b.jsx(QT,{scrollWrapper:S}),u&&N&&b.jsx(ZT,{scrollWrapper:S})]})]})]})};Qu.displayName="SpeakerLayout";const ZT=({scrollWrapper:e})=>{const t=xC(e),n=()=>{e?.scrollBy({left:-150,behavior:"smooth"})},s=()=>{e?.scrollBy({left:150,behavior:"smooth"})};return b.jsxs(b.Fragment,{children:[t&&t!=="start"&&b.jsx(St,{onClick:n,icon:"caret-left",className:"str-video__speaker-layout__participants-bar--button-left"}),t&&t!=="end"&&b.jsx(St,{onClick:s,icon:"caret-right",className:"str-video__speaker-layout__participants-bar--button-right"})]})},QT=({scrollWrapper:e})=>{const t=PC(e),n=()=>{e?.scrollBy({top:-150,behavior:"smooth"})},s=()=>{e?.scrollBy({top:150,behavior:"smooth"})};return b.jsxs(b.Fragment,{children:[t&&t!=="top"&&b.jsx(St,{onClick:n,icon:"caret-up",className:"str-video__speaker-layout__participants-bar--button-top"}),t&&t!=="bottom"&&b.jsx(St,{onClick:s,icon:"caret-down",className:"str-video__speaker-layout__participants-bar--button-bottom"})]})},[ek,tk,nk]="1.23.1".split(".");Fg({type:Er.SdkType.REACT,major:ek,minor:tk,patch:nk});function sk(){const e=nd(),{useCallCallingState:t}=it();return t()===L.LEFT?e("/"):b.jsxs(uT,{children:[b.jsx(Qu,{}),b.jsx(cT,{})]})}const ik="eqc5p9dfwz7p";function hk(){const{id:e}=sd(),[t,n]=v.useState(null),[s,i]=v.useState(null),r=JSON.parse(localStorage.getItem("user")),[o,a]=v.useState(!0),{data:c}=rd({queryKey:["streamToken"],queryFn:ad});return v.useEffect(()=>{async function u(){if(c?.token)try{const d={id:r?._id,name:r?.fullName,image:r?.profilePic},p=new qt({apiKey:ik,user:d,token:c?.token}),l=p.call("default",e);await l.join({create:!0}),n(p),i(l)}catch(d){console.log("Error in initializing call",d),toast.error("Could not connect to call. Please try again")}finally{a(!1)}}u()},[c,r,e]),o?b.jsx(id,{}):b.jsxs("div",{className:"",children:[" className=",pd.videoCallContainer,t&&s?b.jsx(Zu,{client:t,children:b.jsx(Xu,{call:s,children:b.jsx(sk,{})})}):b.jsx("p",{children:"Could not connect please try again"})]})}export{hk as default};
